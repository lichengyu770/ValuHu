# 多页开发实施方案

## 1. 项目分析

### 1.1 当前项目结构

- 基于 Vite + React + Ant Design 的单页应用
- 使用 React Router 进行客户端路由
- 根目录存在多个 HTML 文件（index.html, user-center.html, product-services.html 等）
- 缺少 Vite 配置文件进行多页开发配置

### 1.2 多页开发需求

- 支持多个 HTML 入口文件
- 每个 HTML 文件独立构建
- 保持 React 组件的复用性
- 支持开发环境和生产环境构建

## 2. 技术方案

### 2.1 Vite 多页配置

创建 `vite.config.js` 文件，配置多页开发支持：

- 使用 `rollupOptions.input` 配置多个入口文件
- 确保每个 HTML 文件都能正确引用对应的 JavaScript 模块
- 配置静态资源处理

### 2.2 项目结构优化

- 将根目录下的 HTML 文件保持不变
- 确保每个 HTML 文件都能正确加载 React 应用
- 统一 React 组件的引用路径

### 2.3 构建流程

- 使用 `npm run build` 命令构建所有页面
- 输出文件保持原有目录结构
- 支持开发环境热更新

## 3. 实施步骤

### 3.1 创建 Vite 配置文件

创建 `vite.config.js` 文件，配置多页入口：

```javascript
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';

// 导入所有 HTML 文件作为入口
import fs from 'fs';
import path from 'path';

// 获取所有 HTML 文件
const htmlFiles = fs
  .readdirSync('.')
  .filter((file) => file.endsWith('.html'))
  .map((file) => ({
    [file.replace('.html', '')]: path.resolve(__dirname, file),
  }))
  .reduce((acc, curr) => ({ ...acc, ...curr }), {});

export default defineConfig({
  plugins: [react()],
  build: {
    rollupOptions: {
      input: {
        ...htmlFiles,
      },
      output: {
        dir: 'dist',
        entryFileNames: '[name].js',
        chunkFileNames: 'assets/[name]-[hash].js',
        assetFileNames: 'assets/[name]-[hash].[ext]',
      },
    },
  },
});
```

### 3.2 优化 HTML 文件

- 确保所有 HTML 文件都有正确的 `<!DOCTYPE html>` 声明
- 确保所有 HTML 文件都引用了正确的 JavaScript 入口
- 统一所有 HTML 文件的基础结构

### 3.3 测试构建流程

- 运行 `npm run build` 测试多页构建
- 检查生成的文件结构
- 验证所有页面都能正常访问

### 3.4 开发环境配置

- 确保开发服务器能正确处理多页请求
- 配置开发环境的路由处理
- 测试热更新功能

## 4. 预期效果

### 4.1 构建输出

```
dist/
├── index.html
├── index.js
├── user-center.html
├── user-center.js
├── product-services.html
├── product-services.js
└── assets/
    ├── style-123456.css
    └── vendor-7890ab.js
```

### 4.2 开发体验

- 支持多页热更新
- 每个页面独立开发
- 共享 React 组件和工具函数
- 保持原有项目结构不变

## 5. 注意事项

### 5.1 路径处理

- 确保所有资源引用使用相对路径
- 统一静态资源的引用方式
- 处理好 React Router 与多页的关系

### 5.2 性能优化

- 配置代码分割
- 优化共享模块的打包
- 确保资源按需加载

### 5.3 兼容性

- 确保所有页面都支持现代浏览器
- 配置 Babel 转译
- 支持 IE 11 等旧浏览器（可选）

## 6. 实施风险

### 6.1 依赖冲突

- 确保所有页面使用相同版本的依赖
- 统一依赖管理

### 6.2 路由冲突

- 处理好客户端路由与多页的关系
- 确保路由配置正确

### 6.3 构建错误

- 处理好 HTML 语法错误
- 确保所有入口文件都能正确构建

## 7. 验证标准

### 7.1 构建成功

- 运行 `npm run build` 无错误
- 所有 HTML 文件都能正确生成
- 所有资源文件都能正确引用

### 7.2 页面访问

- 所有页面都能正常访问
- React 应用能正确加载
- 路由功能正常工作

### 7.3 开发体验

- 开发服务器正常启动
- 热更新功能正常工作
- 代码修改能即时反映在浏览器中

## 8. 后续优化

### 8.1 自动化配置

- 自动检测 HTML 文件变化
- 自动更新 Vite 配置

### 8.2 性能监控

- 添加构建性能监控
- 优化构建时间

### 8.3 部署优化

- 配置 CDN 支持
- 优化部署流程

通过以上方案，我们可以实现基于 Vite 的多页开发，保持原有项目结构不变，同时支持多个 HTML 入口文件的独立构建和开发。
