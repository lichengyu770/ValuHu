# 房产估价系统API接口实现计划

## 一、数据库扩展

1. **添加`valuation_results`表** - 存储估价结果
2. **添加`valuation_params`表** - 存储估价参数
3. **添加`valuation_reports`表** - 存储估价报告
4. **添加`uploaded_files`表** - 存储上传的文件
5. **添加`map_geocoding`表** - 存储地图地理编码缓存

## 二、API接口实现

### 1. 房产估价接口

- `POST /api/valuation` - 执行房产估价
- `GET /api/valuation/{id}` - 获取估价结果详情
- `GET /api/valuation/history` - 获取估价历史记录
- `GET /api/valuation/methods` - 获取支持的估价方法

### 2. 估价报告接口

- `POST /api/reports` - 生成估价报告
- `GET /api/reports/{id}` - 获取估价报告详情
- `GET /api/reports/{id}/download` - 下载估价报告
- `DELETE /api/reports/{id}` - 删除估价报告

### 3. 房源信息接口

（已部分实现，需要扩展）

- `GET /api/properties/search` - 高级搜索房源
- `GET /api/properties/{id}/valuation` - 获取房源估价记录

### 4. 用户接口

- `GET /api/users/{id}` - 获取用户信息
- `PUT /api/users/{id}` - 更新用户信息
- `GET /api/users/{id}/valuation-history` - 获取用户估价历史

### 5. 文件上传接口

- `POST /api/upload` - 上传文件
- `GET /api/upload/{id}` - 获取文件信息
- `DELETE /api/upload/{id}` - 删除文件
- `GET /api/upload/{id}/download` - 下载文件

### 6. 地图辅助接口

- `GET /api/map/geocode` - 地理编码（地址转坐标）
- `GET /api/map/reverse-geocode` - 逆地理编码（坐标转地址）
- `GET /api/map/nearby-facilities` - 获取周边设施

## 三、实现步骤

1. **扩展数据库结构** - 更新`db.js`文件，添加新表
2. **实现API接口** - 更新`server.js`文件，添加新的路由和处理函数
3. **测试API接口** - 使用Postman或其他工具测试接口功能
4. **更新前端服务** - 确保前端服务使用新的API接口

## 四、技术要点

1. 使用SQLite数据库存储数据
2. 实现文件上传和下载功能
3. 实现地理编码和逆地理编码功能
4. 实现估价报告生成和下载功能
5. 实现估价历史记录功能
6. 确保API接口的安全性和可靠性

## 五、预期成果

- 完整的房产估价API接口
- 支持多种估价方法
- 支持估价报告生成和下载
- 支持文件上传和管理
- 支持地图辅助功能
- 支持用户管理和估价历史记录

这个计划将帮助我们构建一个完整的房产估价系统API，支持前端应用的所有功能需求。