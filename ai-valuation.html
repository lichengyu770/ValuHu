<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>AIå¿«é€Ÿä¼°ä»·- ValuHub</title>
    <meta content="width=device-width, initial-scale=1, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0" name="viewport"/>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
    <!-- TinyMCEå¯Œæ–‡æœ¬ç¼–è¾‘å™¨ -->
    <script src="https://cdn.tiny.cloud/1/no-api-key/tinymce/6/tinymce.min.js" referrerpolicy="origin"></script>
    <!-- æŠ¥å‘Šç”Ÿæˆç›¸å…³åº“ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    
    <!-- å¼•å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- å¼•å…¥ Chart.js -->
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        
        <!-- Tailwind é…ç½® -->
        <script>
            tailwind.config = {
                theme: {
                    extend: {
                        colors: {
                            primary: '#0056b3',
                            secondary: '#6ea8fe',
                            accent: '#667eea',
                            success: '#52c41a',
                            warning: '#faad14',
                            danger: '#f5222d',
                            dark: '#1a1a1a',
                            light: '#f5f7fa'
                        },
                        fontFamily: {
                            sans: ['Inter', 'system-ui', 'sans-serif'],
                        },
                    }
                }
            }
        </script>
        
        <!-- è¡¨å•å®æ—¶éªŒè¯å’Œæœ¬åœ°å­˜å‚¨ -->
        <script>
            // è¡¨å•å®æ—¶éªŒè¯
            document.addEventListener('DOMContentLoaded', function() {
                const form = document.getElementById('valuation-form');
                
                // åŠ è½½æœ¬åœ°å­˜å‚¨çš„è¡¨å•æ•°æ®
                loadFormData();
                
                // å®æ—¶éªŒè¯
                form.addEventListener('input', function(e) {
                    const field = e.target;
                    validateField(field);
                    saveFormData();
                });
                
                // è¡¨å•æäº¤éªŒè¯
                form.addEventListener('submit', function(e) {
                    let isValid = true;
                    const fields = form.querySelectorAll('input, select, textarea');
                    
                    fields.forEach(field => {
                        if (!validateField(field)) {
                            isValid = false;
                        }
                    });
                    
                    if (!isValid) {
                        e.preventDefault();
                        showToast('è¯·æ£€æŸ¥å¹¶ä¿®æ­£è¡¨å•ä¸­çš„é”™è¯¯', 'error');
                    }
                });
                
                // éªŒè¯å•ä¸ªå­—æ®µ
                function validateField(field) {
                    const value = field.value.trim();
                    const errorElement = field.nextElementSibling;
                    
                    // æ¸…é™¤ä¹‹å‰çš„é”™è¯¯ä¿¡æ¯
                    if (errorElement && errorElement.classList.contains('error-message')) {
                        errorElement.remove();
                    }
                    
                    // æ£€æŸ¥å¿…å¡«å­—æ®µ
                    if (field.hasAttribute('required') && !value) {
                        showFieldError(field, 'æ­¤å­—æ®µä¸ºå¿…å¡«é¡¹');
                        return false;
                    }
                    
                    // æ£€æŸ¥æ•°å­—èŒƒå›´
                    if (field.type === 'number') {
                        const min = parseFloat(field.min);
                        const max = parseFloat(field.max);
                        const valueNum = parseFloat(value);
                        
                        if (!isNaN(min) && valueNum < min) {
                            showFieldError(field, `æ•°å€¼ä¸èƒ½å°äº ${min}`);
                            return false;
                        }
                        
                        if (!isNaN(max) && valueNum > max) {
                            showFieldError(field, `æ•°å€¼ä¸èƒ½å¤§äº ${max}`);
                            return false;
                        }
                    }
                    
                    // æ·»åŠ éªŒè¯é€šè¿‡æ ·å¼
                    field.classList.remove('border-danger');
                    field.classList.add('border-success');
                    
                    return true;
                }
                
                // æ˜¾ç¤ºå­—æ®µé”™è¯¯ä¿¡æ¯
                function showFieldError(field, message) {
                    const errorDiv = document.createElement('div');
                    errorDiv.className = 'error-message text-danger text-xs mt-1';
                    errorDiv.textContent = message;
                    field.parentNode.appendChild(errorDiv);
                    field.classList.remove('border-success');
                    field.classList.add('border-danger');
                }
                
                // ä¿å­˜è¡¨å•æ•°æ®åˆ°æœ¬åœ°å­˜å‚¨
                function saveFormData() {
                    const formData = new FormData(form);
                    const data = {};
                    
                    for (const [key, value] of formData.entries()) {
                        data[key] = value;
                    }
                    
                    localStorage.setItem('valuationFormData', JSON.stringify(data));
                }
                
                // ä»æœ¬åœ°å­˜å‚¨åŠ è½½è¡¨å•æ•°æ®
                function loadFormData() {
                    const savedData = localStorage.getItem('valuationFormData');
                    if (savedData) {
                        const data = JSON.parse(savedData);
                        
                        for (const [key, value] of Object.entries(data)) {
                            const field = form.querySelector(`[name="${key}"]`);
                            if (field) {
                                field.value = value;
                            }
                        }
                    }
                }
                
                // æ˜¾ç¤ºæç¤ºä¿¡æ¯
                function showToast(message, type = 'info') {
                    // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨toastå…ƒç´ 
                    let toast = document.querySelector('.toast');
                    if (!toast) {
                        toast = document.createElement('div');
                        toast.className = 'toast';
                        document.body.appendChild(toast);
                    }
                    
                    toast.textContent = message;
                    toast.className = `toast ${type}`;
                    toast.classList.add('show');
                    
                    // 3ç§’åè‡ªåŠ¨éšè—
                    setTimeout(() => {
                        toast.classList.remove('show');
                    }, 3000);
                }
            });
        </script>
    
    <!-- è‡ªå®šä¹‰å·¥å…·ç±» -->
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .transition-smooth {
                transition: all 0.3s ease;
            }
            .shadow-soft {
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            }
            .shadow-medium {
                box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
            }
        }
    </style>
    <style>
        /* åŸºç¡€æ ·å¼é‡ç½® */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            font-size: 14px;
            line-height: 1.5;
            color: #333;
            background-color: #f5f7fa;
            overflow: hidden;
        }
        
        /* ä¸»å†…å®¹ */
        .main-container {
            display: flex;
            height: 100vh;
            overflow: hidden;
        }
        
        /* å·¦ä¾§ä¾§è¾¹æ  */
        .sidebar {
            width: 240px;
            background-color: #fff;
            box-shadow: 2px 0 8px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            transition: all 0.3s ease;
        }
        
        /* ä¾§è¾¹æ å¤´éƒ¨ */
        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .sidebar-logo {
            font-size: 18px;
            font-weight: bold;
            color: #667eea;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        /* ä¾§è¾¹æ èœå• */
        .sidebar-menu {
            flex: 1;
            padding: 20px 0;
        }
        
        .menu-item {
            padding: 12px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #666;
            display: flex;
            align-items: center;
            gap: 12px;
            position: relative;
        }
        
        .menu-item:hover {
            background-color: #f0f4ff;
            color: #667eea;
        }
        
        .menu-item.active {
            background-color: #667eea;
            color: white;
        }
        
        .menu-icon {
            font-size: 16px;
        }
        
        /* å³ä¾§ä¸»å†…å®¹åŒº */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            width: calc(100% - 240px);
        }
        
        /* é¡¶éƒ¨å¯¼èˆªæ  */
        .top-nav {
            height: 60px;
            background-color: #fff;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            z-index: 10;
            position: relative;
        }
        
        .nav-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .nav-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }
        
        .avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background-color: #667eea;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .user-info:hover .avatar {
            transform: scale(1.1);
        }
        
        /* å·¥ä½œåŒº */
        .workspace {
            flex: 1;
            display: flex;
            overflow: hidden;
        }
        
        /* å·¥ä½œåŒºå¸ƒå±€ */
        .workspace-layout {
            display: flex;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }
        
        /* ç´§å‡‘æ¨¡å¼ */
        body.compact-mode .file-manager {
            width: 200px;
        }
        
        body.compact-mode .right-sidebar {
            width: 280px;
        }
        
        /* èˆ’é€‚æ¨¡å¼ */
        body.comfortable-mode .file-manager {
            width: 320px;
        }
        
        body.comfortable-mode .right-sidebar {
            width: 360px;
        }
        
        /* æš—è‰²æ¨¡å¼ */
        body.dark-mode {
            background-color: #1a1a1a;
            color: #ffffff;
        }
        
        body.dark-mode .sidebar,
        body.dark-mode .top-nav,
        body.dark-mode .file-manager,
        body.dark-mode .editor-area,
        body.dark-mode .right-sidebar,
        body.dark-mode .result-card,
        body.dark-mode .market-analysis,
        body.dark-mode .case-library,
        body.dark-mode .investment-analysis,
        body.dark-mode .system-settings,
        body.dark-mode .valuation-form {
            background-color: #2d2d2d;
            color: #ffffff;
        }
        
        body.dark-mode .btn {
            background-color: #404040;
            color: #ffffff;
            border-color: #666666;
        }
        
        body.dark-mode .btn-primary {
            background-color: #667eea;
            border-color: #667eea;
        }
        
        /* ä¸“æ³¨æ¨¡å¼ */
        body.focus-mode .sidebar,
        body.focus-mode .right-sidebar {
            display: none;
        }
        
        body.focus-mode .main-content {
            width: 100% !important;
        }
        
        /* å…¨å±æ¨¡å¼ */
        body.fullscreen-mode {
            overflow: hidden;
        }
        
        body.fullscreen-mode .main-container {
            height: 100vh;
        }
        
        /* é¢åŒ…å±‘å¯¼èˆª */
        #breadcrumb {
            font-size: 12px;
            color: #999;
            margin-top: 4px;
        }
        
        /* è§†å›¾æ¨¡å¼åˆ‡æ¢æŒ‰é’® */
        .view-mode-btn {
            transition: all 0.3s ease;
        }
        
        .view-mode-btn.active {
            background-color: #667eea;
            color: white;
        }
        
        /* æ‹–æ‹½ä¸Šä¼ åŒºåŸŸæ ·å¼ */
        .drop-zone {
            border: 2px dashed #e0e0e0;
            border-radius: 8px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 16px;
        }
        
        .drop-zone:hover {
            border-color: #667eea;
            background-color: #f0f4ff;
        }
        
        .drop-zone.drag-over {
            border-color: #667eea;
            background-color: #e6ebff;
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(102, 126, 234, 0.15);
        }
        
        .drop-zone-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
        }
        
        /* ä¸Šä¼ æ–‡ä»¶é¡¹æ ·å¼ */
        .uploaded-file-item {
            position: relative;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            overflow: hidden;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .uploaded-file-item:hover {
            border-color: #667eea;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.15);
            transform: translateY(-2px);
        }
        
        .uploaded-file-preview {
            width: 100%;
            height: 120px;
            object-fit: cover;
        }
        
        .uploaded-file-info {
            padding: 8px;
            background-color: rgba(0, 0, 0, 0.05);
            font-size: 12px;
            color: #666;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .uploaded-file-remove {
            position: absolute;
            top: 4px;
            right: 4px;
            background-color: rgba(245, 34, 45, 0.8);
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.2s ease;
        }
        
        .uploaded-file-item:hover .uploaded-file-remove {
            opacity: 1;
        }
        
        .uploaded-file-remove:hover {
            background-color: rgba(245, 34, 45, 1);
        }
        
        /* å·¦ä¾§æ–‡ä»¶ç®¡ç† */
        .file-manager {
            width: 280px;
            background-color: #fafafa;
            border-right: 1px solid #e0e0e0;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }
        
        .file-manager-header {
            padding: 16px;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .file-manager-header h3 {
            font-size: 14px;
            font-weight: bold;
            color: #333;
        }
        
        .file-actions {
            display: flex;
            gap: 8px;
        }
        
        .btn {
            padding: 6px 12px;
            border: 1px solid #e0e0e0;
            background-color: white;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .btn:hover {
            background-color: #f5f5f5;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .btn-primary {
            background-color: #667eea;
            color: white;
            border-color: #667eea;
        }
        
        .btn-primary:hover {
            background-color: #5568d3;
        }
        
        /* åŠ è½½çŠ¶æ€æ ·å¼ */
        .btn.loading {
            pointer-events: none;
            opacity: 0.7;
        }
        
        .btn.loading::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 16px;
            height: 16px;
            margin-top: -8px;
            margin-left: -8px;
            border: 2px solid transparent;
            border-top-color: white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* æ–‡ä»¶åˆ—è¡¨ */
        .file-list {
            padding: 16px;
        }
        
        .file-item {
            padding: 10px;
            margin-bottom: 8px;
            background-color: white;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .file-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(102, 126, 234, 0.1), transparent);
            transition: left 0.5s ease;
        }
        
        .file-item:hover::before {
            left: 100%;
        }
        
        .file-item:hover {
            border-color: #667eea;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.15);
            transform: translateX(2px);
        }
        
        .file-item.active {
            border-color: #667eea;
            background-color: #f0f4ff;
        }
        
        /* ä¸­é—´ç¼–è¾‘åŒº */
        .editor-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        /* ç¼–è¾‘åŒºå¤´éƒ¨ */
        .editor-header {
            padding: 16px 20px;
            border-bottom: 1px solid #e0e0e0;
            background-color: white;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .editor-title {
            font-size: 16px;
            font-weight: bold;
            color: #333;
        }
        
        .editor-tabs {
            display: flex;
            gap: 8px;
        }
        
        .tab {
            padding: 8px 16px;
            border: 1px solid #e0e0e0;
            background-color: white;
            border-radius: 4px 4px 0 0;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .tab:hover {
            background-color: #f8f9fa;
            border-color: #c0c4cc;
        }
        
        .tab.active {
            background-color: #f0f4ff;
            border-color: #667eea;
            color: #667eea;
            transform: translateY(-1px);
        }
        
        /* ç¼–è¾‘å†…å®¹åŒº */
        .editor-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background-color: #fafafa;
        }
        
        /* å†…å®¹åˆ‡æ¢åŠ¨ç”» */
        .form-section,
        .valuation-preview,
        .report-generation {
            transition: all 0.3s ease;
            opacity: 0;
            transform: translateY(10px);
            display: none;
        }
        
        .module-content {
            transition: all 0.3s ease;
            opacity: 0;
            transform: translateY(10px);
            display: none;
            width: 100%;
        }
        
        .form-section.active,
        .valuation-preview.active,
        .report-generation.active {
            opacity: 1;
            transform: translateY(0);
            display: flex;
        }
        
        .module-content.active {
            opacity: 1;
            transform: translateY(0);
            display: flex;
            width: 100%;
        }
        
        /* å¼€å…³æ ·å¼ */
        .switch {
            position: relative;
            display: inline-block;
            width: 48px;
            height: 24px;
        }
        
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background-color: #667eea;
        }
        
        input:focus + .slider {
            box-shadow: 0 0 1px #667eea;
        }
        
        input:checked + .slider:before {
            transform: translateX(24px);
        }
        
        /* ä¼°ä»·è¡¨å• */
        .valuation-form {
            max-width: 800px;
            margin: 0 auto;
            background-color: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
        }
        
        .form-section {
            margin-bottom: 24px;
        }
        
        .form-section h3 {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 16px;
            color: #333;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 16px;
            margin-bottom: 16px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        .form-group label {
            font-size: 13px;
            color: #666;
            margin-bottom: 6px;
            font-weight: 500;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 10px 12px;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            font-size: 14px;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.1);
            transform: translateY(-1px);
        }
        
        .textarea-large {
            min-height: 120px;
            resize: vertical;
        }
        
        /* ä¼°ä»·ç»“æœé¢„è§ˆ */
        .valuation-preview {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }
        
        .result-card {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 16px;
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }
        
        .result-card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }
        
        .result-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .result-row:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }
        
        .result-label {
            color: #666;
            font-size: 14px;
        }
        
        .result-value {
            color: #333;
            font-weight: bold;
            font-size: 16px;
        }
        
        /* å³ä¾§è¾…åŠ©é¢æ¿ */
        .right-sidebar {
            width: 320px;
            background-color: white;
            border-left: 1px solid #e0e0e0;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        /* å³ä¾§AIåŠ©æ‰‹ */
        .ai-assistant {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .ai-header {
            padding: 16px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .ai-header h3 {
            font-size: 16px;
            font-weight: bold;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .ai-chat {
            flex: 1;
            padding: 16px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }
        
        .chat-message {
            max-width: 85%;
            padding: 12px 16px;
            border-radius: 18px;
            font-size: 14px;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .chat-message.ai {
            background-color: #f0f4ff;
            align-self: flex-start;
            color: #333;
        }
        
        .chat-message.user {
            background-color: #667eea;
            align-self: flex-end;
            color: white;
        }
        
        .ai-input-area {
            padding: 16px;
            border-top: 1px solid #e0e0e0;
        }
        
        .ai-input {
            display: flex;
            gap: 10px;
        }
        
        .ai-input input {
            flex: 1;
            padding: 12px;
            border: 1px solid #e0e0e0;
            border-radius: 25px;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        .ai-input input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.1);
        }
        
        .ai-input button {
            padding: 12px 20px;
            background-color: #667eea;
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .ai-input button:hover {
            background-color: #5568d3;
            transform: translateY(-1px);
        }
        
        /* æ“ä½œæŒ‰é’®åŒº */
        .action-buttons {
            padding: 20px;
            background-color: white;
            border-top: 1px solid #e0e0e0;
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }
        
        .btn-large {
            padding: 12px 24px;
            font-size: 14px;
            font-weight: 500;
        }
        
        /* å¸‚åœºåˆ†ææ¨¡å— */
        .market-analysis {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 16px;
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.05);
        }
        
        .market-analysis h4 {
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 12px;
            color: #333;
        }
        
        .market-data {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 16px;
        }
        
        .data-item {
            text-align: center;
            padding: 12px;
            background-color: #f8f9fa;
            border-radius: 6px;
        }
        
        .data-value {
            font-size: 18px;
            font-weight: bold;
            color: #667eea;
        }
        
        .data-label {
            font-size: 12px;
            color: #666;
            margin-top: 4px;
        }
        
        /* æ¡ˆä¾‹åº“æ¨¡å— */
        .case-library {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 16px;
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.05);
        }
        
        .case-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 12px;
        }
        
        .case-item {
            padding: 12px;
            background-color: #f8f9fa;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }
        
        .case-item:hover {
            background-color: #f0f4ff;
            transform: translateY(-2px);
        }
        
        /* æŠ•èµ„åˆ†ææ¨¡å— */
        .investment-analysis {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 16px;
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.05);
        }
        
        .tool-set {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 12px;
        }
        
        .tool-item {
            padding: 12px;
            background-color: #f8f9fa;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }
        
        .tool-item:hover {
            background-color: #f0f4ff;
            transform: translateY(-2px);
        }
        
        /* ç³»ç»Ÿè®¾ç½®æ¨¡å— */
        .system-settings {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 16px;
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.05);
        }
        
        .setting-section {
            margin-bottom: 20px;
        }
        
        .setting-section h4 {
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 12px;
            color: #333;
        }
        
        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        
        /* åŠ è½½çŠ¶æ€æç¤º */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .loading-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        /* æŠ¥å‘Šæ¨¡æ€æ¡† */
        #report-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 10000;
        }
        
        #report-modal .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 12px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
        }
        
        #report-content {
            margin-top: 20px;
        }
        
        #report-content h2 {
            color: #667eea;
            margin-bottom: 20px;
        }
        
        #report-content p {
            margin-bottom: 12px;
            line-height: 1.6;
        }
        
        /* æ“ä½œåé¦ˆæç¤º */
        .toast {
            position: fixed;
            top: 80px;
            right: 20px;
            padding: 12px 20px;
            background-color: #333;
            color: white;
            border-radius: 4px;
            z-index: 9999;
            opacity: 0;
            transform: translateY(-20px);
            transition: all 0.3s ease;
        }
        
        .toast.success {
            background-color: #52c41a;
        }
        
        .toast.error {
            background-color: #ff4d4f;
        }
        
        .toast.warning {
            background-color: #faad14;
        }
        
        .toast.info {
            background-color: #1890ff;
        }
        
        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }
        
        /* å®¢æˆ·ç«¯åˆ‡æ¢å¯¼èˆªæ ·å¼ */
        .client-nav {
            height: 60px;
            background-color: #fff;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .client-nav-content {
            max-width: 100%;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            height: 100%;
        }
        
        .client-logo {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 18px;
            font-weight: bold;
            color: #667eea;
        }
        
        .client-tabs {
            display: flex;
            gap: 4px;
            flex: 1;
            justify-content: center;
        }
        
        .client-tab {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            color: #666;
            background-color: #f5f7fa;
            border: 1px solid #e0e0e0;
        }
        
        .client-tab:hover {
            background-color: #e6ebff;
            color: #667eea;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.15);
        }
        
        .client-tab.active {
            background-color: #667eea;
            color: white;
            border-color: #667eea;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }
        
        .client-icon {
            font-size: 16px;
        }
        
        .client-user-info {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        /* å®¢æˆ·ç«¯å†…å®¹åŒºåŸŸ */
        .client-content {
            display: none;
            width: 100%;
            height: 100%;
        }
        
        .client-content.active {
            display: flex;
        }
        
        /* å¤§ä¼—ç«¯æ ·å¼ */
        .public-dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            padding: 20px;
        }
        
        .dashboard-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }
        
        .dashboard-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        }
        
        /* ä¼ä¸šæ§åˆ¶å°æ ·å¼ */
        .enterprise-dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            padding: 20px;
        }
        
        .dashboard-section {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }
        
        .dashboard-section h3 {
            margin-top: 0;
            margin-bottom: 16px;
            color: #333;
            font-size: 16px;
        }
        
        /* ä¿®å¤LOGOæ–‡å­—ç«–å‘æ˜¾ç¤ºé—®é¢˜ */
        .logo {
            display: flex !important;
            align-items: center !important;
            gap: 8px !important;
            flex-direction: row !important;
            writing-mode: horizontal-tb !important;
            text-orientation: mixed !important;
            direction: ltr !important;
            white-space: nowrap !important;
        }
        
        .logo img {
            display: inline-block !important;
            vertical-align: middle !important;
            max-width: 45px !important;
            max-height: 45px !important;
            width: 45px !important;
            height: 45px !important;
            object-fit: contain !important;
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 1200px) {
            .client-tabs {
                gap: 2px;
            }
            
            .client-tab {
                padding: 6px 12px;
                font-size: 13px;
            }
            
            .ai-assistant {
                width: 280px;
            }
            
            .file-manager {
                width: 240px;
            }
        }
        
        @media (max-width: 992px) {
            .client-tab span:nth-child(2) {
                display: none;
            }
            
            .client-tab {
                padding: 8px;
                border-radius: 50%;
            }
            
            .sidebar {
                width: 200px;
            }
            
            .ai-assistant {
                display: none;
            }
        }
        
        @media (max-width: 768px) {
            .sidebar {
                display: none;
            }
            
            .file-manager {
                display: none;
            }
        }
    </style>









<style>
/* é€šç”¨ä¿®å¤æ ·å¼ - ç¡®ä¿æ–‡å­—æ¨ªå‘æ˜¾ç¤ºå’Œå¯¼èˆªæ å¢å¤§ */

/* æœ€é«˜ä¼˜å…ˆçº§ - ç¡®ä¿æ‰€æœ‰å…ƒç´ æ–‡å­—æ¨ªå‘æ˜¾ç¤º */
*,
*::before,
*::after {
    writing-mode: horizontal-tb !important;
    text-orientation: mixed !important;
    direction: ltr !important;
    /* åªç¡®ä¿æ–‡å­—æ¨ªå‘ï¼Œä¸å¼ºåˆ¶flexå¸ƒå±€ï¼Œè®©æ–‡æœ¬æ­£å¸¸æ¢è¡Œ */
}

/* ç¡®ä¿æ–‡æœ¬å…ƒç´ æ­£å¸¸æ˜¾ç¤ºç©ºæ ¼å’Œæ¢è¡Œ */
p,
span,
div,
th,
td,
li,
strong,
em,
ai,
button,
input,
textarea,
select,
label,
h1,
h2,
h3,
h4,
h5,
h6 {
    display: block !important;
    white-space: normal !important;
    word-break: normal !important;
    overflow-wrap: break-word !important;
}

/* ä¿®å¤LOGOæ–‡å­—ç«–å‘æ˜¾ç¤ºé—®é¢˜ */
.navbar-brand,
.logo {
    display: flex !important;
    align-items: center !important;
    gap: var(--spacing-2) !important;
    flex-direction: row !important;
    white-space: nowrap !important;
}

.navbar-brand img,
.logo img {
    display: inline-block !important;
    vertical-align: middle !important;
    max-width: 50px !important;
    max-height: 50px !important;
    width: 50px !important;
    height: 50px !important;
    object-fit: contain !important;
}

.navbar-brand span,
.navbar-brand a,
.logo span,
.logo a {
    display: inline-block !important;
    vertical-align: middle !important;
}

/* ç¡®ä¿å¯¼èˆªæ å’Œèœå•æ­£ç¡®æ˜¾ç¤º */
.navbar {
    height: 80px !important;
    padding: 16px 24px !important;
    min-height: 80px !important;
    display: flex !important;
    align-items: center !important;
    justify-content: space-between !important;
}

/* å¯¼èˆªèœå•æ ·å¼ */
.nav-menu {
    display: flex !important;
    flex-direction: row !important;
    align-items: center !important;
    gap: var(--spacing-4) !important;
}

.nav-menu a {
    display: inline-flex !important;
    align-items: center !important;
    justify-content: center !important;
    height: 80px !important;
    padding: 0 16px !important;
    font-size: 16px !important;
    line-height: 1 !important;
    text-decoration: none !important;
    color: inherit !important;
    white-space: nowrap !important;
}

/* å¯¼èˆªæŒ‰é’®æ ·å¼ */
.nav-menu .btn {
    display: inline-flex !important;
    align-items: center !important;
    justify-content: center !important;
    height: auto !important;
    min-height: 40px !important;
    padding: 8px 16px !important;
    font-size: 14px !important;
    line-height: 1 !important;
}

/* ç¡®ä¿å®¹å™¨å…ƒç´ æ¨ªå‘æ˜¾ç¤º */
.d-flex,
.align-items-center,
.justify-content-between,
.justify-content-center,
.hero-buttons,
.filter-group,
.filter-search-section,
.action-buttons,
.nav-actions,
.nav-left,
.nav-right,
.user-info,
.stat-header,
.score-item-header {
    display: flex !important;
    flex-direction: row !important;
}

/* ç§»åŠ¨ç«¯èœå•æŒ‰é’®æ ·å¼ */
.btn-text.d-lg-none {
    display: none !important;
}

/* ç¡®ä¿ç½‘æ ¼å¸ƒå±€æ­£å¸¸æ˜¾ç¤º */
.grid,
.grid-cols-4,
.grid-cols-3,
.grid-cols-2 {
    display: grid !important;
    flex-direction: initial !important;
}

/* ç¡®ä¿è¡¨æ ¼å¸ƒå±€æ­£å¸¸æ˜¾ç¤º */
table,
tr,
thead,
tbody,
th,
td {
    display: table !important;
    display: table-row !important;
    display: table-header-group !important;
    display: table-row-group !important;
    display: table-cell !important;
    flex-direction: initial !important;
}

/* ç¡®ä¿åˆ—è¡¨å¸ƒå±€æ­£å¸¸æ˜¾ç¤º */
ul,
ol,
li {
    display: list-item !important;
    flex-direction: initial !important;
}

/* ç¡®ä¿è¡¨å•å…ƒç´ æ­£å¸¸æ˜¾ç¤º */
input,
textarea,
select,
button {
    display: inline-block !important;
    flex-direction: initial !important;
}

/* ç¡®ä¿æ–‡æœ¬å†…å®¹æ­£å¸¸æ˜¾ç¤ºæ¢è¡Œå’Œç©ºæ ¼ */
.text-content,
.card-content,
.main-content,
.scoring-content,
.page-header,
.analysis-title,
.analysis-subtitle,
.chart-container,
.card,
.card-header,
.status-tag,
.score-display,
.pagination,
.pagination-info,
.score-detail-body,
.detail-section,
.detail-title,
.detail-item,
.detail-label,
.detail-value,
.score-item-name,
.score-item-weight,
.score-item-score,
.score-item-description,
.form-group,
.form-label {
    display: block !important;
    flex-direction: initial !important;
    white-space: normal !important;
    word-wrap: break-word !important;
    word-break: normal !important;
}
</style>
</head>
<body>
    <!-- é¡µé¢å¤´éƒ¨ -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <!-- Logo -->
                <a href="index.html" class="logo">
                    <img src="å›¾ç‰‡1.png" alt="ValuHub Logo">
                    ValuHub
                </a>
                
                <!-- æ¡Œé¢å¯¼èˆªèœå• -->
                <nav class="nav-menu">
                    <a href="index.html" class="nav-link">é¦–é¡µ</a>
                    <a href="solutions.html" class="nav-link">è§£å†³æ–¹æ¡ˆ</a>
                    <a href="ai-valuation.html" class="nav-link">AIä¼°ä»·</a>
                    <a href="market-trend.html" class="nav-link">å¸‚åœºè¶‹åŠ¿</a>
                    <a href="research.html" class="nav-link">æ•°æ®ç ”ç©¶</a>
                    <a href="valuation-history.html" class="nav-link">ä¼°ä»·å†å²</a>
                    <a href="report-generation.html" class="nav-link">æŠ¥å‘Šç”Ÿæˆ</a>
                    <a href="login.html" class="nav-link">ç™»å½•</a>
                    <a href="register.html" class="btn btn-primary btn-sm">å…è´¹æ³¨å†Œ</a>
                </nav>
                
                <!-- ç§»åŠ¨ç«¯èœå•æŒ‰é’® -->
                <button class="btn btn-text d-lg-none">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="3" y1="12" x2="21" y2="12"></line>
                        <line x1="3" y1="6" x2="21" y2="6"></line>
                        <line x1="3" y1="18" x2="21" y2="18"></line>
                    </svg>
                </button>
            </div>
        </div>
    </header>
    
    <div class="main-container">
        <!-- å·¦ä¾§ä¾§è¾¹æ  -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h3 id="sidebar-title">AIä¼°ä»·</h3>
            </div>
            <nav class="sidebar-menu" id="sidebar-menu">
                <!-- ä¾§è¾¹æ èœå•å°†æ ¹æ®å®¢æˆ·ç«¯åŠ¨æ€ç”Ÿæˆ -->
            </nav>
        </aside>
        
        <!-- å³ä¾§ä¸»å†…å®¹åŒº -->
        <main class="main-content">
            <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
            <nav class="top-nav">
                <div class="nav-left">
                    <h1 style="font-size: 18px; font-weight: bold; color: #333;"><span id="current-client-title">AIå¿«é€Ÿä¼°ä»·å·¥ä½œå°</span></h1>
                    <!-- é¢åŒ…å±‘å¯¼èˆª -->
                    <div style="font-size: 12px; color: #999; margin-top: 4px;" id="breadcrumb"></div>
                </div>
                <div class="nav-right">
                    <div style="display: flex; gap: 8px; margin-right: 20px;">
                        <!-- è§†å›¾æ¨¡å¼åˆ‡æ¢ -->
                        <button class="btn" id="compact-mode-btn" title="ç´§å‡‘æ¨¡å¼">ğŸ“</button>
                        <button class="btn" id="comfortable-mode-btn" title="èˆ’é€‚æ¨¡å¼">ğŸ›‹ï¸</button>
                        <button class="btn" id="dark-mode-btn" title="æš—è‰²æ¨¡å¼">ğŸŒ™</button>
                        <button class="btn" id="fullscreen-btn" title="å…¨å±æ¨¡å¼">â›¶</button>
                        <button class="btn" id="focus-mode-btn" title="ä¸“æ³¨æ¨¡å¼">ğŸ¯</button>
                    </div>
                    <div style="display: flex; gap: 12px;">
                        <button class="btn" id="export-report-btn">ğŸ“¤ å¯¼å‡ºæŠ¥å‘Š</button>
                        <button class="btn" id="import-data-btn">ğŸ“¥ å¯¼å…¥æ•°æ®</button>
                        <button class="btn btn-primary" id="save-project-btn">ğŸ’¾ ä¿å­˜é¡¹ç›®</button>
                    </div>
                    <div class="user-info">
                        <div class="avatar">U</div>
                        <span>ç”¨æˆ·</span>
                    </div>
                </div>
            </nav>
            
            <!-- å·¥ä½œåŒº -->
            <div class="workspace">
                <!-- å¤§ä¼—ç«¯å†…å®¹ -->
                <div id="public-content" class="client-content active">
                    <!-- AIä¼°ä»·æ¨¡å— -->
                    <div id="ai-valuation" class="module-content active">
                        <div class="workspace-layout">
                            <!-- å·¦ä¾§æ–‡ä»¶ç®¡ç† -->
                            <div class="file-manager">
                                <div class="file-manager-header">
                                    <h3>ä¼°ä»·é¡¹ç›®</h3>
                                    <div class="file-actions">
                                        <button class="btn" id="import-excel-btn">ğŸ“¤ å¯¼å…¥</button>
                                        <button class="btn" id="export-excel-btn">ğŸ“¥ å¯¼å‡º</button>
                                        <input type="file" id="excel-file-input" accept=".xlsx,.xls" style="display: none;">
                                        <button class="btn btn-primary" id="new-project-btn">+ æ–°å»º</button>
                                    </div>
                                </div>
                                
                                <!-- é«˜çº§æœç´¢ä¸ç­›é€‰ -->
                                <div class="search-filter-section" style="padding: 16px; border-bottom: 1px solid #e0e0e0; background-color: #fafafa;">
                                    <!-- æœç´¢è¾“å…¥æ¡† -->
                                    <div style="margin-bottom: 16px;">
                                        <div style="position: relative;">
                                            <input type="text" id="search-input" placeholder="æœç´¢ä¼°ä»·é¡¹ç›®ã€åœ°å€æˆ–å…³é”®è¯..." style="
                                                width: 100%;
                                                padding: 10px 16px;
                                                border: 1px solid #e0e0e0;
                                                border-radius: 20px;
                                                font-size: 14px;
                                                transition: all 0.3s ease;
                                            ">
                                            <div style="
                                                position: absolute;
                                                right: 8px;
                                                top: 50%;
                                                transform: translateY(-50%);
                                                display: flex;
                                                gap: 4px;
                                            ">
                                                <button type="button" id="search-clear-btn" style="
                                                    background: none;
                                                    border: none;
                                                    color: #999;
                                                    cursor: pointer;
                                                    font-size: 16px;
                                                    padding: 4px;
                                                    display: none;
                                                ">âœ•</button>
                                                <button type="button" style="
                                                    background: none;
                                                    border: none;
                                                    color: #667eea;
                                                    cursor: pointer;
                                                    font-size: 18px;
                                                    padding: 4px;
                                                ">ğŸ”</button>
                                            </div>
                                        </div>
                                        <!-- æœç´¢å†å² -->
                                        <div id="search-history" style="
                                            margin-top: 8px;
                                            display: flex;
                                            flex-wrap: wrap;
                                            gap: 6px;
                                        "></div>
                                    </div>
                                    
                                    <!-- ç­›é€‰æ¡ä»¶æŠ˜å é¢æ¿ -->
                                    <div class="filter-panel">
                                        <!-- åŸºç¡€ç­›é€‰æ¡ä»¶ -->
                                        <div class="filter-section" style="margin-bottom: 16px;">
                                            <h4 style="
                                                font-size: 13px;
                                                font-weight: bold;
                                                color: #333;
                                                margin-bottom: 12px;
                                                display: flex;
                                                align-items: center;
                                                gap: 6px;
                                            ">
                                                <span>ğŸ“‹ åŸºç¡€ç­›é€‰</span>
                                            </h4>
                                            <div style="display: grid; grid-template-columns: 1fr 1fr;
                                                gap: 12px;
                                            ">
                                                <div class="form-group">
                                                    <label style="font-size: 12px; color: #666; margin-bottom: 4px; display: block;">ç‰©ä¸šç±»å‹</label>
                                                    <select id="filter-type" style="
                                                        width: 100%;
                                                        padding: 8px 12px;
                                                        border: 1px solid #e0e0e0;
                                                        border-radius: 6px;
                                                        font-size: 13px;
                                                        transition: all 0.3s ease;
                                                    ">
                                                        <option value="">æ‰€æœ‰ç±»å‹</option>
                                                        <option value="ä½å®…">ä½å®…</option>
                                                        <option value="å†™å­—æ¥¼">å†™å­—æ¥¼</option>
                                                        <option value="å•†é“º">å•†é“º</option>
                                                        <option value="åˆ«å¢…">åˆ«å¢…</option>
                                                        <option value="å·¥ä¸šåœ°äº§">å·¥ä¸šåœ°äº§</option>
                                                    </select>
                                                </div>
                                                <div class="form-group">
                                                    <label style="font-size: 12px; color: #666; margin-bottom: 4px; display: block;">åŸå¸‚</label>
                                                    <select id="filter-city" style="
                                                        width: 100%;
                                                        padding: 8px 12px;
                                                        border: 1px solid #e0e0e0;
                                                        border-radius: 6px;
                                                        font-size: 13px;
                                                        transition: all 0.3s ease;
                                                    ">
                                                        <option value="">æ‰€æœ‰åŸå¸‚</option>
                                                        <option value="é•¿æ²™">é•¿æ²™</option>
                                                        <option value="åŒ—äº¬">åŒ—äº¬</option>
                                                        <option value="ä¸Šæµ·">ä¸Šæµ·</option>
                                                        <option value="å¹¿å·">å¹¿å·</option>
                                                        <option value="æ·±åœ³">æ·±åœ³</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- é«˜çº§ç­›é€‰æ¡ä»¶ -->
                                        <div class="filter-section" style="margin-bottom: 16px;">
                                            <h4 style="
                                                font-size: 13px;
                                                font-weight: bold;
                                                color: #333;
                                                margin-bottom: 12px;
                                                display: flex;
                                                align-items: center;
                                                gap: 6px;
                                                cursor: pointer;
                                            " id="advanced-filter-toggle">
                                                <span>ğŸ” é«˜çº§ç­›é€‰</span>
                                                <span id="advanced-filter-icon">â–¼</span>
                                            </h4>
                                            <div id="advanced-filter-content" style="display: none;">
                                                <div style="display: grid; grid-template-columns: 1fr 1fr;
                                                    gap: 12px;
                                                    margin-bottom: 12px;">
                                                    <!-- ä»·æ ¼èŒƒå›´ç­›é€‰ -->
                                                    <div class="form-group">
                                                        <label style="font-size: 12px; color: #666; margin-bottom: 4px; display: block;">ä»·æ ¼èŒƒå›´ (å…ƒ)</label>
                                                        <div style="display: flex; gap: 6px;">
                                                            <input type="number" id="filter-min-price" placeholder="æœ€ä½" style="
                                                                flex: 1;
                                                                padding: 6px 8px;
                                                                border: 1px solid #e0e0e0;
                                                                border-radius: 4px 0 0 4px;
                                                                font-size: 13px;
                                                            ">
                                                            <input type="number" id="filter-max-price" placeholder="æœ€é«˜" style="
                                                                flex: 1;
                                                                padding: 6px 8px;
                                                                border: 1px solid #e0e0e0;
                                                                border-left: none;
                                                                border-radius: 0 4px 4px 0;
                                                                font-size: 13px;
                                                            ">
                                                        </div>
                                                    </div>
                                                    <!-- å»ºç­‘é¢ç§¯èŒƒå›´ç­›é€‰ -->
                                                    <div class="form-group">
                                                        <label style="font-size: 12px; color: #666; margin-bottom: 4px; display: block;">å»ºç­‘é¢ç§¯ (ã¡)</label>
                                                        <div style="display: flex; gap: 6px;">
                                                            <input type="number" id="filter-min-area" placeholder="æœ€å°" style="
                                                                flex: 1;
                                                                padding: 6px 8px;
                                                                border: 1px solid #e0e0e0;
                                                                border-radius: 4px 0 0 4px;
                                                                font-size: 13px;
                                                            ">
                                                            <input type="number" id="filter-max-area" placeholder="æœ€å¤§" style="
                                                                flex: 1;
                                                                padding: 6px 8px;
                                                                border: 1px solid #e0e0e0;
                                                                border-left: none;
                                                                border-radius: 0 4px 4px 0;
                                                                font-size: 13px;
                                                            ">
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                <!-- æ—¥æœŸèŒƒå›´ç­›é€‰ -->
                                                <div style="display: grid; grid-template-columns: 1fr 1fr;
                                                    gap: 12px;
                                                    margin-bottom: 12px;">
                                                    <div class="form-group">
                                                        <label style="font-size: 12px; color: #666; margin-bottom: 4px; display: block;">å¼€å§‹æ—¥æœŸ</label>
                                                        <input type="date" id="filter-start-date" style="
                                                            width: 100%;
                                                            padding: 8px 12px;
                                                            border: 1px solid #e0e0e0;
                                                            border-radius: 6px;
                                                            font-size: 13px;
                                                            transition: all 0.3s ease;
                                                        ">
                                                    </div>
                                                    <div class="form-group">
                                                        <label style="font-size: 12px; color: #666; margin-bottom: 4px; display: block;">ç»“æŸæ—¥æœŸ</label>
                                                        <input type="date" id="filter-end-date" style="
                                                            width: 100%;
                                                            padding: 8px 12px;
                                                            border: 1px solid #e0e0e0;
                                                            border-radius: 6px;
                                                            font-size: 13px;
                                                            transition: all 0.3s ease;
                                                        ">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- æœç´¢æŒ‰é’®å’Œç»“æœæ’åº -->
                                    <div style="display: flex; gap: 8px; align-items: center;">
                                        <button id="search-btn" class="btn btn-primary" style="flex: 1; padding: 10px 16px; font-size: 14px; border-radius: 20px;">
                                            ğŸ” æœç´¢
                                        </button>
                                        <button id="reset-filter-btn" class="btn" style="padding: 10px 16px; font-size: 14px; border-radius: 20px;">
                                            é‡ç½®
                                        </button>
                                        <!-- æ’åºé€‰æ‹© -->
                                        <div style="position: relative;">
                                            <select id="sort-select" style="
                                                padding: 6px 12px;
                                                border: 1px solid #e0e0e0;
                                                border-radius: 15px;
                                                font-size: 12px;
                                                background-color: white;
                                            ">
                                                <option value="date-desc">æœ€æ–°åˆ›å»º</option>
                                                <option value="date-asc">æœ€æ—©åˆ›å»º</option>
                                                <option value="price-desc">ä»·æ ¼ä»é«˜åˆ°ä½</option>
                                                <option value="price-asc">ä»·æ ¼ä»ä½åˆ°é«˜</option>
                                                <option value="area-desc">é¢ç§¯ä»å¤§åˆ°å°</option>
                                                <option value="area-asc">é¢ç§¯ä»å°åˆ°å¤§</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                        
                        <!-- æœç´¢ç»“æœç»Ÿè®¡ -->
                        <div style="padding: 8px 16px; font-size: 12px; color: #999; border-bottom: 1px solid #e0e0e0;">
                            <span id="search-result-count">å…± 3 ä¸ªä¼°ä»·é¡¹ç›®</span>
                        </div>
                        
                        <div class="file-list">
                            <div class="file-item active">
                                <div style="font-weight: 500; margin-bottom: 4px;">é•¿æ²™ä¸‡ç§‘åŸä¼°ä»·</div>
                                <div style="font-size: 12px; color: #999;">2025-12-27 14:30</div>
                            </div>
                            <div class="file-item">
                                <div style="font-weight: 500; margin-bottom: 4px;">å²³éº“åŒºäºŒæ‰‹æˆ¿åˆ†æ</div>
                                <div style="font-size: 12px; color: #999;">2025-12-26 10:15</div>
                            </div>
                            <div class="file-item">
                                <div style="font-weight: 500; margin-bottom: 4px;">å•†ä¸šåœ°äº§ä¼°ä»·</div>
                                <div style="font-size: 12px; color: #999;">2025-12-25 16:45</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ä¸­é—´ç¼–è¾‘åŒº -->
                    <div class="editor-area">
                        <!-- ç¼–è¾‘åŒºå¤´éƒ¨ -->
                        <div class="editor-header">
                            <div class="editor-title">é•¿æ²™ä¸‡ç§‘åŸä¼°ä»·</div>
                            <div class="editor-tabs">
                                <div class="tab active">åŸºç¡€ä¿¡æ¯</div>
                                <div class="tab">è¯¦ç»†å‚æ•°</div>
                                <div class="tab">å‘¨è¾¹é…å¥—</div>
                                <div class="tab">ä¼°ä»·ç»“æœ</div>
                                <div class="tab">æŠ¥å‘Šç”Ÿæˆ</div>
                            </div>
                        </div>
                        
                        <!-- ç¼–è¾‘å†…å®¹åŒº -->
                        <div class="editor-content">
                            <form class="valuation-form" id="valuation-form">
                                <!-- åŸºç¡€ä¿¡æ¯ -->
                                <div class="form-section">
                                    <h3>ğŸ“‹ åŸºç¡€ä¿¡æ¯</h3>
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="property_type">ç‰©ä¸šç±»å‹</label>
                                            <select id="property_type" name="property_type" required>
                                                <option value="apartment">ä½å®…</option>
                                                <option value="commercial">å†™å­—æ¥¼</option>
                                                <option value="shop">å•†é“º</option>
                                                <option value="villa">åˆ«å¢…</option>
                                                <option value="industrial">å·¥ä¸šåœ°äº§</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label for="city">æ‰€åœ¨åŸå¸‚</label>
                                            <select id="city" name="city" class="form-control" required>
                                                <option value="">è¯·é€‰æ‹©åŸå¸‚</option>
                                                <option value="é•¿æ²™">é•¿æ²™</option>
                                                <option value="åŒ—äº¬">åŒ—äº¬</option>
                                                <option value="ä¸Šæµ·">ä¸Šæµ·</option>
                                                <option value="å¹¿å·">å¹¿å·</option>
                                                <option value="æ·±åœ³">æ·±åœ³</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="district">åŒºåŸŸ</label>
                                            <input type="text" id="district" name="district" placeholder="è¯·è¾“å…¥åŒºåŸŸ">
                                        </div>
                                        <div class="form-group">
                                            <label for="community">å°åŒºåç§°</label>
                                            <input type="text" id="community" name="community" placeholder="è¯·è¾“å…¥å°åŒºåç§°">
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="address">è¯¦ç»†åœ°å€</label>
                                            <input type="text" id="address" name="address" placeholder="è¯·è¾“å…¥è¯¦ç»†åœ°å€">
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- å›¾ç‰‡ä¸Šä¼  -->
                                <div class="form-section">
                                    <h3>ğŸ–¼ï¸ èµ„äº§å›¾ç‰‡</h3>
                                    <div class="form-group">
                                        <!-- æ‹–æ‹½ä¸Šä¼ åŒºåŸŸ -->
                                        <div id="drop-zone" class="drop-zone" style="
                                            border: 2px dashed #e0e0e0;
                                            border-radius: 8px;
                                            padding: 30px;
                                            text-align: center;
                                            cursor: pointer;
                                            transition: all 0.3s ease;
                                            margin-bottom: 16px;
                                        ">
                                            <div class="drop-zone-content" style="
                                                display: flex;
                                                flex-direction: column;
                                                align-items: center;
                                                gap: 12px;
                                            ">
                                                <div style="font-size: 48px;">ğŸ“</div>
                                                <h4 style="margin: 0; color: #666;">æ‹–æ‹½å›¾ç‰‡åˆ°æ­¤å¤„æˆ–</h4>
                                                <button type="button" id="file-select-btn" class="btn btn-primary" style="
                                                    padding: 8px 24px;
                                                ">
                                                    é€‰æ‹©æ–‡ä»¶
                                                </button>
                                                <p style="margin: 0; font-size: 12px; color: #999;">
                                                    æ”¯æŒ JPGã€PNGã€GIF æ ¼å¼ï¼Œå•æ–‡ä»¶ä¸è¶…è¿‡ 5MB
                                                </p>
                                            </div>
                                            <!-- éšè—çš„æ–‡ä»¶è¾“å…¥ -->
                                            <input type="file" id="image-input" multiple accept="image/*" style="display: none;">
                                        </div>
                                        
                                        <!-- ä¸Šä¼ æ–‡ä»¶åˆ—è¡¨ -->
                                        <div id="uploaded-files" style="
                                            display: grid;
                                            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
                                            gap: 12px;
                                        "></div>
                                    </div>
                                </div>
                                
                                <!-- è¯¦ç»†å‚æ•° -->
                                <div class="form-section">
                                    <h3>ğŸ“ è¯¦ç»†å‚æ•°</h3>
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="area">å»ºç­‘é¢ç§¯ (ã¡)</label>
                                            <input type="number" id="area" name="area" placeholder="è¯·è¾“å…¥å»ºç­‘é¢ç§¯" required>
                                        </div>
                                        <div class="form-group">
                                            <label for="total_floors">æ€»æ¥¼å±‚æ•°</label>
                                            <input type="number" id="total_floors" name="total_floors" placeholder="è¯·è¾“å…¥æ€»æ¥¼å±‚æ•°" min="1" max="200" required>
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group" style="grid-column: span 1;">
                                            <label for="rooms">å®¤æ•°</label>
                                            <input type="number" id="rooms" name="rooms" placeholder="è¯·è¾“å…¥å®¤æ•°" min="1" max="10" required>
                                        </div>
                                        <div class="form-group" style="grid-column: span 1;">
                                            <label for="bathrooms">å…æ•°</label>
                                            <input type="number" id="bathrooms" name="bathrooms" placeholder="è¯·è¾“å…¥å…æ•°" min="1" max="5" required>
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="floor_level">æ¥¼å±‚</label>
                                            <input type="number" id="floor_level" name="floor_level" placeholder="è¯·è¾“å…¥æ¥¼å±‚" min="1" max="100" required>
                                        </div>
                                        <div class="form-group">
                                            <label for="elevator">ç”µæ¢¯é…ç½®</label>
                                            <select id="elevator" name="elevator" required>
                                                <option value="none">æ— ç”µæ¢¯</option>
                                                <option value="one">1æ¢¯1æˆ·</option>
                                                <option value="two">1æ¢¯2æˆ·</option>
                                                <option value="three">1æ¢¯3æˆ·</option>
                                                <option value="four">1æ¢¯4æˆ·</option>
                                                <option value="more">å¤šæ¢¯å¤šæˆ·</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="orientation">æœå‘</label>
                                            <select id="orientation" name="orientation" required>
                                                <option value="south">æœå—</option>
                                                <option value="north">æœåŒ—</option>
                                                <option value="east">æœä¸œ</option>
                                                <option value="west">æœè¥¿</option>
                                                <option value="northeast">ä¸œåŒ—</option>
                                                <option value="northwest">è¥¿åŒ—</option>
                                                <option value="southeast">ä¸œå—</option>
                                                <option value="southwest">è¥¿å—</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label for="property_rights_years">äº§æƒå¹´é™</label>
                                            <select id="property_rights_years" name="property_rights_years" required>
                                                <option value="40">40å¹´</option>
                                                <option value="50">50å¹´</option>
                                                <option value="70">70å¹´</option>
                                                <option value="perpetual">æ°¸ä¹…</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="plot_ratio">å®¹ç§¯ç‡</label>
                                            <input type="number" id="plot_ratio" name="plot_ratio" placeholder="è¯·è¾“å…¥å®¹ç§¯ç‡" step="0.1" min="0.1" max="10" required>
                                        </div>
                                        <div class="form-group">
                                            <label for="greening_rate">ç»¿åŒ–ç‡ (%)</label>
                                            <input type="number" id="greening_rate" name="greening_rate" placeholder="è¯·è¾“å…¥ç»¿åŒ–ç‡" step="0.1" min="0" max="100" required>
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="decoration_status">è£…ä¿®æƒ…å†µ</label>
                                            <select id="decoration_status" name="decoration_status" required>
                                                <option value="rough">æ¯›å¯</option>
                                                <option value="simple">ç®€è£…</option>
                                                <option value="fine">ç²¾è£…</option>
                                                <option value="luxury">è±ªåè£…ä¿®</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label for="building_year">å»ºæˆå¹´ä»½</label>
                                            <input type="number" id="building_year" name="building_year" placeholder="è¯·è¾“å…¥å»ºæˆå¹´ä»½" min="1900" max="2025" required>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- å‘¨è¾¹é…å¥— -->
                                <div class="form-section">
                                    <h3>ğŸ™ï¸ å‘¨è¾¹é…å¥—</h3>
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="subway_distance">åœ°é“è·ç¦» (m)</label>
                                            <input type="number" id="subway_distance" name="subway_distance" placeholder="è¯·è¾“å…¥åœ°é“è·ç¦»" min="0">
                                        </div>
                                        <div class="form-group">
                                            <label for="school_distance">å­¦æ ¡è·ç¦» (m)</label>
                                            <input type="number" id="school_distance" name="school_distance" placeholder="è¯·è¾“å…¥å­¦æ ¡è·ç¦»" min="0">
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="hospital_distance">åŒ»é™¢è·ç¦» (m)</label>
                                            <input type="number" id="hospital_distance" name="hospital_distance" placeholder="è¯·è¾“å…¥åŒ»é™¢è·ç¦»" min="0">
                                        </div>
                                        <div class="form-group">
                                            <label for="business_distance">å•†åœˆè·ç¦» (m)</label>
                                            <input type="number" id="business_distance" name="business_distance" placeholder="è¯·è¾“å…¥å•†åœˆè·ç¦»" min="0">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="facilities_description">é…å¥—æè¿°</label>
                                        <textarea id="facilities_description" name="facilities_description" class="textarea-large" placeholder="è¯·è¯¦ç»†æè¿°å‘¨è¾¹é…å¥—æƒ…å†µ"></textarea>
                                    </div>
                                </div>
                                
                                <!-- ä¼°ä»·æ¨¡å‹é€‰æ‹© -->
                                <div class="form-section">
                                    <h3>ğŸ¤– ä¼°ä»·æ¨¡å‹</h3>
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="model_type">é€‰æ‹©ä¼°ä»·æ¨¡å‹</label>
                                            <select id="model_type" name="model_type" required>
                                                <option value="ensemble">é›†æˆæ¨¡å‹ (æ¨è)</option>
                                                <option value="linear">çº¿æ€§å›å½’æ¨¡å‹</option>
                                                <option value="random_forest">éšæœºæ£®æ—æ¨¡å‹</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div style="background-color: #f0f4ff; padding: 12px; border-radius: 6px; margin-top: 12px;">
                                        <p style="font-size: 13px; color: #667eea; margin: 0;">
                                            <strong>æ¨¡å‹è¯´æ˜ï¼š</strong>é›†æˆæ¨¡å‹ç»“åˆäº†å¤šç§ç®—æ³•çš„ä¼˜ç‚¹ï¼Œå…·æœ‰æœ€é«˜çš„ä¼°ä»·å‡†ç¡®æ€§ï¼›çº¿æ€§å›å½’æ¨¡å‹ç®€å•ç›´è§‚ï¼Œé€‚åˆå¿«é€Ÿä¼°ä»·ï¼›éšæœºæ£®æ—æ¨¡å‹æ“…é•¿å¤„ç†å¤æ‚ç‰¹å¾å…³ç³»ã€‚
                                        </p>
                                    </div>
                                </div>
                                
                                <!-- æäº¤æŒ‰é’®åŒºåŸŸ -->
                                <div class="form-section" style="text-align: center;">
                                    <button type="submit" id="submit-valuation" class="btn btn-primary btn-large">
                                        ğŸš€ å¼€å§‹ä¼°ä»·
                                    </button>
                                </div>
                            </form>
                            
                            <!-- ä¼°ä»·ç»“æœåŒºåŸŸ -->
                            <div id="valuation-result" class="valuation-preview" style="display: none;">
                                <h3 style="text-align: center; color: #667eea; margin-bottom: 20px;">ğŸ“Š ä¼°ä»·ç»“æœ</h3>
                                
                                <!-- æ ¸å¿ƒä¼°ä»·ä¿¡æ¯ -->
                                <div class="result-card">
                                    <h4 style="margin-top: 0; margin-bottom: 16px; color: #333;">æ ¸å¿ƒä¼°ä»·ä¿¡æ¯</h4>
                                    <div class="result-row">
                                        <span class="result-label">é¢„ä¼°æ€»ä»·</span>
                                        <span class="result-value" id="estimated-price" style="color: #667eea; font-size: 24px;">--</span>
                                    </div>
                                    <div class="result-row">
                                        <span class="result-label">é¢„ä¼°å•ä»·</span>
                                        <span class="result-value" id="price-per-sqm">--</span>
                                    </div>
                                    <div class="result-row">
                                        <span class="result-label">ç½®ä¿¡åº¦</span>
                                        <span class="result-value" id="confidence-level">--</span>
                                    </div>
                                    <div class="result-row">
                                        <span class="result-label">ä½¿ç”¨æ¨¡å‹</span>
                                        <span class="result-value" id="used-model">--</span>
                                    </div>
                                    <div class="result-row">
                                        <span class="result-label">ä¼°ä»·æ—¶é—´</span>
                                        <span class="result-value" id="valuation-time">--</span>
                                    </div>
                                </div>
                                
                                <!-- å›¾è¡¨é€‰é¡¹å¡ -->
                                <div class="result-card">
                                    <div style="display: flex; gap: 8px; margin-bottom: 16px;">
                                        <button class="btn active chart-tab" data-chart="feature-importance">ç‰¹å¾é‡è¦æ€§</button>
                                        <button class="btn chart-tab" data-chart="market-trend">å¸‚åœºè¶‹åŠ¿å¯¹æ¯”</button>
                                        <button class="btn chart-tab" data-chart="price-comparison">ä»·æ ¼å¯¹æ¯”åˆ†æ</button>
                                        <button class="btn chart-tab" data-chart="valuation-history">å†å²ä¼°ä»·è¶‹åŠ¿</button>
                                    </div>
                                    
                                    <!-- å›¾è¡¨å®¹å™¨ -->
                                    <div class="chart-container">
                                        <!-- ç‰¹å¾é‡è¦æ€§å›¾è¡¨ -->
                                        <div id="feature-importance-container" class="chart-panel active">
                                            <canvas id="feature-importance-chart" width="400" height="200"></canvas>
                                        </div>
                                        
                                        <!-- å¸‚åœºè¶‹åŠ¿å¯¹æ¯”å›¾è¡¨ -->
                                        <div id="market-trend-container" class="chart-panel" style="display: none;">
                                            <canvas id="market-trend-chart" width="400" height="200"></canvas>
                                        </div>
                                        
                                        <!-- ä»·æ ¼å¯¹æ¯”åˆ†æå›¾è¡¨ -->
                                        <div id="price-comparison-container" class="chart-panel" style="display: none;">
                                            <canvas id="price-comparison-chart" width="400" height="200"></canvas>
                                        </div>
                                        
                                        <!-- å†å²ä¼°ä»·è¶‹åŠ¿å›¾è¡¨ -->
                                        <div id="valuation-history-container" class="chart-panel" style="display: none;">
                                            <canvas id="valuation-history-chart" width="400" height="200"></canvas>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- å¸‚åœºåˆ†ææ‘˜è¦ -->
                                <div class="result-card">
                                    <h4 style="margin-top: 0; margin-bottom: 16px; color: #333;">ğŸ“ˆ å¸‚åœºåˆ†ææ‘˜è¦</h4>
                                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 16px;">
                                        <div class="data-item">
                                            <div class="data-value" id="market-trend-value">ç¨³å®š</div>
                                            <div class="data-label">å¸‚åœºè¶‹åŠ¿</div>
                                        </div>
                                        <div class="data-item">
                                            <div class="data-value" id="price-growth-rate">+2.5%</div>
                                            <div class="data-label">ä»·æ ¼å¢é•¿ç‡</div>
                                        </div>
                                        <div class="data-item">
                                            <div class="data-value" id="market-confidence">85%</div>
                                            <div class="data-label">å¸‚åœºä¿¡å¿ƒæŒ‡æ•°</div>
                                        </div>
                                        <div class="data-item">
                                            <div class="data-value" id="comparable-count">45</div>
                                            <div class="data-label">å¯æ¯”æ¡ˆä¾‹æ•°</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- æ“ä½œæŒ‰é’® -->
                                <div class="action-buttons" style="justify-content: center; margin-top: 20px;">
                                    <button class="btn" id="reset-valuation">ğŸ”„ é‡æ–°ä¼°ä»·</button>
                                    <button class="btn btn-primary" id="save-valuation">ğŸ’¾ ä¿å­˜ç»“æœ</button>
                                    <button class="btn btn-primary" id="compare-valuation">ğŸ“Š å¯¹æ¯”åˆ†æ</button>
                                    <button class="btn btn-primary" id="generate-report">ğŸ“„ ç”ŸæˆæŠ¥å‘Š</button>
                                </div>
                            </div>
                                
                                <!-- ä¼°ä»·è¯´æ˜ï¼ˆå¯Œæ–‡æœ¬ç¼–è¾‘å™¨ï¼‰ -->
                                <div class="form-section">
                                    <h3>ğŸ“ ä¼°ä»·è¯´æ˜</h3>
                                    <div style="background: white; padding: 10px; border-radius: 8px; border: 1px solid #e0e0e0;">
                                        <textarea id="valuation-description" name="valuation_description" placeholder="è¯·è¾“å…¥ä¼°ä»·è¯´æ˜ã€å¤‡æ³¨æˆ–ä¸“ä¸šåˆ†æ..." style="width: 100%; height: 300px;"></textarea>
                                    </div>
                                </div>
                                
                                <!-- å‚æ•°åŒ–é…ç½® -->
                                <div class="form-section">
                                    <h3>âš™ï¸ å‚æ•°åŒ–é…ç½®</h3>
                                    <div style="background: white; padding: 20px; border-radius: 8px; border: 1px solid #e0e0e0;">
                                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                                            <div>
                                                <h4 style="margin: 0; font-size: 14px; color: #333;">ä¼°ä»·æ¨¡å‹å‚æ•°</h4>
                                                <p style="margin: 4px 0 0 0; font-size: 12px; color: #999;">è°ƒæ•´ä¼°ä»·ç®—æ³•çš„å„é¡¹å‚æ•°</p>
                                            </div>
                                            <div style="display: flex; gap: 10px;">
                                                <select id="template-select" style="padding: 6px 12px; border: 1px solid #e0e0e0; border-radius: 4px; font-size: 12px;">
                                                    <option value="">é€‰æ‹©æ¨¡æ¿</option>
                                                    <option value="default">é»˜è®¤æ¨¡æ¿</option>
                                                </select>
                                                <button id="save-template-btn" class="btn btn-primary" style="padding: 6px 12px; font-size: 12px;">ğŸ’¾ ä¿å­˜æ¨¡æ¿</button>
                                                <button id="delete-template-btn" class="btn" style="padding: 6px 12px; font-size: 12px;">ğŸ—‘ï¸ åˆ é™¤</button>
                                            </div>
                                        </div>
                                        
                                        <div class="form-row" style="margin-bottom: 16px;">
                                            <div class="form-group">
                                                <label>æŠ˜æ—§ç‡ (%)</label>
                                                <input type="number" id="depreciation-rate" placeholder="è¯·è¾“å…¥æŠ˜æ—§ç‡" step="0.1" min="0" max="10" value="0.5">
                                            </div>
                                            <div class="form-group">
                                                <label>åœ°æ®µç³»æ•°</label>
                                                <input type="number" id="location-factor" placeholder="è¯·è¾“å…¥åœ°æ®µç³»æ•°" step="0.1" min="0.5" max="2" value="1">
                                            </div>
                                        </div>
                                        
                                        <div class="form-row" style="margin-bottom: 16px;">
                                            <div class="form-group">
                                                <label>è£…ä¿®ç³»æ•°</label>
                                                <input type="number" id="decoration-factor" placeholder="è¯·è¾“å…¥è£…ä¿®ç³»æ•°" step="0.1" min="0.5" max="2" value="1">
                                            </div>
                                            <div class="form-group">
                                                <label>é…å¥—è®¾æ–½ç³»æ•°</label>
                                                <input type="number" id="facility-factor" placeholder="è¯·è¾“å…¥é…å¥—è®¾æ–½ç³»æ•°" step="0.1" min="0.5" max="2" value="1">
                                            </div>
                                        </div>
                                        
                                        <div class="form-row" style="margin-bottom: 16px;">
                                            <div class="form-group">
                                                <label>æ¥¼å±‚ç³»æ•°</label>
                                                <input type="number" id="floor-factor" placeholder="è¯·è¾“å…¥æ¥¼å±‚ç³»æ•°" step="0.1" min="0.5" max="2" value="1">
                                            </div>
                                            <div class="form-group">
                                                <label>æœå‘ç³»æ•°</label>
                                                <input type="number" id="orientation-factor" placeholder="è¯·è¾“å…¥æœå‘ç³»æ•°" step="0.1" min="0.5" max="2" value="1">
                                            </div>
                                        </div>
                                        
                                        <div style="display: flex; gap: 10px; margin-top: 20px;">
                                            <button id="apply-params-btn" class="btn btn-primary" style="flex: 1; padding: 8px 16px; font-size: 13px;">âœ… åº”ç”¨å‚æ•°</button>
                                            <button id="reset-params-btn" class="btn" style="padding: 8px 16px; font-size: 13px;">ğŸ”„ é‡ç½®å‚æ•°</button>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- ä¼°ä»·ç»“æœé¢„è§ˆ -->
                                <div class="valuation-preview">
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                                        <h3 style="margin: 0; font-size: 15px;">ğŸ’¡ AIä¼°ä»·é¢„è§ˆ</h3>
                                        <div style="display: flex; gap: 10px; align-items: center;">
                                            <div style="display: flex; gap: 5px;">
                                                <button id="save-scheme-btn" class="btn btn-primary" style="padding: 6px 12px; font-size: 12px;">ğŸ’¾ ä¿å­˜æ–¹æ¡ˆ</button>
                                                <button id="compare-schemes-btn" class="btn" style="padding: 6px 12px; font-size: 12px;">ğŸ”„ å¯¹æ¯”æ–¹æ¡ˆ</button>
                                            </div>
                                            <select id="scheme-select" style="padding: 6px 12px; border: 1px solid #e0e0e0; border-radius: 4px; font-size: 12px;">
                                                <option value="current">å½“å‰æ–¹æ¡ˆ</option>
                                            </select>
                                        </div>
                                    </div>
                                    
                                    <!-- æ–¹æ¡ˆå¯¹æ¯”è§†å›¾ -->
                                    <div id="scheme-compare-view" style="display: none; margin-bottom: 20px;">
                                        <div style="background: #f0f4ff; padding: 16px; border-radius: 8px; margin-bottom: 16px;">
                                            <h4 style="margin: 0 0 12px 0; font-size: 14px; color: #667eea;">ğŸ“Š å¤šæ–¹æ¡ˆå¯¹æ¯”</h4>
                                            <div id="compare-results" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 16px;"></div>
                                        </div>
                                    </div>
                                    
                                    <div class="result-card">
                                        <div class="result-row">
                                            <div class="result-label">é¢„ä¼°å•ä»·</div>
                                            <div class="result-value">12,800 å…ƒ/ã¡</div>
                                        </div>
                                        <div class="result-row">
                                            <div class="result-label">é¢„ä¼°æ€»ä»·</div>
                                            <div class="result-value">Â¥ 1,536,000</div>
                                        </div>
                                        <div class="result-row">
                                            <div class="result-label">å¸‚åœºå‚è€ƒä»·åŒºé—´</div>
                                            <div class="result-value">12,500 - 13,200 å…ƒ/ã¡</div>
                                        </div>
                                        <div class="result-row">
                                            <div class="result-label">ä¼°ä»·æ—¶é—´</div>
                                            <div class="result-value">2025-12-27 15:45</div>
                                        </div>
                                    </div>
                                    
                                    <!-- æ•°æ®å¯è§†åŒ–å›¾è¡¨ -->
                                    <div style="margin-top: 24px; display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 20px;">
                                        <!-- é¥¼å›¾ï¼šç‰©ä¸šç±»å‹åˆ†å¸ƒ -->
                                        <div style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 1px 4px rgba(0,0,0,0.05);">
                                            <h4 style="margin-bottom: 16px; color: #333;">ç‰©ä¸šç±»å‹åˆ†å¸ƒ</h4>
                                            <canvas id="propertyTypeChart" height="300"></canvas>
                                        </div>
                                        
                                        <!-- æŸ±çŠ¶å›¾ï¼šåŒºåŸŸå¹³å‡ä»·æ ¼ -->
                                        <div style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 1px 4px rgba(0,0,0,0.05);">
                                            <h4 style="margin-bottom: 16px; color: #333;">åŒºåŸŸå¹³å‡ä»·æ ¼å¯¹æ¯”</h4>
                                            <canvas id="areaPriceChart" height="300"></canvas>
                                        </div>
                                        
                                        <!-- æŠ˜çº¿å›¾ï¼šå†å²ä¼°ä»·è¶‹åŠ¿ -->
                                        <div style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 1px 4px rgba(0,0,0,0.05); grid-column: 1 / -1;">
                                            <h4 style="margin-bottom: 16px; color: #333;">å†å²ä¼°ä»·è¶‹åŠ¿</h4>
                                            <canvas id="priceTrendChart" height="300"></canvas>
                                        </div>
                                        
                                        <!-- æ•£ç‚¹å›¾ï¼šé¢ç§¯ä¸ä»·æ ¼å…³ç³» -->
                                        <div style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 1px 4px rgba(0,0,0,0.05); grid-column: 1 / -1;">
                                            <h4 style="margin-bottom: 16px; color: #333;">é¢ç§¯ä¸ä»·æ ¼å…³ç³»</h4>
                                            <canvas id="areaPriceScatterChart" height="300"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                        
                        <!-- æ“ä½œæŒ‰é’®åŒº -->
                        <div class="action-buttons">
                            <button class="btn">é‡ç½®</button>
                            <button id="generate-report-btn" class="btn btn-primary btn-large">ğŸ“Š ç”Ÿæˆä¼°ä»·æŠ¥å‘Š</button>
                            <button id="export-word-btn" class="btn btn-large" style="background-color: #1890ff; color: white;">ğŸ“„ å¯¼å‡ºWord</button>
                            <button id="export-pdf-btn" class="btn btn-large" style="background-color: #f5222d; color: white;">ğŸ“‘ å¯¼å‡ºPDF</button>
                            <button id="ai-valuation-btn" class="btn btn-large" style="background-color: #52c41a; color: white;">ğŸš€ AIæ™ºèƒ½ä¼°ä»·</button>
                        </div>
                    </div>
                    
                    <!-- å³ä¾§è¾…åŠ©é¢æ¿ -->
                    <div class="right-sidebar">
                        <!-- è¾…åŠ©é¢æ¿æ ‡ç­¾é¡µ -->
                        <div class="sidebar-tabs" style="display: flex; border-bottom: 1px solid #e0e0e0;">
                            <div class="sidebar-tab active" data-tab="ai-assistant" style="flex: 1; padding: 12px; text-align: center; cursor: pointer; border-right: 1px solid #e0e0e0; font-size: 14px;">
                                ğŸ¤– AIåŠ©æ‰‹
                            </div>
                            <div class="sidebar-tab" data-tab="history" style="flex: 1; padding: 12px; text-align: center; cursor: pointer; border-right: 1px solid #e0e0e0; font-size: 14px;">
                                ğŸ“‹ å†å²è®°å½•
                            </div>
                            <div class="sidebar-tab" data-tab="logs" style="flex: 1; padding: 12px; text-align: center; cursor: pointer; font-size: 14px;">
                                ğŸ“ æ“ä½œæ—¥å¿—
                            </div>
                        </div>
                        
                        <!-- AIåŠ©æ‰‹ -->
                        <div id="ai-assistant" class="sidebar-panel active">
                            <div class="ai-header" style="border-bottom: 1px solid #e0e0e0; padding: 16px;">
                                <h3 style="font-size: 16px; font-weight: bold; color: #333;">ğŸ¤– AIåŠ©æ‰‹</h3>
                            </div>
                            <div class="ai-chat" style="flex: 1; padding: 16px; overflow-y: auto; display: flex; flex-direction: column; gap: 16px;">
                                <div class="chat-message ai" style="max-width: 85%; padding: 12px 16px; border-radius: 18px; font-size: 14px; background-color: #f0f4ff; align-self: flex-start; color: #333;">
                                    æ‚¨å¥½ï¼æˆ‘æ˜¯ValuHubAIåŠ©æ‰‹ï¼Œæœ‰ä»€ä¹ˆå¯ä»¥å¸®åŠ©æ‚¨çš„å—ï¼Ÿ
                                </div>
                                <div class="chat-message user" style="max-width: 85%; padding: 12px 16px; border-radius: 18px; font-size: 14px; background-color: #667eea; align-self: flex-end; color: white;">
                                    å¸®æˆ‘åˆ†æä¸€ä¸‹é•¿æ²™ä¸‡ç§‘åŸçš„ä¼°ä»·
                                </div>
                                <div class="chat-message ai" style="max-width: 85%; padding: 12px 16px; border-radius: 18px; font-size: 14px; background-color: #f0f4ff; align-self: flex-start; color: #333;">
                                    å¥½çš„ï¼Œæ­£åœ¨ä¸ºæ‚¨åˆ†æé•¿æ²™ä¸‡ç§‘åŸçš„ä¼°ä»·æƒ…å†µ..
                                </div>
                            </div>
                            <div class="ai-input-area" style="padding: 16px; border-top: 1px solid #e0e0e0;">
                                <div class="ai-input" style="display: flex; gap: 10px;">
                                    <input type="text" placeholder="è¯·è¾“å…¥æ‚¨çš„é—®é¢˜.." style="flex: 1; padding: 12px; border: 1px solid #e0e0e0; border-radius: 25px; font-size: 14px;">
                                    <button style="padding: 12px 20px; background-color: #667eea; color: white; border: none; border-radius: 25px; cursor: pointer;">å‘é€</button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- å†å²è®°å½• -->
                        <div id="history" class="sidebar-panel" style="display: none; flex: 1; flex-direction: column;">
                            <div style="border-bottom: 1px solid #e0e0e0; padding: 16px;">
                                <h3 style="font-size: 16px; font-weight: bold; color: #333;">ğŸ“‹ å†å²è®°å½•</h3>
                            </div>
                            <div style="flex: 1; padding: 16px; overflow-y: auto;">
                                <div style="background: #f8f9fa; padding: 12px; border-radius: 6px; margin-bottom: 12px; cursor: pointer; transition: all 0.3s ease;">
                                    <div style="font-weight: 500; margin-bottom: 4px;">é•¿æ²™ä¸‡ç§‘åŸä¼°ä»·</div>
                                    <div style="font-size: 12px; color: #999;">2025-12-27 15:45</div>
                                </div>
                                <div style="background: #f8f9fa; padding: 12px; border-radius: 6px; margin-bottom: 12px; cursor: pointer; transition: all 0.3s ease;">
                                    <div style="font-weight: 500; margin-bottom: 4px;">å²³éº“åŒºäºŒæ‰‹æˆ¿åˆ†æ</div>
                                    <div style="font-size: 12px; color: #999;">2025-12-26 10:15</div>
                                </div>
                                <div style="background: #f8f9fa; padding: 12px; border-radius: 6px; margin-bottom: 12px; cursor: pointer; transition: all 0.3s ease;">
                                    <div style="font-weight: 500; margin-bottom: 4px;">å•†ä¸šåœ°äº§ä¼°ä»·</div>
                                    <div style="font-size: 12px; color: #999;">2025-12-25 16:45</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- æ“ä½œæ—¥å¿— -->
                        <div id="logs" class="sidebar-panel" style="display: none; flex: 1; flex-direction: column;">
                            <div style="border-bottom: 1px solid #e0e0e0; padding: 16px;">
                                <h3 style="font-size: 16px; font-weight: bold; color: #333;">ğŸ“ æ“ä½œæ—¥å¿—</h3>
                            </div>
                            <div style="flex: 1; padding: 16px; overflow-y: auto; font-size: 13px;">
                                <div style="margin-bottom: 12px; padding-bottom: 12px; border-bottom: 1px solid #f0f0f0;">
                                    <div style="color: #667eea; font-weight: 500; margin-bottom: 4px;">2025-12-27 15:45</div>
                                    <div style="color: #666;">ç”Ÿæˆäº†é•¿æ²™ä¸‡ç§‘åŸä¼°ä»·æŠ¥å‘Š</div>
                                </div>
                                <div style="margin-bottom: 12px; padding-bottom: 12px; border-bottom: 1px solid #f0f0f0;">
                                    <div style="color: #667eea; font-weight: 500; margin-bottom: 4px;">2025-12-27 15:30</div>
                                    <div style="color: #666;">æ›´æ–°äº†é•¿æ²™ä¸‡ç§‘åŸçš„è¯¦ç»†å‚æ•°</div>
                                </div>
                                <div style="margin-bottom: 12px; padding-bottom: 12px; border-bottom: 1px solid #f0f0f0;">
                                    <div style="color: #667eea; font-weight: 500; margin-bottom: 4px;">2025-12-27 15:15</div>
                                    <div style="color: #666;">åˆ›å»ºäº†é•¿æ²™ä¸‡ç§‘åŸä¼°ä»·é¡¹ç›®</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- å¸‚åœºåˆ†ææ¨¡å— -->
                <div id="market-analysis" class="module-content">
                    <div class="file-manager">
                        <div class="file-manager-header">
                            <h3>å¸‚åœºåˆ†ææŠ¥å‘Š</h3>
                            <div class="file-actions">
                                <button class="btn">ğŸ“</button>
                                <button class="btn btn-primary">+ æ–°å»º</button>
                            </div>
                        </div>
                        <div class="file-list">
                            <div class="file-item">
                                <div style="font-weight: 500; margin-bottom: 4px;">é•¿æ²™åŒºåŸŸå¸‚åœºåˆ†æ</div>
                                <div style="font-size: 12px; color: #999;">2025-12-27 14:30</div>
                            </div>
                        </div>
                    </div>
                    <div class="editor-area">
                        <div class="editor-header">
                            <div class="editor-title">å¸‚åœºåˆ†æ</div>
                        </div>
                        <div class="editor-content">
                            <div class="market-analysis">
                                <h3>ğŸ“Š å¸‚åœºåˆ†æ</h3>
                                <div class="form-row" style="margin-bottom: 20px;">
                                    <div class="form-group">
                                        <label>é€‰æ‹©åŸå¸‚</label>
                                        <select id="market-city">
                                            <option value="é•¿æ²™">é•¿æ²™</option>
                                            <option value="åŒ—äº¬">åŒ—äº¬</option>
                                            <option value="ä¸Šæµ·">ä¸Šæµ·</option>
                                            <option value="å¹¿å·">å¹¿å·</option>
                                            <option value="æ·±åœ³">æ·±åœ³</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label>é€‰æ‹©æ—¶é—´æ®µ</label>
                                        <select id="market-timeframe">
                                            <option value="3months">è¿‘3ä¸ªæœˆ</option>
                                            <option value="6months">è¿‘6ä¸ªæœˆ</option>
                                            <option value="1year">è¿‘1å¹´</option>
                                            <option value="3years">è¿‘3å¹´</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <!-- ä»·æ ¼è¶‹åŠ¿å›¾ -->
                                <div style="margin-bottom: 30px;">
                                    <h4 style="margin-bottom: 15px; color: #333;">æˆ¿ä»·è¶‹åŠ¿</h4>
                                    <div style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 1px 4px rgba(0,0,0,0.05);">
                                        <canvas id="priceTrendChart" width="400" height="200"></canvas>
                                    </div>
                                </div>
                                
                                <!-- æˆäº¤é‡å¯¹æ¯”å›¾ -->
                                <div style="margin-bottom: 30px;">
                                    <h4 style="margin-bottom: 15px; color: #333;">æˆäº¤é‡å¯¹æ¯”</h4>
                                    <div style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 1px 4px rgba(0,0,0,0.05);">
                                        <canvas id="volumeChart" width="400" height="200"></canvas>
                                    </div>
                                </div>
                                
                                <!-- å¸‚åœºæ•°æ®ç»Ÿè®¡ -->
                                <div class="market-data">
                                    <div class="data-item">
                                        <div class="data-value">12,800</div>
                                        <div class="data-label">å¹³å‡å•ä»·(å…ƒ/ã¡)</div>
                                    </div>
                                    <div class="data-item">
                                        <div class="data-value">+3.2%</div>
                                        <div class="data-label">ç¯æ¯”æ¶¨å¹…</div>
                                    </div>
                                    <div class="data-item">
                                        <div class="data-value">1,256</div>
                                        <div class="data-label">åœ¨å”®æˆ¿æº</div>
                                    </div>
                                    <div class="data-item">
                                        <div class="data-value">89</div>
                                        <div class="data-label">æœ¬æœˆæˆäº¤</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="ai-assistant">
                        <div class="ai-header">
                            <h3>ğŸ¤– AIåŠ©æ‰‹</h3>
                        </div>
                        <div class="ai-chat">
                            <div class="chat-message ai">
                                æ‚¨å¥½ï¼æˆ‘æ˜¯ValuHubAIåŠ©æ‰‹ï¼Œæœ‰ä»€ä¹ˆå¯ä»¥å¸®åŠ©æ‚¨çš„å—ï¼Ÿ
                            </div>
                        </div>
                        <div class="ai-input-area">
                            <div class="ai-input">
                                <input type="text" placeholder="è¯·è¾“å…¥æ‚¨çš„é—®é¢˜..">
                                <button>å‘é€</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- æ¡ˆä¾‹åº“æ¨¡å— -->
                <div id="case-library" class="module-content">
                    <div class="file-manager">
                        <div class="file-manager-header">
                            <h3>æ¡ˆä¾‹åº“åˆ†ç±»</h3>
                            <div class="file-actions">
                                <button class="btn">ğŸ“</button>
                                <button class="btn btn-primary">+ æ–°å»ºåˆ†ç±»</button>
                            </div>
                        </div>
                        <div class="file-list">
                            <div class="file-item">
                                <div style="font-weight: 500; margin-bottom: 4px;">ä½å®…æ¡ˆä¾‹</div>
                                <div style="font-size: 12px; color: #999;">126ä¸ªæ¡ˆä¾‹</div>
                            </div>
                        </div>
                    </div>
                    <div class="editor-area">
                        <div class="editor-header">
                            <div class="editor-title">æ¡ˆä¾‹åº“</div>
                        </div>
                        <div class="editor-content">
                            <div class="case-library">
                                <h3>ğŸ˜ï¸ æ¡ˆä¾‹åº“</h3>
                                
                                <!-- æœç´¢æ  -->
                                <div style="margin-bottom: 20px;">
                                    <div class="form-row">
                                        <div class="form-group" style="flex: 1;">
                                            <input type="text" id="case-search" placeholder="æœç´¢æ¡ˆä¾‹..." style="width: 100%;">
                                        </div>
                                        <div class="form-group" style="margin-left: 10px;">
                                            <select id="case-type">
                                                <option value="">æ‰€æœ‰ç±»å‹</option>
                                                <option value="ä½å®…">ä½å®…</option>
                                                <option value="å†™å­—æ¥¼">å†™å­—æ¥¼</option>
                                                <option value="å•†é“º">å•†é“º</option>
                                                <option value="åˆ«å¢…">åˆ«å¢…</option>
                                            </select>
                                        </div>
                                        <div class="form-group" style="margin-left: 10px;">
                                            <button class="btn btn-primary" id="search-btn">æœç´¢</button>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- æ¡ˆä¾‹åˆ—è¡¨ -->
                                <div id="case-list" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 16px;">
                                    <!-- æ¡ˆä¾‹å¡ç‰‡å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="ai-assistant">
                        <div class="ai-header">
                            <h3>ğŸ¤– AIåŠ©æ‰‹</h3>
                        </div>
                        <div class="ai-chat">
                            <div class="chat-message ai">
                                æ‚¨å¥½ï¼æˆ‘æ˜¯ValuHubAIåŠ©æ‰‹ï¼Œæœ‰ä»€ä¹ˆå¯ä»¥å¸®åŠ©æ‚¨çš„å—ï¼Ÿ
                            </div>
                        </div>
                        <div class="ai-input-area">
                            <div class="ai-input">
                                <input type="text" placeholder="è¯·è¾“å…¥æ‚¨çš„é—®é¢˜..">
                                <button>å‘é€</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- æŠ•èµ„åˆ†ææ¨¡å— -->
                <div id="investment-analysis" class="module-content">
                    <div class="file-manager">
                        <div class="file-manager-header">
                            <h3>æŠ•èµ„åˆ†ææŠ¥å‘Š</h3>
                            <div class="file-actions">
                                <button class="btn">ğŸ“</button>
                                <button class="btn btn-primary">+ æ–°å»º</button>
                            </div>
                        </div>
                        <div class="file-list">
                            <div class="file-item">
                                <div style="font-weight: 500; margin-bottom: 4px;">é•¿æ²™æŠ•èµ„åˆ†æ</div>
                                <div style="font-size: 12px; color: #999;">2025-12-27 14:30</div>
                            </div>
                        </div>
                    </div>
                    <div class="editor-area">
                        <div class="editor-header">
                            <div class="editor-title">æŠ•èµ„åˆ†æ</div>
                        </div>
                        <div class="editor-content">
                            <div class="investment-analysis">
                                <h3>ğŸ“ˆ æŠ•èµ„åˆ†æ</h3>
                                
                                <!-- æŠ•èµ„å›æŠ¥ç‡è®¡ç®—å™¨ -->
                                <div style="background: white; padding: 24px; border-radius: 8px; box-shadow: 0 1px 4px rgba(0,0,0,0.05);">
                                    <h4 style="margin-bottom: 20px; color: #333;">æŠ•èµ„å›æŠ¥ç‡è®¡ç®—å™¨</h4>
                                    
                                    <div class="form-row" style="margin-bottom: 16px;">
                                        <div class="form-group">
                                            <label>è´­ä¹°æ€»ä»· (ä¸‡å…ƒ)</label>
                                            <input type="number" id="purchase-price" placeholder="è¯·è¾“å…¥è´­ä¹°æ€»ä»·" step="0.1">
                                        </div>
                                        <div class="form-group">
                                            <label>é¦–ä»˜æ¯”ä¾‹ (%)</label>
                                            <input type="number" id="down-payment-ratio" placeholder="è¯·è¾“å…¥é¦–ä»˜æ¯”ä¾‹" step="1" min="0" max="100">
                                        </div>
                                    </div>
                                    
                                    <div class="form-row" style="margin-bottom: 16px;">
                                        <div class="form-group">
                                            <label>è´·æ¬¾å¹´é™ (å¹´)</label>
                                            <input type="number" id="loan-term" placeholder="è¯·è¾“å…¥è´·æ¬¾å¹´é™" step="1" min="1" max="30">
                                        </div>
                                        <div class="form-group">
                                            <label>è´·æ¬¾åˆ©ç‡ (%)</label>
                                            <input type="number" id="loan-rate" placeholder="è¯·è¾“å…¥è´·æ¬¾åˆ©ç‡" step="0.01" min="0">
                                        </div>
                                    </div>
                                    
                                    <div class="form-row" style="margin-bottom: 16px;">
                                        <div class="form-group">
                                            <label>é¢„æœŸå¹´ç§Ÿé‡‘ (ä¸‡å…ƒ)</label>
                                            <input type="number" id="annual-rent" placeholder="è¯·è¾“å…¥é¢„æœŸå¹´ç§Ÿé‡‘" step="0.1">
                                        </div>
                                        <div class="form-group">
                                            <label>é¢„æœŸå¹´å¢å€¼ç‡ (%)</label>
                                            <input type="number" id="annual-appreciation" placeholder="è¯·è¾“å…¥é¢„æœŸå¹´å¢å€¼ç‡" step="0.1">
                                        </div>
                                    </div>
                                    
                                    <div class="form-row" style="margin-bottom: 24px;">
                                        <div class="form-group">
                                            <label>æŒæœ‰å¹´é™ (å¹´)</label>
                                            <input type="number" id="holding-period" placeholder="è¯·è¾“å…¥æŒæœ‰å¹´é™" step="1" min="1">
                                        </div>
                                        <div class="form-group">
                                            <label>äº¤æ˜“ç¨è´¹ç‡ (%)</label>
                                            <input type="number" id="tax-rate" placeholder="è¯·è¾“å…¥äº¤æ˜“ç¨è´¹ç‡" step="0.1" min="0">
                                        </div>
                                    </div>
                                    
                                    <div style="text-align: center; margin-bottom: 20px;">
                                        <button class="btn btn-primary btn-large" id="calculate-roi">è®¡ç®—æŠ•èµ„å›æŠ¥ç‡</button>
                                    </div>
                                    
                                    <!-- è®¡ç®—ç»“æœ -->
                                    <div id="roi-results" style="display: none; background: #f8f9fa; padding: 20px; border-radius: 6px; margin-top: 20px;">
                                        <h5 style="margin-bottom: 16px; color: #333;">è®¡ç®—ç»“æœ</h5>
                                        
                                        <div class="form-row" style="margin-bottom: 12px;">
                                            <div class="form-group" style="flex: 1;">
                                                <label style="color: #666; font-size: 14px;">é¦–ä»˜é‡‘é¢ (ä¸‡å…ƒ)</label>
                                                <div id="down-payment" style="font-weight: 500; font-size: 16px;"></div>
                                            </div>
                                            <div class="form-group" style="flex: 1;">
                                                <label style="color: #666; font-size: 14px;">è´·æ¬¾é‡‘é¢ (ä¸‡å…ƒ)</label>
                                                <div id="loan-amount" style="font-weight: 500; font-size: 16px;"></div>
                                            </div>
                                        </div>
                                        
                                        <div class="form-row" style="margin-bottom: 12px;">
                                            <div class="form-group" style="flex: 1;">
                                                <label style="color: #666; font-size: 14px;">æœˆä¾›é‡‘é¢ (å…ƒ)</label>
                                                <div id="monthly-payment" style="font-weight: 500; font-size: 16px;"></div>
                                            </div>
                                            <div class="form-group" style="flex: 1;">
                                                <label style="color: #666; font-size: 14px;">æ€»åˆ©æ¯æ”¯å‡º (ä¸‡å…ƒ)</label>
                                                <div id="total-interest" style="font-weight: 500; font-size: 16px;"></div>
                                            </div>
                                        </div>
                                        
                                        <div class="form-row" style="margin-bottom: 12px;">
                                            <div class="form-group" style="flex: 1;">
                                                <label style="color: #666; font-size: 14px;">æ€»ç§Ÿé‡‘æ”¶å…¥ (ä¸‡å…ƒ)</label>
                                                <div id="total-rent" style="font-weight: 500; font-size: 16px;"></div>
                                            </div>
                                            <div class="form-group" style="flex: 1;">
                                                <label style="color: #666; font-size: 14px;">æˆ¿äº§å¢å€¼åæ€»ä»· (ä¸‡å…ƒ)</label>
                                                <div id="future-value" style="font-weight: 500; font-size: 16px;"></div>
                                            </div>
                                        </div>
                                        
                                        <div class="form-row" style="margin-bottom: 12px;">
                                            <div class="form-group" style="flex: 1;">
                                                <label style="color: #666; font-size: 14px;">æ€»æŠ•èµ„æ”¶ç›Š (ä¸‡å…ƒ)</label>
                                                <div id="total-profit" style="font-weight: 500; font-size: 16px; color: #52c41a;"></div>
                                            </div>
                                            <div class="form-group" style="flex: 1;">
                                                <label style="color: #666; font-size: 14px;">æŠ•èµ„å›æŠ¥ç‡ (%)</label>
                                                <div id="roi" style="font-weight: 500; font-size: 18px; color: #52c41a;"></div>
                                            </div>
                                        </div>
                                        
                                        <div class="form-row">
                                            <div class="form-group" style="flex: 1;">
                                                <label style="color: #666; font-size: 14px;">å¹´åŒ–æŠ•èµ„å›æŠ¥ç‡ (%)</label>
                                                <div id="annual-roi" style="font-weight: 500; font-size: 18px; color: #52c41a;"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="ai-assistant">
                        <div class="ai-header">
                            <h3>ğŸ¤– AIåŠ©æ‰‹</h3>
                        </div>
                        <div class="ai-chat">
                            <div class="chat-message ai">
                                æ‚¨å¥½ï¼æˆ‘æ˜¯ValuHubAIåŠ©æ‰‹ï¼Œæœ‰ä»€ä¹ˆå¯ä»¥å¸®åŠ©æ‚¨çš„å—ï¼Ÿ
                            </div>
                        </div>
                        <div class="ai-input-area">
                            <div class="ai-input">
                                <input type="text" placeholder="è¯·è¾“å…¥æ‚¨çš„é—®é¢˜..">
                                <button>å‘é€</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- å·¥å…·é›†æ¨¡å— -->
                <div id="tool-set" class="module-content">
                    <div class="file-manager">
                        <div class="file-manager-header">
                            <h3>å·¥å…·é›†</h3>
                            <div class="file-actions">
                                <button class="btn">ğŸ“</button>
                                <button class="btn btn-primary">+ æ·»åŠ å·¥å…·</button>
                            </div>
                        </div>
                        <div class="file-list">
                            <div class="file-item">
                                <div style="font-weight: 500; margin-bottom: 4px;">è®¡ç®—å™¨</div>
                                <div style="font-size: 12px; color: #999;">å¸¸ç”¨å·¥å…·</div>
                            </div>
                        </div>
                    </div>
                    <div class="editor-area">
                        <div class="editor-header">
                            <div class="editor-title">å·¥å…·é›†</div>
                        </div>
                        <div class="editor-content">
                            <div class="tool-set">
                                <h3>ğŸ”§ å·¥å…·é›†</h3>
                                
                                <!-- å·¥å…·æ ‡ç­¾é¡µ -->
                                <div class="editor-tabs" style="margin-bottom: 20px;">
                                    <div class="tab active" data-tool="mortgage-calculator">æˆ¿è´·è®¡ç®—å™¨</div>
                                    <div class="tab" data-tool="tax-calculator">ç¨è´¹è®¡ç®—å™¨</div>
                                    <div class="tab" data-tool="area-converter">é¢ç§¯æ¢ç®—å™¨</div>
                                    <div class="tab" data-tool="rent-roi-calculator">ç§Ÿé‡‘å›æŠ¥ç‡è®¡ç®—å™¨</div>
                                </div>
                                
                                <!-- å·¥å…·å†…å®¹åŒºåŸŸ -->
                                <div class="tool-content" style="background: white; padding: 24px; border-radius: 8px; box-shadow: 0 1px 4px rgba(0,0,0,0.05);">
                                    <!-- æˆ¿è´·è®¡ç®—å™¨ -->
                                    <div id="mortgage-calculator" class="tool-panel active">
                                        <h4 style="margin-bottom: 20px; color: #333;">æˆ¿è´·è®¡ç®—å™¨</h4>
                                        
                                        <div class="form-row" style="margin-bottom: 16px;">
                                            <div class="form-group">
                                                <label>è´·æ¬¾é‡‘é¢ (ä¸‡å…ƒ)</label>
                                                <input type="number" id="mortgage-amount" placeholder="è¯·è¾“å…¥è´·æ¬¾é‡‘é¢" step="0.1">
                                            </div>
                                            <div class="form-group">
                                                <label>è´·æ¬¾å¹´é™ (å¹´)</label>
                                                <input type="number" id="mortgage-term" placeholder="è¯·è¾“å…¥è´·æ¬¾å¹´é™" step="1" min="1" max="30">
                                            </div>
                                        </div>
                                        
                                        <div class="form-row" style="margin-bottom: 16px;">
                                            <div class="form-group">
                                                <label>è´·æ¬¾åˆ©ç‡ (%)</label>
                                                <input type="number" id="mortgage-rate" placeholder="è¯·è¾“å…¥è´·æ¬¾åˆ©ç‡" step="0.01" min="0">
                                            </div>
                                            <div class="form-group">
                                                <label>è¿˜æ¬¾æ–¹å¼</label>
                                                <select id="repayment-method">
                                                    <option value="equal-principal-interest">ç­‰é¢æœ¬æ¯</option>
                                                    <option value="equal-principal">ç­‰é¢æœ¬é‡‘</option>
                                                </select>
                                            </div>
                                        </div>
                                        
                                        <div style="text-align: center; margin-bottom: 20px;">
                                            <button class="btn btn-primary" id="calculate-mortgage">è®¡ç®—</button>
                                        </div>
                                        
                                        <div id="mortgage-results" style="display: none; background: #f8f9fa; padding: 16px; border-radius: 6px; margin-top: 16px;">
                                            <div class="form-row" style="margin-bottom: 12px;">
                                                <div class="form-group" style="flex: 1;">
                                                    <label style="color: #666; font-size: 14px;">æœˆä¾›é‡‘é¢ (å…ƒ)</label>
                                                    <div id="mortgage-monthly-payment" style="font-weight: 500; font-size: 16px;"></div>
                                                </div>
                                                <div class="form-group" style="flex: 1;">
                                                    <label style="color: #666; font-size: 14px;">æ€»åˆ©æ¯ (ä¸‡å…ƒ)</label>
                                                    <div id="mortgage-total-interest" style="font-weight: 500; font-size: 16px;"></div>
                                                </div>
                                            </div>
                                            <div class="form-row">
                                                <div class="form-group" style="flex: 1;">
                                                    <label style="color: #666; font-size: 14px;">è¿˜æ¬¾æ€»é¢ (ä¸‡å…ƒ)</label>
                                                    <div id="mortgage-total-payment" style="font-weight: 500; font-size: 16px;"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- ç¨è´¹è®¡ç®—å™¨ -->
                                    <div id="tax-calculator" class="tool-panel">
                                        <h4 style="margin-bottom: 20px; color: #333;">ç¨è´¹è®¡ç®—å™¨</h4>
                                        
                                        <div class="form-row" style="margin-bottom: 16px;">
                                            <div class="form-group">
                                                <label>æˆ¿å±‹æ€»ä»· (ä¸‡å…ƒ)</label>
                                                <input type="number" id="tax-house-price" placeholder="è¯·è¾“å…¥æˆ¿å±‹æ€»ä»·" step="0.1">
                                            </div>
                                            <div class="form-group">
                                                <label>æˆ¿å±‹é¢ç§¯ (ã¡)</label>
                                                <input type="number" id="tax-house-area" placeholder="è¯·è¾“å…¥æˆ¿å±‹é¢ç§¯" step="0.1">
                                            </div>
                                        </div>
                                        
                                        <div class="form-row" style="margin-bottom: 16px;">
                                            <div class="form-group">
                                                <label>æˆ¿å±‹ç±»å‹</label>
                                                <select id="tax-house-type">
                                                    <option value="normal">æ™®é€šä½å®…</option>
                                                    <option value="non-normal">éæ™®é€šä½å®…</option>
                                                    <option value="commercial">å•†ä¸šåœ°äº§</option>
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label>æ˜¯å¦é¦–å¥—æˆ¿</label>
                                                <select id="tax-first-home">
                                                    <option value="yes">æ˜¯</option>
                                                    <option value="no">å¦</option>
                                                </select>
                                            </div>
                                        </div>
                                        
                                        <div style="text-align: center; margin-bottom: 20px;">
                                            <button class="btn btn-primary" id="calculate-tax">è®¡ç®—</button>
                                        </div>
                                        
                                        <div id="tax-results" style="display: none; background: #f8f9fa; padding: 16px; border-radius: 6px; margin-top: 16px;">
                                            <div class="form-row" style="margin-bottom: 12px;">
                                                <div class="form-group" style="flex: 1;">
                                                    <label style="color: #666; font-size: 14px;">å¥‘ç¨ (å…ƒ)</label>
                                                    <div id="tax-deed" style="font-weight: 500; font-size: 16px;"></div>
                                                </div>
                                                <div class="form-group" style="flex: 1;">
                                                    <label style="color: #666; font-size: 14px;">å¢å€¼ç¨ (å…ƒ)</label>
                                                    <div id="tax-vat" style="font-weight: 500; font-size: 16px;"></div>
                                                </div>
                                            </div>
                                            <div class="form-row" style="margin-bottom: 12px;">
                                                <div class="form-group" style="flex: 1;">
                                                    <label style="color: #666; font-size: 14px;">ä¸ªäººæ‰€å¾—ç¨ (å…ƒ)</label>
                                                    <div id="tax-personal" style="font-weight: 500; font-size: 16px;"></div>
                                                </div>
                                                <div class="form-group" style="flex: 1;">
                                                    <label style="color: #666; font-size: 14px;">å°èŠ±ç¨ (å…ƒ)</label>
                                                    <div id="tax-stamp" style="font-weight: 500; font-size: 16px;"></div>
                                                </div>
                                            </div>
                                            <div class="form-row">
                                                <div class="form-group" style="flex: 1;">
                                                    <label style="color: #666; font-size: 14px;">æ€»ç¨è´¹ (å…ƒ)</label>
                                                    <div id="tax-total" style="font-weight: 500; font-size: 18px; color: #e53e3e;"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- é¢ç§¯æ¢ç®—å™¨ -->
                                    <div id="area-converter" class="tool-panel">
                                        <h4 style="margin-bottom: 20px; color: #333;">é¢ç§¯æ¢ç®—å™¨</h4>
                                        
                                        <div class="form-row" style="margin-bottom: 16px;">
                                            <div class="form-group" style="flex: 1;">
                                                <label>è¾“å…¥é¢ç§¯</label>
                                                <input type="number" id="area-input" placeholder="è¯·è¾“å…¥é¢ç§¯" step="0.01">
                                            </div>
                                            <div class="form-group" style="width: 100px; margin: 0 10px;">
                                                <label>å•ä½</label>
                                                <select id="area-from-unit">
                                                    <option value="square-meter">å¹³æ–¹ç±³ (ã¡)</option>
                                                    <option value="square-foot">å¹³æ–¹è‹±å°º (sq ft)</option>
                                                    <option value="acre">è‹±äº© (acre)</option>
                                                    <option value="hectare">å…¬é¡· (ha)</option>
                                                </select>
                                            </div>
                                            <div class="form-group" style="width: 100px; display: flex; align-items: flex-end;">
                                                <button class="btn btn-primary" style="height: 36px; width: 100%;">è½¬æ¢</button>
                                            </div>
                                        </div>
                                        
                                        <div class="form-row" style="margin-bottom: 16px;">
                                            <div class="form-group" style="flex: 1;">
                                                <label>è½¬æ¢ç»“æœ</label>
                                                <input type="number" id="area-output" readonly style="background: #f8f9fa; cursor: not-allowed;">
                                            </div>
                                            <div class="form-group" style="width: 100px; margin-left: 10px;">
                                                <label>å•ä½</label>
                                                <select id="area-to-unit">
                                                    <option value="square-meter">å¹³æ–¹ç±³ (ã¡)</option>
                                                    <option value="square-foot">å¹³æ–¹è‹±å°º (sq ft)</option>
                                                    <option value="acre">è‹±äº© (acre)</option>
                                                    <option value="hectare">å…¬é¡· (ha)</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- ç§Ÿé‡‘å›æŠ¥ç‡è®¡ç®—å™¨ -->
                                    <div id="rent-roi-calculator" class="tool-panel">
                                        <h4 style="margin-bottom: 20px; color: #333;">ç§Ÿé‡‘å›æŠ¥ç‡è®¡ç®—å™¨</h4>
                                        
                                        <div class="form-row" style="margin-bottom: 16px;">
                                            <div class="form-group">
                                                <label>æˆ¿å±‹æ€»ä»· (ä¸‡å…ƒ)</label>
                                                <input type="number" id="rent-roi-house-price" placeholder="è¯·è¾“å…¥æˆ¿å±‹æ€»ä»·" step="0.1">
                                            </div>
                                            <div class="form-group">
                                                <label>æœˆç§Ÿé‡‘ (å…ƒ)</label>
                                                <input type="number" id="rent-roi-monthly-rent" placeholder="è¯·è¾“å…¥æœˆç§Ÿé‡‘" step="100">
                                            </div>
                                        </div>
                                        
                                        <div style="text-align: center; margin-bottom: 20px;">
                                            <button class="btn btn-primary" id="calculate-rent-roi">è®¡ç®—</button>
                                        </div>
                                        
                                        <div id="rent-roi-results" style="display: none; background: #f8f9fa; padding: 16px; border-radius: 6px; margin-top: 16px;">
                                            <div class="form-row" style="margin-bottom: 12px;">
                                                <div class="form-group" style="flex: 1;">
                                                    <label style="color: #666; font-size: 14px;">å¹´ç§Ÿé‡‘æ”¶å…¥ (å…ƒ)</label>
                                                    <div id="rent-roi-annual-income" style="font-weight: 500; font-size: 16px;"></div>
                                                </div>
                                                <div class="form-group" style="flex: 1;">
                                                    <label style="color: #666; font-size: 14px;">ç§Ÿé‡‘å›æŠ¥ç‡ (%)</label>
                                                    <div id="rent-roi-rate" style="font-weight: 500; font-size: 18px; color: #52c41a;"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="ai-assistant">
                        <div class="ai-header">
                            <h3>ğŸ¤– AIåŠ©æ‰‹</h3>
                        </div>
                        <div class="ai-chat">
                            <div class="chat-message ai">
                                æ‚¨å¥½ï¼æˆ‘æ˜¯ValuHubAIåŠ©æ‰‹ï¼Œæœ‰ä»€ä¹ˆå¯ä»¥å¸®åŠ©æ‚¨çš„å—ï¼Ÿ
                            </div>
                        </div>
                        <div class="ai-input-area">
                            <div class="ai-input">
                                <input type="text" placeholder="è¯·è¾“å…¥æ‚¨çš„é—®é¢˜..">
                                <button>å‘é€</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- è®¾ç½®æ¨¡å— -->
                <div id="settings" class="module-content">
                    <div class="file-manager">
                        <div class="file-manager-header">
                            <h3>è®¾ç½®åˆ†ç±»</h3>
                            <div class="file-actions">
                                <button class="btn">ğŸ“</button>
                            </div>
                        </div>
                        <div class="file-list">
                            <div class="file-item">
                                <div style="font-weight: 500; margin-bottom: 4px;">ç³»ç»Ÿè®¾ç½®</div>
                                <div style="font-size: 12px; color: #999;">åŸºæœ¬é…ç½®</div>
                            </div>
                        </div>
                    </div>
                    <div class="editor-area">
                        <div class="editor-header">
                            <div class="editor-title">è®¾ç½®</div>
                        </div>
                        <div class="editor-content">
                            <div class="system-settings">
                                <h3>âš™ï¸ è®¾ç½®</h3>
                                
                                <!-- è®¾ç½®æ ‡ç­¾é¡µ -->
                                <div class="editor-tabs" style="margin-bottom: 20px;">
                                    <div class="tab active" data-setting="user-info">ç”¨æˆ·ä¿¡æ¯</div>
                                    <div class="tab" data-setting="system-settings">ç³»ç»Ÿè®¾ç½®</div>
                                    <div class="tab" data-setting="notification-settings">é€šçŸ¥è®¾ç½®</div>
                                    <div class="tab" data-setting="security-settings">å®‰å…¨è®¾ç½®</div>
                                </div>
                                
                                <!-- è®¾ç½®å†…å®¹åŒºåŸŸ -->
                                <div class="setting-content" style="background: white; padding: 24px; border-radius: 8px; box-shadow: 0 1px 4px rgba(0,0,0,0.05);">
                                    <!-- ç”¨æˆ·ä¿¡æ¯è®¾ç½® -->
                                    <div id="user-info" class="setting-panel active">
                                        <h4 style="margin-bottom: 20px; color: #333;">ç”¨æˆ·ä¿¡æ¯</h4>
                                        
                                        <div style="display: flex; align-items: center; margin-bottom: 24px;">
                                            <div style="width: 80px; height: 80px; border-radius: 50%; background: #667eea; color: white; display: flex; align-items: center; justify-content: center; font-size: 32px; font-weight: bold; margin-right: 20px;">U</div>
                                            <div>
                                                <div style="font-size: 18px; font-weight: 500; margin-bottom: 8px;">ç”¨æˆ·</div>
                                                <button class="btn" style="padding: 6px 16px;">æ›´æ¢å¤´åƒ</button>
                                            </div>
                                        </div>
                                        
                                        <div class="form-row" style="margin-bottom: 16px;">
                                            <div class="form-group">
                                                <label>ç”¨æˆ·å</label>
                                                <input type="text" placeholder="è¯·è¾“å…¥ç”¨æˆ·å" value="ç”¨æˆ·">
                                            </div>
                                            <div class="form-group">
                                                <label>é‚®ç®±</label>
                                                <input type="email" placeholder="è¯·è¾“å…¥é‚®ç®±" value="user@example.com">
                                            </div>
                                        </div>
                                        
                                        <div class="form-row" style="margin-bottom: 24px;">
                                            <div class="form-group">
                                                <label>æ‰‹æœºå·</label>
                                                <input type="tel" placeholder="è¯·è¾“å…¥æ‰‹æœºå·" value="138****8888">
                                            </div>
                                            <div class="form-group">
                                                <label>æ‰€å±æœºæ„</label>
                                                <input type="text" placeholder="è¯·è¾“å…¥æ‰€å±æœºæ„" value="ValuHub">
                                            </div>
                                        </div>
                                        
                                        <div style="text-align: right;">
                                            <button class="btn btn-primary">ä¿å­˜ä¿®æ”¹</button>
                                        </div>
                                    </div>
                                    
                                    <!-- ç³»ç»Ÿè®¾ç½® -->
                                    <div id="system-settings" class="setting-panel">
                                        <h4 style="margin-bottom: 20px; color: #333;">ç³»ç»Ÿè®¾ç½®</h4>
                                        
                                        <div class="setting-section" style="margin-bottom: 20px;">
                                            <h5 style="margin-bottom: 16px; color: #666;">ç•Œé¢è®¾ç½®</h5>
                                            
                                            <div class="setting-item" style="display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid #f0f0f0;">
                                                <div>
                                                    <div style="font-weight: 500;">æš—è‰²æ¨¡å¼</div>
                                                    <div style="font-size: 12px; color: #999;">å¯ç”¨æš—è‰²ä¸»é¢˜</div>
                                                </div>
                                                <label class="switch">
                                                    <input type="checkbox" id="dark-mode">
                                                    <span class="slider"></span>
                                                </label>
                                            </div>
                                            
                                            <div class="setting-item" style="display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid #f0f0f0;">
                                                <div>
                                                    <div style="font-weight: 500;">ä¾§è¾¹æ æ”¶èµ·</div>
                                                    <div style="font-size: 12px; color: #999;">é»˜è®¤æ”¶èµ·å·¦ä¾§ä¾§è¾¹æ </div>
                                                </div>
                                                <label class="switch">
                                                    <input type="checkbox" id="sidebar-collapsed">
                                                    <span class="slider"></span>
                                                </label>
                                            </div>
                                        </div>
                                        
                                        <div class="setting-section" style="margin-bottom: 20px;">
                                            <h5 style="margin-bottom: 16px; color: #666;">è¯­è¨€è®¾ç½®</h5>
                                            
                                            <div class="form-row" style="margin-bottom: 16px;">
                                                <div class="form-group">
                                                    <label>ç³»ç»Ÿè¯­è¨€</label>
                                                    <select>
                                                        <option>ä¸­æ–‡ (ç®€ä½“)</option>
                                                        <option>English</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div style="text-align: right;">
                                            <button class="btn btn-primary">ä¿å­˜è®¾ç½®</button>
                                        </div>
                                    </div>
                                    
                                    <!-- é€šçŸ¥è®¾ç½® -->
                                    <div id="notification-settings" class="setting-panel">
                                        <h4 style="margin-bottom: 20px; color: #333;">é€šçŸ¥è®¾ç½®</h4>
                                        
                                        <div class="setting-item" style="display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid #f0f0f0;">
                                            <div>
                                                <div style="font-weight: 500;">é‚®ä»¶é€šçŸ¥</div>
                                                <div style="font-size: 12px; color: #999;">æ¥æ”¶ç³»ç»Ÿé‚®ä»¶é€šçŸ¥</div>
                                            </div>
                                            <label class="switch">
                                                <input type="checkbox" id="email-notifications" checked>
                                                <span class="slider"></span>
                                            </label>
                                        </div>
                                        
                                        <div class="setting-item" style="display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid #f0f0f0;">
                                            <div>
                                                <div style="font-weight: 500;">çŸ­ä¿¡é€šçŸ¥</div>
                                                <div style="font-size: 12px; color: #999;">æ¥æ”¶ç³»ç»ŸçŸ­ä¿¡é€šçŸ¥</div>
                                            </div>
                                            <label class="switch">
                                                <input type="checkbox" id="sms-notifications" checked>
                                                <span class="slider"></span>
                                            </label>
                                        </div>
                                        
                                        <div class="setting-item" style="display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid #f0f0f0;">
                                            <div>
                                                <div style="font-weight: 500;">ä¼°ä»·æŠ¥å‘Šé€šçŸ¥</div>
                                                <div style="font-size: 12px; color: #999;">å½“ä¼°ä»·æŠ¥å‘Šç”Ÿæˆå®Œæˆæ—¶é€šçŸ¥</div>
                                            </div>
                                            <label class="switch">
                                                <input type="checkbox" id="report-notifications" checked>
                                                <span class="slider"></span>
                                            </label>
                                        </div>
                                        
                                        <div class="setting-item" style="display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid #f0f0f0;">
                                            <div>
                                                <div style="font-weight: 500;">å¸‚åœºåŠ¨æ€é€šçŸ¥</div>
                                                <div style="font-size: 12px; color: #999;">æ¥æ”¶å¸‚åœºåŠ¨æ€æ›´æ–°é€šçŸ¥</div>
                                            </div>
                                            <label class="switch">
                                                <input type="checkbox" id="market-notifications">
                                                <span class="slider"></span>
                                            </label>
                                        </div>
                                        
                                        <div style="text-align: right; margin-top: 24px;">
                                            <button class="btn btn-primary">ä¿å­˜è®¾ç½®</button>
                                        </div>
                                    </div>
                                    
                                    <!-- å®‰å…¨è®¾ç½® -->
                                    <div id="security-settings" class="setting-panel">
                                        <h4 style="margin-bottom: 20px; color: #333;">å®‰å…¨è®¾ç½®</h4>
                                        
                                        <div class="setting-section" style="margin-bottom: 24px;">
                                            <h5 style="margin-bottom: 16px; color: #666;">å¯†ç ç®¡ç†</h5>
                                            
                                            <div class="form-row" style="margin-bottom: 16px;">
                                                <div class="form-group">
                                                    <label>å½“å‰å¯†ç </label>
                                                    <input type="password" placeholder="è¯·è¾“å…¥å½“å‰å¯†ç ">
                                                </div>
                                            </div>
                                            
                                            <div class="form-row" style="margin-bottom: 16px;">
                                                <div class="form-group">
                                                    <label>æ–°å¯†ç </label>
                                                    <input type="password" placeholder="è¯·è¾“å…¥æ–°å¯†ç ">
                                                </div>
                                                <div class="form-group">
                                                    <label>ç¡®è®¤æ–°å¯†ç </label>
                                                    <input type="password" placeholder="è¯·ç¡®è®¤æ–°å¯†ç ">
                                                </div>
                                            </div>
                                            
                                            <div style="text-align: right;">
                                                <button class="btn btn-primary">ä¿®æ”¹å¯†ç </button>
                                            </div>
                                        </div>
                                        
                                        <div class="setting-section">
                                            <h5 style="margin-bottom: 16px; color: #666;">ç™»å½•è®¾ç½®</h5>
                                            
                                            <div class="setting-item" style="display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid #f0f0f0;">
                                                <div>
                                                    <div style="font-weight: 500;">åŒå› ç´ è®¤è¯</div>
                                                    <div style="font-size: 12px; color: #999;">å¯ç”¨åŒå› ç´ è®¤è¯æé«˜è´¦å·å®‰å…¨æ€§</div>
                                                </div>
                                                <label class="switch">
                                                    <input type="checkbox" id="two-factor-auth">
                                                    <span class="slider"></span>
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="ai-assistant">
                        <div class="ai-header">
                            <h3>ğŸ¤– AIåŠ©æ‰‹</h3>
                        </div>
                        <div class="ai-chat">
                            <div class="chat-message ai">
                                æ‚¨å¥½ï¼æˆ‘æ˜¯ValuHubAIåŠ©æ‰‹ï¼Œæœ‰ä»€ä¹ˆå¯ä»¥å¸®åŠ©æ‚¨çš„å—ï¼Ÿ
                            </div>
                        </div>
                        <div class="ai-input-area">
                            <div class="ai-input">
                                <input type="text" placeholder="è¯·è¾“å…¥æ‚¨çš„é—®é¢˜..">
                                <button>å‘é€</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ä¼ä¸šç«¯å†…å®¹ -->
        <div id="enterprise-content" class="client-content">
            <div class="enterprise-dashboard">
                <div class="dashboard-section">
                    <h3>ğŸ“Š ä¼ä¸šæ•°æ®æ¦‚è§ˆ</h3>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px;">
                        <div class="data-card">
                            <div style="font-size: 24px; font-weight: bold; color: #667eea;">128</div>
                            <div style="font-size: 13px; color: #666;">æœ¬æœˆä¼°ä»·é¡¹ç›®</div>
                        </div>
                        <div class="data-card">
                            <div style="font-size: 24px; font-weight: bold; color: #52c41a;">Â¥ 9,850ä¸‡</div>
                            <div style="font-size: 13px; color: #666;">ä¼°ä»·æ€»é‡‘é¢</div>
                        </div>
                        <div class="data-card">
                            <div style="font-size: 24px; font-weight: bold; color: #faad14;">98%</div>
                            <div style="font-size: 13px; color: #666;">å®Œæˆç‡</div>
                        </div>
                        <div class="data-card">
                            <div style="font-size: 24px; font-weight: bold; color: #f5222d;">15</div>
                            <div style="font-size: 13px; color: #666;">å¾…å¤„ç†ä»»åŠ¡</div>
                        </div>
                    </div>
                </div>
                <div class="dashboard-section">
                    <h3>ğŸ“ˆ ä¼°ä»·è¶‹åŠ¿</h3>
                    <div style="height: 200px; background: #f8f9fa; border-radius: 6px; display: flex; align-items: center; justify-content: center; color: #999;">
                        ä¼°ä»·è¶‹åŠ¿å›¾è¡¨
                    </div>
                </div>
                <div class="dashboard-section">
                    <h3>ğŸ‘¥ å›¢é˜Ÿåä½œ</h3>
                    <div style="display: grid; gap: 12px;">
                        <div style="padding: 12px; background: #f0f4ff; border-radius: 6px;">
                            <div style="font-weight: 500; margin-bottom: 4px;">å¼ å·¥ - æ­£åœ¨å¤„ç†</div>
                            <div style="font-size: 12px; color: #666;">é•¿æ²™ä¸‡ç§‘åŸä¼°ä»·é¡¹ç›®</div>
                        </div>
                        <div style="padding: 12px; background: #f6ffed; border-radius: 6px;">
                            <div style="font-weight: 500; margin-bottom: 4px;">æå·¥ - å·²å®Œæˆ</div>
                            <div style="font-size: 12px; color: #666;">å²³éº“åŒºäºŒæ‰‹æˆ¿åˆ†æ</div>
                        </div>
                    </div>
                </div>
                <div class="dashboard-section">
                    <h3>ğŸ“‹ æœ€è¿‘é¡¹ç›®</h3>
                    <div style="display: grid; gap: 12px;">
                        <div style="padding: 12px; border: 1px solid #e0e0e0; border-radius: 6px;">
                            <div style="font-weight: 500; margin-bottom: 4px;">é•¿æ²™ä¸‡ç§‘åŸä¼°ä»·</div>
                            <div style="font-size: 12px; color: #999;">2025-12-27 14:30</div>
                        </div>
                        <div style="padding: 12px; border: 1px solid #e0e0e0; border-radius: 6px;">
                            <div style="font-weight: 500; margin-bottom: 4px;">å²³éº“åŒºäºŒæ‰‹æˆ¿åˆ†æ</div>
                            <div style="font-size: 12px; color: #999;">2025-12-26 10:15</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- æ”¿åºœç«¯å†…å®¹ -->
        <div id="government-content" class="client-content">
            <div class="enterprise-dashboard">
                <div class="dashboard-section">
                    <h3>ğŸ›ï¸ æ”¿åºœç›‘ç®¡æ§åˆ¶å°</h3>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px;">
                        <div class="data-card">
                            <div style="font-size: 24px; font-weight: bold; color: #667eea;">1,258</div>
                            <div style="font-size: 13px; color: #666;">æœ¬æœˆä¼°ä»·é¡¹ç›®</div>
                        </div>
                        <div class="data-card">
                            <div style="font-size: 24px; font-weight: bold; color: #52c41a;">Â¥ 128äº¿</div>
                            <div style="font-size: 13px; color: #666;">ä¼°ä»·æ€»é‡‘é¢</div>
                        </div>
                        <div class="data-card">
                            <div style="font-size: 24px; font-weight: bold; color: #faad14;">95%</div>
                            <div style="font-size: 13px; color: #666;">åˆè§„ç‡</div>
                        </div>
                        <div class="data-card">
                            <div style="font-size: 24px; font-weight: bold; color: #f5222d;">23</div>
                            <div style="font-size: 13px; color: #666;">å¾…å®¡æ ¸é¡¹ç›®</div>
                        </div>
                    </div>
                </div>
                <div class="dashboard-section">
                    <h3>ğŸ“Š å¸‚åœºç›‘ç®¡</h3>
                    <div style="height: 200px; background: #f8f9fa; border-radius: 6px; display: flex; align-items: center; justify-content: center; color: #999;">
                        å¸‚åœºç›‘ç®¡å›¾è¡¨
                    </div>
                </div>
                <div class="dashboard-section">
                    <h3>ğŸ” åˆè§„æ£€æŸ¥</h3>
                    <div style="display: grid; gap: 12px;">
                        <div style="padding: 12px; background: #f0f4ff; border-radius: 6px;">
                            <div style="font-weight: 500; margin-bottom: 4px;">å¾…å®¡æ ¸é¡¹ç›®</div>
                            <div style="font-size: 12px; color: #666;">23ä¸ªé¡¹ç›®ç­‰å¾…å®¡æ ¸</div>
                        </div>
                        <div style="padding: 12px; background: #fff1f0; border-radius: 6px;">
                            <div style="font-weight: 500; margin-bottom: 4px;">å¼‚å¸¸é¡¹ç›®</div>
                            <div style="font-size: 12px; color: #666;">5ä¸ªé¡¹ç›®å­˜åœ¨å¼‚å¸¸</div>
                        </div>
                    </div>
                </div>
                <div class="dashboard-section">
                    <h3>ğŸ“‹ æ”¿ç­–å‘å¸ƒ</h3>
                    <div style="padding: 12px; border: 1px solid #e0e0e0; border-radius: 6px;">
                        <div style="font-weight: 500; margin-bottom: 4px;">å…³äºè°ƒæ•´æˆ¿åœ°äº§ä¼°ä»·æ ‡å‡†çš„é€šçŸ¥</div>
                        <div style="font-size: 12px; color: #666; margin-bottom: 8px;">2025-12-20</div>
                        <div style="font-size: 13px; color: #666;">ä¸ºè¿›ä¸€æ­¥è§„èŒƒæˆ¿åœ°äº§ä¼°ä»·è¡Œä¸ºï¼Œæé«˜ä¼°ä»·è´¨é‡ï¼Œç°å°†è°ƒæ•´åçš„æˆ¿åœ°äº§ä¼°ä»·æ ‡å‡†é€šçŸ¥å¦‚ä¸‹...</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- åä¼šç«¯å†…å®¹ -->
        <div id="association-content" class="client-content">
            <div class="enterprise-dashboard">
                <div class="dashboard-section">
                    <h3>ğŸ¤ åä¼šç®¡ç†æ§åˆ¶å°</h3>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px;">
                        <div class="data-card">
                            <div style="font-size: 24px; font-weight: bold; color: #667eea;">528</div>
                            <div style="font-size: 13px; color: #666;">åä¼šä¼šå‘˜</div>
                        </div>
                        <div class="data-card">
                            <div style="font-size: 24px; font-weight: bold; color: #52c41a;">36</div>
                            <div style="font-size: 13px; color: #666;">æœ¬æœˆæ´»åŠ¨</div>
                        </div>
                        <div class="data-card">
                            <div style="font-size: 24px; font-weight: bold; color: #faad14;">12</div>
                            <div style="font-size: 13px; color: #666;">å¾…å®¡æ‰¹ä¼šå‘˜</div>
                        </div>
                        <div class="data-card">
                            <div style="font-size: 24px; font-weight: bold; color: #f5222d;">8</div>
                            <div style="font-size: 13px; color: #666;">è¡Œä¸šå…¬å‘Š</div>
                        </div>
                    </div>
                </div>
                <div class="dashboard-section">
                    <h3>ğŸ“Š ä¼šå‘˜æ•°æ®</h3>
                    <div style="height: 200px; background: #f8f9fa; border-radius: 6px; display: flex; align-items: center; justify-content: center; color: #999;">
                        ä¼šå‘˜æ•°æ®å›¾è¡¨
                    </div>
                </div>
                <div class="dashboard-section">
                    <h3>ğŸ“‹ è¡Œä¸šæ´»åŠ¨</h3>
                    <div style="display: grid; gap: 12px;">
                        <div style="padding: 12px; background: #f0f4ff; border-radius: 6px;">
                            <div style="font-weight: 500; margin-bottom: 4px;">2025å¹´æˆ¿åœ°äº§ä¼°ä»·è¡Œä¸šå¹´ä¼š</div>
                            <div style="font-size: 12px; color: #666;">2025-12-30 09:00-17:00</div>
                        </div>
                        <div style="padding: 12px; background: #f6ffed; border-radius: 6px;">
                            <div style="font-weight: 500; margin-bottom: 4px;">ä¼°ä»·å¸ˆç»§ç»­æ•™è‚²åŸ¹è®­ç­</div>
                            <div style="font-size: 12px; color: #666;">2026-01-15 14:00-16:00</div>
                        </div>
                    </div>
                </div>
                <div class="dashboard-section">
                    <h3>ğŸ“¢ è¡Œä¸šå…¬å‘Š</h3>
                    <div style="padding: 12px; border: 1px solid #e0e0e0; border-radius: 6px;">
                        <div style="font-weight: 500; margin-bottom: 4px;">å…³äºå‘å¸ƒ2025å¹´ä¼°ä»·è¡Œä¸šæŠ¥å‘Šçš„é€šçŸ¥</div>
                        <div style="font-size: 12px; color: #666; margin-bottom: 8px;">2025-12-25</div>
                        <div style="font-size: 13px; color: #666;">åä¼šå·²å‘å¸ƒ2025å¹´æˆ¿åœ°äº§ä¼°ä»·è¡Œä¸šæŠ¥å‘Šï¼Œè¯·å„ä¼šå‘˜å•ä½åŠæ—¶ä¸‹è½½æŸ¥é˜…...</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- é™¢æ ¡ç«¯å†…å®¹ -->
        <div id="institution-content" class="client-content">
            <div class="enterprise-dashboard">
                <div class="dashboard-section">
                    <h3>ğŸ“ é™¢æ ¡æ•™å­¦æ§åˆ¶å°</h3>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px;">
                        <div class="data-card">
                            <div style="font-size: 24px; font-weight: bold; color: #667eea;">1,256</div>
                            <div style="font-size: 13px; color: #666;">å­¦ç”Ÿç”¨æˆ·</div>
                        </div>
                        <div class="data-card">
                            <div style="font-size: 24px; font-weight: bold; color: #52c41a;">48</div>
                            <div style="font-size: 13px; color: #666;">æ•™å­¦æ¡ˆä¾‹</div>
                        </div>
                        <div class="data-card">
                            <div style="font-size: 24px; font-weight: bold; color: #faad14;">15</div>
                            <div style="font-size: 13px; color: #666;">å®è·µé¡¹ç›®</div>
                        </div>
                        <div class="data-card">
                            <div style="font-size: 24px; font-weight: bold; color: #f5222d;">8</div>
                            <div style="font-size: 13px; color: #666;">æ•™å­¦è®¡åˆ’</div>
                        </div>
                    </div>
                </div>
                <div class="dashboard-section">
                    <h3>ğŸ“Š æ•™å­¦æ•°æ®</h3>
                    <div style="height: 200px; background: #f8f9fa; border-radius: 6px; display: flex; align-items: center; justify-content: center; color: #999;">
                        æ•™å­¦æ•°æ®å›¾è¡¨
                    </div>
                </div>
                <div class="dashboard-section">
                    <h3>ğŸ“š æ•™å­¦æ¡ˆä¾‹</h3>
                    <div style="display: grid; gap: 12px;">
                        <div style="padding: 12px; background: #f0f4ff; border-radius: 6px;">
                            <div style="font-weight: 500; margin-bottom: 4px;">ä½å®…ä¼°ä»·æ¡ˆä¾‹</div>
                            <div style="font-size: 12px; color: #666;">é€‚ç”¨äºä¼°ä»·åŸºç¡€è¯¾ç¨‹æ•™å­¦</div>
                        </div>
                        <div style="padding: 12px; background: #fff1f0; border-radius: 6px;">
                            <div style="font-weight: 500; margin-bottom: 4px;">å•†ä¸šåœ°äº§ä¼°ä»·æ¡ˆä¾‹</div>
                            <div style="font-size: 12px; color: #666;">é€‚ç”¨äºé«˜çº§ä¼°ä»·è¯¾ç¨‹æ•™å­¦</div>
                        </div>
                    </div>
                </div>
                <div class="dashboard-section">
                    <h3>ğŸ”¬ å®è·µé¡¹ç›®</h3>
                    <div style="padding: 12px; border: 1px solid #e0e0e0; border-radius: 6px;">
                        <div style="font-weight: 500; margin-bottom: 4px;">2025å¹´æˆ¿åœ°äº§å¸‚åœºè°ƒç ”é¡¹ç›®</div>
                        <div style="font-size: 12px; color: #666; margin-bottom: 8px;">æˆªæ­¢æ—¥æœŸï¼š2026-01-10</div>
                        <div style="font-size: 13px; color: #666;">é¡¹ç›®è¦æ±‚ï¼šå„å°ç»„å®ŒæˆæŒ‡å®šåŒºåŸŸçš„æˆ¿åœ°äº§å¸‚åœºè°ƒç ”ï¼Œå¹¶æäº¤è°ƒç ”æŠ¥å‘Š...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
    
    <!-- æŠ¥å‘Šæ¨¡æ€æ¡† -->
    <div id="report-modal">
        <div class="modal-content">
            <h2>ğŸ“„ AIä¼°ä»·æŠ¥å‘Š</h2>
            <div id="report-content"></div>
            <div style="display: flex; justify-content: flex-end; gap: 12px; margin-top: 20px;">
                <button class="btn" onclick="document.getElementById('report-modal').style.display = 'none'">å…³é—­</button>
                <button class="btn btn-primary">ä¸‹è½½æŠ¥å‘Š</button>
            </div>
        </div>
    </div>
    
    <!-- OSSä¸Šä¼ åŒºåŸŸ -->
    <div class="oss-upload-section" style="margin: 20px 0; padding: 20px; background: white; border-radius: 8px; box-shadow: 0 1px 4px rgba(0,0,0,0.05);">
        <h3 style="margin: 0 0 16px 0; color: #667eea;">ğŸ“¤ OSSæ–‡ä»¶ç®¡ç†</h3>
        <div style="display: flex; gap: 12px; align-items: center; margin-bottom: 16px;">
            <input type="file" id="oss-file-input" multiple style="flex: 1; padding: 8px; border: 1px solid #e0e0e0; border-radius: 4px;">
            <button id="upload-to-oss-btn" class="btn btn-primary" style="padding: 8px 16px;">ä¸Šä¼ åˆ°OSS</button>
        </div>
        <div id="oss-upload-result" style="font-size: 14px; color: #666;"></div>
    </div>
    
    <script>
        // APIè°ƒç”¨åœ°å€é…ç½®
        const API_BASE = "http://localhost:8000/api/v1"; // æœ¬åœ°åç«¯åœ°å€
        
        // è®¤è¯Token
        let authToken = localStorage.getItem('auth_token');
        
        // DOMåŠ è½½å®Œæˆåæ‰§è¡Œ
        document.addEventListener('DOMContentLoaded', function() {
            // åˆå§‹åŒ–å˜é‡
            const loadingOverlay = document.querySelector('.loading-overlay');
            const toast = document.querySelector('.toast');
            
            // 1. æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            function showLoading() {
                loadingOverlay.classList.add('active');
            }
            
            // 2. éšè—åŠ è½½çŠ¶æ€
            function hideLoading() {
                loadingOverlay.classList.remove('active');
            }
            
            // 3. æ˜¾ç¤ºæ“ä½œåé¦ˆæç¤º
            function showToast(message, type = 'info', duration = 3000) {
                toast.textContent = message;
                toast.className = `toast ${type}`;
                toast.classList.add('show');
                
                setTimeout(() => {
                    toast.classList.remove('show');
                }, duration);
            }
            
            // 4. OSSæ–‡ä»¶ä¸Šä¼ åŠŸèƒ½
            const ossFileInput = document.getElementById('oss-file-input');
            const uploadToOssBtn = document.getElementById('upload-to-oss-btn');
            const ossUploadResult = document.getElementById('oss-upload-result');
            
            uploadToOssBtn.addEventListener('click', async function() {
                const files = ossFileInput.files;
                if (files.length === 0) {
                    showToast('è¯·é€‰æ‹©è¦ä¸Šä¼ çš„æ–‡ä»¶', 'warning');
                    return;
                }
                
                showLoading();
                ossUploadResult.innerHTML = '<div style="color: #667eea;">æ­£åœ¨ä¸Šä¼ æ–‡ä»¶...</div>';
                
                try {
                    // éå†æ–‡ä»¶åˆ—è¡¨ï¼Œæ”¯æŒå¤šæ–‡ä»¶ä¸Šä¼ 
                    const results = [];
                    for (let i = 0; i < files.length; i++) {
                        const file = files[i];
                        const formData = new FormData();
                        formData.append('file', file);
                        
                        const response = await fetch(`${API_BASE}/oss/upload`, {
                            method: 'POST',
                            body: formData
                        });
                        
                        const result = await response.json();
                        results.push({ file: file.name, result });
                    }
                    
                    // æ˜¾ç¤ºä¸Šä¼ ç»“æœ
                    let resultHtml = '<h4 style="margin: 12px 0; color: #333;">ä¸Šä¼ ç»“æœï¼š</h4>';
                    results.forEach(({ file, result }) => {
                        if (result.success) {
                            resultHtml += `
                                <div style="margin: 8px 0; padding: 12px; background: #f6ffed; border: 1px solid #b7eb8f; border-radius: 4px;">
                                    <p style="margin: 0 0 4px 0; color: #389e0d;">âœ… ${file} ä¸Šä¼ æˆåŠŸ</p>
                                    <p style="margin: 0; font-size: 12px; color: #52c41a;">
                                        ğŸ”— <a href="${result.url}" target="_blank" style="color: #52c41a; text-decoration: underline;">${result.url}</a>
                                    </p>
                                </div>
                            `;
                        } else {
                            resultHtml += `
                                <div style="margin: 8px 0; padding: 12px; background: #fff1f0; border: 1px solid #ffccc7; border-radius: 4px;">
                                    <p style="margin: 0; color: #cf1322;">âŒ ${file} ä¸Šä¼ å¤±è´¥ï¼š${result.error}</p>
                                </div>
                            `;
                        }
                    });
                    
                    ossUploadResult.innerHTML = resultHtml;
                    showToast('æ–‡ä»¶ä¸Šä¼ å®Œæˆ', 'success');
                } catch (error) {
                    ossUploadResult.innerHTML = `<div style="color: #f5222d;">âŒ ä¸Šä¼ å¤±è´¥ï¼š${error.message}</div>`;
                    showToast('æ–‡ä»¶ä¸Šä¼ å¤±è´¥', 'error');
                } finally {
                    hideLoading();
                }
            });
            
            // æœ¬åœ°æˆ¿äº§çŸ¥è¯†åº“- ç”¨äºRAGæ£€ç´¢
            const realEstateKnowledgeBase = {
                // æˆ¿äº§ä¼°ä»·ç›¸å…³çŸ¥è¯†
                valuation: [
                    {
                        id: 1,
                        question: "é•¿æ²™ä¸‡ç§‘åŸçš„æˆ¿ä»·èµ°åŠ¿å¦‚ä½•ï¼Ÿ",
                        answer: "é•¿æ²™ä¸‡ç§‘åŸè¿‘ä¸€å¹´æˆ¿ä»·èµ°åŠ¿å¹³ç¨³ï¼Œå¹³å‡å•ä»·çº¦ä¸º12800å…ƒ/ã¡ï¼Œç¯æ¯”ä¸Šæœˆä¸Šæ¶¨0.5%ï¼ŒåŒæ¯”å»å¹´ä¸Šæ¶¨1.2%ã€‚",
                        context: "é•¿æ²™ä¸‡ç§‘åŸä½äºæœ›åŸåŒºæ ¸å¿ƒåœ°æ®µï¼Œ2018å¹´å»ºæˆï¼Œå‘¨è¾¹é…å¥—æˆç†Ÿï¼Œäº¤é€šä¾¿åˆ©ã€‚",
                        keywords: ["é•¿æ²™", "ä¸‡ç§‘åŸ", "æˆ¿ä»·èµ°åŠ¿"]
                    },
                    {
                        id: 2,
                        question: "å¦‚ä½•è®¡ç®—æˆ¿äº§ä¼°ä»·ï¼Ÿ",
                        answer: "æˆ¿äº§ä¼°ä»·é€šå¸¸è€ƒè™‘ä»¥ä¸‹å› ç´ ï¼š1. åœ°ç†ä½ç½®ï¼›2. å»ºç­‘å¹´ä»£ï¼›3. å»ºç­‘é¢ç§¯ï¼›4. æ¥¼å±‚å’Œæœå‘ï¼›5. è£…ä¿®æƒ…å†µï¼›6. å‘¨è¾¹é…å¥—ï¼›7. å¸‚åœºè¡Œæƒ…ã€‚æˆ‘ä»¬çš„AIä¼°ä»·æ¨¡å‹ç»¼åˆè¿™äº›å› ç´ ï¼Œé‡‡ç”¨å¤šå…ƒå›å½’ç®—æ³•è®¡ç®—å‡ºç²¾å‡†çš„ä¼°ä»·ç»“æœã€‚",
                        context: "æˆ¿äº§ä¼°ä»·æ˜¯æˆ¿åœ°äº§äº¤æ˜“ä¸­çš„é‡è¦ç¯èŠ‚ï¼Œå½±å“å› ç´ ä¼—å¤šã€‚",
                        keywords: ["æˆ¿äº§ä¼°ä»·", "è®¡ç®—æ–¹æ³•", "å½±å“å› ç´ "]
                    },
                    {
                        id: 3,
                        question: "æœ›åŸåŒºçš„æˆ¿ä»·æ°´å¹³å¦‚ä½•ï¼Ÿ",
                        answer: "æœ›åŸåŒºå½“å‰å¹³å‡æˆ¿ä»·çº¦ä¸º6800å…ƒ/ã¡ï¼Œä½äºé•¿æ²™å¸‚å¹³å‡æ°´å¹³ã€‚è¿‘å¹´æ¥ï¼Œéšç€åŒºåŸŸå‘å±•å’Œåœ°é“å¼€é€šï¼Œæˆ¿ä»·å‘ˆç°ç¨³ä¸­æœ‰å‡çš„è¶‹åŠ¿ã€‚",
                        context: "æœ›åŸåŒºæ˜¯é•¿æ²™å¸‚çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œè¿‘å¹´æ¥å‘å±•è¿…é€Ÿã€‚",
                        keywords: ["æœ›åŸåŒº", "æˆ¿ä»·æ°´å¹³"]
                    }
                ],
                // åŒºåŸŸåˆ†æç›¸å…³çŸ¥è¯†
                regional: [
                    {
                        id: 1,
                        question: "é•¿æ²™å²³éº“åŒºçš„æŠ•èµ„ä»·å€¼å¦‚ä½•ï¼Ÿ",
                        answer: "å²³éº“åŒºå…·æœ‰è¾ƒé«˜çš„æŠ•èµ„ä»·å€¼ï¼ŒåŸå› åŒ…æ‹¬ï¼š1. é«˜æ ¡äº‘é›†ï¼Œäººæ–‡æ°›å›´æµ“åšï¼›2. é«˜æ–°æŠ€æœ¯äº§ä¸šå‘å±•è¿…é€Ÿï¼›3. äº¤é€šä¾¿åˆ©ï¼Œåœ°é“ç½‘ç»œå®Œå–„ï¼›4. ç”Ÿæ€ç¯å¢ƒä¼˜ç¾ï¼Œå®œå±…å®œä¸šã€‚",
                        context: "å²³éº“åŒºæ˜¯é•¿æ²™å¸‚çš„æ•™è‚²å’Œç§‘æŠ€ä¸­å¿ƒã€‚",
                        keywords: ["å²³éº“åŒº", "æŠ•èµ„ä»·å€¼"]
                    },
                    {
                        id: 2,
                        question: "é•¿æ²™å“ªä¸ªåŒºåŸŸæœ€é€‚åˆæŠ•èµ„ï¼Ÿ",
                        answer: "é•¿æ²™æŠ•èµ„ä»·å€¼è¾ƒé«˜çš„åŒºåŸŸåŒ…æ‹¬ï¼š1. å²³éº“åŒºï¼ˆæ•™è‚²ç§‘æŠ€ä¸­å¿ƒï¼‰ï¼›2. é›¨èŠ±åŒºï¼ˆå•†ä¸šä¸­å¿ƒï¼‰ï¼›3. æœ›åŸåŒºï¼ˆä»·æ ¼æ´¼åœ°ï¼Œå‘å±•æ½œåŠ›å¤§ï¼‰ï¼›4. å¼€ç¦åŒºï¼ˆå†å²æ–‡åŒ–ä¸­å¿ƒï¼‰ã€‚å…·ä½“é€‰æ‹©åº”æ ¹æ®æŠ•èµ„é¢„ç®—å’Œç›®æ ‡æ¥ç¡®å®šã€‚",
                        context: "é•¿æ²™å¸‚å„åŒºåŸŸå‘å±•ä¸å‡è¡¡ï¼ŒæŠ•èµ„ä»·å€¼å„æœ‰ç‰¹ç‚¹ã€‚",
                        keywords: ["é•¿æ²™", "æŠ•èµ„åŒºåŸŸ", "æ¨è"]
                    }
                ],
                // æŠ•èµ„å»ºè®®ç›¸å…³çŸ¥è¯†
                investment: [
                    {
                        id: 1,
                        question: "å½“å‰å¸‚åœºç¯å¢ƒä¸‹ï¼Œæ˜¯å¦é€‚åˆæŠ•èµ„æˆ¿äº§ï¼Ÿ",
                        answer: "å½“å‰é•¿æ²™æˆ¿åœ°äº§å¸‚åœºå¤„äºå¹³ç¨³å‘å±•é˜¶æ®µï¼Œé€‚åˆé•¿æœŸæŠ•èµ„ã€‚å»ºè®®å…³æ³¨ä»¥ä¸‹å‡ ç‚¹ï¼š1. é€‰æ‹©æ ¸å¿ƒåŒºåŸŸæˆ–å‘å±•æ½œåŠ›å¤§çš„æ¿å—ï¼›2. å…³æ³¨äº¤é€šã€æ•™è‚²ã€åŒ»ç–—ç­‰é…å¥—è®¾æ–½ï¼›3. åˆç†æ§åˆ¶æ æ†ï¼Œé¿å…è¿‡åº¦è´Ÿå€ºï¼›4. è€ƒè™‘ç§Ÿé‡‘å›æŠ¥ç‡ã€‚",
                        context: "å½“å‰æˆ¿åœ°äº§å¸‚åœºæ”¿ç­–ç¨³å®šï¼Œå¸‚åœºé¢„æœŸå‘å¥½ã€‚",
                        keywords: ["æŠ•èµ„å»ºè®®", "å¸‚åœºç¯å¢ƒ", "æˆ¿äº§æŠ•èµ„"]
                    },
                    {
                        id: 2,
                        question: "å¦‚ä½•æé«˜æˆ¿äº§æŠ•èµ„å›æŠ¥ç‡ï¼Ÿ",
                        answer: "æé«˜æˆ¿äº§æŠ•èµ„å›æŠ¥ç‡çš„æ–¹æ³•åŒ…æ‹¬ï¼š1. é€‰æ‹©ç§Ÿé‡‘å›æŠ¥ç‡é«˜çš„åŒºåŸŸï¼›2. åˆç†æ§åˆ¶è´­æˆ¿æˆæœ¬ï¼›3. è¿›è¡Œé€‚å½“çš„è£…ä¿®æ”¹é€ ï¼Œæé«˜ç§Ÿé‡‘æ°´å¹³ï¼›4. é•¿æœŸæŒæœ‰ï¼Œäº«å—æˆ¿ä»·ä¸Šæ¶¨å¸¦æ¥çš„æ”¶ç›Šï¼›5. å…³æ³¨æ”¿ç­–å˜åŒ–ï¼ŒåŠæ—¶è°ƒæ•´æŠ•èµ„ç­–ç•¥ã€‚",
                        context: "æˆ¿äº§æŠ•èµ„å›æŠ¥ç‡å—å¤šç§å› ç´ å½±å“ã€‚",
                        keywords: ["æŠ•èµ„å›æŠ¥ç‡", "æé«˜æ–¹æ³•"]
                    }
                ]
            };
            
            // RAGæ£€ç´¢å™¨ - ä»çŸ¥è¯†åº“ä¸­æ£€ç´¢ç›¸å…³çŸ¥è¯†
            function ragRetriever(query) {
                const queryLower = query.toLowerCase();
                const results = [];
                
                // éå†æ‰€æœ‰çŸ¥è¯†åº“
                Object.values(realEstateKnowledgeBase).forEach(category => {
                    category.forEach(item => {
                        // æ£€æŸ¥å…³é”®è¯åŒ¹é…
                        const matched = item.keywords.some(keyword => 
                            queryLower.includes(keyword.toLowerCase())
                        );
                        
                        // æ£€æŸ¥é—®é¢˜åŒ¹é…
                        const questionMatch = item.question.toLowerCase().includes(queryLower);
                        
                        if (matched || questionMatch) {
                            results.push(item);
                        }
                    });
                });
                
                return results;
            }
            
            // æœ¬åœ°LLMæ¨¡æ‹Ÿå™¨- ç”Ÿæˆè¿è´¯çš„å›ç­”
            function localLLM(prompt, context) {
                // ç®€å•çš„å›ç­”ç”Ÿæˆé€»è¾‘ï¼Œç»“åˆä¸Šä¸‹æ–‡
                let answer = "";
                
                if (context.length > 0) {
                    // ä»ä¸Šä¸‹æ–‡ä¸­é€‰æ‹©æœ€ç›¸å…³çš„å›ç­”
                    const bestMatch = context[0];
                    answer = bestMatch.answer;
                } else {
                    // é€šç”¨å›ç­”
                    answer = "æ ¹æ®æˆ‘çš„åˆ†æï¼Œæ‚¨çš„é—®é¢˜æ¶‰åŠæˆ¿äº§ç›¸å…³é¢†åŸŸã€‚å»ºè®®æ‚¨æä¾›æ›´å…·ä½“çš„ä¿¡æ¯ï¼Œä»¥ä¾¿æˆ‘ä¸ºæ‚¨æä¾›æ›´ç²¾å‡†çš„å›ç­”ã€‚";
                }
                
                return answer;
            }
            
            // AIåŠ©æ‰‹æ ¸å¿ƒé€»è¾‘ - RAGæµç¨‹
            function generateAIResponse(query, chatHistory = []) {
                // 1. æ£€ç´¢ç›¸å…³çŸ¥è¯†
                const retrievedKnowledge = ragRetriever(query);
                
                // 2. ç”Ÿæˆå›ç­”
                const prompt = `åŸºäºä»¥ä¸‹ä¸Šä¸‹æ–‡å’Œå¯¹è¯å†å²ï¼Œå›ç­”ç”¨æˆ·é—®é¢˜ï¼š

ä¸Šä¸‹æ–‡ï¼š${JSON.stringify(retrievedKnowledge)}

å¯¹è¯å†å²ï¼š${JSON.stringify(chatHistory)}

ç”¨æˆ·é—®é¢˜ï¼š${query}

è¯·ç”Ÿæˆä¸“ä¸šã€è¿è´¯çš„å›ç­”ã€‚`;
                
                const answer = localLLM(prompt, retrievedKnowledge);
                
                return {
                    answer: answer,
                    sources: retrievedKnowledge.map(item => item.question)
                };
            }
            
            // æ˜¾ç¤ºAIåŠ©æ‰‹æ¶ˆæ¯
            function showAIAssistant(message, sources = []) {
                const aiChat = document.querySelector('.ai-chat');
                const aiMessage = document.createElement('div');
                aiMessage.className = 'chat-message ai';
                
                // æ·»åŠ æ¶ˆæ¯å†…å®¹
                const messageContent = document.createElement('div');
                messageContent.textContent = message;
                aiMessage.appendChild(messageContent);
                
                // æ·»åŠ æ¥æºä¿¡æ¯ï¼ˆå¦‚æœæœ‰ï¼‰
                if (sources.length > 0) {
                    const sourcesDiv = document.createElement('div');
                    sourcesDiv.style.fontSize = '12px';
                    sourcesDiv.style.color = '#666';
                    sourcesDiv.style.marginTop = '8px';
                    sourcesDiv.innerHTML = `
                        <strong>å‚è€ƒæ¥æºï¼š</strong>
                        <ul style="margin: 4px 0 0 16px; padding: 0;">
                            ${sources.map(source => `<li>${source}</li>`).join('')}
                        </ul>
                    `;
                    aiMessage.appendChild(sourcesDiv);
                }
                
                aiChat.appendChild(aiMessage);
                aiChat.scrollTop = aiChat.scrollHeight;
            }
            
            // ä¼°ä»·é¡¹ç›®åˆ‡æ¢åŠŸèƒ½
            const fileItems = document.querySelectorAll('.file-item');
            const fileList = document.querySelector('.file-list');
            const editorTitle = document.querySelector('.editor-title');
            
            fileItems.forEach(item => {
                item.addEventListener('click', function() {
                    // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                    showLoading();
                    
                    // ç§»é™¤æ‰€æœ‰activeç±»
                    fileItems.forEach(i => i.classList.remove('active'));
                    // æ·»åŠ activeç±»åˆ°å½“å‰ç‚¹å‡»é¡¹
                    this.classList.add('active');
                    
                    // æ›´æ–°é¡¹ç›®åç§°
                    const projectName = this.querySelector('div:nth-child(1)').textContent;
                    editorTitle.textContent = projectName;
                    
                    // æ¨¡æ‹Ÿæ•°æ®åŠ è½½å»¶è¿Ÿ
                    setTimeout(() => {
                        // éšè—åŠ è½½çŠ¶æ€
                        hideLoading();
                        // æ˜¾ç¤ºæˆåŠŸæç¤º
                        showToast(`å·²åˆ‡æ¢åˆ°é¡¹ç›®ï¼š${projectName}`, 'success');
                    }, 500);
                });
            });

            // 5. æ–°å»ºä¼°ä»·é¡¹ç›®åŠŸèƒ½
            const newProjectBtn = document.querySelector('.file-manager-header .btn-primary');
            newProjectBtn.addEventListener('click', function() {
                // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                this.classList.add('loading');
                
                // åˆ›å»ºæ–°çš„é¡¹ç›®é¡¹
                const newItem = document.createElement('div');
                newItem.className = 'file-item';
                const now = new Date();
                newItem.innerHTML = `
                    <div style="font-weight: 500; margin-bottom: 4px;">æ–°å»ºä¼°ä»·é¡¹ç›®${fileItems.length + 1}</div>
                    <div style="font-size: 12px; color: #999;">${now.toLocaleDateString()} ${now.toLocaleTimeString()}</div>
                `;
                
                // æ·»åŠ åˆ°åˆ—è¡¨é¡¶éƒ¨
                fileList.insertBefore(newItem, fileList.firstChild);
                
                // ä¸ºæ–°é¡¹æ·»åŠ ç‚¹å‡»äº‹ä»¶
                newItem.addEventListener('click', function() {
                    // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                    showLoading();
                    
                    // ç§»é™¤æ‰€æœ‰activeç±»
                    document.querySelectorAll('.file-item').forEach(i => i.classList.remove('active'));
                    // æ·»åŠ activeç±»åˆ°å½“å‰ç‚¹å‡»é¡¹
                    this.classList.add('active');
                    
                    // æ›´æ–°é¡¹ç›®åç§°
                    const projectName = this.querySelector('div:nth-child(1)').textContent;
                    editorTitle.textContent = projectName;
                    
                    // æ¨¡æ‹Ÿæ•°æ®åŠ è½½å»¶è¿Ÿ
                    setTimeout(() => {
                        // éšè—åŠ è½½çŠ¶æ€
                        hideLoading();
                        // æ˜¾ç¤ºæˆåŠŸæç¤º
                        showToast(`å·²åˆ‡æ¢åˆ°é¡¹ç›®ï¼š${projectName}`, 'success');
                    }, 500);
                });
                
                // æ¨¡æ‹Ÿåˆ›å»ºå»¶è¿Ÿ
                setTimeout(() => {
                    // éšè—åŠ è½½çŠ¶æ€
                    this.classList.remove('loading');
                    // è§¦å‘ç‚¹å‡»äº‹ä»¶
                    newItem.click();
                    // æ˜¾ç¤ºæˆåŠŸæç¤º
                    showToast('æ–°å»ºä¼°ä»·é¡¹ç›®æˆåŠŸ', 'success');
                }, 800);
            });

            // 6. æ ‡ç­¾é¡µåˆ‡æ¢åŠŸèƒ½
            const tabs = document.querySelectorAll('.tab');
            const tabContents = {
                'åŸºç¡€ä¿¡æ¯': document.querySelector('.form-section:nth-child(1)'),
                'è¯¦ç»†å‚æ•°': document.querySelector('.form-section:nth-child(2)'),
                'å‘¨è¾¹é…å¥—': document.querySelector('.form-section:nth-child(3)'),
                'ä¼°ä»·ç»“æœ': document.querySelector('.valuation-preview'),
                'æŠ¥å‘Šç”Ÿæˆ': null // éœ€è¦åˆ›å»ºæŠ¥å‘Šç”Ÿæˆå†…å®¹
            };

            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    // ç§»é™¤æ‰€æœ‰activeç±»
                    tabs.forEach(t => t.classList.remove('active'));
                    // æ·»åŠ activeç±»åˆ°å½“å‰ç‚¹å‡»é¡¹
                    this.classList.add('active');
                    
                    const tabName = this.textContent;
                    
                    // éšè—æ‰€æœ‰å†…å®¹
                    Object.values(tabContents).forEach(content => {
                        if (content) {
                            content.classList.remove('active');
                        }
                    });
                    
                    if (tabContents[tabName]) {
                        // æ˜¾ç¤ºå¯¹åº”å†…å®¹
                        tabContents[tabName].classList.add('active');
                    } else if (tabName === 'æŠ¥å‘Šç”Ÿæˆ') {
                        // æ£€æŸ¥æŠ¥å‘Šç”Ÿæˆå†…å®¹æ˜¯å¦å·²åˆ›å»º
                        if (!tabContents['æŠ¥å‘Šç”Ÿæˆ']) {
                            const editorContent = document.querySelector('.editor-content');
                            const reportContent = document.createElement('div');
                            reportContent.className = 'report-generation';
                            reportContent.innerHTML = `
                                <div class="valuation-form">
                                    <h3>ğŸ“„ æŠ¥å‘Šç”Ÿæˆ</h3>
                                    <div style="margin-bottom: 20px;">
                                        <label style="display: block; margin-bottom: 8px;">æŠ¥å‘Šç±»å‹</label>
                                        <div style="display: flex; gap: 12px; margin-bottom: 16px;">
                                            <label style="display: flex; align-items: center; gap: 6px;">
                                                <input type="radio" name="report-type" value="basic" checked>
                                                <span>åŸºç¡€ç‰ˆæŠ¥å‘Š</span>
                                            </label>
                                            <label style="display: flex; align-items: center; gap: 6px;">
                                                <input type="radio" name="report-type" value="detailed">
                                                <span>è¯¦ç»†ç‰ˆæŠ¥å‘Š</span>
                                            </label>
                                            <label style="display: flex; align-items: center; gap: 6px;">
                                                <input type="radio" name="report-type" value="professional">
                                                <span>ä¸“ä¸šç‰ˆæŠ¥å‘Š</span>
                                            </label>
                                        </div>
                                    </div>
                                    <div style="margin-bottom: 20px;">
                                        <label style="display: block; margin-bottom: 8px;">æŠ¥å‘Šæ ¼å¼</label>
                                        <div style="display: flex; gap: 12px;">
                                            <label style="display: flex; align-items: center; gap: 6px;">
                                                <input type="checkbox" name="report-format" value="pdf" checked>
                                                <span>PDF</span>
                                            </label>
                                            <label style="display: flex; align-items: center; gap: 6px;">
                                                <input type="checkbox" name="report-format" value="word">
                                                <span>Word</span>
                                            </label>
                                            <label style="display: flex; align-items: center; gap: 6px;">
                                                <input type="checkbox" name="report-format" value="html">
                                                <span>HTML</span>
                                            </label>
                                        </div>
                                    </div>
                                    <div style="margin-bottom: 20px;">
                                        <label style="display: block; margin-bottom: 8px;">åŒ…å«å†…å®¹</label>
                                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                                            <label style="display: flex; align-items: center; gap: 6px;">
                                                <input type="checkbox" name="report-content" value="basic-info" checked>
                                                <span>åŸºç¡€ä¿¡æ¯</span>
                                            </label>
                                            <label style="display: flex; align-items: center; gap: 6px;">
                                                <input type="checkbox" name="report-content" value="detailed-params" checked>
                                                <span>è¯¦ç»†å‚æ•°</span>
                                            </label>
                                            <label style="display: flex; align-items: center; gap: 6px;">
                                                <input type="checkbox" name="report-content" value="surroundings" checked>
                                                <span>å‘¨è¾¹é…å¥—</span>
                                            </label>
                                            <label style="display: flex; align-items: center; gap: 6px;">
                                                <input type="checkbox" name="report-content" value="valuation-result" checked>
                                                <span>ä¼°ä»·ç»“æœ</span>
                                            </label>
                                            <label style="display: flex; align-items: center; gap: 6px;">
                                                <input type="checkbox" name="report-content" value="market-analysis">
                                                <span>å¸‚åœºåˆ†æ</span>
                                            </label>
                                            <label style="display: flex; align-items: center; gap: 6px;">
                                                <input type="checkbox" name="report-content" value="comparable-cases">
                                                <span>å¯æ¯”æ¡ˆä¾‹</span>
                                            </label>
                                        </div>
                                    </div>
                                    <div style="display: flex; gap: 12px; justify-content: flex-end;">
                                        <button class="btn">å–æ¶ˆ</button>
                                        <button class="btn btn-primary btn-large" id="generate-report-btn">ç”ŸæˆæŠ¥å‘Š</button>
                                    </div>
                                </div>
                            `;
                            editorContent.appendChild(reportContent);
                            tabContents['æŠ¥å‘Šç”Ÿæˆ'] = reportContent;
                            
                            // ä¸ºç”ŸæˆæŠ¥å‘ŠæŒ‰é’®æ·»åŠ äº‹ä»¶
                            const generateReportBtn = document.getElementById('generate-report-btn');
                            generateReportBtn.addEventListener('click', function() {
                                const result = calculatePrice(); 
                                const report = ` 
                                    <h2>ValuHub AI ä¼°ä»·æŠ¥å‘Š</h2> 
                                    <p>æˆ¿äº§åœ°å€ï¼š${document.getElementById('address').value || 'æœªå¡«å†™'}</p> 
                                    <p>ä¼°ä»·å•ä»·ï¼š${result.pricePerSqm} å…ƒ/ã¡</p> 
                                    <p>æ€»ä»·ï¼š${result.totalPrice} å…ƒ</p> 
                                    <p>å¸‚åœºä¿¡å¿ƒåº¦ï¼š${result.confidence}%</p> 
                                    <p>åˆ†æå»ºè®®ï¼š${result.recommendation}</p> 
                                    <p><small>æŠ¥å‘Šç”Ÿæˆæ—¶é—´ï¼š${new Date().toLocaleString()}</small></p> 
                                `; 
                                
                                // æ˜¾ç¤ºæŠ¥å‘Š 
                                document.getElementById('report-content').innerHTML = report; 
                                document.getElementById('report-modal').style.display = 'flex'; 
                                
                                showToast("æŠ¥å‘Šå·²ç”Ÿæˆï¼", "success");
                            });
                        }
                        
                        // æ˜¾ç¤ºæŠ¥å‘Šç”Ÿæˆå†…å®¹
                        tabContents['æŠ¥å‘Šç”Ÿæˆ'].classList.add('active');
                    }
                });
            });
            
            // åˆå§‹æ˜¾ç¤ºåŸºç¡€ä¿¡æ¯
            tabs[0].click();

            // 6. AIåŠ©æ‰‹æ¶ˆæ¯å‘é€åŠŸèƒ½- æ”¯æŒRAGå’Œå¤šè½®å¯¹è¯
            const aiInput = document.querySelector('.ai-input input');
            const aiSendBtn = document.querySelector('.ai-input button');
            const aiChat = document.querySelector('.ai-chat');
            
            // å¯¹è¯å†å²è®°å½•
            let chatHistory = [];
            
            // ä»DOMä¸­æ¢å¤å¯¹è¯å†å²
            function loadChatHistory() {
                const messages = aiChat.querySelectorAll('.chat-message');
                messages.forEach(msg => {
                    if (msg.classList.contains('user')) {
                        chatHistory.push({
                            role: 'user',
                            content: msg.textContent
                        });
                    } else {
                        chatHistory.push({
                            role: 'assistant',
                            content: msg.textContent.split('å‚è€ƒæ¥æºï¼š')[0].trim()
                        });
                    }
                });
            }
            
            // åˆå§‹åŒ–å¯¹è¯å†å²
            loadChatHistory();
            
            function sendMessage() {
                const userQuery = aiInput.value.trim();
                if (!userQuery) return;
                
                // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯åˆ°èŠå¤©è®°å½•
                const userMessage = document.createElement('div');
                userMessage.className = 'chat-message user';
                userMessage.textContent = userQuery;
                aiChat.appendChild(userMessage);
                
                // æ›´æ–°å¯¹è¯å†å²
                chatHistory.push({
                    role: 'user',
                    content: userQuery
                });
                
                // æ¸…ç©ºè¾“å…¥æ¡†
                aiInput.value = '';
                
                // æ»šåŠ¨åˆ°åº•éƒ¨
                aiChat.scrollTop = aiChat.scrollHeight;
                
                // æ˜¾ç¤ºAIæ­£åœ¨è¾“å…¥çŠ¶æ€
                const typingMessage = document.createElement('div');
                typingMessage.className = 'chat-message ai';
                typingMessage.innerHTML = '<div style="display: flex; gap: 4px;"><span>.</span><span>.</span><span>.</span></div>';
                aiChat.appendChild(typingMessage);
                aiChat.scrollTop = aiChat.scrollHeight;
                
                // ç”ŸæˆAIå›å¤
                setTimeout(() => {
                    // ç§»é™¤æ­£åœ¨è¾“å…¥çŠ¶æ€
                    typingMessage.remove();
                    
                    // è°ƒç”¨AIç”Ÿæˆå›ç­” - RAGæµç¨‹
                    const aiResponse = generateAIResponse(userQuery, chatHistory);
                    
                    // æ˜¾ç¤ºAIå›å¤
                    showAIAssistant(aiResponse.answer, aiResponse.sources);
                    
                    // æ›´æ–°å¯¹è¯å†å²
                    chatHistory.push({
                        role: 'assistant',
                        content: aiResponse.answer
                    });
                    
                    // é™åˆ¶å¯¹è¯å†å²é•¿åº¦ï¼Œé¿å…å†…å­˜å ç”¨è¿‡é«˜
                    if (chatHistory.length > 20) {
                        chatHistory = chatHistory.slice(-20);
                    }
                }, 1000);
            }
            
            aiSendBtn.addEventListener('click', sendMessage);
            aiInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });

            // 8. ä¾§è¾¹æ èœå•ç‚¹å‡»åŠŸèƒ½
            const menuItems = document.querySelectorAll('.menu-item');
            
            // èœå•ä¸å†…éƒ¨æ¨¡å—IDçš„æ˜ å°„å…³ç³»
            const menuModuleMap = {
                'AIä¼°ä»·': 'ai-valuation',
                'å¸‚åœºåˆ†æ': 'market-analysis',
                'æ¡ˆä¾‹åº“': 'case-library',
                'æŠ•èµ„åˆ†æ': 'investment-analysis',
                'å·¥å…·é›†': 'tool-set',
                'è®¾ç½®': 'settings'
            };

            menuItems.forEach(item => {
                item.addEventListener('click', function() {
                    // ç§»é™¤æ‰€æœ‰èœå•activeç±»
                    menuItems.forEach(i => i.classList.remove('active'));
                    // æ·»åŠ activeç±»åˆ°å½“å‰ç‚¹å‡»é¡¹
                    this.classList.add('active');
                    
                    const menuText = this.querySelector('span:nth-child(2)').textContent;
                    const moduleId = menuModuleMap[menuText];
                    
                    if (moduleId) {
                        // ç§»é™¤æ‰€æœ‰æ¨¡å—çš„activeç±»
                        document.querySelectorAll('.module-content').forEach(module => {
                            module.classList.remove('active');
                        });
                        // æ·»åŠ activeç±»åˆ°ç›®æ ‡æ¨¡å—
                        document.getElementById(moduleId).classList.add('active');
                        
                        // å¦‚æœæ˜¯å¸‚åœºåˆ†ææ¨¡å—ï¼Œåˆå§‹åŒ–å›¾è¡¨
                        if (moduleId === 'market-analysis') {
                            initMarketCharts();
                        }
                    }
                });
            });
            
            // å¸‚åœºåˆ†ææ¨¡å— - å›¾è¡¨åŠŸèƒ½
            let priceTrendChart = null;
            let volumeChart = null;
            
            function initMarketCharts() {
                // ä»·æ ¼è¶‹åŠ¿å›¾æ•°æ®
                const priceData = {
                    labels: ['2025-10', '2025-11', '2025-12'],
                    datasets: [{
                        label: 'å¹³å‡æˆ¿ä»· (å…ƒ/ã¡)',
                        data: [12500, 12700, 12800],
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        tension: 0.3,
                        fill: true
                    }]
                };
                
                // æˆäº¤é‡æ•°æ®
                const volumeData = {
                    labels: ['2025-10', '2025-11', '2025-12'],
                    datasets: [{
                        label: 'æˆäº¤é‡ (å¥—)',
                        data: [75, 82, 89],
                        backgroundColor: ['#ff6b6b', '#4ecdc4', '#45b7d1'],
                        borderRadius: 6
                    }]
                };
                
                // åˆå§‹åŒ–ä»·æ ¼è¶‹åŠ¿å›¾
                const priceCtx = document.getElementById('priceTrendChart');
                if (priceTrendChart) {
                    priceTrendChart.destroy();
                }
                priceTrendChart = new Chart(priceCtx, {
                    type: 'line',
                    data: priceData,
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: true,
                                position: 'top'
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: false,
                                ticks: {
                                    callback: function(value) {
                                        return value.toLocaleString() + ' å…ƒ/ã¡';
                                    }
                                }
                            }
                        }
                    }
                });
                
                // åˆå§‹åŒ–æˆäº¤é‡å›¾è¡¨
                const volumeCtx = document.getElementById('volumeChart');
                if (volumeChart) {
                    volumeChart.destroy();
                }
                volumeChart = new Chart(volumeCtx, {
                    type: 'bar',
                    data: volumeData,
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: true,
                                position: 'top'
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            }
            
            // ä¸ºå¸‚åœºåˆ†ææ¨¡å—çš„é€‰æ‹©å™¨æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
            document.getElementById('market-city')?.addEventListener('change', initMarketCharts);
            document.getElementById('market-timeframe')?.addEventListener('change', initMarketCharts);
            
            // åˆå§‹åŠ è½½æ—¶ï¼Œå¦‚æœå½“å‰æ˜¯å¸‚åœºåˆ†ææ¨¡å—ï¼Œåˆå§‹åŒ–å›¾è¡¨
            if (document.getElementById('market-analysis').classList.contains('active')) {
                initMarketCharts();
            }
            
            // æ¡ˆä¾‹åº“æ¨¡å— - æ¡ˆä¾‹åˆ—è¡¨å’Œæœç´¢åŠŸèƒ½
            const caseData = [
                {
                    id: 1,
                    title: 'é•¿æ²™ä¸‡ç§‘åŸä½å®…ä¼°ä»·',
                    type: 'ä½å®…',
                    city: 'é•¿æ²™',
                    area: 'å¼€ç¦åŒº',
                    price: 1536000,
                    areaSize: 120,
                    date: '2025-12-27',
                    description: 'é•¿æ²™ä¸‡ç§‘åŸ120ã¡ä¸‰å®¤ä¸¤å…ä½å®…ä¼°ä»·æ¡ˆä¾‹'
                },
                {
                    id: 2,
                    title: 'åŒ—äº¬CBDå†™å­—æ¥¼ä¼°ä»·',
                    type: 'å†™å­—æ¥¼',
                    city: 'åŒ—äº¬',
                    area: 'æœé˜³åŒº',
                    price: 5200000,
                    areaSize: 260,
                    date: '2025-12-26',
                    description: 'åŒ—äº¬CBDæ ¸å¿ƒåŒºåŸŸ260ã¡å†™å­—æ¥¼ä¼°ä»·æ¡ˆä¾‹'
                },
                {
                    id: 3,
                    title: 'ä¸Šæµ·å¤–æ»©å•†é“ºä¼°ä»·',
                    type: 'å•†é“º',
                    city: 'ä¸Šæµ·',
                    area: 'é»„æµ¦åŒº',
                    price: 8900000,
                    areaSize: 180,
                    date: '2025-12-25',
                    description: 'ä¸Šæµ·å¤–æ»©180ã¡å•†é“ºä¼°ä»·æ¡ˆä¾‹'
                },
                {
                    id: 4,
                    title: 'æ·±åœ³å—å±±åˆ«å¢…ä¼°ä»·',
                    type: 'åˆ«å¢…',
                    city: 'æ·±åœ³',
                    area: 'å—å±±åŒº',
                    price: 12800000,
                    areaSize: 380,
                    date: '2025-12-24',
                    description: 'æ·±åœ³å—å±±380ã¡è±ªååˆ«å¢…ä¼°ä»·æ¡ˆä¾‹'
                },
                {
                    id: 5,
                    title: 'å¹¿å·å¤©æ²³ä½å®…ä¼°ä»·',
                    type: 'ä½å®…',
                    city: 'å¹¿å·',
                    area: 'å¤©æ²³åŒº',
                    price: 3200000,
                    areaSize: 145,
                    date: '2025-12-23',
                    description: 'å¹¿å·å¤©æ²³145ã¡å››å®¤ä¸¤å…ä½å®…ä¼°ä»·æ¡ˆä¾‹'
                },
                {
                    id: 6,
                    title: 'é•¿æ²™å²³éº“åŒºå†™å­—æ¥¼ä¼°ä»·',
                    type: 'å†™å­—æ¥¼',
                    city: 'é•¿æ²™',
                    area: 'å²³éº“åŒº',
                    price: 2800000,
                    areaSize: 180,
                    date: '2025-12-22',
                    description: 'é•¿æ²™å²³éº“åŒº180ã¡å†™å­—æ¥¼ä¼°ä»·æ¡ˆä¾‹'
                }
            ];
            
            // æ¸²æŸ“æ¡ˆä¾‹å¡ç‰‡
            function renderCaseCards(cases) {
                const caseList = document.getElementById('case-list');
                caseList.innerHTML = '';
                
                cases.forEach(caseItem => {
                    const caseCard = document.createElement('div');
                    caseCard.className = 'case-item';
                    caseCard.style = `
                        background: white;
                        padding: 20px;
                        border-radius: 8px;
                        box-shadow: 0 1px 4px rgba(0,0,0,0.05);
                        transition: all 0.3s ease;
                        cursor: pointer;
                    `;
                    
                    const pricePerSquare = Math.round(caseItem.price / caseItem.areaSize);
                    
                    caseCard.innerHTML = `
                        <div style="font-weight: 500; margin-bottom: 8px; font-size: 15px;">${caseItem.title}</div>
                        <div style="display: flex; gap: 12px; margin-bottom: 12px;">
                            <span style="font-size: 12px; color: #667eea; background: #f0f4ff; padding: 2px 8px; border-radius: 4px;">${caseItem.type}</span>
                            <span style="font-size: 12px; color: #999;">${caseItem.city} ${caseItem.area}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 12px;">
                            <div>
                                <div style="font-size: 18px; font-weight: bold; color: #e53e3e;">Â¥${caseItem.price.toLocaleString()}</div>
                                <div style="font-size: 12px; color: #999;">${pricePerSquare.toLocaleString()}å…ƒ/ã¡</div>
                            </div>
                            <div style="text-align: right;">
                                <div style="font-size: 14px; color: #333;">${caseItem.areaSize}ã¡</div>
                                <div style="font-size: 12px; color: #999;">${caseItem.date}</div>
                            </div>
                        </div>
                        <div style="font-size: 13px; color: #666; line-height: 1.5;">${caseItem.description}</div>
                    `;
                    
                    caseCard.addEventListener('click', () => {
                        alert(`æŸ¥çœ‹æ¡ˆä¾‹ï¼š${caseItem.title}`);
                    });
                    
                    caseList.appendChild(caseCard);
                });
            }
            
            // æœç´¢åŠŸèƒ½
            function searchCases() {
                const searchTerm = document.getElementById('case-search')?.value.toLowerCase() || '';
                const caseType = document.getElementById('case-type')?.value || '';
                
                let filteredCases = caseData;
                
                if (searchTerm) {
                    filteredCases = filteredCases.filter(caseItem => 
                        caseItem.title.toLowerCase().includes(searchTerm) ||
                        caseItem.description.toLowerCase().includes(searchTerm) ||
                        caseItem.city.toLowerCase().includes(searchTerm) ||
                        caseItem.area.toLowerCase().includes(searchTerm)
                    );
                }
                
                if (caseType) {
                    filteredCases = filteredCases.filter(caseItem => 
                        caseItem.type === caseType
                    );
                }
                
                renderCaseCards(filteredCases);
            }
            
            // åˆå§‹åŒ–æ¡ˆä¾‹åº“
            function initCaseLibrary() {
                renderCaseCards(caseData);
                
                // æ·»åŠ æœç´¢äº‹ä»¶ç›‘å¬å™¨
                const searchBtn = document.getElementById('search-btn');
                const caseSearch = document.getElementById('case-search');
                const caseType = document.getElementById('case-type');
                
                if (searchBtn) {
                    searchBtn.addEventListener('click', searchCases);
                }
                
                if (caseSearch) {
                    caseSearch.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter') {
                            searchCases();
                        }
                    });
                }
                
                if (caseType) {
                    caseType.addEventListener('change', searchCases);
                }
            }
            
            // åˆå§‹åŠ è½½æ—¶ï¼Œå¦‚æœå½“å‰æ˜¯æ¡ˆä¾‹åº“æ¨¡å—ï¼Œåˆå§‹åŒ–æ¡ˆä¾‹åˆ—è¡¨
            if (document.getElementById('case-library').classList.contains('active')) {
                initCaseLibrary();
            }
            
            // æ›´æ–°ä¾§è¾¹æ èœå•ç‚¹å‡»äº‹ä»¶ï¼Œæ·»åŠ æ¡ˆä¾‹åº“åˆå§‹åŒ–
            menuItems.forEach(item => {
                item.addEventListener('click', function() {
                    const menuText = this.querySelector('span:nth-child(2)').textContent;
                    const moduleId = menuModuleMap[menuText];
                    
                    if (moduleId === 'case-library') {
                        setTimeout(initCaseLibrary, 100); // å»¶è¿Ÿåˆå§‹åŒ–ï¼Œç¡®ä¿æ¨¡å—å·²æ˜¾ç¤º
                    }
                });
            });
            
            // æŠ•èµ„åˆ†ææ¨¡å— - æŠ•èµ„å›æŠ¥ç‡è®¡ç®—å™¨åŠŸèƒ½
            function calculateROI() {
                // è·å–è¾“å…¥å€¼
                const purchasePrice = parseFloat(document.getElementById('purchase-price')?.value) || 0;
                const downPaymentRatio = parseFloat(document.getElementById('down-payment-ratio')?.value) || 0;
                const loanTerm = parseInt(document.getElementById('loan-term')?.value) || 0;
                const loanRate = parseFloat(document.getElementById('loan-rate')?.value) || 0;
                const annualRent = parseFloat(document.getElementById('annual-rent')?.value) || 0;
                const annualAppreciation = parseFloat(document.getElementById('annual-appreciation')?.value) || 0;
                const holdingPeriod = parseInt(document.getElementById('holding-period')?.value) || 0;
                const taxRate = parseFloat(document.getElementById('tax-rate')?.value) || 0;
                
                // éªŒè¯è¾“å…¥
                if (purchasePrice <= 0 || downPaymentRatio <= 0 || loanTerm <= 0 || loanRate <= 0 || holdingPeriod <= 0) {
                    alert('è¯·å¡«å†™æ‰€æœ‰å¿…å¡«å­—æ®µ');
                    return;
                }
                
                // è®¡ç®—é¦–ä»˜é‡‘é¢å’Œè´·æ¬¾é‡‘é¢
                const downPayment = purchasePrice * (downPaymentRatio / 100);
                const loanAmount = purchasePrice - downPayment;
                
                // è®¡ç®—æœˆä¾›ï¼ˆç­‰é¢æœ¬æ¯ï¼‰
                const monthlyRate = loanRate / 100 / 12;
                const totalMonths = loanTerm * 12;
                const monthlyPayment = loanAmount * 10000 * monthlyRate * Math.pow(1 + monthlyRate, totalMonths) / (Math.pow(1 + monthlyRate, totalMonths) - 1);
                
                // è®¡ç®—æ€»åˆ©æ¯æ”¯å‡º
                const totalInterest = (monthlyPayment * totalMonths - loanAmount * 10000) / 10000;
                
                // è®¡ç®—æ€»ç§Ÿé‡‘æ”¶å…¥
                const totalRent = annualRent * holdingPeriod;
                
                // è®¡ç®—æˆ¿äº§å¢å€¼åæ€»ä»·
                const futureValue = purchasePrice * Math.pow(1 + annualAppreciation / 100, holdingPeriod);
                
                // è®¡ç®—äº¤æ˜“ç¨è´¹
                const transactionTax = futureValue * (taxRate / 100);
                
                // è®¡ç®—æŒæœ‰æœŸé—´çš„æ€»æœˆä¾›æ”¯å‡º
                const totalMonthlyPayments = (monthlyPayment * 12 * holdingPeriod) / 10000;
                
                // è®¡ç®—æ€»æŠ•èµ„æˆæœ¬
                const totalInvestment = downPayment + totalMonthlyPayments + transactionTax;
                
                // è®¡ç®—æ€»æŠ•èµ„æ”¶ç›Š
                const totalProfit = futureValue + totalRent - totalInvestment;
                
                // è®¡ç®—æŠ•èµ„å›æŠ¥ç‡
                const roi = (totalProfit / totalInvestment) * 100;
                
                // è®¡ç®—å¹´åŒ–æŠ•èµ„å›æŠ¥ç‡
                const annualROI = (Math.pow(1 + roi / 100, 1 / holdingPeriod) - 1) * 100;
                
                // æ˜¾ç¤ºç»“æœ
                document.getElementById('down-payment').textContent = downPayment.toFixed(2);
                document.getElementById('loan-amount').textContent = loanAmount.toFixed(2);
                document.getElementById('monthly-payment').textContent = Math.round(monthlyPayment).toLocaleString();
                document.getElementById('total-interest').textContent = totalInterest.toFixed(2);
                document.getElementById('total-rent').textContent = totalRent.toFixed(2);
                document.getElementById('future-value').textContent = futureValue.toFixed(2);
                document.getElementById('total-profit').textContent = totalProfit.toFixed(2);
                document.getElementById('roi').textContent = roi.toFixed(2);
                document.getElementById('annual-roi').textContent = annualROI.toFixed(2);
                
                // æ˜¾ç¤ºç»“æœåŒºåŸŸ
                document.getElementById('roi-results').style.display = 'block';
            }
            
            // ä¸ºè®¡ç®—æŒ‰é’®æ·»åŠ ç‚¹å‡»äº‹ä»¶ç›‘å¬å™¨
            const calculateRoiBtn = document.getElementById('calculate-roi');
            if (calculateRoiBtn) {
                calculateRoiBtn.addEventListener('click', calculateROI);
            }
            
            // å·¥å…·é›†æ¨¡å— - å·¥å…·æ ‡ç­¾é¡µåˆ‡æ¢åŠŸèƒ½
            function initToolTabs() {
                const toolTabs = document.querySelectorAll('.editor-tabs .tab');
                const toolPanels = document.querySelectorAll('.tool-panel');
                
                toolTabs.forEach(tab => {
                    tab.addEventListener('click', function() {
                        // ç§»é™¤æ‰€æœ‰æ ‡ç­¾é¡µçš„activeç±»
                        toolTabs.forEach(t => t.classList.remove('active'));
                        // æ·»åŠ activeç±»åˆ°å½“å‰ç‚¹å‡»çš„æ ‡ç­¾é¡µ
                        this.classList.add('active');
                        
                        // è·å–ç›®æ ‡å·¥å…·ID
                        const targetTool = this.dataset.tool;
                        
                        // éšè—æ‰€æœ‰å·¥å…·é¢æ¿
                        toolPanels.forEach(panel => {
                            panel.classList.remove('active');
                        });
                        
                        // æ˜¾ç¤ºç›®æ ‡å·¥å…·é¢æ¿
                        const targetPanel = document.getElementById(targetTool);
                        if (targetPanel) {
                            targetPanel.classList.add('active');
                        }
                    });
                });
            }
            
            // å·¥å…·é›†æ¨¡å— - æˆ¿è´·è®¡ç®—å™¨åŠŸèƒ½
            function calculateMortgage() {
                const mortgageAmount = parseFloat(document.getElementById('mortgage-amount')?.value) || 0;
                const mortgageTerm = parseInt(document.getElementById('mortgage-term')?.value) || 0;
                const mortgageRate = parseFloat(document.getElementById('mortgage-rate')?.value) || 0;
                const repaymentMethod = document.getElementById('repayment-method')?.value || 'equal-principal-interest';
                
                if (mortgageAmount <= 0 || mortgageTerm <= 0 || mortgageRate <= 0) {
                    alert('è¯·å¡«å†™æ‰€æœ‰å¿…å¡«å­—æ®µ');
                    return;
                }
                
                const monthlyRate = mortgageRate / 100 / 12;
                const totalMonths = mortgageTerm * 12;
                let monthlyPayment, totalPayment, totalInterest;
                
                if (repaymentMethod === 'equal-principal-interest') {
                    // ç­‰é¢æœ¬æ¯
                    monthlyPayment = mortgageAmount * 10000 * monthlyRate * Math.pow(1 + monthlyRate, totalMonths) / (Math.pow(1 + monthlyRate, totalMonths) - 1);
                    totalPayment = monthlyPayment * totalMonths;
                } else {
                    // ç­‰é¢æœ¬é‡‘
                    const principalPerMonth = mortgageAmount * 10000 / totalMonths;
                    const firstMonthInterest = mortgageAmount * 10000 * monthlyRate;
                    monthlyPayment = principalPerMonth + firstMonthInterest;
                    totalInterest = (mortgageAmount * 10000 * monthlyRate * (totalMonths + 1)) / 2;
                    totalPayment = mortgageAmount * 10000 + totalInterest;
                }
                
                totalInterest = (totalPayment - mortgageAmount * 10000) / 10000;
                
                // æ˜¾ç¤ºç»“æœ
                document.getElementById('mortgage-monthly-payment').textContent = Math.round(monthlyPayment).toLocaleString();
                document.getElementById('mortgage-total-interest').textContent = totalInterest.toFixed(2);
                document.getElementById('mortgage-total-payment').textContent = (totalPayment / 10000).toFixed(2);
                document.getElementById('mortgage-results').style.display = 'block';
            }
            
            // å·¥å…·é›†æ¨¡å— - ç¨è´¹è®¡ç®—å™¨åŠŸèƒ½
            function calculateTax() {
                const housePrice = parseFloat(document.getElementById('tax-house-price')?.value) || 0;
                const houseArea = parseFloat(document.getElementById('tax-house-area')?.value) || 0;
                const houseType = document.getElementById('tax-house-type')?.value || 'normal';
                const firstHome = document.getElementById('tax-first-home')?.value === 'yes';
                
                if (housePrice <= 0 || houseArea <= 0) {
                    alert('è¯·å¡«å†™æ‰€æœ‰å¿…å¡«å­—æ®µ');
                    return;
                }
                
                let deedTax = 0;
                let vat = 0;
                let personalTax = 0;
                let stampTax = 0;
                
                // è®¡ç®—å¥‘ç¨
                if (houseType === 'normal') {
                    if (firstHome) {
                        if (houseArea <= 90) {
                            deedTax = housePrice * 0.01;
                        } else {
                            deedTax = housePrice * 0.015;
                        }
                    } else {
                        deedTax = housePrice * 0.03;
                    }
                } else {
                    deedTax = housePrice * 0.03;
                }
                
                // è®¡ç®—å¢å€¼ç¨ï¼ˆç®€åŒ–è®¡ç®—ï¼‰
                vat = housePrice * 0.056;
                
                // è®¡ç®—ä¸ªäººæ‰€å¾—ç¨
                personalTax = housePrice * 0.01;
                
                // è®¡ç®—å°èŠ±ç¨
                stampTax = housePrice * 0.0005;
                
                const totalTax = deedTax + vat + personalTax + stampTax;
                
                // æ˜¾ç¤ºç»“æœ
                document.getElementById('tax-deed').textContent = Math.round(deedTax * 10000).toLocaleString();
                document.getElementById('tax-vat').textContent = Math.round(vat * 10000).toLocaleString();
                document.getElementById('tax-personal').textContent = Math.round(personalTax * 10000).toLocaleString();
                document.getElementById('tax-stamp').textContent = Math.round(stampTax * 10000).toLocaleString();
                document.getElementById('tax-total').textContent = Math.round(totalTax * 10000).toLocaleString();
                document.getElementById('tax-results').style.display = 'block';
            }
            
            // å·¥å…·é›†æ¨¡å— - é¢ç§¯æ¢ç®—å™¨åŠŸèƒ½
            function convertArea() {
                const areaInput = parseFloat(document.getElementById('area-input')?.value) || 0;
                const fromUnit = document.getElementById('area-from-unit')?.value || 'square-meter';
                const toUnit = document.getElementById('area-to-unit')?.value || 'square-meter';
                
                if (areaInput < 0) {
                    alert('è¯·è¾“å…¥æœ‰æ•ˆçš„é¢ç§¯å€¼');
                    return;
                }
                
                // é¢ç§¯è½¬æ¢ç³»æ•°ï¼ˆè½¬æ¢ä¸ºå¹³æ–¹ç±³ï¼‰
                const conversionFactors = {
                    'square-meter': 1,
                    'square-foot': 0.092903,
                    'acre': 4046.86,
                    'hectare': 10000
                };
                
                // å…ˆè½¬æ¢ä¸ºå¹³æ–¹ç±³
                const areaInSquareMeter = areaInput * conversionFactors[fromUnit];
                // å†è½¬æ¢ä¸ºç›®æ ‡å•ä½
                const areaInTargetUnit = areaInSquareMeter / conversionFactors[toUnit];
                
                // æ˜¾ç¤ºç»“æœ
                document.getElementById('area-output').value = areaInTargetUnit.toFixed(4);
            }
            
            // å·¥å…·é›†æ¨¡å— - ç§Ÿé‡‘å›æŠ¥ç‡è®¡ç®—å™¨åŠŸèƒ½
            function calculateRentROI() {
                const housePrice = parseFloat(document.getElementById('rent-roi-house-price')?.value) || 0;
                const monthlyRent = parseFloat(document.getElementById('rent-roi-monthly-rent')?.value) || 0;
                
                if (housePrice <= 0 || monthlyRent <= 0) {
                    alert('è¯·å¡«å†™æ‰€æœ‰å¿…å¡«å­—æ®µ');
                    return;
                }
                
                const annualIncome = monthlyRent * 12;
                const rentROI = (annualIncome / (housePrice * 10000)) * 100;
                
                // æ˜¾ç¤ºç»“æœ
                document.getElementById('rent-roi-annual-income').textContent = annualIncome.toLocaleString();
                document.getElementById('rent-roi-rate').textContent = rentROI.toFixed(2);
                document.getElementById('rent-roi-results').style.display = 'block';
            }
            
            // åˆå§‹åŒ–å·¥å…·é›†åŠŸèƒ½
            function initToolSet() {
                // åˆå§‹åŒ–å·¥å…·æ ‡ç­¾é¡µ
                initToolTabs();
                
                // æ·»åŠ æˆ¿è´·è®¡ç®—å™¨äº‹ä»¶ç›‘å¬å™¨
                const calculateMortgageBtn = document.getElementById('calculate-mortgage');
                if (calculateMortgageBtn) {
                    calculateMortgageBtn.addEventListener('click', calculateMortgage);
                }
                
                // æ·»åŠ ç¨è´¹è®¡ç®—å™¨äº‹ä»¶ç›‘å¬å™¨
                const calculateTaxBtn = document.getElementById('calculate-tax');
                if (calculateTaxBtn) {
                    calculateTaxBtn.addEventListener('click', calculateTax);
                }
                
                // æ·»åŠ é¢ç§¯æ¢ç®—å™¨äº‹ä»¶ç›‘å¬å™¨
                const areaConvertBtn = document.querySelector('#area-converter .btn');
                if (areaConvertBtn) {
                    areaConvertBtn.addEventListener('click', convertArea);
                }
                
                // æ·»åŠ ç§Ÿé‡‘å›æŠ¥ç‡è®¡ç®—å™¨äº‹ä»¶ç›‘å¬å™¨
                const calculateRentRoiBtn = document.getElementById('calculate-rent-roi');
                if (calculateRentRoiBtn) {
                    calculateRentRoiBtn.addEventListener('click', calculateRentROI);
                }
            }
            
            // åˆå§‹åŠ è½½æ—¶ï¼Œå¦‚æœå½“å‰æ˜¯å·¥å…·é›†æ¨¡å—ï¼Œåˆå§‹åŒ–å·¥å…·é›†åŠŸèƒ½
            if (document.getElementById('tool-set').classList.contains('active')) {
                setTimeout(initToolSet, 100); // å»¶è¿Ÿåˆå§‹åŒ–ï¼Œç¡®ä¿æ¨¡å—å·²æ˜¾ç¤º
            }
            
            // æ›´æ–°ä¾§è¾¹æ èœå•ç‚¹å‡»äº‹ä»¶ï¼Œæ·»åŠ å·¥å…·é›†åˆå§‹åŒ–
            menuItems.forEach(item => {
                item.addEventListener('click', function() {
                    const menuText = this.querySelector('span:nth-child(2)').textContent;
                    const moduleId = menuModuleMap[menuText];
                    
                    if (moduleId === 'tool-set') {
                        setTimeout(initToolSet, 100); // å»¶è¿Ÿåˆå§‹åŒ–ï¼Œç¡®ä¿æ¨¡å—å·²æ˜¾ç¤º
                    } else if (moduleId === 'settings') {
                        setTimeout(initSettings, 100); // å»¶è¿Ÿåˆå§‹åŒ–ï¼Œç¡®ä¿æ¨¡å—å·²æ˜¾ç¤º
                    }
                });
            });
            
            // è®¾ç½®æ¨¡å— - è®¾ç½®æ ‡ç­¾é¡µåˆ‡æ¢åŠŸèƒ½
            function initSettingsTabs() {
                const settingTabs = document.querySelectorAll('.setting-content .editor-tabs .tab');
                const settingPanels = document.querySelectorAll('.setting-panel');
                
                settingTabs.forEach(tab => {
                    tab.addEventListener('click', function() {
                        // ç§»é™¤æ‰€æœ‰æ ‡ç­¾é¡µçš„activeç±»
                        settingTabs.forEach(t => t.classList.remove('active'));
                        // æ·»åŠ activeç±»åˆ°å½“å‰ç‚¹å‡»çš„æ ‡ç­¾é¡µ
                        this.classList.add('active');
                        
                        // è·å–ç›®æ ‡è®¾ç½®ID
                        const targetSetting = this.dataset.setting;
                        
                        // éšè—æ‰€æœ‰è®¾ç½®é¢æ¿
                        settingPanels.forEach(panel => {
                            panel.classList.remove('active');
                        });
                        
                        // æ˜¾ç¤ºç›®æ ‡è®¾ç½®é¢æ¿
                        const targetPanel = document.getElementById(targetSetting);
                        if (targetPanel) {
                            targetPanel.classList.add('active');
                        }
                    });
                });
            }
            
            // è®¾ç½®æ¨¡å— - ä¿å­˜è®¾ç½®åŠŸèƒ½
            function initSettingSave() {
                // ç”¨æˆ·ä¿¡æ¯ä¿å­˜
                const saveUserInfoBtn = document.querySelector('#user-info .btn-primary');
                if (saveUserInfoBtn) {
                    saveUserInfoBtn.addEventListener('click', function() {
                        alert('ç”¨æˆ·ä¿¡æ¯å·²ä¿å­˜');
                    });
                }
                
                // ç³»ç»Ÿè®¾ç½®ä¿å­˜
                const saveSystemSettingsBtn = document.querySelector('#system-settings .btn-primary');
                if (saveSystemSettingsBtn) {
                    saveSystemSettingsBtn.addEventListener('click', function() {
                        alert('ç³»ç»Ÿè®¾ç½®å·²ä¿å­˜');
                    });
                }
                
                // é€šçŸ¥è®¾ç½®ä¿å­˜
                const saveNotificationSettingsBtn = document.querySelector('#notification-settings .btn-primary');
                if (saveNotificationSettingsBtn) {
                    saveNotificationSettingsBtn.addEventListener('click', function() {
                        alert('é€šçŸ¥è®¾ç½®å·²ä¿å­˜');
                    });
                }
                
                // ä¿®æ”¹å¯†ç ä¿å­˜
                const changePasswordBtn = document.querySelector('#security-settings .btn-primary');
                if (changePasswordBtn) {
                    changePasswordBtn.addEventListener('click', function() {
                        alert('å¯†ç ä¿®æ”¹åŠŸèƒ½å·²è§¦å‘');
                    });
                }
            }
            
            // åˆå§‹åŒ–è®¾ç½®æ¨¡å—åŠŸèƒ½
            function initSettings() {
                initSettingsTabs();
                initSettingSave();
            }
            
            // åˆå§‹åŠ è½½æ—¶ï¼Œå¦‚æœå½“å‰æ˜¯è®¾ç½®æ¨¡å—ï¼Œåˆå§‹åŒ–è®¾ç½®åŠŸèƒ½
            if (document.getElementById('settings').classList.contains('active')) {
                setTimeout(initSettings, 100); // å»¶è¿Ÿåˆå§‹åŒ–ï¼Œç¡®ä¿æ¨¡å—å·²æ˜¾ç¤º
            }
            
            // Excelå¯¼å…¥/å¯¼å‡ºåŠŸèƒ½
            function initExcelFunctions() {
                const importExcelBtn = document.getElementById('import-excel-btn');
                const exportExcelBtn = document.getElementById('export-excel-btn');
                const excelFileInput = document.getElementById('excel-file-input');
                const fileList = document.querySelector('.file-list');
                
                // æœç´¢ç›¸å…³å…ƒç´ 
                const searchInput = document.getElementById('search-input');
                const filterType = document.getElementById('filter-type');
                const filterCity = document.getElementById('filter-city');
                const filterStartDate = document.getElementById('filter-start-date');
                const filterEndDate = document.getElementById('filter-end-date');
                const filterMinPrice = document.getElementById('filter-min-price');
                const filterMaxPrice = document.getElementById('filter-max-price');
                const filterMinArea = document.getElementById('filter-min-area');
                const filterMaxArea = document.getElementById('filter-max-area');
                const sortSelect = document.getElementById('sort-select');
                const searchBtn = document.getElementById('search-btn');
                const resetFilterBtn = document.getElementById('reset-filter-btn');
                const searchResultCount = document.getElementById('search-result-count');
                
                // æ¨¡æ‹Ÿä¼°ä»·é¡¹ç›®æ•°æ®
                let valuationProjects = [
                    {
                        id: 1,
                        title: 'é•¿æ²™ä¸‡ç§‘åŸä¼°ä»·',
                        date: '2025-12-27 14:30',
                        type: 'ä½å®…',
                        city: 'é•¿æ²™',
                        area: 'å¼€ç¦åŒº',
                        price: 1536000,
                        areaSize: 120
                    },
                    {
                        id: 2,
                        title: 'å²³éº“åŒºäºŒæ‰‹æˆ¿åˆ†æ',
                        date: '2025-12-26 10:15',
                        type: 'ä½å®…',
                        city: 'é•¿æ²™',
                        area: 'å²³éº“åŒº',
                        price: 1800000,
                        areaSize: 140
                    },
                    {
                        id: 3,
                        title: 'å•†ä¸šåœ°äº§ä¼°ä»·',
                        date: '2025-12-25 16:45',
                        type: 'å•†é“º',
                        city: 'é•¿æ²™',
                        area: 'èŠ™è“‰åŒº',
                        price: 3500000,
                        areaSize: 150
                    }
                ];
                
                // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                function showLoading(message) {
                    const loadingOverlay = document.createElement('div');
                    loadingOverlay.className = 'loading-overlay active';
                    loadingOverlay.innerHTML = `
                        <div style="text-align: center;">
                            <div class="loading-spinner"></div>
                            <p style="margin-top: 16px; color: #333;">${message}</p>
                        </div>
                    `;
                    document.body.appendChild(loadingOverlay);
                    return loadingOverlay;
                }
                
                // éšè—åŠ è½½çŠ¶æ€
                function hideLoading(loadingOverlay) {
                    if (loadingOverlay) {
                        loadingOverlay.remove();
                    }
                }
                
                // ç”ŸæˆExcelå¯¼å…¥æ¨¡æ¿
                function generateImportTemplate() {
                    const templateData = [
                        {
                            'é¡¹ç›®åç§°': 'ç¤ºä¾‹é¡¹ç›®',
                            'åˆ›å»ºæ—¥æœŸ': '2025-12-29',
                            'ç‰©ä¸šç±»å‹': 'ä½å®…',
                            'åŸå¸‚': 'é•¿æ²™',
                            'åŒºåŸŸ': 'å¼€ç¦åŒº',
                            'å»ºç­‘é¢ç§¯': 120,
                            'ä¼°ä»·(å…ƒ)': 1536000
                        },
                        {
                            'é¡¹ç›®åç§°': '',
                            'åˆ›å»ºæ—¥æœŸ': '',
                            'ç‰©ä¸šç±»å‹': 'å†™å­—æ¥¼',
                            'åŸå¸‚': '',
                            'åŒºåŸŸ': '',
                            'å»ºç­‘é¢ç§¯': '',
                            'ä¼°ä»·(å…ƒ)': ''
                        }
                    ];
                    
                    const worksheet = XLSX.utils.json_to_sheet(templateData);
                    const workbook = XLSX.utils.book_new();
                    XLSX.utils.book_append_sheet(workbook, worksheet, 'å¯¼å…¥æ¨¡æ¿');
                    
                    // æ·»åŠ è¯´æ˜å·¥ä½œè¡¨
                    const instructions = [
                        { 'è¯´æ˜': '1. è¯·æŒ‰ç…§æ¨¡æ¿æ ¼å¼å¡«å†™ä¼°ä»·é¡¹ç›®ä¿¡æ¯' },
                        { 'è¯´æ˜': '2. å¸¦*çš„åˆ—ä¸ºå¿…å¡«é¡¹' },
                        { 'è¯´æ˜': '3. ç‰©ä¸šç±»å‹æ”¯æŒï¼šä½å®…ã€å†™å­—æ¥¼ã€å•†é“ºã€åˆ«å¢…ã€å·¥ä¸šåœ°äº§' },
                        { 'è¯´æ˜': '' },
                        { 'åˆ—å': 'é¡¹ç›®åç§°', 'è¯´æ˜': 'å¿…å¡«ï¼Œä¼°ä»·é¡¹ç›®çš„åç§°', 'ç¤ºä¾‹': 'é•¿æ²™ä¸‡ç§‘åŸä¼°ä»·' },
                        { 'åˆ—å': 'åˆ›å»ºæ—¥æœŸ', 'è¯´æ˜': 'é€‰å¡«ï¼Œæ ¼å¼ï¼šYYYY-MM-DD HH:MM', 'ç¤ºä¾‹': '2025-12-29 14:30' },
                        { 'åˆ—å': 'ç‰©ä¸šç±»å‹', 'è¯´æ˜': 'é€‰å¡«ï¼Œé»˜è®¤ï¼šä½å®…', 'ç¤ºä¾‹': 'ä½å®…' },
                        { 'åˆ—å': 'åŸå¸‚', 'è¯´æ˜': 'é€‰å¡«ï¼Œé»˜è®¤ï¼šé•¿æ²™', 'ç¤ºä¾‹': 'é•¿æ²™' },
                        { 'åˆ—å': 'åŒºåŸŸ', 'è¯´æ˜': 'é€‰å¡«ï¼Œé¡¹ç›®æ‰€åœ¨åŒºåŸŸ', 'ç¤ºä¾‹': 'å¼€ç¦åŒº' },
                        { 'åˆ—å': 'å»ºç­‘é¢ç§¯', 'è¯´æ˜': 'é€‰å¡«ï¼Œå•ä½ï¼šå¹³æ–¹ç±³', 'ç¤ºä¾‹': '120' },
                        { 'åˆ—å': 'ä¼°ä»·(å…ƒ)', 'è¯´æ˜': 'é€‰å¡«ï¼Œé¡¹ç›®æ€»ä¼°ä»·', 'ç¤ºä¾‹': '1536000' }
                    ];
                    const instructionsSheet = XLSX.utils.json_to_sheet(instructions);
                    XLSX.utils.book_append_sheet(workbook, instructionsSheet, 'å¡«å†™è¯´æ˜');
                    
                    XLSX.writeFile(workbook, 'ä¼°ä»·é¡¹ç›®å¯¼å…¥æ¨¡æ¿.xlsx');
                }
                
                // æ•°æ®éªŒè¯å’Œå¤„ç†
                function validateAndProcessData(data) {
                    const validProjects = [];
                    const errors = [];
                    
                    data.forEach((item, index) => {
                        const row = index + 2; // è¡Œå·ï¼ˆ+2æ˜¯å› ä¸ºExcelä»1å¼€å§‹ï¼Œä¸”æœ‰æ ‡é¢˜è¡Œï¼‰
                        const project = {
                            id: valuationProjects.length + validProjects.length + 1,
                            title: item['é¡¹ç›®åç§°'] || '',
                            date: item['åˆ›å»ºæ—¥æœŸ'] || new Date().toLocaleString(),
                            type: item['ç‰©ä¸šç±»å‹'] || 'ä½å®…',
                            city: item['åŸå¸‚'] || 'é•¿æ²™',
                            area: item['åŒºåŸŸ'] || '',
                            price: item['ä¼°ä»·(å…ƒ)'] || 0,
                            areaSize: item['å»ºç­‘é¢ç§¯'] || 0
                        };
                        
                        // æ•°æ®éªŒè¯
                        if (!project.title.trim()) {
                            errors.push(`ç¬¬${row}è¡Œï¼šé¡¹ç›®åç§°ä¸èƒ½ä¸ºç©º`);
                            return;
                        }
                        
                        // éªŒè¯ç‰©ä¸šç±»å‹
                        const validTypes = ['ä½å®…', 'å†™å­—æ¥¼', 'å•†é“º', 'åˆ«å¢…', 'å·¥ä¸šåœ°äº§'];
                        if (!validTypes.includes(project.type)) {
                            errors.push(`ç¬¬${row}è¡Œï¼šç‰©ä¸šç±»å‹æ— æ•ˆï¼Œæ”¯æŒçš„ç±»å‹ï¼š${validTypes.join(', ')}`);
                            return;
                        }
                        
                        // éªŒè¯å»ºç­‘é¢ç§¯
                        if (project.areaSize && isNaN(parseFloat(project.areaSize))) {
                            errors.push(`ç¬¬${row}è¡Œï¼šå»ºç­‘é¢ç§¯å¿…é¡»æ˜¯æ•°å­—`);
                            return;
                        }
                        
                        // éªŒè¯ä¼°ä»·
                        if (project.price && isNaN(parseFloat(project.price))) {
                            errors.push(`ç¬¬${row}è¡Œï¼šä¼°ä»·å¿…é¡»æ˜¯æ•°å­—`);
                            return;
                        }
                        
                        validProjects.push(project);
                    });
                    
                    return { validProjects, errors };
                }
                
                // å¯¼å…¥Excelæ–‡ä»¶
                importExcelBtn.addEventListener('click', function() {
                    // åˆ›å»ºå¯¼å…¥èœå•
                    const menu = document.createElement('div');
                    menu.className = 'dropdown-menu';
                    menu.style.cssText = `
                        position: absolute;
                        top: 100%;
                        right: 10px;
                        background: white;
                        border: 1px solid #e0e0e0;
                        border-radius: 8px;
                        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
                        z-index: 1000;
                        min-width: 150px;
                    `;
                    menu.innerHTML = `
                        <div style="padding: 8px;">
                            <button id="import-file-btn" style="width: 100%; padding: 8px 12px; text-align: left; border: none; background: none; cursor: pointer;">
                                ğŸ“ é€‰æ‹©æ–‡ä»¶å¯¼å…¥
                            </button>
                            <button id="download-template-btn" style="width: 100%; padding: 8px 12px; text-align: left; border: none; background: none; cursor: pointer;">
                                ğŸ“„ ä¸‹è½½å¯¼å…¥æ¨¡æ¿
                            </button>
                        </div>
                    `;
                    
                    // æ·»åŠ åˆ°é¡µé¢
                    this.style.position = 'relative';
                    this.appendChild(menu);
                    
                    // ç‚¹å‡»é€‰æ‹©æ–‡ä»¶å¯¼å…¥
                    document.getElementById('import-file-btn').addEventListener('click', function() {
                        excelFileInput.click();
                        menu.remove();
                    });
                    
                    // ç‚¹å‡»ä¸‹è½½æ¨¡æ¿
                    document.getElementById('download-template-btn').addEventListener('click', function() {
                        generateImportTemplate();
                        menu.remove();
                        showToast('å¯¼å…¥æ¨¡æ¿å·²ä¸‹è½½ï¼', 'success');
                    });
                    
                    // ç‚¹å‡»å¤–éƒ¨å…³é—­èœå•
                    setTimeout(() => {
                        document.addEventListener('click', function closeMenu(e) {
                            if (!menu.contains(e.target) && e.target !== importExcelBtn) {
                                menu.remove();
                                document.removeEventListener('click', closeMenu);
                            }
                        });
                    }, 100);
                });
                
                excelFileInput.addEventListener('change', function(e) {
                    const file = e.target.files[0];
                    if (!file) return;
                    
                    // éªŒè¯æ–‡ä»¶ç±»å‹
                    const validExtensions = ['.xlsx', '.xls'];
                    const fileName = file.name.toLowerCase();
                    if (!validExtensions.some(ext => fileName.endsWith(ext))) {
                        showToast('è¯·é€‰æ‹©æœ‰æ•ˆçš„Excelæ–‡ä»¶ (.xlsx, .xls)', 'danger');
                        return;
                    }
                    
                    const loadingOverlay = showLoading('æ­£åœ¨å¯¼å…¥æ•°æ®...');
                    
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const data = new Uint8Array(e.target.result);
                            const workbook = XLSX.read(data, { type: 'array' });
                            const firstSheetName = workbook.SheetNames[0];
                            const worksheet = workbook.Sheets[firstSheetName];
                            const jsonData = XLSX.utils.sheet_to_json(worksheet);
                            
                            // éªŒè¯å’Œå¤„ç†æ•°æ®
                            const { validProjects, errors } = validateAndProcessData(jsonData);
                            
                            if (errors.length > 0) {
                                // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
                                const errorMessage = `å¯¼å…¥è¿‡ç¨‹ä¸­å‘ç° ${errors.length} ä¸ªé”™è¯¯ï¼š\n\n${errors.join('\n')}`;
                                alert(errorMessage);
                                
                                // ä»ç„¶å¯¼å…¥æœ‰æ•ˆæ•°æ®
                                if (validProjects.length > 0) {
                                    valuationProjects = [...valuationProjects, ...validProjects];
                                    searchAndFilter();
                                    showToast(`éƒ¨åˆ†å¯¼å…¥æˆåŠŸï¼å…±å¯¼å…¥ ${validProjects.length} ä¸ªæœ‰æ•ˆé¡¹ç›®ï¼Œ${errors.length} ä¸ªé¡¹ç›®å¯¼å…¥å¤±è´¥`, 'warning');
                                }
                            } else {
                                // å…¨éƒ¨å¯¼å…¥æˆåŠŸ
                                valuationProjects = [...valuationProjects, ...validProjects];
                                searchAndFilter();
                                showToast(`å¯¼å…¥æˆåŠŸï¼å…±å¯¼å…¥ ${validProjects.length} ä¸ªä¼°ä»·é¡¹ç›®`, 'success');
                            }
                        } catch (error) {
                            console.error('å¯¼å…¥å¤±è´¥ï¼š', error);
                            showToast('å¯¼å…¥å¤±è´¥ï¼š' + error.message, 'danger');
                        } finally {
                            hideLoading(loadingOverlay);
                        }
                    };
                    
                    reader.onerror = function() {
                        hideLoading(loadingOverlay);
                        showToast('æ–‡ä»¶è¯»å–å¤±è´¥', 'danger');
                    };
                    
                    reader.readAsArrayBuffer(file);
                    
                    // æ¸…ç©ºæ–‡ä»¶è¾“å…¥
                    e.target.value = '';
                });
                
                // å¯¼å‡ºExcelæ–‡ä»¶
                exportExcelBtn.addEventListener('click', function() {
                    const loadingOverlay = showLoading('æ­£åœ¨ç”ŸæˆExcelæ–‡ä»¶...');
                    
                    setTimeout(() => {
                        try {
                            // å‡†å¤‡å¯¼å‡ºæ•°æ®
                            const exportData = valuationProjects.map(project => ({
                                'é¡¹ç›®åç§°': project.title,
                                'åˆ›å»ºæ—¥æœŸ': project.date,
                                'ç‰©ä¸šç±»å‹': project.type,
                                'åŸå¸‚': project.city,
                                'åŒºåŸŸ': project.area,
                                'å»ºç­‘é¢ç§¯': project.areaSize,
                                'ä¼°ä»·(å…ƒ)': project.price
                            }));
                            
                            // åˆ›å»ºå·¥ä½œè¡¨å’Œå·¥ä½œç°¿
                            const worksheet = XLSX.utils.json_to_sheet(exportData);
                            
                            // è®¾ç½®åˆ—å®½
                            const wscols = [
                                { wch: 25 }, // é¡¹ç›®åç§°
                                { wch: 20 }, // åˆ›å»ºæ—¥æœŸ
                                { wch: 12 }, // ç‰©ä¸šç±»å‹
                                { wch: 10 }, // åŸå¸‚
                                { wch: 15 }, // åŒºåŸŸ
                                { wch: 12 }, // å»ºç­‘é¢ç§¯
                                { wch: 15 }  // ä¼°ä»·(å…ƒ)
                            ];
                            worksheet['!cols'] = wscols;
                            
                            const workbook = XLSX.utils.book_new();
                            XLSX.utils.book_append_sheet(workbook, worksheet, 'ä¼°ä»·é¡¹ç›®');
                            
                            // ç”ŸæˆExcelæ–‡ä»¶å¹¶ä¸‹è½½
                            const fileName = `ä¼°ä»·é¡¹ç›®åˆ—è¡¨_${new Date().toISOString().slice(0, 10)}.xlsx`;
                            XLSX.writeFile(workbook, fileName);
                            
                            showToast('Excelæ–‡ä»¶å¯¼å‡ºæˆåŠŸï¼', 'success');
                        } catch (error) {
                            console.error('å¯¼å‡ºå¤±è´¥ï¼š', error);
                            showToast('å¯¼å‡ºå¤±è´¥ï¼š' + error.message, 'danger');
                        } finally {
                            hideLoading(loadingOverlay);
                        }
                    }, 500);
                });
                
                // æ·»åŠ æ•°æ®å¯¼å‡ºåˆ°å¯¼å…¥æŒ‰é’®çš„æç¤º
                importExcelBtn.title = 'å¯¼å…¥Excelæ–‡ä»¶æˆ–ä¸‹è½½å¯¼å…¥æ¨¡æ¿';
                exportExcelBtn.title = 'å¯¼å‡ºä¼°ä»·é¡¹ç›®åˆ—è¡¨åˆ°Excelæ–‡ä»¶';
                
                // æœç´¢å†å²åŠŸèƒ½
                function initSearchHistory() {
                    // åŠ è½½æœç´¢å†å²
                    function loadSearchHistory() {
                        const history = JSON.parse(localStorage.getItem('searchHistory')) || [];
                        return history;
                    }
                    
                    // ä¿å­˜æœç´¢å†å²
                    function saveSearchHistory(term) {
                        if (!term.trim()) return;
                        
                        let history = loadSearchHistory();
                        // ç§»é™¤é‡å¤é¡¹
                        history = history.filter(item => item !== term);
                        // æ·»åŠ åˆ°å¼€å¤´
                        history.unshift(term);
                        // åªä¿ç•™æœ€è¿‘10æ¡
                        if (history.length > 10) {
                            history = history.slice(0, 10);
                        }
                        localStorage.setItem('searchHistory', JSON.stringify(history));
                    }
                    
                    // æ˜¾ç¤ºæœç´¢å†å²
                    function displaySearchHistory() {
                        const history = loadSearchHistory();
                        const historyContainer = document.getElementById('search-history');
                        
                        if (history.length === 0) {
                            historyContainer.style.display = 'none';
                            return;
                        }
                        
                        historyContainer.innerHTML = '';
                        historyContainer.style.display = 'flex';
                        
                        history.forEach(term => {
                            const historyItem = document.createElement('div');
                            historyItem.style.cssText = `
                                background-color: white;
                                border: 1px solid #e0e0e0;
                                border-radius: 12px;
                                padding: 4px 10px;
                                font-size: 12px;
                                color: #666;
                                cursor: pointer;
                                transition: all 0.2s ease;
                            `;
                            historyItem.textContent = term;
                            
                            historyItem.addEventListener('click', function() {
                                searchInput.value = term;
                                searchAndFilter();
                            });
                            
                            historyItem.addEventListener('mouseenter', function() {
                                this.style.backgroundColor = '#f0f4ff';
                                this.style.color = '#667eea';
                            });
                            
                            historyItem.addEventListener('mouseleave', function() {
                                this.style.backgroundColor = 'white';
                                this.style.color = '#666';
                            });
                            
                            historyContainer.appendChild(historyItem);
                        });
                    }
                    
                    // æ¸…é™¤æœç´¢å†å²
                    document.getElementById('search-clear-btn')?.addEventListener('click', function() {
                        searchInput.value = '';
                        this.style.display = 'none';
                        searchAndFilter();
                        displaySearchHistory();
                    });
                    
                    // ç›‘å¬æœç´¢è¾“å…¥å˜åŒ–
                    searchInput.addEventListener('input', function() {
                        const clearBtn = document.getElementById('search-clear-btn');
                        if (this.value.trim()) {
                            clearBtn.style.display = 'block';
                        } else {
                            clearBtn.style.display = 'none';
                        }
                    });
                    
                    // åˆå§‹æ˜¾ç¤ºæœç´¢å†å²
                    displaySearchHistory();
                    
                    return {
                        saveSearchHistory,
                        displaySearchHistory
                    };
                }
                
                // é«˜çº§ç­›é€‰é¢æ¿æŠ˜å /å±•å¼€åŠŸèƒ½
                function initAdvancedFilter() {
                    const toggleBtn = document.getElementById('advanced-filter-toggle');
                    const content = document.getElementById('advanced-filter-content');
                    const icon = document.getElementById('advanced-filter-icon');
                    
                    if (!toggleBtn || !content || !icon) {
                        return;
                    }
                    
                    toggleBtn.addEventListener('click', function() {
                        if (content.style.display === 'none') {
                            content.style.display = 'block';
                            icon.textContent = 'â–²';
                        } else {
                            content.style.display = 'none';
                            icon.textContent = 'â–¼';
                        }
                    });
                }
                
                // æœç´¢å’Œç­›é€‰åŠŸèƒ½
                function searchAndFilter() {
                    const searchTerm = searchInput.value.toLowerCase();
                    const selectedType = filterType.value;
                    const selectedCity = filterCity.value;
                    const startDate = filterStartDate.value;
                    const endDate = filterEndDate.value;
                    const minPrice = parseFloat(filterMinPrice?.value) || 0;
                    const maxPrice = parseFloat(filterMaxPrice?.value) || Infinity;
                    const minArea = parseFloat(filterMinArea?.value) || 0;
                    const maxArea = parseFloat(filterMaxArea?.value) || Infinity;
                    const sortOrder = sortSelect?.value || 'date-desc';
                    
                    // ä¿å­˜æœç´¢å†å²
                    if (searchTerm.trim()) {
                        searchHistoryFunctions.saveSearchHistory(searchInput.value);
                        searchHistoryFunctions.displaySearchHistory();
                    }
                    
                    // ç­›é€‰æ•°æ®
                    let filteredProjects = valuationProjects.filter(project => {
                        // æ ‡é¢˜æœç´¢
                        const matchesSearch = project.title.toLowerCase().includes(searchTerm) || 
                                            project.area.toLowerCase().includes(searchTerm) ||
                                            project.city.toLowerCase().includes(searchTerm);
                        
                        // ç‰©ä¸šç±»å‹ç­›é€‰
                        const matchesType = !selectedType || project.type === selectedType;
                        
                        // åŸå¸‚ç­›é€‰
                        const matchesCity = !selectedCity || project.city === selectedCity;
                        
                        // æ—¥æœŸèŒƒå›´ç­›é€‰
                        let matchesDate = true;
                        if (startDate || endDate) {
                            const projectDate = new Date(project.date);
                            const start = startDate ? new Date(startDate) : new Date(0);
                            const end = endDate ? new Date(endDate) : new Date(8640000000000000);
                            end.setHours(23, 59, 59, 999);
                            matchesDate = projectDate >= start && projectDate <= end;
                        }
                        
                        // ä»·æ ¼èŒƒå›´ç­›é€‰
                        const matchesPrice = project.price >= minPrice && project.price <= maxPrice;
                        
                        // å»ºç­‘é¢ç§¯èŒƒå›´ç­›é€‰
                        const matchesArea = project.areaSize >= minArea && project.areaSize <= maxArea;
                        
                        return matchesSearch && matchesType && matchesCity && matchesDate && matchesPrice && matchesArea;
                    });
                    
                    // æ’åºæ•°æ®
                    filteredProjects = sortProjects(filteredProjects, sortOrder);
                    
                    // æ›´æ–°æ–‡ä»¶åˆ—è¡¨
                    updateFileList(filteredProjects);
                    
                    // æ›´æ–°æœç´¢ç»“æœç»Ÿè®¡
                    searchResultCount.textContent = `å…± ${filteredProjects.length} ä¸ªä¼°ä»·é¡¹ç›®`;
                }
                
                // é¡¹ç›®æ’åºåŠŸèƒ½
                function sortProjects(projects, sortOrder) {
                    return [...projects].sort((a, b) => {
                        switch (sortOrder) {
                            case 'date-desc':
                                return new Date(b.date) - new Date(a.date);
                            case 'date-asc':
                                return new Date(a.date) - new Date(b.date);
                            case 'price-desc':
                                return b.price - a.price;
                            case 'price-asc':
                                return a.price - b.price;
                            case 'area-desc':
                                return b.areaSize - a.areaSize;
                            case 'area-asc':
                                return a.areaSize - b.areaSize;
                            default:
                                return new Date(b.date) - new Date(a.date);
                        }
                    });
                }
                
                // é‡ç½®ç­›é€‰æ¡ä»¶
                function resetFilters() {
                    searchInput.value = '';
                    filterType.value = '';
                    filterCity.value = '';
                    filterStartDate.value = '';
                    filterEndDate.value = '';
                    
                    // é‡ç½®é«˜çº§ç­›é€‰æ¡ä»¶
                    if (filterMinPrice) filterMinPrice.value = '';
                    if (filterMaxPrice) filterMaxPrice.value = '';
                    if (filterMinArea) filterMinArea.value = '';
                    if (filterMaxArea) filterMaxArea.value = '';
                    
                    // é‡ç½®æ’åº
                    if (sortSelect) sortSelect.value = 'date-desc';
                    
                    // é‡ç½®æœç´¢æ¸…é™¤æŒ‰é’®
                    const clearBtn = document.getElementById('search-clear-btn');
                    if (clearBtn) clearBtn.style.display = 'none';
                    
                    searchAndFilter();
                }
                
                // æ›´æ–°æ–‡ä»¶åˆ—è¡¨æ˜¾ç¤º
                function updateFileList(projects = valuationProjects) {
                    fileList.innerHTML = '';
                    projects.forEach((project, index) => {
                        const fileItem = document.createElement('div');
                        fileItem.className = 'file-item';
                        if (index === 0) {
                            fileItem.classList.add('active');
                        }
                        fileItem.innerHTML = `
                            <div style="font-weight: 500; margin-bottom: 4px;">${project.title}</div>
                            <div style="font-size: 12px; color: #999;">${project.date}</div>
                            <div style="font-size: 11px; color: #667eea; margin-top: 4px;">
                                ${project.type} | ${project.city} ${project.area}
                            </div>
                        `;
                        fileList.appendChild(fileItem);
                    });
                }
                
                // é‡ç½®ç­›é€‰æ¡ä»¶
                function resetFilters() {
                    searchInput.value = '';
                    filterType.value = '';
                    filterCity.value = '';
                    filterStartDate.value = '';
                    filterEndDate.value = '';
                    
                    searchAndFilter();
                }
                
                // åˆå§‹åŒ–æœç´¢å†å²åŠŸèƒ½
                const searchHistoryFunctions = initSearchHistory();
                
                // åˆå§‹åŒ–é«˜çº§ç­›é€‰é¢æ¿
                initAdvancedFilter();
                
                // æ·»åŠ æœç´¢äº‹ä»¶ç›‘å¬å™¨
                searchBtn.addEventListener('click', searchAndFilter);
                searchInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        searchAndFilter();
                    }
                });
                filterType.addEventListener('change', searchAndFilter);
                filterCity.addEventListener('change', searchAndFilter);
                filterStartDate.addEventListener('change', searchAndFilter);
                filterEndDate.addEventListener('change', searchAndFilter);
                resetFilterBtn.addEventListener('click', resetFilters);
                
                // æ·»åŠ é«˜çº§ç­›é€‰äº‹ä»¶ç›‘å¬å™¨
                if (filterMinPrice) filterMinPrice.addEventListener('change', searchAndFilter);
                if (filterMaxPrice) filterMaxPrice.addEventListener('change', searchAndFilter);
                if (filterMinArea) filterMinArea.addEventListener('change', searchAndFilter);
                if (filterMaxArea) filterMaxArea.addEventListener('change', searchAndFilter);
                if (sortSelect) sortSelect.addEventListener('change', searchAndFilter);
                
                // åˆå§‹åŒ–æ–‡ä»¶åˆ—è¡¨
                updateFileList();
            }
            
            // æ•°æ®å¯è§†åŒ–å›¾è¡¨åŠŸèƒ½
            function initDataVisualization() {
                // å›¾è¡¨é…ç½®é€‰é¡¹
                const chartOptions = {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                padding: 20,
                                font: {
                                    size: 14
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.label}: ${context.raw.toLocaleString()}`;
                                }
                            }
                        },
                        zoom: {
                            zoom: {
                                wheel: {
                                    enabled: true,
                                },
                                pinch: {
                                    enabled: true
                                },
                                mode: 'xy',
                            },
                            pan: {
                                enabled: true,
                                mode: 'xy',
                            }
                        },
                        download: {
                            filename: 'chart.png',
                            backgroundColor: '#ffffff'
                        }
                    },
                    animation: {
                        duration: 1500,
                        easing: 'easeInOutQuart'
                    },
                    interaction: {
                        mode: 'nearest',
                        axis: 'x',
                        intersect: false
                    }
                };
                
                // ç‰©ä¸šç±»å‹åˆ†å¸ƒé¥¼å›¾ï¼ˆä¼˜åŒ–ç‰ˆï¼‰
                const propertyTypeCtx = document.getElementById('propertyTypeChart');
                if (propertyTypeCtx) {
                    new Chart(propertyTypeCtx, {
                        type: 'doughnut',
                        data: {
                            labels: ['ä½å®…', 'å†™å­—æ¥¼', 'å•†é“º', 'åˆ«å¢…', 'å·¥ä¸šåœ°äº§'],
                            datasets: [{
                                data: [65, 15, 10, 7, 3],
                                backgroundColor: [
                                    '#667eea',
                                    '#764ba2',
                                    '#f093fb',
                                    '#4facfe',
                                    '#43e97b'
                                ],
                                borderWidth: 0,
                                hoverOffset: 15,
                                hoverBackgroundColor: [
                                    '#5568d3',
                                    '#6b46c1',
                                    '#e573fb',
                                    '#3a8ffe',
                                    '#38d9a9'
                                ]
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'right',
                                    labels: {
                                        padding: 20,
                                        font: {
                                            size: 14
                                        }
                                    }
                                },
                                tooltip: {
                                    callbacks: {
                                        label: function(context) {
                                            return `${context.label}: ${context.raw}%`;
                                        },
                                        afterLabel: function(context) {
                                            return 'ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…';
                                        }
                                    }
                                }
                            },
                            animation: {
                                animateRotate: true,
                                animateScale: true
                            }
                        }
                    });
                }
                
                // åŒºåŸŸå¹³å‡ä»·æ ¼å¯¹æ¯”æŸ±çŠ¶å›¾ï¼ˆä¼˜åŒ–ç‰ˆï¼‰
                const areaPriceCtx = document.getElementById('areaPriceChart');
                if (areaPriceCtx) {
                    new Chart(areaPriceCtx, {
                        type: 'bar',
                        data: {
                            labels: ['å¼€ç¦åŒº', 'å²³éº“åŒº', 'èŠ™è“‰åŒº', 'é›¨èŠ±åŒº', 'å¤©å¿ƒåŒº', 'æœ›åŸåŒº'],
                            datasets: [{
                                label: '2024å¹´',
                                data: [11800, 12500, 13200, 12100, 12800, 9500],
                                backgroundColor: 'rgba(102, 126, 234, 0.7)',
                                borderRadius: 6,
                                hoverBackgroundColor: '#5568d3'
                            }, {
                                label: '2025å¹´',
                                data: [12800, 13500, 14200, 13100, 13800, 10500],
                                backgroundColor: 'rgba(67, 233, 123, 0.7)',
                                borderRadius: 6,
                                hoverBackgroundColor: '#38d9a9'
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'top',
                                    labels: {
                                        padding: 20,
                                        font: {
                                            size: 14
                                        }
                                    }
                                },
                                tooltip: {
                                    callbacks: {
                                        label: function(context) {
                                            return `${context.dataset.label}: ${context.raw.toLocaleString()} å…ƒ/ã¡`;
                                        }
                                    }
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    ticks: {
                                        callback: function(value) {
                                            return value.toLocaleString();
                                        }
                                    }
                                }
                            },
                            animation: {
                                duration: 1500,
                                easing: 'easeInOutQuart'
                            }
                        }
                    });
                }
                
                // å†å²ä¼°ä»·è¶‹åŠ¿æŠ˜çº¿å›¾ï¼ˆä¼˜åŒ–ç‰ˆï¼‰
                const priceTrendCtx = document.getElementById('priceTrendChart');
                if (priceTrendCtx) {
                    new Chart(priceTrendCtx, {
                        type: 'line',
                        data: {
                            labels: ['2024-01', '2024-03', '2024-05', '2024-07', '2024-09', '2024-11', '2025-01', '2025-03', '2025-05', '2025-07', '2025-09', '2025-11'],
                            datasets: [{
                                label: 'ä½å®…',
                                data: [11200, 11500, 11800, 12000, 12300, 12500, 12600, 12700, 12900, 13100, 13300, 13500],
                                borderColor: '#667eea',
                                backgroundColor: 'rgba(102, 126, 234, 0.1)',
                                tension: 0.4,
                                fill: true,
                                borderWidth: 3,
                                pointRadius: 5,
                                pointHoverRadius: 8,
                                pointBackgroundColor: '#ffffff',
                                pointBorderColor: '#667eea',
                                pointBorderWidth: 2
                            }, {
                                label: 'å†™å­—æ¥¼',
                                data: [9800, 9900, 10100, 10300, 10500, 10700, 10900, 11100, 11300, 11500, 11700, 11900],
                                borderColor: '#764ba2',
                                backgroundColor: 'rgba(118, 75, 162, 0.1)',
                                tension: 0.4,
                                fill: true,
                                borderWidth: 3,
                                pointRadius: 5,
                                pointHoverRadius: 8,
                                pointBackgroundColor: '#ffffff',
                                pointBorderColor: '#764ba2',
                                pointBorderWidth: 2
                            }, {
                                label: 'å•†é“º',
                                data: [15200, 15500, 15800, 16100, 16400, 16700, 17000, 17300, 17600, 17900, 18200, 18500],
                                borderColor: '#f093fb',
                                backgroundColor: 'rgba(240, 147, 251, 0.1)',
                                tension: 0.4,
                                fill: true,
                                borderWidth: 3,
                                pointRadius: 5,
                                pointHoverRadius: 8,
                                pointBackgroundColor: '#ffffff',
                                pointBorderColor: '#f093fb',
                                pointBorderWidth: 2
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'top',
                                    labels: {
                                        padding: 20,
                                        font: {
                                            size: 14
                                        }
                                    }
                                },
                                tooltip: {
                                    mode: 'index',
                                    intersect: false,
                                    callbacks: {
                                        label: function(context) {
                                            return `${context.dataset.label}: ${context.raw.toLocaleString()} å…ƒ/ã¡`;
                                        }
                                    }
                                },
                                zoom: {
                                    zoom: {
                                        wheel: {
                                            enabled: true,
                                        },
                                        pinch: {
                                            enabled: true
                                        },
                                        mode: 'x',
                                    },
                                    pan: {
                                        enabled: true,
                                        mode: 'x',
                                    }
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: false,
                                    ticks: {
                                        callback: function(value) {
                                            return value.toLocaleString() + ' å…ƒ/ã¡';
                                        }
                                    }
                                }
                            }
                        }
                    });
                }
                
                // é¢ç§¯ä¸ä»·æ ¼å…³ç³»æ•£ç‚¹å›¾ï¼ˆä¼˜åŒ–ç‰ˆï¼‰
                const areaPriceScatterCtx = document.getElementById('areaPriceScatterChart');
                if (areaPriceScatterCtx) {
                    // ç”Ÿæˆåˆ†ç±»æ¨¡æ‹Ÿæ•°æ®
                    const scatterData = {
                        ä½å®…: [],
                        å†™å­—æ¥¼: [],
                        å•†é“º: []
                    };
                    
                    // ä¸åŒç‰©ä¸šç±»å‹çš„ä»·æ ¼åŒºé—´
                    const priceRanges = {
                        ä½å®…: { min: 12000, max: 15000 },
                        å†™å­—æ¥¼: { min: 10000, max: 13000 },
                        å•†é“º: { min: 18000, max: 25000 }
                    };
                    
                    // ç”Ÿæˆæ•°æ®
                    for (const type in scatterData) {
                        for (let i = 0; i < 30; i++) {
                            const area = Math.floor(Math.random() * 200) + 50; // 50-250ã¡
                            const pricePerSqm = priceRanges[type].min + Math.random() * (priceRanges[type].max - priceRanges[type].min);
                            const price = Math.round(pricePerSqm * area);
                            scatterData[type].push({
                                x: area,
                                y: price
                            });
                        }
                    }
                    
                    // ç‰©ä¸šç±»å‹é¢œè‰²æ˜ å°„
                    const typeColors = {
                        ä½å®…: {
                            bg: 'rgba(102, 126, 234, 0.6)',
                            border: '#667eea',
                            hoverBg: '#5568d3'
                        },
                        å†™å­—æ¥¼: {
                            bg: 'rgba(118, 75, 162, 0.6)',
                            border: '#764ba2',
                            hoverBg: '#6b46c1'
                        },
                        å•†é“º: {
                            bg: 'rgba(240, 147, 251, 0.6)',
                            border: '#f093fb',
                            hoverBg: '#e573fb'
                        }
                    };
                    
                    // åˆ›å»ºæ•°æ®é›†
                    const datasets = [];
                    for (const type in scatterData) {
                        datasets.push({
                            label: type,
                            data: scatterData[type],
                            backgroundColor: typeColors[type].bg,
                            borderColor: typeColors[type].border,
                            borderWidth: 1,
                            pointRadius: 6,
                            pointHoverRadius: 10,
                            pointHoverBackgroundColor: typeColors[type].hoverBg,
                            pointHoverBorderWidth: 3
                        });
                    }
                    
                    new Chart(areaPriceScatterCtx, {
                        type: 'scatter',
                        data: {
                            datasets: datasets
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    display: true,
                                    position: 'top',
                                    labels: {
                                        padding: 20,
                                        font: {
                                            size: 14
                                        }
                                    }
                                },
                                tooltip: {
                                    callbacks: {
                                        label: function(context) {
                                            const area = context.parsed.x;
                                            const price = context.parsed.y;
                                            const pricePerSquare = Math.round(price / area);
                                            return `${context.dataset.label}: é¢ç§¯ ${area}ã¡ | æ€»ä»· Â¥${price.toLocaleString()} | å•ä»· ${pricePerSquare.toLocaleString()}å…ƒ/ã¡`;
                                        }
                                    }
                                },
                                zoom: {
                                    zoom: {
                                        wheel: {
                                            enabled: true,
                                        },
                                        pinch: {
                                            enabled: true
                                        },
                                        mode: 'xy',
                                    },
                                    pan: {
                                        enabled: true,
                                        mode: 'xy',
                                    }
                                }
                            },
                            scales: {
                                x: {
                                    type: 'linear',
                                    position: 'bottom',
                                    title: {
                                        display: true,
                                        text: 'é¢ç§¯ (ã¡)',
                                        font: {
                                            size: 14,
                                            weight: 'bold'
                                        }
                                    },
                                    ticks: {
                                        font: {
                                            size: 12
                                        }
                                    }
                                },
                                y: {
                                    title: {
                                        display: true,
                                        text: 'æ€»ä»· (å…ƒ)',
                                        font: {
                                            size: 14,
                                            weight: 'bold'
                                        }
                                    },
                                    ticks: {
                                        callback: function(value) {
                                            return 'Â¥' + value.toLocaleString();
                                        },
                                        font: {
                                            size: 12
                                        }
                                    }
                                }
                            },
                            animation: {
                                duration: 2000,
                                easing: 'easeInOutQuart'
                            }
                        }
                    });
                }
                
                // ç‰©ä¸šç‰¹å¾æ¯”è¾ƒé›·è¾¾å›¾
                const propertyFeaturesCtx = document.getElementById('propertyFeaturesChart');
                if (propertyFeaturesCtx) {
                    new Chart(propertyFeaturesCtx, {
                        type: 'radar',
                        data: {
                            labels: ['äº¤é€šä¾¿åˆ©åº¦', 'æ•™è‚²èµ„æº', 'åŒ»ç–—è®¾æ–½', 'å•†ä¸šé…å¥—', 'ç¯å¢ƒè´¨é‡', 'å‡å€¼æ½œåŠ›'],
                            datasets: [{
                                label: 'ä½å®…',
                                data: [85, 90, 80, 75, 88, 92],
                                backgroundColor: 'rgba(102, 126, 234, 0.2)',
                                borderColor: '#667eea',
                                borderWidth: 3,
                                pointBackgroundColor: '#667eea',
                                pointBorderColor: '#fff',
                                pointHoverBackgroundColor: '#fff',
                                pointHoverBorderColor: '#667eea',
                                pointRadius: 6,
                                pointHoverRadius: 9
                            }, {
                                label: 'å†™å­—æ¥¼',
                                data: [95, 70, 75, 90, 65, 85],
                                backgroundColor: 'rgba(118, 75, 162, 0.2)',
                                borderColor: '#764ba2',
                                borderWidth: 3,
                                pointBackgroundColor: '#764ba2',
                                pointBorderColor: '#fff',
                                pointHoverBackgroundColor: '#fff',
                                pointHoverBorderColor: '#764ba2',
                                pointRadius: 6,
                                pointHoverRadius: 9
                            }, {
                                label: 'å•†é“º',
                                data: [90, 65, 80, 95, 70, 88],
                                backgroundColor: 'rgba(240, 147, 251, 0.2)',
                                borderColor: '#f093fb',
                                borderWidth: 3,
                                pointBackgroundColor: '#f093fb',
                                pointBorderColor: '#fff',
                                pointHoverBackgroundColor: '#fff',
                                pointHoverBorderColor: '#f093fb',
                                pointRadius: 6,
                                pointHoverRadius: 9
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'top',
                                    labels: {
                                        padding: 20,
                                        font: {
                                            size: 14
                                        }
                                    }
                                },
                                tooltip: {
                                    callbacks: {
                                        label: function(context) {
                                            return `${context.dataset.label}: ${context.raw} åˆ†`;
                                        }
                                    }
                                }
                            },
                            scales: {
                                r: {
                                    beginAtZero: true,
                                    max: 100,
                                    ticks: {
                                        stepSize: 20,
                                        font: {
                                            size: 12
                                        }
                                    },
                                    pointLabels: {
                                        font: {
                                            size: 13
                                        }
                                    }
                                }
                            },
                            animation: {
                                duration: 2000,
                                easing: 'easeInOutQuart'
                            }
                        }
                    });
                }
            }
            
            // åˆå§‹åŒ–æ•°æ®å¯è§†åŒ–å›¾è¡¨
            window.addEventListener('load', initDataVisualization);
            
            // åˆå§‹åŒ–ExcelåŠŸèƒ½
            initExcelFunctions();
            
            // æ‹–æ‹½ä¸Šä¼ åŠŸèƒ½
            function initDragDropUpload() {
                const dragDropArea = document.getElementById('drag-drop-area');
                const imageUploadInput = document.getElementById('image-upload-input');
                const imagePreviewContainer = document.getElementById('image-preview-container');
                
                // å›¾ç‰‡é¢„è§ˆæ•°æ®
                let uploadedImages = [];
                
                // æ‹–æ‹½äº‹ä»¶å¤„ç†
                dragDropArea.addEventListener('dragenter', function(e) {
                    e.preventDefault();
                    dragDropArea.style.backgroundColor = '#e6ebff';
                    dragDropArea.style.borderColor = '#5568d3';
                });
                
                dragDropArea.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    dragDropArea.style.backgroundColor = '#e6ebff';
                    dragDropArea.style.borderColor = '#5568d3';
                });
                
                dragDropArea.addEventListener('dragleave', function(e) {
                    if (!dragDropArea.contains(e.relatedTarget)) {
                        dragDropArea.style.backgroundColor = '#f8f9fa';
                        dragDropArea.style.borderColor = '#667eea';
                    }
                });
                
                dragDropArea.addEventListener('drop', function(e) {
                    e.preventDefault();
                    dragDropArea.style.backgroundColor = '#f8f9fa';
                    dragDropArea.style.borderColor = '#667eea';
                    
                    const files = e.dataTransfer.files;
                    handleFiles(files);
                });
                
                // ç‚¹å‡»ä¸Šä¼ 
                dragDropArea.addEventListener('click', function() {
                    imageUploadInput.click();
                });
                
                // æ–‡ä»¶é€‰æ‹©äº‹ä»¶
                imageUploadInput.addEventListener('change', function(e) {
                    const files = e.target.files;
                    handleFiles(files);
                });
                
                // å¤„ç†ä¸Šä¼ çš„æ–‡ä»¶
                function handleFiles(files) {
                    for (let i = 0; i < files.length; i++) {
                        const file = files[i];
                        
                        // éªŒè¯æ–‡ä»¶ç±»å‹
                        if (!file.type.startsWith('image/')) {
                            alert('è¯·ä¸Šä¼ å›¾ç‰‡æ–‡ä»¶ï¼');
                            continue;
                        }
                        
                        // éªŒè¯æ–‡ä»¶å¤§å°ï¼ˆ5MBï¼‰
                        if (file.size > 5 * 1024 * 1024) {
                            alert('å›¾ç‰‡å¤§å°ä¸èƒ½è¶…è¿‡ 5MBï¼');
                            continue;
                        }
                        
                        // è¯»å–æ–‡ä»¶å¹¶æ˜¾ç¤ºé¢„è§ˆ
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            const imageData = e.target.result;
                            uploadedImages.push({
                                id: Date.now() + Math.random(),
                                name: file.name,
                                size: file.size,
                                data: imageData
                            });
                            
                            // æ›´æ–°å›¾ç‰‡é¢„è§ˆ
                            updateImagePreview();
                        };
                        reader.readAsDataURL(file);
                    }
                }
                
                // æ›´æ–°å›¾ç‰‡é¢„è§ˆ
                function updateImagePreview() {
                    imagePreviewContainer.innerHTML = '';
                    
                    uploadedImages.forEach(image => {
                        const previewItem = document.createElement('div');
                        previewItem.style.cssText = `
                            position: relative;
                            border-radius: 4px;
                            overflow: hidden;
                            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                            transition: all 0.3s ease;
                        `;
                        
                        previewItem.innerHTML = `
                            <img src="${image.data}" style="
                                width: 100%;
                                height: 100px;
                                object-fit: cover;
                                display: block;
                            " alt="${image.name}">
                            <div style="
                                position: absolute;
                                top: 0;
                                right: 0;
                                background: rgba(0,0,0,0.5);
                                color: white;
                                padding: 4px 8px;
                                cursor: pointer;
                                font-size: 14px;
                                transition: all 0.3s ease;
                            " class="remove-image-btn" data-id="${image.id}">Ã—</div>
                            <div style="
                                position: absolute;
                                bottom: 0;
                                left: 0;
                                right: 0;
                                background: rgba(0,0,0,0.5);
                                color: white;
                                padding: 4px 8px;
                                font-size: 11px;
                                white-space: nowrap;
                                overflow: hidden;
                                text-overflow: ellipsis;
                            ">${image.name}</div>
                        `;
                        
                        // æ·»åŠ ç§»é™¤å›¾ç‰‡äº‹ä»¶
                        const removeBtn = previewItem.querySelector('.remove-image-btn');
                        removeBtn.addEventListener('click', function() {
                            const imageId = parseInt(this.dataset.id);
                            uploadedImages = uploadedImages.filter(img => img.id !== imageId);
                            updateImagePreview();
                        });
                        
                        imagePreviewContainer.appendChild(previewItem);
                    });
                }
                
                // åˆå§‹åŒ–æ‹–æ‹½ä¸Šä¼ åŠŸèƒ½
                console.log('æ‹–æ‹½ä¸Šä¼ åŠŸèƒ½å·²åˆå§‹åŒ–');
            }
            
            // åˆå§‹åŒ–ç¼–è¾‘åŒºæ ‡ç­¾é¡µåˆ‡æ¢åŠŸèƒ½
            function initEditorTabs() {
                const editorTabs = document.querySelectorAll('.editor-tabs .tab');
                const formSections = document.querySelectorAll('.valuation-form .form-section');
                const valuationPreview = document.querySelector('.valuation-preview');
                
                editorTabs.forEach(tab => {
                    tab.addEventListener('click', function() {
                        // ç§»é™¤æ‰€æœ‰æ ‡ç­¾é¡µçš„activeç±»
                        editorTabs.forEach(t => t.classList.remove('active'));
                        // æ·»åŠ activeç±»åˆ°å½“å‰ç‚¹å‡»çš„æ ‡ç­¾é¡µ
                        this.classList.add('active');
                        
                        // è·å–å½“å‰æ ‡ç­¾é¡µçš„æ–‡æœ¬å†…å®¹
                        const tabText = this.textContent.trim();
                        
                        // éšè—æ‰€æœ‰è¡¨å•sectionå’Œä¼°ä»·é¢„è§ˆ
                        formSections.forEach(section => {
                            section.style.display = 'none';
                        });
                        if (valuationPreview) {
                            valuationPreview.style.display = 'none';
                        }
                        
                        // æ ¹æ®æ ‡ç­¾é¡µæ˜¾ç¤ºå¯¹åº”çš„å†…å®¹
                        switch(tabText) {
                            case 'åŸºç¡€ä¿¡æ¯':
                                document.querySelector('.form-section:nth-of-type(1)').style.display = 'block';
                                break;
                            case 'è¯¦ç»†å‚æ•°':
                                document.querySelector('.form-section:nth-of-type(2)').style.display = 'block';
                                break;
                            case 'å‘¨è¾¹é…å¥—':
                                document.querySelector('.form-section:nth-of-type(3)').style.display = 'block';
                                break;
                            case 'ä¼°ä»·ç»“æœ':
                                if (valuationPreview) {
                                    valuationPreview.style.display = 'block';
                                }
                                break;
                            case 'æŠ¥å‘Šç”Ÿæˆ':
                                // å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ æŠ¥å‘Šç”Ÿæˆå†…å®¹
                                break;
                        }
                    });
                });
            }
            
            // å®æ—¶ä¼°ä»·è®¡ç®—åŠŸèƒ½
            function initRealTimeValuation() {
                const areaInput = document.getElementById('area');
                const citySelect = document.getElementById('city');
                const addressInput = document.getElementById('address');
                const yearBuiltInput = document.getElementById('year-built');
                
                const estimatedUnitPrice = document.querySelector('.result-card .result-row:nth-child(1) .result-value');
                const estimatedTotalPrice = document.querySelector('.result-card .result-row:nth-child(2) .result-value');
                const priceRange = document.querySelector('.result-card .result-row:nth-child(3) .result-value');
                
                // åŸå¸‚åŸºå‡†ä»·æ ¼æ•°æ®
                const cityBasePrices = {
                    'é•¿æ²™': 12800,
                    'åŒ—äº¬': 65000,
                    'ä¸Šæµ·': 68000,
                    'å¹¿å·': 45000,
                    'æ·±åœ³': 72000
                };
                
                // è®¡ç®—ä¼°ä»·å‡½æ•°
                // å¢å¼ºçš„ä¼°ä»·è®¡ç®—å‡½æ•°ï¼Œæ”¯æŒæ›´å¤šå‚æ•°
                function calculateValuation() {
                    const area = parseFloat(areaInput?.value) || 0;
                    const city = citySelect?.value || 'é•¿æ²™';
                    const yearBuilt = parseInt(yearBuiltInput?.value) || new Date().getFullYear();
                    const floor = floorInput?.value || '';
                    const orientation = orientationSelect?.value || 'å—åŒ—é€šé€';
                    
                    // åŸºç¡€å•ä»·
                    const basePrice = cityBasePrices[city] || 12800;
                    
                    // æ ¹æ®æˆ¿é¾„è°ƒæ•´ï¼ˆæ¯å¹´æŠ˜æ—§0.5%ï¼‰
                    const currentYear = new Date().getFullYear();
                    const age = Math.max(0, currentYear - yearBuilt);
                    const ageFactor = Math.max(0.7, 1 - (age * 0.005));
                    
                    // æ¥¼å±‚ç³»æ•°ï¼ˆæ ¹æ®æ¥¼å±‚è°ƒæ•´ï¼Œä¸­é—´æ¥¼å±‚æœ€ä¼˜ï¼‰
                    let floorFactor = 1.0;
                    if (floor) {
                        const floorParts = floor.split('/');
                        if (floorParts.length === 2) {
                            const currentFloor = parseInt(floorParts[0]);
                            const totalFloors = parseInt(floorParts[1]);
                            if (currentFloor > 0 && totalFloors > 0) {
                                const floorRatio = currentFloor / totalFloors;
                                if (floorRatio >= 0.3 && floorRatio <= 0.7) {
                                    floorFactor = 1.05; // ä¸­é—´æ¥¼å±‚åŠ ä»·5%
                                } else if (floorRatio < 0.1) {
                                    floorFactor = 0.95; // ä½å±‚å‡ä»·5%
                                } else if (floorRatio > 0.9) {
                                    floorFactor = 0.98; // é¡¶å±‚å‡ä»·2%
                                }
                            }
                        }
                    }
                    
                    // æœå‘ç³»æ•°
                    const orientationFactors = {
                        'å—åŒ—é€šé€': 1.05,
                        'æœå—': 1.02,
                        'æœåŒ—': 0.98,
                        'æœä¸œ': 1.0,
                        'æœè¥¿': 0.97
                    };
                    const orientationFactor = orientationFactors[orientation] || 1.0;
                    
                    // è®¡ç®—æœ€ç»ˆå•ä»·
                    const unitPrice = Math.round(basePrice * ageFactor * floorFactor * orientationFactor);
                    const totalPrice = Math.round(unitPrice * area);
                    
                    // æ›´æ–°ä¼°ä»·ç»“æœ
                    if (estimatedUnitPrice) {
                        estimatedUnitPrice.textContent = unitPrice.toLocaleString() + ' å…ƒ/ã¡';
                    }
                    if (estimatedTotalPrice) {
                        estimatedTotalPrice.textContent = 'Â¥ ' + totalPrice.toLocaleString();
                    }
                    if (priceRange) {
                        const lowerRange = Math.round(unitPrice * 0.97);
                        const upperRange = Math.round(unitPrice * 1.03);
                        priceRange.textContent = lowerRange.toLocaleString() + ' - ' + upperRange.toLocaleString() + ' å…ƒ/ã¡';
                    }
                    
                    // æ›´æ–°ä»·æ ¼æ„æˆåˆ†æ
                    updatePriceComposition(basePrice, ageFactor, floorFactor, orientationFactor);
                }
                
                // æ›´æ–°ä»·æ ¼æ„æˆåˆ†æ
                function updatePriceComposition(basePrice, ageFactor, floorFactor, orientationFactor) {
                    const compositionChart = document.getElementById('priceCompositionChart');
                    if (compositionChart) {
                        const ctx = compositionChart.getContext('2d');
                        
                        // é”€æ¯ç°æœ‰å›¾è¡¨
                        if (window.priceCompositionChartInstance) {
                            window.priceCompositionChartInstance.destroy();
                        }
                        
                        // åˆ›å»ºæ–°å›¾è¡¨
                        window.priceCompositionChartInstance = new Chart(ctx, {
                            type: 'bar',
                            data: {
                                labels: ['åŸºç¡€ä»·æ ¼', 'æˆ¿é¾„ç³»æ•°', 'æ¥¼å±‚ç³»æ•°', 'æœå‘ç³»æ•°'],
                                datasets: [{
                                    label: 'ä»·æ ¼æ„æˆ',
                                    data: [basePrice, ageFactor, floorFactor, orientationFactor],
                                    backgroundColor: [
                                        'rgba(102, 126, 234, 0.8)',
                                        'rgba(75, 192, 192, 0.8)',
                                        'rgba(255, 206, 86, 0.8)',
                                        'rgba(255, 99, 132, 0.8)'
                                    ],
                                    borderColor: [
                                        'rgba(102, 126, 234, 1)',
                                        'rgba(75, 192, 192, 1)',
                                        'rgba(255, 206, 86, 1)',
                                        'rgba(255, 99, 132, 1)'
                                    ],
                                    borderWidth: 1
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                scales: {
                                    y: {
                                        beginAtZero: true,
                                        title: {
                                            display: true,
                                            text: 'æ•°å€¼'
                                        }
                                    }
                                }
                            }
                        });
                    }
                }
                
                // æ·»åŠ è¾“å…¥äº‹ä»¶ç›‘å¬å™¨ï¼Œå®ç°å®æ—¶é¢„è§ˆ
                const inputs = [areaInput, yearBuiltInput, floorInput, addressInput];
                const selects = [citySelect, orientationSelect, typeSelect];
                
                inputs.forEach(input => {
                    if (input) {
                        input.addEventListener('input', calculateValuation);
                    }
                });
                
                selects.forEach(select => {
                    if (select) {
                        select.addEventListener('change', calculateValuation);
                    }
                });
                
                // åˆå§‹åŒ–æ–¹æ¡ˆç®¡ç†
                let savedSchemes = JSON.parse(localStorage.getItem('valuationSchemes')) || [];
                
                // ä¿å­˜æ–¹æ¡ˆ
                function saveScheme() {
                    const schemeName = prompt('è¯·è¾“å…¥æ–¹æ¡ˆåç§°ï¼š');
                    if (!schemeName) return;
                    
                    const scheme = {
                        id: Date.now(),
                        name: schemeName,
                        timestamp: new Date().toISOString(),
                        estimatedUnitPrice: estimatedUnitPrice?.textContent || '',
                        estimatedTotalPrice: estimatedTotalPrice?.textContent || '',
                        priceRange: priceRange?.textContent || '',
                        parameters: {
                            area: areaInput?.value || '',
                            city: citySelect?.value || '',
                            yearBuilt: yearBuiltInput?.value || '',
                            floor: floorInput?.value || '',
                            orientation: orientationSelect?.value || '',
                            type: typeSelect?.value || '',
                            address: addressInput?.value || ''
                        }
                    };
                    
                    savedSchemes.push(scheme);
                    localStorage.setItem('valuationSchemes', JSON.stringify(savedSchemes));
                    
                    // æ›´æ–°æ–¹æ¡ˆé€‰æ‹©ä¸‹æ‹‰æ¡†
                    updateSchemeSelect();
                    
                    // æ˜¾ç¤ºæˆåŠŸæç¤º
                    showToast('æ–¹æ¡ˆä¿å­˜æˆåŠŸï¼', 'success');
                }
                
                // æ›´æ–°æ–¹æ¡ˆé€‰æ‹©ä¸‹æ‹‰æ¡†
                function updateSchemeSelect() {
                    const schemeSelect = document.getElementById('scheme-select');
                    if (!schemeSelect) return;
                    
                    // æ¸…ç©ºç°æœ‰é€‰é¡¹ï¼ˆä¿ç•™å½“å‰æ–¹æ¡ˆï¼‰
                    const currentOption = schemeSelect.querySelector('[value="current"]');
                    schemeSelect.innerHTML = '';
                    schemeSelect.appendChild(currentOption);
                    
                    // æ·»åŠ ä¿å­˜çš„æ–¹æ¡ˆ
                    savedSchemes.forEach(scheme => {
                        const option = document.createElement('option');
                        option.value = scheme.id;
                        option.textContent = `${scheme.name} (${new Date(scheme.timestamp).toLocaleString()})`;
                        schemeSelect.appendChild(option);
                    });
                }
                
                // åŠ è½½æ–¹æ¡ˆ
                function loadScheme(schemeId) {
                    const scheme = savedSchemes.find(s => s.id === parseInt(schemeId));
                    if (!scheme) return;
                    
                    // åŠ è½½å‚æ•°
                    if (areaInput) areaInput.value = scheme.parameters.area;
                    if (citySelect) citySelect.value = scheme.parameters.city;
                    if (yearBuiltInput) yearBuiltInput.value = scheme.parameters.yearBuilt;
                    if (floorInput) floorInput.value = scheme.parameters.floor;
                    if (orientationSelect) orientationSelect.value = scheme.parameters.orientation;
                    if (typeSelect) typeSelect.value = scheme.parameters.type;
                    if (addressInput) addressInput.value = scheme.parameters.address;
                    
                    // é‡æ–°è®¡ç®—ä¼°ä»·
                    calculateValuation();
                    
                    // æ˜¾ç¤ºæˆåŠŸæç¤º
                    showToast(`æ–¹æ¡ˆ "${scheme.name}" å·²åŠ è½½ï¼`, 'success');
                }
                
                // å¯¹æ¯”æ–¹æ¡ˆ
                function compareSchemes() {
                    const compareView = document.getElementById('scheme-compare-view');
                    const compareResults = document.getElementById('compare-results');
                    
                    if (!compareView || !compareResults) return;
                    
                    // æ˜¾ç¤ºå¯¹æ¯”è§†å›¾
                    compareView.style.display = 'block';
                    
                    // æ¸…ç©ºç°æœ‰å¯¹æ¯”ç»“æœ
                    compareResults.innerHTML = '';
                    
                    // æ·»åŠ å½“å‰æ–¹æ¡ˆ
                    const currentSchemeCard = createSchemeCard({
                        name: 'å½“å‰æ–¹æ¡ˆ',
                        estimatedUnitPrice: estimatedUnitPrice?.textContent || '',
                        estimatedTotalPrice: estimatedTotalPrice?.textContent || '',
                        priceRange: priceRange?.textContent || '',
                        timestamp: new Date().toISOString(),
                        isCurrent: true
                    });
                    compareResults.appendChild(currentSchemeCard);
                    
                    // æ·»åŠ ä¿å­˜çš„æ–¹æ¡ˆ
                    savedSchemes.forEach(scheme => {
                        const schemeCard = createSchemeCard(scheme);
                        compareResults.appendChild(schemeCard);
                    });
                    
                    // æ›´æ–°å¯¹æ¯”å›¾è¡¨
                    updateCompareChart();
                }
                
                // åˆ›å»ºæ–¹æ¡ˆå¡ç‰‡
                function createSchemeCard(scheme) {
                    const card = document.createElement('div');
                    card.className = 'result-card';
                    card.style.backgroundColor = scheme.isCurrent ? '#e6f7ff' : '#fff';
                    
                    card.innerHTML = `
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                            <h4 style="margin: 0; font-size: 14px; color: ${scheme.isCurrent ? '#1890ff' : '#333'};">${scheme.name}</h4>
                            <span style="font-size: 12px; color: #999;">${new Date(scheme.timestamp).toLocaleString()}</span>
                        </div>
                        <div class="result-row">
                            <div class="result-label">é¢„ä¼°å•ä»·</div>
                            <div class="result-value">${scheme.estimatedUnitPrice}</div>
                        </div>
                        <div class="result-row">
                            <div class="result-label">é¢„ä¼°æ€»ä»·</div>
                            <div class="result-value">${scheme.estimatedTotalPrice}</div>
                        </div>
                        <div class="result-row">
                            <div class="result-label">ä»·æ ¼åŒºé—´</div>
                            <div class="result-value">${scheme.priceRange}</div>
                        </div>
                    `;
                    
                    return card;
                }
                
                // æ›´æ–°å¯¹æ¯”å›¾è¡¨
                function updateCompareChart() {
                    const compareChart = document.getElementById('compareChart');
                    if (!compareChart) return;
                    
                    const ctx = compareChart.getContext('2d');
                    
                    // é”€æ¯ç°æœ‰å›¾è¡¨
                    if (window.compareChartInstance) {
                        window.compareChartInstance.destroy();
                    }
                    
                    // å‡†å¤‡æ•°æ®
                    const schemeNames = ['å½“å‰æ–¹æ¡ˆ', ...savedSchemes.map(s => s.name)];
                    const unitPrices = [
                        parseInt(estimatedUnitPrice?.textContent.replace(/[^0-9]/g, '')) || 0,
                        ...savedSchemes.map(s => parseInt(s.estimatedUnitPrice.replace(/[^0-9]/g, '')) || 0)
                    ];
                    
                    // åˆ›å»ºæ–°å›¾è¡¨
                    window.compareChartInstance = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: schemeNames,
                            datasets: [{
                                label: 'é¢„ä¼°å•ä»· (å…ƒ/ã¡)',
                                data: unitPrices,
                                backgroundColor: 'rgba(102, 126, 234, 0.8)',
                                borderColor: 'rgba(102, 126, 234, 1)',
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    title: {
                                        display: true,
                                        text: 'é¢„ä¼°å•ä»· (å…ƒ/ã¡)'
                                    }
                                }
                            }
                        }
                    });
                }
                
                // ç»‘å®šæ–¹æ¡ˆç®¡ç†æŒ‰é’®äº‹ä»¶
                document.getElementById('save-scheme-btn')?.addEventListener('click', saveScheme);
                document.getElementById('compare-schemes-btn')?.addEventListener('click', compareSchemes);
                
                document.getElementById('scheme-select')?.addEventListener('change', function(e) {
                    if (e.target.value !== 'current') {
                        loadScheme(e.target.value);
                    }
                });
                
                // åˆå§‹åŒ–æ–¹æ¡ˆé€‰æ‹©
                updateSchemeSelect();
                
                // åˆå§‹åŒ–æ—¶è®¡ç®—ä¸€æ¬¡
                calculateValuation();
            }
            
            // åˆå§‹åŒ–ç¼–è¾‘åŒºæ ‡ç­¾é¡µ
            initEditorTabs();
            
            // åˆå§‹åŒ–å¯Œæ–‡æœ¬ç¼–è¾‘å™¨åŠŸèƒ½
            function initRichTextEditor() {
                // åˆå§‹åŒ–TinyMCEç¼–è¾‘å™¨
                tinymce.init({
                    selector: '#valuation-description',
                    height: 400,
                    width: '100%',
                    plugins: [
                        'advlist', 'autolink', 'lists', 'link', 'image', 'charmap', 'preview',
                        'anchor', 'searchreplace', 'visualblocks', 'code', 'fullscreen',
                        'insertdatetime', 'media', 'table', 'code', 'help', 'wordcount',
                        'emoticons', 'pagebreak', 'hr', 'toc', 'quickbars', 'nonbreaking',
                        'directionality', 'visualchars', 'importcss', 'textpattern', 'template',
                        'codesample', 'help', 'statusbar', 'charmap'
                    ],
                    toolbar: 'undo redo | styles | bold italic underline strikethrough | forecolor backcolor | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image media | table codesample | fullscreen preview code | pagebreak hr | emoticons charmap | insert tools | help',
                    toolbar_mode: 'wrap',
                    styles_formats: [
                        { title: 'Heading 1', format: 'h1' },
                        { title: 'Heading 2', format: 'h2' },
                        { title: 'Heading 3', format: 'h3' },
                        { title: 'Paragraph', format: 'p' },
                        { title: 'Quote', format: 'blockquote' },
                        { title: 'Code', format: 'code' },
                        { title: 'Valuation Section', inline: 'span', styles: { 'background-color': '#e6ebff', 'padding': '2px 6px', 'border-radius': '3px' } },
                        { title: 'Important', inline: 'span', styles: { 'font-weight': 'bold', 'color': '#f5222d' } }
                    ],
                    content_style: `
                        body { 
                            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
                            font-size: 14px;
                            line-height: 1.6;
                            color: #333;
                            max-width: 100%;
                        }
                        h1 { color: #667eea; margin: 16px 0 12px 0; font-size: 24px; }
                        h2 { color: #764ba2; margin: 14px 0 10px 0; font-size: 20px; }
                        h3 { color: #f093fb; margin: 12px 0 8px 0; font-size: 18px; }
                        table { border-collapse: collapse; width: 100%; margin: 16px 0; }
                        table, th, td { border: 1px solid #e0e0e0; padding: 8px; }
                        th { background-color: #f8f9fa; font-weight: bold; }
                        blockquote { border-left: 4px solid #667eea; margin: 16px 0; padding: 10px 16px; background-color: #f0f4ff; }
                        code { background-color: #f6f8fa; padding: 2px 6px; border-radius: 3px; font-family: 'Courier New', monospace; }
                        pre { background-color: #f6f8fa; padding: 16px; border-radius: 8px; overflow-x: auto; }
                        .valuation-section { background-color: #e6ebff; padding: 2px 6px; border-radius: 3px; }
                        .important { font-weight: bold; color: #f5222d; }
                    `,
                    setup: function(editor) {
                        // æ’å…¥å›¾è¡¨æŒ‰é’®
                        editor.ui.registry.addButton('insertchart', {
                            text: 'ğŸ“Š æ’å…¥å›¾è¡¨',
                            icon: 'chart-line',
                            onAction: function() {
                                editor.insertContent('<div class="chart-placeholder" style="border: 2px dashed #667eea; padding: 20px; border-radius: 8px; text-align: center; background-color: #f0f4ff;"><strong>ğŸ“Š å›¾è¡¨å ä½ç¬¦</strong><p style="margin: 8px 0 0 0; color: #667eea; font-size: 12px;">ç‚¹å‡»æ­¤å¤„ç¼–è¾‘æˆ–æ›¿æ¢ä¸ºå®é™…å›¾è¡¨</p></div><p></p>');
                            }
                        });
                        
                        // æ’å…¥è¡¨æ ¼æ¨¡æ¿æŒ‰é’®
                        editor.ui.registry.addButton('inserttabletemplate', {
                            text: 'ğŸ“‹ æ’å…¥ä¼°ä»·è¡¨æ ¼',
                            icon: 'table',
                            onAction: function() {
                                const tableContent = `
                                    <table>
                                        <thead>
                                            <tr>
                                                <th>é¡¹ç›®</th>
                                                <th>æ•°å€¼</th>
                                                <th>è¯´æ˜</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>é¢„ä¼°å•ä»·</td>
                                                <td></td>
                                                <td></td>
                                            </tr>
                                            <tr>
                                                <td>é¢„ä¼°æ€»ä»·</td>
                                                <td></td>
                                                <td></td>
                                            </tr>
                                            <tr>
                                                <td>å¸‚åœºå‚è€ƒä»·åŒºé—´</td>
                                                <td></td>
                                                <td></td>
                                            </tr>
                                            <tr>
                                                <td>æŠ˜æ—§ç‡</td>
                                                <td></td>
                                                <td></td>
                                            </tr>
                                            <tr>
                                                <td>åœ°æ®µç³»æ•°</td>
                                                <td></td>
                                                <td></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                    <p></p>
                                `;
                                editor.insertContent(tableContent);
                            }
                        });
                        
                        // æ’å…¥ä¼°ä»·æ‘˜è¦æŒ‰é’®
                        editor.ui.registry.addButton('insertsummary', {
                            text: 'ğŸ“ æ’å…¥ä¼°ä»·æ‘˜è¦',
                            icon: 'document',
                            onAction: function() {
                                const summaryContent = `
                                    <div style="background-color: #f0f4ff; padding: 20px; border-radius: 8px; margin: 16px 0;">
                                        <h3 style="margin-top: 0; color: #667eea;">ä¼°ä»·æ‘˜è¦</h3>
                                        <p><strong>é¡¹ç›®åç§°ï¼š</strong></p>
                                        <p><strong>ä¼°ä»·æ—¥æœŸï¼š</strong>${new Date().toLocaleDateString()}</p>
                                        <p><strong>ä¼°ä»·ç»“æœï¼š</strong></p>
                                        <p><strong>ä¼°ä»·æ–¹æ³•ï¼š</strong></p>
                                        <p><strong>å¸‚åœºå‚è€ƒï¼š</strong></p>
                                    </div>
                                    <p></p>
                                `;
                                editor.insertContent(summaryContent);
                            }
                        });
                        
                        // æ’å…¥å…¬å¼æŒ‰é’®
                        editor.ui.registry.addButton('insertformula', {
                            text: 'ğŸ§® æ’å…¥å…¬å¼',
                            icon: 'calculator',
                            onAction: function() {
                                editor.insertContent('<div class="formula-placeholder" style="border: 1px solid #e0e0e0; padding: 10px; border-radius: 6px; font-family: \"Courier New\", monospace; background-color: #fafafa;">å…¬å¼ï¼š[å•ä»· = åŸºå‡†ä»· Ã— (1 - æŠ˜æ—§ç‡) Ã— åœ°æ®µç³»æ•° Ã— è£…ä¿®ç³»æ•° Ã— é…å¥—è®¾æ–½ç³»æ•° Ã— æ¥¼å±‚ç³»æ•° Ã— æœå‘ç³»æ•°]</div><p></p>');
                            }
                        });
                        
                        // æ’å…¥ä¸“ä¸šæœ¯è¯­è§£é‡ŠæŒ‰é’®
                        editor.ui.registry.addButton('insertterm', {
                            text: 'ğŸ“– æ’å…¥æœ¯è¯­',
                            icon: 'dictionary',
                            onAction: function() {
                                editor.insertContent('<span class="term" style="border-bottom: 1px dashed #667eea; cursor: help;" title="ç‚¹å‡»æ·»åŠ æœ¯è¯­è§£é‡Š">ä¸“ä¸šæœ¯è¯­</span>');
                            }
                        });
                        
                        // è‡ªå®šä¹‰å·¥å…·ç»„
                        editor.ui.registry.addGroup('insert', {
                            icon: 'plus',
                            tooltip: 'æ’å…¥å·¥å…·',
                            buttons: ['insertchart', 'inserttabletemplate', 'insertsummary', 'insertformula', 'insertterm']
                        });
                        
                        // æ·»åŠ çŠ¶æ€ä¿¡æ¯
                        editor.on('init', function() {
                            editor.statusBar.hide();
                        });
                        
                        // è‡ªåŠ¨ä¿å­˜åŠŸèƒ½
                        let autoSaveTimer;
                        editor.on('change', function() {
                            clearTimeout(autoSaveTimer);
                            autoSaveTimer = setTimeout(function() {
                                // å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ è‡ªåŠ¨ä¿å­˜é€»è¾‘ï¼Œä¾‹å¦‚ä¿å­˜åˆ°localStorage
                                console.log('ç¼–è¾‘å™¨å†…å®¹å·²è‡ªåŠ¨ä¿å­˜');
                            }, 3000);
                        });
                        
                        // æ’å…¥æ¨¡æ¿
                        editor.ui.registry.addButton('inserttemplate', {
                            text: 'ğŸ“‹ æ’å…¥æ¨¡æ¿',
                            icon: 'template',
                            onAction: function() {
                                const templateContent = `
                                    <h1>AIæ™ºèƒ½ä¼°ä»·æŠ¥å‘Š</h1>
                                    <h2>1. é¡¹ç›®æ¦‚å†µ</h2>
                                    <p></p>
                                    <h2>2. ä¼°ä»·æ–¹æ³•</h2>
                                    <p></p>
                                    <h2>3. ä¼°ä»·ç»“æœ</h2>
                                    <table>
                                        <tr>
                                            <th>é¡¹ç›®</th>
                                            <th>æ•°å€¼</th>
                                        </tr>
                                        <tr>
                                            <td>é¢„ä¼°å•ä»·</td>
                                            <td></td>
                                        </tr>
                                        <tr>
                                            <td>é¢„ä¼°æ€»ä»·</td>
                                            <td></td>
                                        </tr>
                                        <tr>
                                            <td>å¸‚åœºå‚è€ƒä»·åŒºé—´</td>
                                            <td></td>
                                        </tr>
                                    </table>
                                    <h2>4. å¸‚åœºåˆ†æ</h2>
                                    <p></p>
                                    <h2>5. ä¼°ä»·è¯´æ˜</h2>
                                    <p></p>
                                    <h2>6. é£é™©æç¤º</h2>
                                    <p></p>
                                    <p><strong>æŠ¥å‘Šæ—¥æœŸï¼š</strong>${new Date().toLocaleDateString()}</p>
                                    <p><strong>æŠ¥å‘Šç¼–å·ï¼š</strong>AI-${Date.now().toString().slice(-8)}</p>
                                `;
                                editor.insertContent(templateContent);
                            }
                        });
                        
                        // æ’å…¥å¸‚åœºåˆ†ææ¨¡æ¿
                        editor.ui.registry.addButton('insertmarketanalysis', {
                            text: 'ğŸ“Š æ’å…¥å¸‚åœºåˆ†æ',
                            icon: 'pie-chart',
                            onAction: function() {
                                const marketAnalysisContent = `
                                    <div style="background-color: #f0f4ff; padding: 20px; border-radius: 8px; margin: 16px 0;">
                                        <h3 style="margin-top: 0; color: #667eea;">å¸‚åœºåˆ†æ</h3>
                                        <h4>1. åŒºåŸŸå¸‚åœºæ¦‚å†µ</h4>
                                        <p></p>
                                        <h4>2. åŒç±»ç‰©ä¸šå¯¹æ¯”</h4>
                                        <table>
                                            <thead>
                                                <tr>
                                                    <th>é¡¹ç›®åç§°</th>
                                                    <th>é¢ç§¯(ã¡)</th>
                                                    <th>å•ä»·(å…ƒ/ã¡)</th>
                                                    <th>æ€»ä»·(ä¸‡å…ƒ)</th>
                                                    <th>æˆäº¤æ—¥æœŸ</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                </tr>
                                                <tr>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                </tr>
                                                <tr>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                        <h4>3. å¸‚åœºè¶‹åŠ¿é¢„æµ‹</h4>
                                        <p></p>
                                    </div>
                                    <p></p>
                                `;
                                editor.insertContent(marketAnalysisContent);
                            }
                        });
                        
                        // æ’å…¥é£é™©è¯„ä¼°æ¨¡æ¿
                        editor.ui.registry.addButton('insertriskassessment', {
                            text: 'âš ï¸ æ’å…¥é£é™©è¯„ä¼°',
                            icon: 'alert-circle',
                            onAction: function() {
                                const riskAssessmentContent = `
                                    <div style="background-color: #fff7e6; padding: 20px; border-radius: 8px; margin: 16px 0; border-left: 4px solid #faad14;">
                                        <h3 style="margin-top: 0; color: #faad14;">é£é™©è¯„ä¼°</h3>
                                        <table>
                                            <thead>
                                                <tr>
                                                    <th>é£é™©ç±»å‹</th>
                                                    <th>é£é™©ç­‰çº§</th>
                                                    <th>é£é™©æè¿°</th>
                                                    <th>åº”å¯¹å»ºè®®</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>å¸‚åœºé£é™©</td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                </tr>
                                                <tr>
                                                    <td>æ”¿ç­–é£é™©</td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                </tr>
                                                <tr>
                                                    <td>æµåŠ¨æ€§é£é™©</td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                </tr>
                                                <tr>
                                                    <td>æ“ä½œé£é™©</td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <p></p>
                                `;
                                editor.insertContent(riskAssessmentContent);
                            }
                        });
                        
                        // æ’å…¥æŠ•èµ„å»ºè®®æ¨¡æ¿
                        editor.ui.registry.addButton('insertinvestmentadvice', {
                            text: 'ğŸ’¡ æ’å…¥æŠ•èµ„å»ºè®®',
                            icon: 'lightbulb',
                            onAction: function() {
                                const investmentAdviceContent = `
                                    <div style="background-color: #f6ffed; padding: 20px; border-radius: 8px; margin: 16px 0; border-left: 4px solid #52c41a;">
                                        <h3 style="margin-top: 0; color: #52c41a;">æŠ•èµ„å»ºè®®</h3>
                                        <h4>1. æŠ•èµ„ä»·å€¼åˆ†æ</h4>
                                        <p></p>
                                        <h4>2. æŠ•èµ„ç­–ç•¥å»ºè®®</h4>
                                        <ul>
                                            <li></li>
                                            <li></li>
                                            <li></li>
                                        </ul>
                                        <h4>3. æŒæœ‰æœŸå»ºè®®</h4>
                                        <p></p>
                                        <h4>4. å˜ç°ç­–ç•¥</h4>
                                        <p></p>
                                    </div>
                                    <p></p>
                                `;
                                editor.insertContent(investmentAdviceContent);
                            }
                        });
                        
                        // æ’å…¥SWOTåˆ†ææ¨¡æ¿
                        editor.ui.registry.addButton('insertswot', {
                            text: 'ğŸ“‹ æ’å…¥SWOTåˆ†æ',
                            icon: 'grid',
                            onAction: function() {
                                const swotContent = `
                                    <div style="padding: 20px; border-radius: 8px; margin: 16px 0;">
                                        <h3 style="margin-top: 0; color: #667eea;">SWOTåˆ†æ</h3>
                                        <table style="width: 100%;">
                                            <tr>
                                                <th style="background-color: #e6f7ff; width: 50%;">ä¼˜åŠ¿ (Strengths)</th>
                                                <th style="background-color: #fff2e8; width: 50%;">åŠ£åŠ¿ (Weaknesses)</th>
                                            </tr>
                                            <tr>
                                                <td style="vertical-align: top;"></td>
                                                <td style="vertical-align: top;"></td>
                                            </tr>
                                            <tr>
                                                <th style="background-color: #f6ffed; width: 50%;">æœºä¼š (Opportunities)</th>
                                                <th style="background-color: #fff1f0; width: 50%;">å¨èƒ (Threats)</th>
                                            </tr>
                                            <tr>
                                                <td style="vertical-align: top;"></td>
                                                <td style="vertical-align: top;"></td>
                                            </tr>
                                        </table>
                                    </div>
                                    <p></p>
                                `;
                                editor.insertContent(swotContent);
                            }
                        });
                        
                        // æ›´æ–°è‡ªå®šä¹‰å·¥å…·ç»„ï¼Œæ·»åŠ æ–°æŒ‰é’®
                        editor.ui.registry.addGroup('insert', {
                            icon: 'plus',
                            tooltip: 'æ’å…¥å·¥å…·',
                            buttons: ['insertchart', 'inserttabletemplate', 'insertsummary', 'insertformula', 'insertterm', 'inserttemplate', 'insertmarketanalysis', 'insertriskassessment', 'insertinvestmentadvice', 'insertswot']
                        });
                        
                        // æ·»åŠ å¿«æ·é”®æ”¯æŒ
                        editor.addShortcut('Ctrl+Shift+C', 'æ’å…¥å›¾è¡¨', function() {
                            editor.execCommand('mceInsertContent', false, '<div class="chart-placeholder" style="border: 2px dashed #667eea; padding: 20px; border-radius: 8px; text-align: center; background-color: #f0f4ff;"><strong>ğŸ“Š å›¾è¡¨å ä½ç¬¦</strong><p style="margin: 8px 0 0 0; color: #667eea; font-size: 12px;">ç‚¹å‡»æ­¤å¤„ç¼–è¾‘æˆ–æ›¿æ¢ä¸ºå®é™…å›¾è¡¨</p></div><p></p>');
                        });
                        
                        editor.addShortcut('Ctrl+Shift+T', 'æ’å…¥ä¼°ä»·è¡¨æ ¼', function() {
                            const tableContent = `
                                <table>
                                    <thead>
                                        <tr>
                                            <th>é¡¹ç›®</th>
                                            <th>æ•°å€¼</th>
                                            <th>è¯´æ˜</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>é¢„ä¼°å•ä»·</td>
                                            <td></td>
                                            <td></td>
                                        </tr>
                                        <tr>
                                            <td>é¢„ä¼°æ€»ä»·</td>
                                            <td></td>
                                            <td></td>
                                        </tr>
                                        <tr>
                                            <td>å¸‚åœºå‚è€ƒä»·åŒºé—´</td>
                                            <td></td>
                                            <td></td>
                                        </tr>
                                        <tr>
                                            <td>æŠ˜æ—§ç‡</td>
                                            <td></td>
                                            <td></td>
                                        </tr>
                                        <tr>
                                            <td>åœ°æ®µç³»æ•°</td>
                                            <td></td>
                                            <td></td>
                                        </tr>
                                    </tbody>
                                </table>
                                <p></p>
                            `;
                            editor.insertContent(tableContent);
                        });
                        
                        editor.addShortcut('Ctrl+Shift+S', 'æ’å…¥ä¼°ä»·æ‘˜è¦', function() {
                            const summaryContent = `
                                <div style="background-color: #f0f4ff; padding: 20px; border-radius: 8px; margin: 16px 0;">
                                    <h3 style="margin-top: 0; color: #667eea;">ä¼°ä»·æ‘˜è¦</h3>
                                    <p><strong>é¡¹ç›®åç§°ï¼š</strong></p>
                                    <p><strong>ä¼°ä»·æ—¥æœŸï¼š</strong>${new Date().toLocaleDateString()}</p>
                                    <p><strong>ä¼°ä»·ç»“æœï¼š</strong></p>
                                    <p><strong>ä¼°ä»·æ–¹æ³•ï¼š</strong></p>
                                    <p><strong>å¸‚åœºå‚è€ƒï¼š</strong></p>
                                </div>
                                <p></p>
                            `;
                            editor.insertContent(summaryContent);
                        });
                        
                        // æ³¨å†Œæ’å…¥å·¥å…·ç»„
                        editor.ui.registry.addGroup('tools', {
                            icon: 'tools',
                            tooltip: 'å·¥å…·',
                            buttons: ['inserttemplate', 'toc', 'pagebreak', 'hr', 'charmap']
                        });
                    },
                    menubar: 'file edit view insert format tools table help',
                    menu: {
                        file: { title: 'File', items: 'newdocument restoredraft | preview | export print | deleteallconversations' },
                        edit: { title: 'Edit', items: 'undo redo | cut copy paste pastetext | selectall | searchreplace' },
                        view: { title: 'View', items: 'code | visualaid visualchars visualblocks | spellchecker | preview fullscreen' },
                        insert: { title: 'Insert', items: 'image media template codesample inserttable | charmap emoticons hr | pagebreak nonbreaking anchor | toc | insertdatetime' },
                        format: { title: 'Format', items: 'bold italic underline strikethrough superscript subscript codeformat | styles blocks fontfamily fontsize align | forecolor backcolor | removeformat' },
                        tools: { title: 'Tools', items: 'spellchecker spellcheckerlanguage | a11ycheck code wordcount' },
                        table: { title: 'Table', items: 'inserttable | cell row column | tableprops deletetable' }
                    },
                    language: 'zh_CN',
                    browser_spellcheck: true,
                    contextmenu: 'link image table codesample insertchart',
                    quickbars_selection_toolbar: 'bold italic | quicklink h2 h3 blockquote code',
                    quickbars_insert_toolbar: 'quickimage quicktable quicklink',
                    autosave_ask_before_unload: true,
                    autosave_interval: '30s',
                    autosave_prefix: 'valuation-report-{path}{query}-{id}-',
                    autosave_restore_when_empty: false,
                    autosave_retention: '2m',
                    content_css: [
                        '//fonts.googleapis.com/css?family=Lato:300,300i,400,400i',
                        '//www.tiny.cloud/css/codepen.min.css'
                    ],
                    importcss_append: true,
                    skin: 'oxide',
                    content_css: 'default',
                    noneditable_noneditable_class: 'noneditable',
                    toolbar_location: 'top',
                    statusbar_location: 'bottom',
                    resize: 'both',
                    min_height: 300,
                    max_height: 800
                });
            }
            
            // åˆå§‹åŒ–å®æ—¶ä¼°ä»·è®¡ç®—
            initRealTimeValuation();
            
            // åˆå§‹åŒ–å‚æ•°åŒ–é…ç½®å’Œæ¨¡æ¿åŠŸèƒ½
            function initParamConfig() {
                // ä»localStorageåŠ è½½ä¿å­˜çš„æ¨¡æ¿
                function loadTemplates() {
                    const templates = JSON.parse(localStorage.getItem('valuationTemplates')) || [];
                    const templateSelect = document.getElementById('template-select');
                    
                    // æ¸…ç©ºç°æœ‰é€‰é¡¹ï¼ˆä¿ç•™é»˜è®¤é€‰é¡¹ï¼‰
                    templateSelect.innerHTML = '<option value="">é€‰æ‹©æ¨¡æ¿</option><option value="default">é»˜è®¤æ¨¡æ¿</option>';
                    
                    // æ·»åŠ ä¿å­˜çš„æ¨¡æ¿
                    templates.forEach(template => {
                        const option = document.createElement('option');
                        option.value = template.id;
                        option.textContent = template.name;
                        templateSelect.appendChild(option);
                    });
                }
                
                // ä¿å­˜å½“å‰å‚æ•°ä¸ºæ¨¡æ¿
                document.getElementById('save-template-btn').addEventListener('click', function() {
                    const templateName = prompt('è¯·è¾“å…¥æ¨¡æ¿åç§°ï¼š');
                    if (!templateName) return;
                    
                    // è·å–å½“å‰å‚æ•°
                    const params = {
                        depreciationRate: parseFloat(document.getElementById('depreciation-rate').value) || 0.5,
                        locationFactor: parseFloat(document.getElementById('location-factor').value) || 1,
                        decorationFactor: parseFloat(document.getElementById('decoration-factor').value) || 1,
                        facilityFactor: parseFloat(document.getElementById('facility-factor').value) || 1,
                        floorFactor: parseFloat(document.getElementById('floor-factor').value) || 1,
                        orientationFactor: parseFloat(document.getElementById('orientation-factor').value) || 1
                    };
                    
                    // è·å–ç°æœ‰æ¨¡æ¿
                    const templates = JSON.parse(localStorage.getItem('valuationTemplates')) || [];
                    
                    // æ·»åŠ æ–°æ¨¡æ¿
                    const newTemplate = {
                        id: Date.now().toString(),
                        name: templateName,
                        params: params,
                        createdAt: new Date().toISOString()
                    };
                    
                    templates.push(newTemplate);
                    localStorage.setItem('valuationTemplates', JSON.stringify(templates));
                    
                    // æ›´æ–°æ¨¡æ¿é€‰æ‹©å™¨
                    loadTemplates();
                    alert('æ¨¡æ¿å·²ä¿å­˜ï¼');
                });
                
                // åŠ è½½é€‰å®šçš„æ¨¡æ¿
                document.getElementById('template-select').addEventListener('change', function() {
                    const templateId = this.value;
                    if (!templateId) return;
                    
                    if (templateId === 'default') {
                        // åŠ è½½é»˜è®¤æ¨¡æ¿å‚æ•°
                        setParams({
                            depreciationRate: 0.5,
                            locationFactor: 1,
                            decorationFactor: 1,
                            facilityFactor: 1,
                            floorFactor: 1,
                            orientationFactor: 1
                        });
                        return;
                    }
                    
                    // åŠ è½½è‡ªå®šä¹‰æ¨¡æ¿
                    const templates = JSON.parse(localStorage.getItem('valuationTemplates')) || [];
                    const template = templates.find(t => t.id === templateId);
                    
                    if (template) {
                        setParams(template.params);
                    }
                });
                
                // åˆ é™¤é€‰å®šçš„æ¨¡æ¿
                document.getElementById('delete-template-btn').addEventListener('click', function() {
                    const templateSelect = document.getElementById('template-select');
                    const templateId = templateSelect.value;
                    
                    if (!templateId || templateId === 'default') {
                        alert('è¯·é€‰æ‹©ä¸€ä¸ªè‡ªå®šä¹‰æ¨¡æ¿è¿›è¡Œåˆ é™¤');
                        return;
                    }
                    
                    if (confirm('ç¡®å®šè¦åˆ é™¤æ­¤æ¨¡æ¿å—ï¼Ÿ')) {
                        let templates = JSON.parse(localStorage.getItem('valuationTemplates')) || [];
                        templates = templates.filter(t => t.id !== templateId);
                        localStorage.setItem('valuationTemplates', JSON.stringify(templates));
                        
                        // æ›´æ–°æ¨¡æ¿é€‰æ‹©å™¨
                        loadTemplates();
                        templateSelect.value = '';
                        alert('æ¨¡æ¿å·²åˆ é™¤ï¼');
                    }
                });
                
                // åº”ç”¨å½“å‰å‚æ•°åˆ°ä¼°ä»·è®¡ç®—
                document.getElementById('apply-params-btn').addEventListener('click', function() {
                    // è·å–å½“å‰å‚æ•°
                    const params = {
                        depreciationRate: parseFloat(document.getElementById('depreciation-rate').value) || 0.5,
                        locationFactor: parseFloat(document.getElementById('location-factor').value) || 1,
                        decorationFactor: parseFloat(document.getElementById('decoration-factor').value) || 1,
                        facilityFactor: parseFloat(document.getElementById('facility-factor').value) || 1,
                        floorFactor: parseFloat(document.getElementById('floor-factor').value) || 1,
                        orientationFactor: parseFloat(document.getElementById('orientation-factor').value) || 1
                    };
                    
                    // ä¿å­˜å½“å‰å‚æ•°åˆ°localStorage
                    localStorage.setItem('currentValuationParams', JSON.stringify(params));
                    
                    // é‡æ–°è®¡ç®—ä¼°ä»·ï¼ˆå¯ä»¥åœ¨è¿™é‡Œæ·»åŠ æ›´å¤æ‚çš„è®¡ç®—é€»è¾‘ï¼‰
                    alert('å‚æ•°å·²åº”ç”¨ï¼Œä¼°ä»·ç»“æœå°†æ ¹æ®æ–°å‚æ•°é‡æ–°è®¡ç®—');
                    
                    // å¦‚æœå®æ—¶ä¼°ä»·å‡½æ•°å­˜åœ¨ï¼Œè°ƒç”¨å®ƒ
                    if (typeof calculateValuation === 'function') {
                        calculateValuation();
                    }
                });
                
                // é‡ç½®å‚æ•°ä¸ºé»˜è®¤å€¼
                document.getElementById('reset-params-btn').addEventListener('click', function() {
                    setParams({
                        depreciationRate: 0.5,
                        locationFactor: 1,
                        decorationFactor: 1,
                        facilityFactor: 1,
                        floorFactor: 1,
                        orientationFactor: 1
                    });
                });
                
                // è®¾ç½®å‚æ•°åˆ°è¡¨å•
                function setParams(params) {
                    document.getElementById('depreciation-rate').value = params.depreciationRate;
                    document.getElementById('location-factor').value = params.locationFactor;
                    document.getElementById('decoration-factor').value = params.decorationFactor;
                    document.getElementById('facility-factor').value = params.facilityFactor;
                    document.getElementById('floor-factor').value = params.floorFactor;
                    document.getElementById('orientation-factor').value = params.orientationFactor;
                }
                
                // åˆå§‹åŒ–ï¼šåŠ è½½ä¿å­˜çš„æ¨¡æ¿å’Œå½“å‰å‚æ•°
                loadTemplates();
                
                // åŠ è½½ä¸Šæ¬¡ä½¿ç”¨çš„å‚æ•°
                const savedParams = JSON.parse(localStorage.getItem('currentValuationParams'));
                if (savedParams) {
                    setParams(savedParams);
                }
            }
            
            // åˆå§‹åŒ–å¯Œæ–‡æœ¬ç¼–è¾‘å™¨
            initRichTextEditor();
            
            // åˆå§‹åŒ–å®æ—¶é¢„è§ˆä¸å¯¹æ¯”åŠŸèƒ½
            function initRealTimeComparison() {
                let savedSchemes = JSON.parse(localStorage.getItem('valuationSchemes')) || [];
                
                // ä¿å­˜å½“å‰æ–¹æ¡ˆ
                document.getElementById('save-scheme-btn').addEventListener('click', function() {
                    const schemeName = prompt('è¯·è¾“å…¥æ–¹æ¡ˆåç§°ï¼š');
                    if (!schemeName) return;
                    
                    // è·å–å½“å‰ä¼°ä»·ç»“æœ
                    const estimatedUnitPrice = document.querySelector('.result-card .result-row:nth-child(1) .result-value').textContent;
                    const estimatedTotalPrice = document.querySelector('.result-card .result-row:nth-child(2) .result-value').textContent;
                    const priceRange = document.querySelector('.result-card .result-row:nth-child(3) .result-value').textContent;
                    
                    // è·å–å½“å‰å‚æ•°
                    const params = {
                        depreciationRate: parseFloat(document.getElementById('depreciation-rate').value) || 0.5,
                        locationFactor: parseFloat(document.getElementById('location-factor').value) || 1,
                        decorationFactor: parseFloat(document.getElementById('decoration-factor').value) || 1,
                        facilityFactor: parseFloat(document.getElementById('facility-factor').value) || 1,
                        floorFactor: parseFloat(document.getElementById('floor-factor').value) || 1,
                        orientationFactor: parseFloat(document.getElementById('orientation-factor').value) || 1
                    };
                    
                    // åˆ›å»ºæ–°æ–¹æ¡ˆ
                    const newScheme = {
                        id: Date.now().toString(),
                        name: schemeName,
                        estimatedUnitPrice: estimatedUnitPrice,
                        estimatedTotalPrice: estimatedTotalPrice,
                        priceRange: priceRange,
                        params: params,
                        createdAt: new Date().toLocaleString()
                    };
                    
                    // ä¿å­˜åˆ°localStorage
                    savedSchemes.push(newScheme);
                    localStorage.setItem('valuationSchemes', JSON.stringify(savedSchemes));
                    
                    // æ›´æ–°æ–¹æ¡ˆé€‰æ‹©å™¨
                    updateSchemeSelector();
                    alert('æ–¹æ¡ˆå·²ä¿å­˜ï¼');
                });
                
                // åˆ‡æ¢æ–¹æ¡ˆ
                document.getElementById('scheme-select').addEventListener('change', function() {
                    const schemeId = this.value;
                    if (schemeId === 'current') {
                        // æ¢å¤åˆ°å½“å‰æ–¹æ¡ˆ
                        return;
                    }
                    
                    // åŠ è½½é€‰å®šçš„æ–¹æ¡ˆ
                    const scheme = savedSchemes.find(s => s.id === schemeId);
                    if (scheme) {
                        // æ›´æ–°å‚æ•°è¡¨å•
                        setParams(scheme.params);
                        
                        // æ›´æ–°ä¼°ä»·ç»“æœ
                        document.querySelector('.result-card .result-row:nth-child(1) .result-value').textContent = scheme.estimatedUnitPrice;
                        document.querySelector('.result-card .result-row:nth-child(2) .result-value').textContent = scheme.estimatedTotalPrice;
                        document.querySelector('.result-card .result-row:nth-child(3) .result-value').textContent = scheme.priceRange;
                        
                        alert('å·²åˆ‡æ¢åˆ°æ–¹æ¡ˆï¼š' + scheme.name);
                    }
                });
                
                // æ˜¾ç¤º/éšè—æ–¹æ¡ˆå¯¹æ¯”è§†å›¾
                document.getElementById('compare-schemes-btn').addEventListener('click', function() {
                    const compareView = document.getElementById('scheme-compare-view');
                    const compareResults = document.getElementById('compare-results');
                    
                    if (compareView.style.display === 'none') {
                        // æ˜¾ç¤ºå¯¹æ¯”è§†å›¾
                        compareView.style.display = 'block';
                        this.textContent = 'âœ• å…³é—­å¯¹æ¯”';
                        
                        // ç”Ÿæˆå¯¹æ¯”ç»“æœ
                        generateComparisonResults();
                    } else {
                        // éšè—å¯¹æ¯”è§†å›¾
                        compareView.style.display = 'none';
                        this.textContent = 'ğŸ”„ å¯¹æ¯”æ–¹æ¡ˆ';
                    }
                });
                
                // ç”Ÿæˆå¯¹æ¯”ç»“æœ
                function generateComparisonResults() {
                    const compareResults = document.getElementById('compare-results');
                    compareResults.innerHTML = '';
                    
                    // è·å–å½“å‰æ–¹æ¡ˆ
                    const currentUnitPrice = document.querySelector('.result-card .result-row:nth-child(1) .result-value').textContent;
                    const currentTotalPrice = document.querySelector('.result-card .result-row:nth-child(2) .result-value').textContent;
                    const currentPriceRange = document.querySelector('.result-card .result-row:nth-child(3) .result-value').textContent;
                    
                    // æ·»åŠ å½“å‰æ–¹æ¡ˆåˆ°å¯¹æ¯”
                    const currentSchemeCard = document.createElement('div');
                    currentSchemeCard.style.cssText = `
                        background: white;
                        padding: 16px;
                        border-radius: 8px;
                        box-shadow: 0 2px 8px rgba(0,0,0,0.05);
                        border: 2px solid #667eea;
                    `;
                    currentSchemeCard.innerHTML = `
                        <div style="font-weight: bold; color: #667eea; margin-bottom: 12px; font-size: 14px;">å½“å‰æ–¹æ¡ˆ</div>
                        <div style="margin-bottom: 8px; font-size: 13px;">
                            <span style="color: #666;">é¢„ä¼°å•ä»·ï¼š</span>
                            <span style="font-weight: 500;">${currentUnitPrice}</span>
                        </div>
                        <div style="margin-bottom: 8px; font-size: 13px;">
                            <span style="color: #666;">é¢„ä¼°æ€»ä»·ï¼š</span>
                            <span style="font-weight: 500;">${currentTotalPrice}</span>
                        </div>
                        <div style="margin-bottom: 8px; font-size: 13px;">
                            <span style="color: #666;">ä»·æ ¼åŒºé—´ï¼š</span>
                            <span style="font-weight: 500;">${currentPriceRange}</span>
                        </div>
                        <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid #f0f0f0; font-size: 11px; color: #999;">
                            å½“å‰å®æ—¶æ•°æ®
                        </div>
                    `;
                    compareResults.appendChild(currentSchemeCard);
                    
                    // æ·»åŠ ä¿å­˜çš„æ–¹æ¡ˆåˆ°å¯¹æ¯”
                    savedSchemes.forEach(scheme => {
                        const schemeCard = document.createElement('div');
                        schemeCard.style.cssText = `
                            background: white;
                            padding: 16px;
                            border-radius: 8px;
                            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
                        `;
                        schemeCard.innerHTML = `
                            <div style="font-weight: bold; margin-bottom: 12px; font-size: 14px;">${scheme.name}</div>
                            <div style="margin-bottom: 8px; font-size: 13px;">
                                <span style="color: #666;">é¢„ä¼°å•ä»·ï¼š</span>
                                <span style="font-weight: 500;">${scheme.estimatedUnitPrice}</span>
                            </div>
                            <div style="margin-bottom: 8px; font-size: 13px;">
                                <span style="color: #666;">é¢„ä¼°æ€»ä»·ï¼š</span>
                                <span style="font-weight: 500;">${scheme.estimatedTotalPrice}</span>
                            </div>
                            <div style="margin-bottom: 8px; font-size: 13px;">
                                <span style="color: #666;">ä»·æ ¼åŒºé—´ï¼š</span>
                                <span style="font-weight: 500;">${scheme.priceRange}</span>
                            </div>
                            <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid #f0f0f0; font-size: 11px; color: #999;">
                                ä¿å­˜äºï¼š${scheme.createdAt}
                            </div>
                        `;
                        compareResults.appendChild(schemeCard);
                    });
                }
                
                // æ›´æ–°æ–¹æ¡ˆé€‰æ‹©å™¨
                function updateSchemeSelector() {
                    const schemeSelect = document.getElementById('scheme-select');
                    
                    // æ¸…ç©ºç°æœ‰é€‰é¡¹ï¼ˆä¿ç•™å½“å‰æ–¹æ¡ˆé€‰é¡¹ï¼‰
                    schemeSelect.innerHTML = '<option value="current">å½“å‰æ–¹æ¡ˆ</option>';
                    
                    // æ·»åŠ ä¿å­˜çš„æ–¹æ¡ˆ
                    savedSchemes.forEach(scheme => {
                        const option = document.createElement('option');
                        option.value = scheme.id;
                        option.textContent = scheme.name;
                        schemeSelect.appendChild(option);
                    });
                }
                
                // åˆå§‹åŒ–æ–¹æ¡ˆé€‰æ‹©å™¨
                updateSchemeSelector();
            }
            
            // åˆå§‹åŒ–å‚æ•°åŒ–é…ç½®
            initParamConfig();
            
            // åˆå§‹åŒ–ä¸€é”®ç”ŸæˆæŠ¥å‘ŠåŠŸèƒ½
            function initReportGeneration() {
                // æŠ¥å‘Šæ¨¡æ¿å®šä¹‰
                const reportTemplates = {
                    'basic': {
                        name: 'åŸºç¡€æ¨¡æ¿',
                        description: 'åŒ…å«æ ¸å¿ƒä¼°ä»·ä¿¡æ¯çš„ç®€æ´æŠ¥å‘Š',
                        generate: generateBasicReport
                    },
                    'detailed': {
                        name: 'è¯¦ç»†æ¨¡æ¿',
                        description: 'åŒ…å«å®Œæ•´ä¼°ä»·åˆ†æå’Œå¸‚åœºæ•°æ®çš„è¯¦ç»†æŠ¥å‘Š',
                        generate: generateDetailedReport
                    },
                    'professional': {
                        name: 'ä¸“ä¸šæ¨¡æ¿',
                        description: 'é€‚åˆä¸“ä¸šä¼°ä»·å¸ˆä½¿ç”¨çš„ä¸“ä¸šæŠ¥å‘Šæ ¼å¼',
                        generate: generateProfessionalReport
                    },
                    'simple': {
                        name: 'ç®€æ˜“æ¨¡æ¿',
                        description: 'ç®€æ´æ˜äº†çš„ä¼°ä»·æŠ¥å‘Š',
                        generate: generateSimpleReport
                    }
                };
                
                // ç”Ÿæˆä¼°ä»·æŠ¥å‘Š
                document.getElementById('generate-report-btn').addEventListener('click', function() {
                    // æ˜¾ç¤ºæ¨¡æ¿é€‰æ‹©æ¨¡æ€æ¡†
                    showTemplateSelectModal();
                });
                
                // æ˜¾ç¤ºæ¨¡æ¿é€‰æ‹©æ¨¡æ€æ¡†
                function showTemplateSelectModal() {
                    // åˆ›å»ºæ¨¡æ¿é€‰æ‹©æ¨¡æ€æ¡†
                    const modal = document.createElement('div');
                    modal.style.cssText = `
                        position: fixed;
                        top: 0;
                        left: 0;
                        width: 100%;
                        height: 100%;
                        background-color: rgba(0, 0, 0, 0.5);
                        display: flex;
                        justify-content: center;
                        align-items: center;
                        z-index: 10000;
                        padding: 20px;
                    `;
                    
                    const modalContent = document.createElement('div');
                    modalContent.style.cssText = `
                        background-color: white;
                        padding: 30px;
                        border-radius: 12px;
                        max-width: 600px;
                        width: 100%;
                        max-height: 90vh;
                        overflow-y: auto;
                        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
                    `;
                    
                    modalContent.innerHTML = `
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 1px solid #e0e0e0; padding-bottom: 15px;">
                            <h2 style="margin: 0; font-size: 18px; color: #333;">é€‰æ‹©æŠ¥å‘Šæ¨¡æ¿</h2>
                            <button onclick="this.closest('[style*=fixed]').remove()" style="background: none; border: none; font-size: 20px; cursor: pointer; color: #999;">&times;</button>
                        </div>
                        <div id="template-list" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 16px;"></div>
                    `;
                    
                    modal.appendChild(modalContent);
                    document.body.appendChild(modal);
                    
                    // æ¸²æŸ“æ¨¡æ¿åˆ—è¡¨
                    const templateList = document.getElementById('template-list');
                    Object.entries(reportTemplates).forEach(([key, template]) => {
                        const templateCard = document.createElement('div');
                        templateCard.style.cssText = `
                            border: 1px solid #e0e0e0;
                            border-radius: 8px;
                            padding: 20px;
                            cursor: pointer;
                            transition: all 0.3s ease;
                            display: flex;
                            flex-direction: column;
                        `;
                        templateCard.onmouseover = () => {
                            templateCard.style.borderColor = '#667eea';
                            templateCard.style.boxShadow = '0 2px 8px rgba(102, 126, 234, 0.15)';
                        };
                        templateCard.onmouseout = () => {
                            templateCard.style.borderColor = '#e0e0e0';
                            templateCard.style.boxShadow = 'none';
                        };
                        templateCard.onclick = () => {
                            generateReportWithTemplate(key);
                            modal.remove();
                        };
                        
                        templateCard.innerHTML = `
                            <h3 style="margin: 0 0 8px 0; color: #667eea;">${template.name}</h3>
                            <p style="margin: 0 0 16px 0; color: #666; font-size: 14px;">${template.description}</p>
                            <button style="padding: 8px 16px; background-color: #667eea; color: white; border: none; border-radius: 4px; cursor: pointer; margin-top: auto;">é€‰æ‹©æ¨¡æ¿</button>
                        `;
                        templateList.appendChild(templateCard);
                    });
                }
                
                // ä½¿ç”¨æŒ‡å®šæ¨¡æ¿ç”ŸæˆæŠ¥å‘Š
                function generateReportWithTemplate(templateKey) {
                    // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                    const generateBtn = document.getElementById('generate-report-btn');
                    if (generateBtn) {
                        generateBtn.classList.add('loading');
                    }
                    
                    setTimeout(() => {
                        // æ”¶é›†æŠ¥å‘Šæ•°æ®
                        const reportData = collectReportData();
                        
                        // ç”ŸæˆæŠ¥å‘Šå†…å®¹
                        const template = reportTemplates[templateKey] || reportTemplates['basic'];
                        const reportContent = template.generate(reportData);
                        
                        // æ˜¾ç¤ºæŠ¥å‘Š
                        showReportModal(reportContent, reportData);
                        
                        // ç§»é™¤åŠ è½½çŠ¶æ€
                        if (generateBtn) {
                            generateBtn.classList.remove('loading');
                        }
                    }, 1000);
                }
                
                // æ”¶é›†æŠ¥å‘Šæ•°æ®
                function collectReportData() {
                    // æ”¶é›†è¡¨å•æ•°æ®
                    const address = document.getElementById('address')?.value || '';
                    const area = document.getElementById('area')?.value || '';
                    const city = document.getElementById('city')?.value || 'é•¿æ²™';
                    const yearBuilt = document.getElementById('yearBuilt')?.value || new Date().getFullYear();
                    const floor = document.getElementById('floor')?.value || '';
                    const orientation = document.getElementById('orientation')?.value || 'å—åŒ—é€šé€';
                    const type = document.getElementById('type')?.value || 'ä½å®…';
                    
                    return {
                        title: 'AIæ™ºèƒ½ä¼°ä»·æŠ¥å‘Š',
                        date: new Date().toLocaleString(),
                        projectName: address || 'æœªå‘½åé¡¹ç›®',
                        estimatedUnitPrice: document.querySelector('.result-card .result-row:nth-child(1) .result-value').textContent,
                        estimatedTotalPrice: document.querySelector('.result-card .result-row:nth-child(2) .result-value').textContent,
                        priceRange: document.querySelector('.result-card .result-row:nth-child(3) .result-value').textContent,
                        description: tinymce.get('valuation-description')?.getContent() || 'æ— ä¼°ä»·è¯´æ˜',
                        formData: {
                            address,
                            area,
                            city,
                            yearBuilt,
                            floor,
                            orientation,
                            type
                        },
                        timestamp: new Date().toISOString()
                    };
                }
                
                // åŸºç¡€æŠ¥å‘Šæ¨¡æ¿
                function generateBasicReport(data) {
                    return `
                        <div style="max-width: 800px; margin: 0 auto;">
                            <h1 style="color: #667eea; text-align: center; margin-bottom: 20px;">${data.title}</h1>
                            <div style="text-align: center; margin-bottom: 30px; color: #999;">æŠ¥å‘Šæ—¥æœŸï¼š${data.date}</div>
                            
                            <h2 style="color: #333; margin-top: 30px; margin-bottom: 20px;">ä¸€ã€é¡¹ç›®æ¦‚å†µ</h2>
                            <p style="margin-bottom: 16px;">é¡¹ç›®åç§°ï¼š${data.projectName}</p>
                            <p style="margin-bottom: 16px;">åœ°å€ï¼š${data.formData.address}</p>
                            <p style="margin-bottom: 16px;">å»ºç­‘é¢ç§¯ï¼š${data.formData.area} ã¡</p>
                            <p style="margin-bottom: 16px;">ç‰©ä¸šç±»å‹ï¼š${data.formData.type}</p>
                            
                            <h2 style="color: #333; margin-top: 30px; margin-bottom: 20px;">äºŒã€ä¼°ä»·ç»“æœ</h2>
                            <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 12px;">
                                    <span style="color: #666;">é¢„ä¼°å•ä»·ï¼š</span>
                                    <span style="font-weight: bold;">${data.estimatedUnitPrice}</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 12px;">
                                    <span style="color: #666;">é¢„ä¼°æ€»ä»·ï¼š</span>
                                    <span style="font-weight: bold;">${data.estimatedTotalPrice}</span>
                                </div>
                                <div style="display: flex; justify-content: space-between;">
                                    <span style="color: #666;">å¸‚åœºå‚è€ƒä»·åŒºé—´ï¼š</span>
                                    <span style="font-weight: bold;">${data.priceRange}</span>
                                </div>
                            </div>
                            
                            <h2 style="color: #333; margin-top: 30px; margin-bottom: 20px;">ä¸‰ã€ä¼°ä»·è¯´æ˜</h2>
                            <div style="background: white; padding: 20px; border: 1px solid #e0e0e0; border-radius: 8px;">
                                ${data.description}
                            </div>
                            
                            <div style="margin-top: 40px; text-align: center; color: #999; font-size: 12px;">
                                <p>æŠ¥å‘Šç”Ÿæˆï¼šValuHubAIä¼°ä»·ç³»ç»Ÿ</p>
                                <p>Â© 2025 ValuHub. All rights reserved.</p>
                            </div>
                        </div>
                    `;
                }
                
                // è¯¦ç»†æŠ¥å‘Šæ¨¡æ¿
                function generateDetailedReport(data) {
                    return `
                        <div style="max-width: 900px; margin: 0 auto; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;">
                            <div style="background-color: #667eea; color: white; padding: 40px; text-align: center; border-radius: 8px 8px 0 0;">
                                <h1 style="margin: 0; font-size: 28px;">${data.title}</h1>
                                <p style="margin: 12px 0 0 0;">æŠ¥å‘Šæ—¥æœŸï¼š${data.date}</p>
                            </div>
                            
                            <div style="background-color: white; padding: 40px; border-radius: 0 0 8px 8px; box-shadow: 0 2px 12px rgba(0,0,0,0.1);">
                                <h2 style="color: #333; margin-top: 0; margin-bottom: 24px; border-bottom: 2px solid #667eea; padding-bottom: 12px;">ä¸€ã€é¡¹ç›®æ¦‚å†µ</h2>
                                <table style="width: 100%; border-collapse: collapse; margin-bottom: 30px;">
                                    <tbody>
                                        <tr>
                                            <td style="width: 150px; padding: 12px; background-color: #f8f9fa; font-weight: bold; border: 1px solid #e0e0e0;">é¡¹ç›®åç§°</td>
                                            <td style="padding: 12px; border: 1px solid #e0e0e0;">${data.projectName}</td>
                                        </tr>
                                        <tr>
                                            <td style="width: 150px; padding: 12px; background-color: #f8f9fa; font-weight: bold; border: 1px solid #e0e0e0;">åœ°å€</td>
                                            <td style="padding: 12px; border: 1px solid #e0e0e0;">${data.formData.address}</td>
                                        </tr>
                                        <tr>
                                            <td style="width: 150px; padding: 12px; background-color: #f8f9fa; font-weight: bold; border: 1px solid #e0e0e0;">åŸå¸‚</td>
                                            <td style="padding: 12px; border: 1px solid #e0e0e0;">${data.formData.city}</td>
                                        </tr>
                                        <tr>
                                            <td style="width: 150px; padding: 12px; background-color: #f8f9fa; font-weight: bold; border: 1px solid #e0e0e0;">å»ºç­‘é¢ç§¯</td>
                                            <td style="padding: 12px; border: 1px solid #e0e0e0;">${data.formData.area} ã¡</td>
                                        </tr>
                                        <tr>
                                            <td style="width: 150px; padding: 12px; background-color: #f8f9fa; font-weight: bold; border: 1px solid #e0e0e0;">ç‰©ä¸šç±»å‹</td>
                                            <td style="padding: 12px; border: 1px solid #e0e0e0;">${data.formData.type}</td>
                                        </tr>
                                        <tr>
                                            <td style="width: 150px; padding: 12px; background-color: #f8f9fa; font-weight: bold; border: 1px solid #e0e0e0;">å»ºé€ å¹´ä»£</td>
                                            <td style="padding: 12px; border: 1px solid #e0e0e0;">${data.formData.yearBuilt}å¹´</td>
                                        </tr>
                                        <tr>
                                            <td style="width: 150px; padding: 12px; background-color: #f8f9fa; font-weight: bold; border: 1px solid #e0e0e0;">æ¥¼å±‚</td>
                                            <td style="padding: 12px; border: 1px solid #e0e0e0;">${data.formData.floor}</td>
                                        </tr>
                                        <tr>
                                            <td style="width: 150px; padding: 12px; background-color: #f8f9fa; font-weight: bold; border: 1px solid #e0e0e0;">æœå‘</td>
                                            <td style="padding: 12px; border: 1px solid #e0e0e0;">${data.formData.orientation}</td>
                                        </tr>
                                    </tbody>
                                </table>
                                
                                <h2 style="color: #333; margin-top: 0; margin-bottom: 24px; border-bottom: 2px solid #667eea; padding-bottom: 12px;">äºŒã€ä¼°ä»·ç»“æœ</h2>
                                <div style="background: #e6f7ff; padding: 24px; border-radius: 8px; margin-bottom: 30px; border-left: 4px solid #1890ff;">
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 16px; font-size: 16px;">
                                        <span style="color: #666;">é¢„ä¼°å•ä»·ï¼š</span>
                                        <span style="font-weight: bold; color: #1890ff;">${data.estimatedUnitPrice}</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 16px; font-size: 16px;">
                                        <span style="color: #666;">é¢„ä¼°æ€»ä»·ï¼š</span>
                                        <span style="font-weight: bold; color: #1890ff;">${data.estimatedTotalPrice}</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; font-size: 16px;">
                                        <span style="color: #666;">å¸‚åœºå‚è€ƒä»·åŒºé—´ï¼š</span>
                                        <span style="font-weight: bold; color: #1890ff;">${data.priceRange}</span>
                                    </div>
                                </div>
                                
                                <h2 style="color: #333; margin-top: 0; margin-bottom: 24px; border-bottom: 2px solid #667eea; padding-bottom: 12px;">ä¸‰ã€å¸‚åœºåˆ†æ</h2>
                                <div style="margin-bottom: 30px;">
                                    <p style="margin-bottom: 16px; line-height: 1.6;">æ ¹æ®å½“å‰å¸‚åœºæ•°æ®ï¼Œ${data.formData.city}å¸‚${data.formData.type}å¸‚åœºä¿æŒç¨³å®šå¢é•¿è¶‹åŠ¿ã€‚æœ€è¿‘6ä¸ªæœˆï¼Œè¯¥åŒºåŸŸåŒç±»ç‰©ä¸šå¹³å‡ä»·æ ¼æ¶¨å¹…çº¦ä¸º2.5%ï¼Œé¢„è®¡æœªæ¥3-6ä¸ªæœˆå°†ä¿æŒç±»ä¼¼å¢é•¿æ€åŠ¿ã€‚</p>
                                    <p style="margin-bottom: 16px; line-height: 1.6;">å½±å“æœ¬æ¬¡ä¼°ä»·çš„ä¸»è¦å› ç´ åŒ…æ‹¬ï¼šåœ°ç†ä½ç½®ã€å»ºç­‘é¢ç§¯ã€ç‰©ä¸šç±»å‹ã€å»ºé€ å¹´ä»£ã€æ¥¼å±‚å’Œæœå‘ç­‰ã€‚å…¶ä¸­ï¼Œåœ°ç†ä½ç½®å’Œæ¥¼å±‚æ˜¯å½±å“ä»·æ ¼çš„æ ¸å¿ƒå› ç´ ã€‚</p>
                                </div>
                                
                                <h2 style="color: #333; margin-top: 0; margin-bottom: 24px; border-bottom: 2px solid #667eea; padding-bottom: 12px;">å››ã€ä¼°ä»·è¯´æ˜</h2>
                                <div style="background: white; padding: 24px; border: 1px solid #e0e0e0; border-radius: 8px; margin-bottom: 30px;">
                                    ${data.description}
                                </div>
                                
                                <h2 style="color: #333; margin-top: 0; margin-bottom: 24px; border-bottom: 2px solid #667eea; padding-bottom: 12px;">äº”ã€é£é™©æç¤º</h2>
                                <div style="background: #fff7e6; padding: 20px; border-radius: 8px; margin-bottom: 30px; border-left: 4px solid #faad14;">
                                    <p style="margin: 0; line-height: 1.6;">1. æœ¬æŠ¥å‘ŠåŸºäºå½“å‰å¸‚åœºæ•°æ®ç”Ÿæˆï¼Œå¸‚åœºæ³¢åŠ¨å¯èƒ½å½±å“ä¼°ä»·ç»“æœå‡†ç¡®æ€§ï¼›</p>
                                    <p style="margin: 8px 0; line-height: 1.6;">2. å®é™…äº¤æ˜“ä»·æ ¼å¯èƒ½å› äº¤æ˜“åŒæ–¹åå•†ã€å¸‚åœºå˜åŒ–ç­‰å› ç´ æœ‰æ‰€ä¸åŒï¼›</p>
                                    <p style="margin: 8px 0; line-height: 1.6;">3. æœ¬æŠ¥å‘Šä»…ä¾›å‚è€ƒï¼Œä¸æ„æˆä»»ä½•æŠ•èµ„å»ºè®®ï¼›</p>
                                    <p style="margin: 8px 0; line-height: 1.6;">4. å¦‚éœ€æ›´å‡†ç¡®çš„ä¼°ä»·ç»“æœï¼Œå»ºè®®å’¨è¯¢ä¸“ä¸šä¼°ä»·å¸ˆã€‚</p>
                                </div>
                                
                                <div style="margin-top: 40px; text-align: center; color: #999; font-size: 12px;">
                                    <p>æŠ¥å‘Šç”Ÿæˆï¼šValuHubAIä¼°ä»·ç³»ç»Ÿ</p>
                                    <p>æŠ¥å‘Šç¼–å·ï¼šAI-${Date.now().toString().slice(-8)}</p>
                                    <p>Â© 2025 ValuHub. All rights reserved.</p>
                                </div>
                            </div>
                        </div>
                    `;
                }
                
                // ä¸“ä¸šæŠ¥å‘Šæ¨¡æ¿
                function generateProfessionalReport(data) {
                    return `
                        <div style="max-width: 1000px; margin: 0 auto; font-family: Times New Roman, serif;">
                            <div style="text-align: center; margin-bottom: 40px;">
                                <h1 style="margin: 0; font-size: 32px; color: #333; font-weight: bold;">${data.title}</h1>
                                <p style="margin: 16px 0 0 0; font-size: 16px; color: #666;">Report of AI Intelligent Valuation</p>
                                <div style="margin-top: 20px; font-size: 14px; color: #999;">
                                    <p>æŠ¥å‘Šæ—¥æœŸï¼š${data.date}</p>
                                    <p>æŠ¥å‘Šç¼–å·ï¼šAI-PRO-${Date.now().toString().slice(-10)}</p>
                                </div>
                            </div>
                            
                            <div style="border: 1px solid #000; padding: 30px; margin-bottom: 30px; border-radius: 8px;">
                                <h2 style="margin: 0 0 24px 0; font-size: 24px; color: #000; text-align: center; border-bottom: 2px solid #000; padding-bottom: 12px;">1. ä¼°ä»·ç›®çš„</h2>
                                <p style="margin: 0; text-align: center; font-size: 16px; line-height: 1.8;">ä¸ºæˆ¿åœ°äº§äº¤æ˜“ã€æŠµæŠ¼ã€è¯„ä¼°ç­‰æä¾›ä¸“ä¸šä¼°ä»·å‚è€ƒ</p>
                            </div>
                            
                            <div style="border: 1px solid #000; padding: 30px; margin-bottom: 30px; border-radius: 8px;">
                                <h2 style="margin: 0 0 24px 0; font-size: 24px; color: #000; text-align: center; border-bottom: 2px solid #000; padding-bottom: 12px;">2. ä¼°ä»·å¯¹è±¡</h2>
                                <table style="width: 100%; border-collapse: collapse; margin-bottom: 20px;">
                                    <thead>
                                        <tr>
                                            <th style="border: 1px solid #000; padding: 12px; background-color: #f8f9fa; text-align: left;">é¡¹ç›®</th>
                                            <th style="border: 1px solid #000; padding: 12px; background-color: #f8f9fa; text-align: left;">å†…å®¹</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td style="border: 1px solid #000; padding: 12px; font-weight: bold;">é¡¹ç›®åç§°</td>
                                            <td style="border: 1px solid #000; padding: 12px;">${data.projectName}</td>
                                        </tr>
                                        <tr>
                                            <td style="border: 1px solid #000; padding: 12px; font-weight: bold;">åœ°ç†ä½ç½®</td>
                                            <td style="border: 1px solid #000; padding: 12px;">${data.formData.address}</td>
                                        </tr>
                                        <tr>
                                            <td style="border: 1px solid #000; padding: 12px; font-weight: bold;">ç‰©ä¸šç±»å‹</td>
                                            <td style="border: 1px solid #000; padding: 12px;">${data.formData.type}</td>
                                        </tr>
                                        <tr>
                                            <td style="border: 1px solid #000; padding: 12px; font-weight: bold;">å»ºç­‘é¢ç§¯</td>
                                            <td style="border: 1px solid #000; padding: 12px;">${data.formData.area} ã¡</td>
                                        </tr>
                                        <tr>
                                            <td style="border: 1px solid #000; padding: 12px; font-weight: bold;">å»ºé€ å¹´ä»£</td>
                                            <td style="border: 1px solid #000; padding: 12px;">${data.formData.yearBuilt}å¹´</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            
                            <div style="border: 1px solid #000; padding: 30px; margin-bottom: 30px; border-radius: 8px;">
                                <h2 style="margin: 0 0 24px 0; font-size: 24px; color: #000; text-align: center; border-bottom: 2px solid #000; padding-bottom: 12px;">3. ä¼°ä»·ç»“æœ</h2>
                                <div style="text-align: center; font-size: 18px; margin-bottom: 20px;">
                                    <p style="margin: 0 0 12px 0;"><strong>é¢„ä¼°å•ä»·ï¼š</strong>${data.estimatedUnitPrice}</p>
                                    <p style="margin: 0 0 12px 0;"><strong>é¢„ä¼°æ€»ä»·ï¼š</strong>${data.estimatedTotalPrice}</p>
                                    <p style="margin: 0;"><strong>å¸‚åœºå‚è€ƒä»·åŒºé—´ï¼š</strong>${data.priceRange}</p>
                                </div>
                                <div style="text-align: right; font-size: 14px; color: #666; margin-top: 30px;">
                                    <p>ä¼°ä»·æ–¹æ³•ï¼šå¸‚åœºæ¯”è¾ƒæ³• + AIç®—æ³•æ¨¡å‹</p>
                                    <p>ä¼°ä»·åŸºå‡†æ—¥ï¼š${new Date().toLocaleDateString()}</p>
                                </div>
                            </div>
                            
                            <div style="border: 1px solid #000; padding: 30px; margin-bottom: 30px; border-radius: 8px;">
                                <h2 style="margin: 0 0 24px 0; font-size: 24px; color: #000; text-align: center; border-bottom: 2px solid #000; padding-bottom: 12px;">4. ä¼°ä»·åˆ†æ</h2>
                                <div style="font-size: 16px; line-height: 1.8;">
                                    ${data.description}
                                </div>
                            </div>
                            
                            <div style="border: 1px solid #000; padding: 30px; margin-bottom: 30px; border-radius: 8px;">
                                <h2 style="margin: 0 0 24px 0; font-size: 24px; color: #000; text-align: center; border-bottom: 2px solid #000; padding-bottom: 12px;">5. ä¼°ä»·å¸ˆå£°æ˜</h2>
                                <div style="font-size: 14px; line-height: 1.8; margin-left: 40px;">
                                    <p>1. æœ¬æŠ¥å‘Šæ˜¯æ ¹æ®ä¼°ä»·å¯¹è±¡çš„å®é™…æƒ…å†µå’Œå¸‚åœºæ•°æ®ï¼Œéµå¾ªç‹¬ç«‹ã€å®¢è§‚ã€å…¬æ­£çš„åŸåˆ™ç”Ÿæˆï¼›</p>
                                    <p>2. æŠ¥å‘Šä¸­çš„ä¼°ä»·ç»“æœä»…ä½œä¸ºå‚è€ƒï¼Œä¸æ„æˆä»»ä½•æ³•å¾‹ä¿è¯ï¼›</p>
                                    <p>3. æŠ¥å‘Šæœ‰æ•ˆæœŸä¸ºè‡ªå‡ºå…·ä¹‹æ—¥èµ·6ä¸ªæœˆï¼›</p>
                                    <p>4. æœ¬æŠ¥å‘Šæœªç»æˆæƒä¸å¾—ç”¨äºå…¶ä»–ç”¨é€”ã€‚</p>
                                </div>
                            </div>
                            
                            <div style="text-align: center; margin-top: 50px;">
                                <p style="margin: 0; font-size: 14px; color: #666;">ValuHubAIä¼°ä»·ç³»ç»Ÿ</p>
                                <p style="margin: 8px 0 0 0; font-size: 12px; color: #999;">Â© 2025 Zhihuiyun. All rights reserved.</p>
                            </div>
                        </div>
                    `;
                }
                
                // ç®€æ˜“æŠ¥å‘Šæ¨¡æ¿
                function generateSimpleReport(data) {
                    return `
                        <div style="max-width: 600px; margin: 0 auto; font-family: Arial, sans-serif;">
                            <div style="background-color: #f5f5f5; padding: 20px; border-radius: 8px;">
                                <h1 style="margin: 0; font-size: 20px; color: #333; text-align: center;">${data.title}</h1>
                                <p style="margin: 8px 0 0 0; text-align: center; font-size: 12px; color: #999;">${data.date}</p>
                            </div>
                            
                            <div style="padding: 20px; border: 1px solid #e0e0e0; border-top: none; border-radius: 0 0 8px 8px;">
                                <div style="margin-bottom: 20px;">
                                    <h3 style="margin: 0 0 12px 0; font-size: 16px; color: #667eea;">é¡¹ç›®ä¿¡æ¯</h3>
                                    <p style="margin: 0 0 8px 0; font-size: 14px;"><strong>åç§°ï¼š</strong>${data.projectName}</p>
                                    <p style="margin: 0 0 8px 0; font-size: 14px;"><strong>åœ°å€ï¼š</strong>${data.formData.address}</p>
                                    <p style="margin: 0; font-size: 14px;"><strong>é¢ç§¯ï¼š</strong>${data.formData.area} ã¡</p>
                                </div>
                                
                                <div style="margin-bottom: 20px; padding: 16px; background-color: #e6f7ff; border-radius: 4px;">
                                    <h3 style="margin: 0 0 12px 0; font-size: 16px; color: #1890ff;">ä¼°ä»·ç»“æœ</h3>
                                    <p style="margin: 0 0 8px 0; font-size: 14px;"><strong>å•ä»·ï¼š</strong>${data.estimatedUnitPrice}</p>
                                    <p style="margin: 0 0 8px 0; font-size: 14px;"><strong>æ€»ä»·ï¼š</strong>${data.estimatedTotalPrice}</p>
                                    <p style="margin: 0; font-size: 14px;"><strong>åŒºé—´ï¼š</strong>${data.priceRange}</p>
                                </div>
                                
                                <div>
                                    <h3 style="margin: 0 0 12px 0; font-size: 16px; color: #52c41a;">å¤‡æ³¨</h3>
                                    <div style="font-size: 14px; line-height: 1.5;">${data.description.replace(/<[^>]*>/g, '')}</div>
                                </div>
                            </div>
                        </div>
                    `;
                }
                
                // å¯¼å‡ºWordæ–‡æ¡£
                function exportWordReport(reportHTML, reportData) {
                    // åˆ›å»ºå®Œæ•´çš„HTMLæ–‡æ¡£
                    const fullHTML = `
                        <!DOCTYPE html>
                        <html>
                        <head>
                            <meta charset="utf-8">
                            <title>${reportData.title}</title>
                            <style>
                                body {
                                    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                                    line-height: 1.6;
                                    color: #333;
                                    max-width: 800px;
                                    margin: 0 auto;
                                    padding: 20px;
                                }
                                h1, h2, h3 {
                                    color: #667eea;
                                    margin-top: 30px;
                                    margin-bottom: 15px;
                                }
                                table {
                                    border-collapse: collapse;
                                    width: 100%;
                                    margin: 20px 0;
                                }
                                th, td {
                                    border: 1px solid #e0e0e0;
                                    padding: 12px;
                                    text-align: left;
                                }
                                th {
                                    background-color: #f8f9fa;
                                    font-weight: bold;
                                }
                                .result-box {
                                    background: #f0f4ff;
                                    padding: 20px;
                                    border-radius: 8px;
                                    margin: 20px 0;
                                }
                            </style>
                        </head>
                        <body>
                            ${reportHTML}
                        </body>
                        </html>
                    `;
                    
                    // åˆ›å»ºBlobå¯¹è±¡
                    const blob = new Blob([fullHTML], { type: 'application/msword' });
                    
                    // ä½¿ç”¨FileSaver.jsä¿å­˜æ–‡ä»¶
                    saveAs(blob, `${reportData.projectName || 'ä¼°ä»·æŠ¥å‘Š'}.doc`);
                    
                    showToast('Wordæ–‡æ¡£å¯¼å‡ºæˆåŠŸï¼', 'success');
                }
                
                // å¯¼å‡ºPDFæ–‡æ¡£
                function exportPDFReport(reportHTML, reportData) {
                    // ä½¿ç”¨jspdfåº“ç”ŸæˆPDF
                    const { jsPDF } = window.jspdf;
                    const doc = new jsPDF({
                        orientation: 'portrait',
                        unit: 'mm',
                        format: 'a4'
                    });
                    
                    // è®¾ç½®å­—ä½“å’Œæ ·å¼
                    doc.setFontSize(16);
                    doc.text(reportData.title, 105, 20, { align: 'center' });
                    
                    doc.setFontSize(10);
                    doc.text(`æŠ¥å‘Šæ—¥æœŸï¼š${reportData.date}`, 10, 30);
                    doc.text(`é¡¹ç›®åç§°ï¼š${reportData.projectName}`, 10, 35);
                    
                    // ç®€å•å¤„ç†HTMLå†…å®¹ä¸ºçº¯æ–‡æœ¬
                    const plainText = reportHTML.replace(/<[^>]*>/g, '');
                    
                    // è®¡ç®—æ–‡æœ¬é«˜åº¦ï¼Œè‡ªåŠ¨åˆ†é¡µ
                    const pageHeight = doc.internal.pageSize.height;
                    const margin = 20;
                    let yPos = 50;
                    
                    // åˆ†æ®µå¤„ç†æ–‡æœ¬
                    const lines = plainText.split('\n');
                    for (let i = 0; i < lines.length; i++) {
                        const line = lines[i].trim();
                        if (line) {
                            // æ£€æŸ¥æ˜¯å¦éœ€è¦åˆ†é¡µ
                            if (yPos > pageHeight - margin) {
                                doc.addPage();
                                yPos = margin;
                            }
                            
                            // æ ¹æ®è¡Œé•¿åº¦è°ƒæ•´å­—ä½“å¤§å°
                            if (line.startsWith('ä¸€ã€') || line.startsWith('äºŒã€') || line.startsWith('ä¸‰ã€')) {
                                doc.setFontSize(14);
                                doc.text(line, 10, yPos);
                                yPos += 8;
                                doc.setFontSize(12);
                            } else {
                                doc.setFontSize(12);
                                const splitText = doc.splitTextToSize(line, 180);
                                doc.text(splitText, 10, yPos);
                                yPos += splitText.length * 5 + 2;
                            }
                        }
                    }
                    
                    // ä¿å­˜PDF
                    doc.save(`${reportData.projectName || 'ä¼°ä»·æŠ¥å‘Š'}.pdf`);
                    
                    showToast('PDFæ–‡æ¡£å¯¼å‡ºæˆåŠŸï¼', 'success');
                }
                
                // æ˜¾ç¤ºæŠ¥å‘Šæ¨¡æ€æ¡†
                function showReportModal(content, reportData) {
                    // åˆ›å»ºæ¨¡æ€æ¡†
                    const modal = document.createElement('div');
                    modal.style.cssText = `
                        position: fixed;
                        top: 0;
                        left: 0;
                        width: 100%;
                        height: 100%;
                        background-color: rgba(0, 0, 0, 0.5);
                        display: flex;
                        justify-content: center;
                        align-items: center;
                        z-index: 10000;
                        padding: 20px;
                    `;
                    
                    const modalContent = document.createElement('div');
                    modalContent.style.cssText = `
                        background-color: white;
                        padding: 30px;
                        border-radius: 12px;
                        max-width: 90%;
                        max-height: 90vh;
                        overflow-y: auto;
                        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
                    `;
                    
                    const modalHeader = document.createElement('div');
                    modalHeader.style.cssText = `
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        margin-bottom: 20px;
                        border-bottom: 1px solid #e0e0e0;
                        padding-bottom: 15px;
                    `;
                    
                    const modalTitle = document.createElement('h2');
                    modalTitle.style.cssText = `
                        margin: 0;
                        color: #333;
                        font-size: 20px;
                    `;
                    modalTitle.textContent = 'ä¼°ä»·æŠ¥å‘Š';
                    
                    const closeBtn = document.createElement('button');
                    closeBtn.style.cssText = `
                        background: none;
                        border: none;
                        font-size: 24px;
                        cursor: pointer;
                        color: #999;
                        padding: 0;
                    `;
                    closeBtn.textContent = 'Ã—';
                    closeBtn.addEventListener('click', () => {
                        document.body.removeChild(modal);
                    });
                    
                    // åˆ›å»ºå¯¼å‡ºæŒ‰é’®åŒºåŸŸ
                    const exportButtons = document.createElement('div');
                    exportButtons.style.cssText = `
                        display: flex;
                        gap: 12px;
                        margin-bottom: 20px;
                        padding: 16px;
                        background-color: #f8f9fa;
                        border-radius: 8px;
                        border: 1px solid #e0e0e0;
                    `;
                    
                    // Wordå¯¼å‡ºæŒ‰é’®
                    const exportWordBtn = document.createElement('button');
                    exportWordBtn.style.cssText = `
                        padding: 10px 20px;
                        background-color: #2563eb;
                        color: white;
                        border: none;
                        border-radius: 6px;
                        cursor: pointer;
                        font-size: 14px;
                        font-weight: 500;
                        transition: all 0.3s ease;
                        display: flex;
                        align-items: center;
                        gap: 8px;
                    `;
                    exportWordBtn.innerHTML = `<span>ğŸ“„</span> å¯¼å‡ºWord`;
                    exportWordBtn.addEventListener('click', () => {
                        exportWordReport(content, reportData);
                    });
                    exportWordBtn.onmouseover = () => {
                        exportWordBtn.style.backgroundColor = '#1d4ed8';
                        exportWordBtn.style.transform = 'translateY(-1px)';
                        exportWordBtn.style.boxShadow = '0 2px 8px rgba(37, 99, 235, 0.3)';
                    };
                    exportWordBtn.onmouseout = () => {
                        exportWordBtn.style.backgroundColor = '#2563eb';
                        exportWordBtn.style.transform = 'translateY(0)';
                        exportWordBtn.style.boxShadow = 'none';
                    };
                    
                    // PDFå¯¼å‡ºæŒ‰é’®
                    const exportPdfBtn = document.createElement('button');
                    exportPdfBtn.style.cssText = `
                        padding: 10px 20px;
                        background-color: #f97316;
                        color: white;
                        border: none;
                        border-radius: 6px;
                        cursor: pointer;
                        font-size: 14px;
                        font-weight: 500;
                        transition: all 0.3s ease;
                        display: flex;
                        align-items: center;
                        gap: 8px;
                    `;
                    exportPdfBtn.innerHTML = `<span>ğŸ“Š</span> å¯¼å‡ºPDF`;
                    exportPdfBtn.addEventListener('click', () => {
                        exportPDFReport(content, reportData);
                    });
                    exportPdfBtn.onmouseover = () => {
                        exportPdfBtn.style.backgroundColor = '#ea580c';
                        exportPdfBtn.style.transform = 'translateY(-1px)';
                        exportPdfBtn.style.boxShadow = '0 2px 8px rgba(249, 115, 22, 0.3)';
                    };
                    exportPdfBtn.onmouseout = () => {
                        exportPdfBtn.style.backgroundColor = '#f97316';
                        exportPdfBtn.style.transform = 'translateY(0)';
                        exportPdfBtn.style.boxShadow = 'none';
                    };
                    
                    // æ·»åŠ æŒ‰é’®åˆ°æŒ‰é’®åŒºåŸŸ
                    exportButtons.appendChild(exportWordBtn);
                    exportButtons.appendChild(exportPdfBtn);
                    
                    // æŠ¥å‘Šå†…å®¹åŒºåŸŸ
                    const reportContent = document.createElement('div');
                    reportContent.innerHTML = content;
                    
                    // æ„å»ºæ¨¡æ€æ¡†å†…å®¹
                    modalHeader.appendChild(modalTitle);
                    modalHeader.appendChild(closeBtn);
                    modalContent.appendChild(modalHeader);
                    modalContent.appendChild(exportButtons);
                    modalContent.appendChild(reportContent);
                    modal.appendChild(modalContent);
                    
                    // æ·»åŠ åˆ°é¡µé¢
                    document.body.appendChild(modal);
                }
                
                // æ˜¾ç¤ºæç¤ºä¿¡æ¯
                function showToast(message, type = 'info') {
                    // åˆ›å»ºtoastå…ƒç´ 
                    const toast = document.createElement('div');
                    toast.className = `toast ${type}`;
                    toast.textContent = message;
                    
                    // æ·»åŠ åˆ°é¡µé¢
                    document.body.appendChild(toast);
                    
                    // æ˜¾ç¤ºtoast
                    setTimeout(() => {
                        toast.classList.add('show');
                    }, 100);
                    
                    // éšè—toast
                    setTimeout(() => {
                        toast.classList.remove('show');
                        setTimeout(() => {
                            document.body.removeChild(toast);
                        }, 300);
                    }, 3000);
                }
            }
            
            // åˆå§‹åŒ–å®æ—¶é¢„è§ˆä¸å¯¹æ¯”åŠŸèƒ½
            initRealTimeComparison();
            
            // åˆå§‹åŒ–è‡ªåŠ¨ä¿å­˜åŠŸèƒ½
            function initAutoSave() {
                // è‡ªåŠ¨ä¿å­˜å®šæ—¶å™¨
                let autoSaveTimer = null;
                // æœ€åä¿å­˜æ—¶é—´
                let lastSaveTime = 0;
                // ä¿å­˜é—´éš”ï¼ˆ5ç§’ï¼‰
                const SAVE_INTERVAL = 5000;
                
                // è‡ªåŠ¨ä¿å­˜çŠ¶æ€æŒ‡ç¤ºå™¨
                const saveIndicator = document.createElement('div');
                saveIndicator.style.cssText = `
                    position: fixed;
                    bottom: 20px;
                    right: 20px;
                    padding: 8px 16px;
                    background-color: rgba(0, 0, 0, 0.7);
                    color: white;
                    border-radius: 20px;
                    font-size: 12px;
                    z-index: 9999;
                    opacity: 0;
                    transition: opacity 0.3s ease;
                `;
                document.body.appendChild(saveIndicator);
                
                // æ˜¾ç¤ºä¿å­˜çŠ¶æ€
                function showSaveStatus(message, isSuccess = true) {
                    saveIndicator.textContent = message;
                    saveIndicator.style.opacity = '1';
                    
                    setTimeout(() => {
                        saveIndicator.style.opacity = '0';
                    }, 2000);
                }
                
                // ä¿å­˜æ•°æ®åˆ°localStorage
                function saveData() {
                    const now = Date.now();
                    // é¿å…è¿‡äºé¢‘ç¹ä¿å­˜
                    if (now - lastSaveTime < 1000) return;
                    
                    try {
                        // æ”¶é›†è¡¨å•æ•°æ®
                        const formData = {
                            propertyType: document.querySelector('.valuation-form select:nth-of-type(1)').value,
                            city: document.getElementById('city').value,
                            area: document.querySelector('.valuation-form input:nth-of-type(1)').value,
                            communityName: document.querySelector('.valuation-form input:nth-of-type(2)').value,
                            address: document.getElementById('address').value,
                            buildingArea: document.getElementById('area').value,
                            floor: document.getElementById('floor').value,
                            yearBuilt: document.getElementById('year-built').value,
                            description: tinymce.get('valuation-description')?.getContent() || '',
                            params: {
                                depreciationRate: document.getElementById('depreciation-rate').value,
                                locationFactor: document.getElementById('location-factor').value,
                                decorationFactor: document.getElementById('decoration-factor').value,
                                facilityFactor: document.getElementById('facility-factor').value,
                                floorFactor: document.getElementById('floor-factor').value,
                                orientationFactor: document.getElementById('orientation-factor').value
                            },
                            lastSaved: new Date().toLocaleString()
                        };
                        
                        // ä¿å­˜åˆ°localStorage
                        localStorage.setItem('autoSavedValuationData', JSON.stringify(formData));
                        
                        lastSaveTime = now;
                        showSaveStatus('è‡ªåŠ¨ä¿å­˜æˆåŠŸ âœ“', true);
                    } catch (error) {
                        console.error('è‡ªåŠ¨ä¿å­˜å¤±è´¥:', error);
                        showSaveStatus('è‡ªåŠ¨ä¿å­˜å¤±è´¥ âœ—', false);
                    }
                }
                
                // æ¢å¤æ•°æ®
                function restoreData() {
                    const savedData = localStorage.getItem('autoSavedValuationData');
                    if (savedData) {
                        try {
                            const data = JSON.parse(savedData);
                            
                            // æ¢å¤è¡¨å•æ•°æ®
                            if (data.propertyType) document.querySelector('.valuation-form select:nth-of-type(1)').value = data.propertyType;
                            if (data.city) document.getElementById('city').value = data.city;
                            if (data.area) document.querySelector('.valuation-form input:nth-of-type(1)').value = data.area;
                            if (data.communityName) document.querySelector('.valuation-form input:nth-of-type(2)').value = data.communityName;
                            if (data.address) document.getElementById('address').value = data.address;
                            if (data.buildingArea) document.getElementById('area').value = data.buildingArea;
                            if (data.floor) document.getElementById('floor').value = data.floor;
                            if (data.yearBuilt) document.getElementById('year-built').value = data.yearBuilt;
                            
                            // æ¢å¤å‚æ•°é…ç½®
                            if (data.params) {
                                if (data.params.depreciationRate) document.getElementById('depreciation-rate').value = data.params.depreciationRate;
                                if (data.params.locationFactor) document.getElementById('location-factor').value = data.params.locationFactor;
                                if (data.params.decorationFactor) document.getElementById('decoration-factor').value = data.params.decorationFactor;
                                if (data.params.facilityFactor) document.getElementById('facility-factor').value = data.params.facilityFactor;
                                if (data.params.floorFactor) document.getElementById('floor-factor').value = data.params.floorFactor;
                                if (data.params.orientationFactor) document.getElementById('orientation-factor').value = data.params.orientationFactor;
                            }
                            
                            // æ¢å¤å¯Œæ–‡æœ¬å†…å®¹ï¼ˆå»¶è¿Ÿæ¢å¤ï¼Œç¡®ä¿TinyMCEå·²åˆå§‹åŒ–ï¼‰
                            if (data.description) {
                                setTimeout(() => {
                                    const editor = tinymce.get('valuation-description');
                                    if (editor) {
                                        editor.setContent(data.description);
                                    }
                                }, 500);
                            }
                            
                            console.log('æ•°æ®å·²æ¢å¤');
                        } catch (error) {
                            console.error('æ¢å¤æ•°æ®å¤±è´¥:', error);
                        }
                    }
                }
                
                // ç›‘å¬è¡¨å•è¾“å…¥äº‹ä»¶
                const formInputs = document.querySelectorAll('.valuation-form input, .valuation-form select, .valuation-form textarea');
                formInputs.forEach(input => {
                    input.addEventListener('input', () => {
                        // å»¶è¿Ÿä¿å­˜ï¼Œé¿å…é¢‘ç¹è§¦å‘
                        clearTimeout(autoSaveTimer);
                        autoSaveTimer = setTimeout(saveData, 1000);
                    });
                });
                
                // å®šæœŸè‡ªåŠ¨ä¿å­˜ï¼ˆ5ç§’ï¼‰
                setInterval(saveData, SAVE_INTERVAL);
                
                // é¡µé¢åŠ è½½æ—¶æ¢å¤æ•°æ®
                restoreData();
                
                // é¡µé¢å…³é—­å‰ä¿å­˜
                window.addEventListener('beforeunload', saveData);
            }
            
            // åˆå§‹åŒ–æ€§èƒ½ä¼˜åŒ–åŠŸèƒ½
            function initPerformanceOptimization() {
                // å»¶è¿ŸåŠ è½½éå…³é”®èµ„æº
                function lazyLoadResources() {
                    // å»¶è¿Ÿåˆå§‹åŒ–TinyMCEï¼ˆä»…åœ¨éœ€è¦æ—¶ï¼‰
                    const descriptionTextarea = document.getElementById('valuation-description');
                    if (descriptionTextarea) {
                        const observer = new IntersectionObserver((entries) => {
                            entries.forEach(entry => {
                                if (entry.isIntersecting) {
                                    // å…ƒç´ è¿›å…¥è§†å£ï¼Œåˆå§‹åŒ–TinyMCE
                                    if (typeof initRichTextEditor === 'function') {
                                        initRichTextEditor();
                                    }
                                    observer.disconnect();
                                }
                            });
                        });
                        observer.observe(descriptionTextarea);
                    }
                }
                
                // ä¼˜åŒ–å›¾ç‰‡åŠ è½½
                function optimizeImageLoading() {
                    // ä¸ºå›¾ç‰‡æ·»åŠ æ‡’åŠ è½½å±æ€§
                    const images = document.querySelectorAll('img');
                    images.forEach(img => {
                        if (!img.src) {
                            img.src = img.dataset.src;
                        }
                        img.loading = 'lazy';
                    });
                }
                
                // å‡å°‘åˆå§‹JavaScriptæ‰§è¡Œæ—¶é—´
                function optimizeJSExecution() {
                    // å°†éå…³é”®åˆå§‹åŒ–å‡½æ•°å»¶è¿Ÿæ‰§è¡Œ
                    setTimeout(() => {
                        // åˆå§‹åŒ–éå…³é”®åŠŸèƒ½
                        console.log('éå…³é”®åŠŸèƒ½å·²åˆå§‹åŒ–');
                    }, 2000);
                }
                
                // æ‰§è¡Œæ€§èƒ½ä¼˜åŒ–
                lazyLoadResources();
                optimizeImageLoading();
                optimizeJSExecution();
            }
            
            // åˆå§‹åŒ–ä¸€é”®ç”ŸæˆæŠ¥å‘ŠåŠŸèƒ½
            initReportGeneration();
            
            // åˆå§‹åŒ–æ‹–æ‹½ä¸Šä¼ åŠŸèƒ½
            initDragDropUpload();
            
            // åˆå§‹åŒ–è‡ªåŠ¨ä¿å­˜åŠŸèƒ½
            initAutoSave();
            
            // åˆå§‹åŒ–å¿«æ·é”®æ”¯æŒåŠŸèƒ½
            function initKeyboardShortcuts() {
                // å¿«æ·é”®æ˜ å°„
                const shortcuts = {
                    'Ctrl+S': () => {
                        // ä¿å­˜é¡¹ç›®
                        const saveBtn = document.querySelector('.nav-right .btn:nth-child(3)');
                        if (saveBtn) {
                            saveBtn.click();
                        }
                    },
                    'Ctrl+F': () => {
                        // èšç„¦æœç´¢æ¡†
                        const searchInput = document.getElementById('search-input');
                        if (searchInput) {
                            searchInput.focus();
                        }
                    },
                    'Ctrl+N': () => {
                        // æ–°å»ºé¡¹ç›®ï¼ˆæ¨¡æ‹Ÿï¼‰
                        alert('æ–°å»ºé¡¹ç›®åŠŸèƒ½å·²è§¦å‘');
                    },
                    'Ctrl+E': () => {
                        // å¯¼å‡ºæŠ¥å‘Š
                        const exportBtn = document.querySelector('.nav-right .btn:nth-child(1)');
                        if (exportBtn) {
                            exportBtn.click();
                        }
                    },
                    'Ctrl+I': () => {
                        // å¯¼å…¥æ•°æ®
                        const importBtn = document.querySelector('.nav-right .btn:nth-child(2)');
                        if (importBtn) {
                            importBtn.click();
                        }
                    },
                    'Ctrl+R': () => {
                        // AIæ™ºèƒ½ä¼°ä»·
                        const aiValuationBtn = document.getElementById('ai-valuation-btn');
                        if (aiValuationBtn) {
                            aiValuationBtn.click();
                        }
                    },
                    'Ctrl+G': () => {
                        // ç”ŸæˆæŠ¥å‘Š
                        const generateReportBtn = document.getElementById('generate-report-btn');
                        if (generateReportBtn) {
                            generateReportBtn.click();
                        }
                    },
                    'Tab': (e) => {
                        // è‡ªå®šä¹‰Tabé”®è¡Œä¸ºï¼ˆå¦‚æœéœ€è¦ï¼‰
                        // è¿™é‡Œå¯ä»¥æ·»åŠ è‡ªå®šä¹‰Tabé”®å¤„ç†é€»è¾‘
                    },
                    'Esc': (e) => {
                        // å…³é—­æ¨¡æ€æ¡†æˆ–å¼¹çª—
                        const modals = document.querySelectorAll('.modal');
                        modals.forEach(modal => {
                            if (modal.style.display !== 'none') {
                                modal.style.display = 'none';
                            }
                        });
                    }
                };
                
                // ç›‘å¬é”®ç›˜äº‹ä»¶
                document.addEventListener('keydown', function(e) {
                    // æ„å»ºå¿«æ·é”®ç»„åˆå­—ç¬¦ä¸²
                    let keyCombo = '';
                    if (e.ctrlKey) keyCombo += 'Ctrl+';
                    if (e.shiftKey) keyCombo += 'Shift+';
                    if (e.altKey) keyCombo += 'Alt+';
                    keyCombo += e.key.toUpperCase();
                    
                    // æ‰§è¡Œå¯¹åº”çš„å¿«æ·é”®åŠŸèƒ½
                    if (shortcuts[keyCombo]) {
                        e.preventDefault();
                        shortcuts[keyCombo](e);
                    }
                });
                
                // æ˜¾ç¤ºå¿«æ·é”®æç¤º
                function showShortcutsHelp() {
                    const shortcutsHelp = document.createElement('div');
                    shortcutsHelp.style.cssText = `
                        position: fixed;
                        top: 50%;
                        left: 50%;
                        transform: translate(-50%, -50%);
                        background: white;
                        padding: 20px;
                        border-radius: 8px;
                        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
                        z-index: 10000;
                        max-width: 80%;
                        max-height: 80vh;
                        overflow-y: auto;
                    `;
                    
                    const shortcutsList = document.createElement('div');
                    shortcutsList.innerHTML = `
                        <h2 style="margin-top: 0; color: #333;">å¿«æ·é”®å¸®åŠ©</h2>
                        <table style="border-collapse: collapse; width: 100%; margin-top: 15px;">
                            <tr>
                                <th style="text-align: left; padding: 8px; border-bottom: 1px solid #e0e0e0;">å¿«æ·é”®</th>
                                <th style="text-align: left; padding: 8px; border-bottom: 1px solid #e0e0e0;">åŠŸèƒ½</th>
                            </tr>
                            <tr>
                                <td style="padding: 8px; border-bottom: 1px solid #f0f0f0;">Ctrl+S</td>
                                <td style="padding: 8px; border-bottom: 1px solid #f0f0f0;">ä¿å­˜é¡¹ç›®</td>
                            </tr>
                            <tr>
                                <td style="padding: 8px; border-bottom: 1px solid #f0f0f0;">Ctrl+F</td>
                                <td style="padding: 8px; border-bottom: 1px solid #f0f0f0;">èšç„¦æœç´¢æ¡†</td>
                            </tr>
                            <tr>
                                <td style="padding: 8px; border-bottom: 1px solid #f0f0f0;">Ctrl+N</td>
                                <td style="padding: 8px; border-bottom: 1px solid #f0f0f0;">æ–°å»ºé¡¹ç›®</td>
                            </tr>
                            <tr>
                                <td style="padding: 8px; border-bottom: 1px solid #f0f0f0;">Ctrl+E</td>
                                <td style="padding: 8px; border-bottom: 1px solid #f0f0f0;">å¯¼å‡ºæŠ¥å‘Š</td>
                            </tr>
                            <tr>
                                <td style="padding: 8px; border-bottom: 1px solid #f0f0f0;">Ctrl+I</td>
                                <td style="padding: 8px; border-bottom: 1px solid #f0f0f0;">å¯¼å…¥æ•°æ®</td>
                            </tr>
                            <tr>
                                <td style="padding: 8px; border-bottom: 1px solid #f0f0f0;">Ctrl+R</td>
                                <td style="padding: 8px; border-bottom: 1px solid #f0f0f0;">AIæ™ºèƒ½ä¼°ä»·</td>
                            </tr>
                            <tr>
                                <td style="padding: 8px; border-bottom: 1px solid #f0f0f0;">Ctrl+G</td>
                                <td style="padding: 8px; border-bottom: 1px solid #f0f0f0;">ç”ŸæˆæŠ¥å‘Š</td>
                            </tr>
                            <tr>
                                <td style="padding: 8px; border-bottom: 1px solid #f0f0f0;">Esc</td>
                                <td style="padding: 8px; border-bottom: 1px solid #f0f0f0;">å…³é—­æ¨¡æ€æ¡†</td>
                            </tr>
                        </table>
                        <div style="margin-top: 20px; text-align: center;">
                            <button id="close-shortcuts" style="padding: 8px 16px; background: #667eea; color: white; border: none; border-radius: 4px; cursor: pointer;">å…³é—­</button>
                        </div>
                    `;
                    
                    shortcutsHelp.appendChild(shortcutsList);
                    document.body.appendChild(shortcutsHelp);
                    
                    // å…³é—­å¿«æ·é”®å¸®åŠ©
                    document.getElementById('close-shortcuts').addEventListener('click', () => {
                        document.body.removeChild(shortcutsHelp);
                    });
                }
                
                // æ·»åŠ å¿«æ·é”®å¸®åŠ©æŒ‰é’®
                const shortcutsHelpBtn = document.createElement('button');
                shortcutsHelpBtn.style.cssText = `
                    position: fixed;
                    bottom: 20px;
                    left: 20px;
                    padding: 8px 16px;
                    background: #667eea;
                    color: white;
                    border: none;
                    border-radius: 4px;
                    cursor: pointer;
                    font-size: 12px;
                    z-index: 9999;
                `;
                shortcutsHelpBtn.textContent = 'âŒ¨ï¸ å¿«æ·é”®';
                shortcutsHelpBtn.addEventListener('click', showShortcutsHelp);
                document.body.appendChild(shortcutsHelpBtn);
            }
            
            // åˆå§‹åŒ–æ€§èƒ½ä¼˜åŒ–
            initPerformanceOptimization();
            
            // åˆå§‹åŒ–è§†å›¾æ¨¡å¼åŠŸèƒ½ï¼ˆå…¨å±ã€æš—è‰²ã€ä¸“æ³¨ï¼‰
            function initViewModes() {
                // å…¨å±æ¨¡å¼åŠŸèƒ½
                function toggleFullscreen() {
                    if (!document.fullscreenElement) {
                        document.documentElement.requestFullscreen().catch(err => {
                            alert(`å…¨å±è¯·æ±‚å¤±è´¥: ${err.message}`);
                        });
                    } else {
                        if (document.exitFullscreen) {
                            document.exitFullscreen();
                        }
                    }
                }
                
                // æš—è‰²æ¨¡å¼åŠŸèƒ½
                function toggleDarkMode() {
                    document.body.classList.toggle('dark-mode');
                    
                    // ä¿å­˜æš—è‰²æ¨¡å¼çŠ¶æ€åˆ°localStorage
                    const isDarkMode = document.body.classList.contains('dark-mode');
                    localStorage.setItem('darkModeEnabled', JSON.stringify(isDarkMode));
                }
                
                // ä¸“æ³¨æ¨¡å¼åŠŸèƒ½
                function toggleFocusMode() {
                    document.body.classList.toggle('focus-mode');
                    
                    // ä¿å­˜ä¸“æ³¨æ¨¡å¼çŠ¶æ€åˆ°localStorage
                    const isFocusMode = document.body.classList.contains('focus-mode');
                    localStorage.setItem('focusModeEnabled', JSON.stringify(isFocusMode));
                }
                
                // æ¢å¤ä¿å­˜çš„è§†å›¾æ¨¡å¼
                function restoreViewModes() {
                    // æ¢å¤æš—è‰²æ¨¡å¼
                    const darkModeEnabled = JSON.parse(localStorage.getItem('darkModeEnabled')) || false;
                    if (darkModeEnabled) {
                        document.body.classList.add('dark-mode');
                    }
                    
                    // æ¢å¤ä¸“æ³¨æ¨¡å¼
                    const focusModeEnabled = JSON.parse(localStorage.getItem('focusModeEnabled')) || false;
                    if (focusModeEnabled) {
                        document.body.classList.add('focus-mode');
                    }
                }
                
                // æ·»åŠ è§†å›¾æ¨¡å¼åˆ‡æ¢æŒ‰é’®åˆ°é¡¶éƒ¨å¯¼èˆª
                const viewModesContainer = document.createElement('div');
                viewModesContainer.style.cssText = `
                    display: flex;
                    gap: 8px;
                    margin-right: 20px;
                `;
                
                // å…¨å±æ¨¡å¼æŒ‰é’®
                const fullscreenBtn = document.createElement('button');
                fullscreenBtn.className = 'btn';
                fullscreenBtn.innerHTML = 'â›¶ å…¨å±';
                fullscreenBtn.addEventListener('click', toggleFullscreen);
                
                // æš—è‰²æ¨¡å¼æŒ‰é’®
                const darkModeBtn = document.createElement('button');
                darkModeBtn.className = 'btn';
                darkModeBtn.innerHTML = 'ğŸŒ™ æš—è‰²';
                darkModeBtn.addEventListener('click', toggleDarkMode);
                
                // ä¸“æ³¨æ¨¡å¼æŒ‰é’®
                const focusModeBtn = document.createElement('button');
                focusModeBtn.className = 'btn';
                focusModeBtn.innerHTML = 'ğŸ¯ ä¸“æ³¨';
                focusModeBtn.addEventListener('click', toggleFocusMode);
                
                // æ·»åŠ åˆ°é¡¶éƒ¨å¯¼èˆªå³ä¾§
                viewModesContainer.appendChild(fullscreenBtn);
                viewModesContainer.appendChild(darkModeBtn);
                viewModesContainer.appendChild(focusModeBtn);
                
                const navRight = document.querySelector('.nav-right');
                if (navRight) {
                    navRight.insertBefore(viewModesContainer, navRight.firstChild);
                }
                
                // æ·»åŠ æš—è‰²æ¨¡å¼CSS
                const darkModeStyles = document.createElement('style');
                darkModeStyles.textContent = `
                    /* æš—è‰²æ¨¡å¼æ ·å¼ */
                    body.dark-mode {
                        background-color: #1a1a1a;
                        color: #e0e0e0;
                    }
                    
                    body.dark-mode .sidebar,
                    body.dark-mode .top-nav,
                    body.dark-mode .file-manager,
                    body.dark-mode .editor-header,
                    body.dark-mode .valuation-form,
                    body.dark-mode .result-card,
                    body.dark-mode .right-sidebar,
                    body.dark-mode .form-section,
                    body.dark-mode .market-analysis,
                    body.dark-mode .case-library,
                    body.dark-mode .investment-analysis,
                    body.dark-mode .system-settings,
                    body.dark-mode .tool-content,
                    body.dark-mode .setting-content {
                        background-color: #2d2d2d;
                        border-color: #404040;
                    }
                    
                    body.dark-mode .sidebar-menu .menu-item:hover {
                        background-color: #3a3a3a;
                    }
                    
                    body.dark-mode .form-group input,
                    body.dark-mode .form-group select,
                    body.dark-mode .form-group textarea {
                        background-color: #404040;
                        border-color: #555;
                        color: #e0e0e0;
                    }
                    
                    body.dark-mode .form-group input:focus,
                    body.dark-mode .form-group select:focus,
                    body.dark-mode .form-group textarea:focus {
                        border-color: #667eea;
                        box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.2);
                    }
                    
                    body.dark-mode .file-item {
                        background-color: #3a3a3a;
                        border-color: #404040;
                    }
                    
                    body.dark-mode .file-item:hover {
                        border-color: #667eea;
                    }
                    
                    body.dark-mode .file-item.active {
                        background-color: #3a3e5a;
                        border-color: #667eea;
                    }
                    
                    body.dark-mode .tab {
                        background-color: #3a3a3a;
                        border-color: #404040;
                        color: #e0e0e0;
                    }
                    
                    body.dark-mode .tab.active {
                        background-color: #3a3e5a;
                        border-color: #667eea;
                        color: #667eea;
                    }
                    
                    body.dark-mode .result-label {
                        color: #b0b0b0;
                    }
                    
                    body.dark-mode .result-value {
                        color: #e0e0e0;
                    }
                    
                    body.dark-mode #drag-drop-area {
                        background-color: #3a3a3a;
                        border-color: #667eea;
                    }
                    
                    body.dark-mode #drag-drop-area:hover {
                        background-color: #404040;
                    }
                    
                    /* æš—è‰²æ¨¡å¼ä¸‹çš„å›¾è¡¨æ ·å¼ */
                    body.dark-mode .chart-container canvas {
                        filter: invert(0.9) hue-rotate(180deg);
                    }
                `;
                document.head.appendChild(darkModeStyles);
                
                // æ·»åŠ ä¸“æ³¨æ¨¡å¼CSS
                const focusModeStyles = document.createElement('style');
                focusModeStyles.textContent = `
                    /* ä¸“æ³¨æ¨¡å¼æ ·å¼ */
                    body.focus-mode .sidebar {
                        transform: translateX(-100%);
                        width: 0;
                    }
                    
                    body.focus-mode .main-content {
                        width: 100%;
                    }
                    
                    body.focus-mode .file-manager {
                        transform: translateX(-100%);
                        width: 0;
                        overflow: hidden;
                    }
                    
                    body.focus-mode .right-sidebar {
                        transform: translateX(100%);
                        width: 0;
                        overflow: hidden;
                    }
                    
                    body.focus-mode .workspace {
                        justify-content: center;
                    }
                    
                    body.focus-mode .editor-area {
                        flex: 1;
                        max-width: 1200px;
                        margin: 0 auto;
                    }
                `;
                document.head.appendChild(focusModeStyles);
                
                // æ¢å¤ä¿å­˜çš„è§†å›¾æ¨¡å¼
                restoreViewModes();
                
                // æ·»åŠ å¿«æ·é”®æ”¯æŒ
                document.addEventListener('keydown', function(e) {
                    // Ctrl+Shift+F åˆ‡æ¢å…¨å±æ¨¡å¼
                    if (e.ctrlKey && e.shiftKey && e.key.toLowerCase() === 'f') {
                        e.preventDefault();
                        toggleFullscreen();
                    }
                    
                    // Ctrl+Shift+D åˆ‡æ¢æš—è‰²æ¨¡å¼
                    if (e.ctrlKey && e.shiftKey && e.key.toLowerCase() === 'd') {
                        e.preventDefault();
                        toggleDarkMode();
                    }
                    
                    // Ctrl+Shift+K åˆ‡æ¢ä¸“æ³¨æ¨¡å¼
                    if (e.ctrlKey && e.shiftKey && e.key.toLowerCase() === 'k') {
                        e.preventDefault();
                        toggleFocusMode();
                    }
                });
            }
            
            // åˆå§‹åŒ–å¿«æ·é”®æ”¯æŒ
            initKeyboardShortcuts();
            
            // åˆå§‹åŒ–è§†å›¾æ¨¡å¼åŠŸèƒ½
            initViewModes();

            // é¡¶éƒ¨å¯¼èˆªæ æŒ‰é’®åŠŸèƒ½
            const exportBtn = document.querySelector('.nav-right .btn:nth-child(1)');
            const importBtn = document.querySelector('.nav-right .btn:nth-child(2)');
            const saveBtn = document.querySelector('.nav-right .btn:nth-child(3)');
            
            // æ¨¡æ€æ¡†å…ƒç´ 
            const exportModal = document.getElementById('export-modal');
            const importModal = document.getElementById('import-modal');
            const saveModal = document.getElementById('save-modal');
            
            // å¯¼å‡ºæŠ¥å‘ŠåŠŸèƒ½
            exportBtn.addEventListener('click', function() {
                // æ˜¾ç¤ºå¯¼å‡ºæŠ¥å‘Šæ¨¡æ€æ¡†
                alert('å¯¼å‡ºæŠ¥å‘ŠåŠŸèƒ½å·²è§¦å‘');
            });
            
            // å¯¼å…¥æ•°æ®åŠŸèƒ½
            importBtn.addEventListener('click', function() {
                // è§¦å‘Excelå¯¼å…¥
                document.getElementById('excel-file-input').click();
            });
            
            // ä¿å­˜é¡¹ç›®åŠŸèƒ½
            saveBtn.addEventListener('click', function() {
                alert('é¡¹ç›®å·²ä¿å­˜');
            });
            
            // åˆå§‹åŒ–å³ä¾§è¾…åŠ©é¢æ¿æ ‡ç­¾é¡µåˆ‡æ¢åŠŸèƒ½
            const sidebarTabs = document.querySelectorAll('.sidebar-tab');
            const sidebarPanels = document.querySelectorAll('.sidebar-panel');
            
            sidebarTabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    // ç§»é™¤æ‰€æœ‰æ ‡ç­¾é¡µçš„activeç±»
                    sidebarTabs.forEach(t => t.classList.remove('active'));
                    // ç§»é™¤æ‰€æœ‰é¢æ¿çš„activeç±»å¹¶éšè—
                    sidebarPanels.forEach(panel => {
                        panel.classList.remove('active');
                        panel.style.display = 'none';
                    });
                    
                    // æ·»åŠ å½“å‰æ ‡ç­¾é¡µçš„activeç±»
                    this.classList.add('active');
                    
                    // æ˜¾ç¤ºå¯¹åº”çš„é¢æ¿
                    const tabName = this.dataset.tab;
                    const targetPanel = document.getElementById(tabName);
                    if (targetPanel) {
                        targetPanel.classList.add('active');
                        targetPanel.style.display = 'flex';
                    }
                });
            });
            
            // åˆå§‹åŒ–å³ä¾§è¾…åŠ©é¢æ¿AIåŠ©æ‰‹èŠå¤©åŠŸèƒ½
            const rightSidebarAiSendBtn = document.querySelector('.right-sidebar .ai-input-area button');
            const rightSidebarAiInput = document.querySelector('.right-sidebar .ai-input-area input');
            const rightSidebarAiChat = document.querySelector('.right-sidebar .ai-chat');
            
            rightSidebarAiSendBtn.addEventListener('click', function() {
                const message = rightSidebarAiInput.value.trim();
                if (message) {
                    // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯
                    const userMessage = document.createElement('div');
                    userMessage.className = 'chat-message user';
                    userMessage.textContent = message;
                    rightSidebarAiChat.appendChild(userMessage);
                    
                    // æ¸…ç©ºè¾“å…¥æ¡†
                    rightSidebarAiInput.value = '';
                    
                    // æ»šåŠ¨åˆ°åº•éƒ¨
                    rightSidebarAiChat.scrollTop = rightSidebarAiChat.scrollHeight;
                    
                    // æ¨¡æ‹ŸAIå›å¤
                    setTimeout(() => {
                        const aiMessage = document.createElement('div');
                        aiMessage.className = 'chat-message ai';
                        aiMessage.textContent = 'æ­£åœ¨ä¸ºæ‚¨åˆ†æ...';
                        rightSidebarAiChat.appendChild(aiMessage);
                        rightSidebarAiChat.scrollTop = rightSidebarAiChat.scrollHeight;
                    }, 500);
                }
            });
            
            // å›è½¦é”®å‘é€æ¶ˆæ¯
            rightSidebarAiInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    rightSidebarAiSendBtn.click();
                }
            });
            
            // æ“ä½œå†å²è®°å½•ç±»
            class OperationHistory {
                constructor() {
                    this.history = []; // æ“ä½œè®°å½•æ•°ç»„
                    this.currentIndex = -1; // å½“å‰æ“ä½œç´¢å¼•
                }
                
                // æ·»åŠ æ–°æ“ä½œ
                pushOperation(operation) {
                    // æˆªæ–­å½“å‰ç´¢å¼•åçš„è®°å½•
                    this.history = this.history.slice(0, this.currentIndex + 1);
                    // å­˜å…¥æ–°æ“ä½œ
                    this.history.push(operation);
                    // æ›´æ–°å½“å‰ç´¢å¼•
                    this.currentIndex = this.history.length - 1;
                    // æ›´æ–°æŒ‰é’®çŠ¶æ€
                    this.updateButtonStatus();
                }
                
                // æ’¤é”€æ“ä½œ
                undo() {
                    if (this.currentIndex >= 0) {
                        const operation = this.history[this.currentIndex];
                        this.currentIndex--;
                        this.updateButtonStatus();
                        return operation;
                    }
                    return null;
                }
                
                // æ¢å¤æ“ä½œ
                redo() {
                    if (this.currentIndex < this.history.length - 1) {
                        this.currentIndex++;
                        const operation = this.history[this.currentIndex];
                        this.updateButtonStatus();
                        return operation;
                    }
                    return null;
                }
                
                // æ›´æ–°æŒ‰é’®çŠ¶æ€
                updateButtonStatus() {
                    const undoBtn = document.getElementById('undo-btn');
                    const redoBtn = document.getElementById('redo-btn');
                    const eraseSelectedBtn = document.getElementById('erase-selected-btn');
                    
                    if (undoBtn) {
                        undoBtn.disabled = this.currentIndex < 0;
                    }
                    if (redoBtn) {
                        redoBtn.disabled = this.currentIndex >= this.history.length - 1;
                    }
                    if (eraseSelectedBtn) {
                        // æ£€æŸ¥æ˜¯å¦æœ‰é€‰ä¸­çš„é¡¹ç›®
                        const selectedItems = document.querySelectorAll('.file-item.selected');
                        eraseSelectedBtn.disabled = selectedItems.length === 0;
                    }
                }
            }
            
            // åˆ›å»ºæ“ä½œå†å²å®ä¾‹
            const operationHistory = new OperationHistory();
            
            // åˆå§‹åŒ–è§†å›¾æ¨¡å¼åˆ‡æ¢åŠŸèƒ½
            function initViewModes() {
                // ç´§å‡‘æ¨¡å¼åˆ‡æ¢
                // æ¨¡å¼ç®¡ç†åŠŸèƒ½
                const modeManager = {
                    // ä¿å­˜æ¨¡å¼åå¥½åˆ°localStorage
                    saveModePreferences: function() {
                        const preferences = {
                            compactMode: document.body.classList.contains('compact-mode'),
                            darkMode: document.body.classList.contains('dark-mode'),
                            focusMode: document.body.classList.contains('focus-mode')
                        };
                        localStorage.setItem('valuationModePreferences', JSON.stringify(preferences));
                    },
                    
                    // ä»localStorageåŠ è½½æ¨¡å¼åå¥½
                    loadModePreferences: function() {
                        const preferences = JSON.parse(localStorage.getItem('valuationModePreferences')) || {};
                        
                        if (preferences.compactMode) {
                            document.body.classList.add('compact-mode');
                            document.getElementById('compact-mode-btn')?.classList.add('active');
                        } else {
                            document.body.classList.add('comfortable-mode');
                            document.getElementById('comfortable-mode-btn')?.classList.add('active');
                        }
                        
                        if (preferences.darkMode) {
                            document.body.classList.add('dark-mode');
                            document.getElementById('dark-mode-btn')?.classList.add('active');
                        }
                        
                        if (preferences.focusMode) {
                            document.body.classList.add('focus-mode');
                            document.getElementById('focus-mode-btn')?.classList.add('active');
                        }
                    },
                    
                    // åº”ç”¨è¿‡æ¸¡æ•ˆæœ
                    applyTransition: function(element, className, duration = 300) {
                        element.style.transition = `all ${duration}ms ease`;
                        element.classList.toggle(className);
                        setTimeout(() => {
                            element.style.transition = '';
                        }, duration);
                    }
                };
                
                // åŠ è½½æ¨¡å¼åå¥½
                modeManager.loadModePreferences();
                
                // ç´§å‡‘æ¨¡å¼åˆ‡æ¢
                document.getElementById('compact-mode-btn')?.addEventListener('click', function() {
                    modeManager.applyTransition(document.body, 'compact-mode');
                    modeManager.applyTransition(document.body, 'comfortable-mode');
                    this.classList.add('active');
                    document.getElementById('comfortable-mode-btn')?.classList.remove('active');
                    modeManager.saveModePreferences();
                });
                
                // èˆ’é€‚æ¨¡å¼åˆ‡æ¢
                document.getElementById('comfortable-mode-btn')?.addEventListener('click', function() {
                    modeManager.applyTransition(document.body, 'comfortable-mode');
                    modeManager.applyTransition(document.body, 'compact-mode');
                    this.classList.add('active');
                    document.getElementById('compact-mode-btn')?.classList.remove('active');
                    modeManager.saveModePreferences();
                });
                
                // æš—è‰²æ¨¡å¼åˆ‡æ¢
                document.getElementById('dark-mode-btn')?.addEventListener('click', function() {
                    modeManager.applyTransition(document.body, 'dark-mode', 500);
                    this.classList.toggle('active');
                    modeManager.saveModePreferences();
                });
                
                // ä¸“æ³¨æ¨¡å¼åˆ‡æ¢
                document.getElementById('focus-mode-btn')?.addEventListener('click', function() {
                    modeManager.applyTransition(document.body, 'focus-mode', 300);
                    this.classList.toggle('active');
                    modeManager.saveModePreferences();
                });
                
                // å…¨å±æ¨¡å¼åˆ‡æ¢
                document.getElementById('fullscreen-btn')?.addEventListener('click', function() {
                    this.classList.toggle('active');
                    
                    if (document.fullscreenElement) {
                        document.exitFullscreen();
                        modeManager.applyTransition(document.body, 'fullscreen-mode');
                    } else {
                        document.documentElement.requestFullscreen();
                        modeManager.applyTransition(document.body, 'fullscreen-mode');
                    }
                });
                
                // ç›‘å¬å…¨å±å˜åŒ–äº‹ä»¶
                document.addEventListener('fullscreenchange', function() {
                    const fullscreenBtn = document.getElementById('fullscreen-btn');
                    if (document.fullscreenElement) {
                        fullscreenBtn?.classList.add('active');
                        document.body.classList.add('fullscreen-mode');
                    } else {
                        fullscreenBtn?.classList.remove('active');
                        document.body.classList.remove('fullscreen-mode');
                    }
                });
                
                // ç›‘å¬ESCé”®é€€å‡ºå…¨å±
                document.addEventListener('keydown', function(e) {
                    if (e.key === 'Escape' && document.fullscreenElement) {
                        document.body.classList.remove('fullscreen-mode');
                    }
                });
            }
            
            // åˆå§‹åŒ–å¿«æ·é”®æ”¯æŒ
            function initKeyboardShortcuts() {
                document.addEventListener('keydown', function(e) {
                    // Ctrl+S ä¿å­˜é¡¹ç›®
                    if (e.ctrlKey && e.key === 's') {
                        e.preventDefault();
                        document.getElementById('save-project-btn')?.click();
                    }
                    
                    // Ctrl+F æœç´¢
                    if (e.ctrlKey && e.key === 'f') {
                        e.preventDefault();
                        const searchInput = document.getElementById('search-input');
                        if (searchInput) {
                            searchInput.focus();
                        }
                    }
                    
                    // Ctrl+E å¯¼å‡ºæŠ¥å‘Š
                    if (e.ctrlKey && e.key === 'e') {
                        e.preventDefault();
                        document.getElementById('export-report-btn')?.click();
                    }
                    
                    // Ctrl+I å¯¼å…¥æ•°æ®
                    if (e.ctrlKey && e.key === 'i') {
                        e.preventDefault();
                        document.getElementById('import-data-btn')?.click();
                    }
                    
                    // Ctrl+N æ–°å»ºé¡¹ç›®
                    if (e.ctrlKey && e.key === 'n') {
                        e.preventDefault();
                        document.getElementById('new-project-btn')?.click();
                    }
                    
                    // Ctrl+Z æ’¤é”€
                    if (e.ctrlKey && e.key === 'z') {
                        e.preventDefault();
                        operationHistory.undo();
                    }
                    
                    // Ctrl+Y é‡åš
                    if (e.ctrlKey && e.key === 'y') {
                        e.preventDefault();
                        operationHistory.redo();
                    }
                    
                    // F11 å…¨å±æ¨¡å¼
                    if (e.key === 'F11') {
                        e.preventDefault();
                        document.getElementById('fullscreen-btn')?.click();
                    }
                    
                    // Ctrl+Shift+D æš—è‰²æ¨¡å¼
                    if (e.ctrlKey && e.shiftKey && e.key === 'D') {
                        e.preventDefault();
                        document.getElementById('dark-mode-btn')?.click();
                    }
                    
                    // Ctrl+Shift+F ä¸“æ³¨æ¨¡å¼
                    if (e.ctrlKey && e.shiftKey && e.key === 'F') {
                        e.preventDefault();
                        document.getElementById('focus-mode-btn')?.click();
                    }
                });
            }
            
            // åˆå§‹åŒ–æ‹–æ‹½ä¸Šä¼ åŠŸèƒ½
            function initDragDropUpload() {
                const dropZone = document.getElementById('drop-zone');
                const fileSelectBtn = document.getElementById('file-select-btn');
                const imageInput = document.getElementById('image-input');
                const uploadedFilesContainer = document.getElementById('uploaded-files');
                
                if (!dropZone || !fileSelectBtn || !imageInput || !uploadedFilesContainer) {
                    return;
                }
                
                // å­˜å‚¨å·²ä¸Šä¼ çš„æ–‡ä»¶
                let uploadedFiles = [];
                
                // é˜»æ­¢é»˜è®¤çš„æ‹–æ‹½è¡Œä¸º
                ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                    dropZone.addEventListener(eventName, preventDefaults, false);
                    document.body.addEventListener(eventName, preventDefaults, false);
                });
                
                function preventDefaults(e) {
                    e.preventDefault();
                    e.stopPropagation();
                }
                
                // é«˜äº®æ‹–æ‹½åŒºåŸŸ
                ['dragenter', 'dragover'].forEach(eventName => {
                    dropZone.addEventListener(eventName, highlight, false);
                });
                
                ['dragleave', 'drop'].forEach(eventName => {
                    dropZone.addEventListener(eventName, unhighlight, false);
                });
                
                function highlight() {
                    dropZone.classList.add('drag-over');
                }
                
                function unhighlight() {
                    dropZone.classList.remove('drag-over');
                }
                
                // å¤„ç†æ–‡ä»¶æ”¾ç½®
                dropZone.addEventListener('drop', handleDrop, false);
                
                function handleDrop(e) {
                    const dt = e.dataTransfer;
                    const files = dt.files;
                    
                    handleFiles(files);
                }
                
                // å¤„ç†æ–‡ä»¶é€‰æ‹©
                fileSelectBtn.addEventListener('click', function() {
                    imageInput.click();
                });
                
                imageInput.addEventListener('change', function() {
                    handleFiles(this.files);
                });
                
                // å¤„ç†æ–‡ä»¶ä¸Šä¼ 
                function handleFiles(files) {
                    const fileArray = Array.from(files);
                    
                    fileArray.forEach(file => {
                        // éªŒè¯æ–‡ä»¶ç±»å‹
                        if (!validateFileType(file)) {
                            showToast('ä¸æ”¯æŒçš„æ–‡ä»¶ç±»å‹ï¼Œè¯·é€‰æ‹©å›¾ç‰‡æ–‡ä»¶', 'danger');
                            return;
                        }
                        
                        // éªŒè¯æ–‡ä»¶å¤§å°
                        if (!validateFileSize(file)) {
                            showToast('æ–‡ä»¶å¤§å°è¶…è¿‡é™åˆ¶ï¼Œå•æ–‡ä»¶ä¸èƒ½è¶…è¿‡ 5MB', 'danger');
                            return;
                        }
                        
                        // æ·»åŠ åˆ°å·²ä¸Šä¼ æ–‡ä»¶åˆ—è¡¨
                        uploadedFiles.push(file);
                        
                        // æ˜¾ç¤ºæ–‡ä»¶é¢„è§ˆ
                        showFilePreview(file);
                    });
                }
                
                // éªŒè¯æ–‡ä»¶ç±»å‹
                function validateFileType(file) {
                    const validTypes = ['image/jpeg', 'image/png', 'image/gif'];
                    return validTypes.includes(file.type);
                }
                
                // éªŒè¯æ–‡ä»¶å¤§å°ï¼ˆ5MBï¼‰
                function validateFileSize(file) {
                    const maxSize = 5 * 1024 * 1024; // 5MB
                    return file.size <= maxSize;
                }
                
                // æ˜¾ç¤ºæ–‡ä»¶é¢„è§ˆ
                function showFilePreview(file) {
                    const reader = new FileReader();
                    
                    reader.onload = function(e) {
                        const fileItem = document.createElement('div');
                        fileItem.className = 'uploaded-file-item';
                        fileItem.dataset.filename = file.name;
                        
                        fileItem.innerHTML = `
                            <img src="${e.target.result}" alt="${file.name}" class="uploaded-file-preview">
                            <div class="uploaded-file-info">${file.name}</div>
                            <button type="button" class="uploaded-file-remove" title="åˆ é™¤æ–‡ä»¶">Ã—</button>
                        `;
                        
                        // æ·»åŠ åˆ é™¤äº‹ä»¶
                        const removeBtn = fileItem.querySelector('.uploaded-file-remove');
                        removeBtn.addEventListener('click', function() {
                            removeFile(file.name, fileItem);
                        });
                        
                        // æ·»åŠ åˆ°ä¸Šä¼ æ–‡ä»¶åˆ—è¡¨
                        uploadedFilesContainer.appendChild(fileItem);
                    };
                    
                    reader.readAsDataURL(file);
                }
                
                // åˆ é™¤æ–‡ä»¶
                function removeFile(filename, fileElement) {
                    // ä»æ•°ç»„ä¸­ç§»é™¤æ–‡ä»¶
                    uploadedFiles = uploadedFiles.filter(file => file.name !== filename);
                    
                    // ä»DOMä¸­ç§»é™¤å…ƒç´ 
                    if (fileElement && fileElement.parentNode) {
                        fileElement.parentNode.removeChild(fileElement);
                    }
                    
                    showToast('æ–‡ä»¶å·²åˆ é™¤', 'success');
                }
                
                // æ¸…ç†å‡½æ•°
                return function cleanup() {
                    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                        dropZone.removeEventListener(eventName, preventDefaults, false);
                        document.body.removeEventListener(eventName, preventDefaults, false);
                        dropZone.removeEventListener(eventName, highlight, false);
                        dropZone.removeEventListener(eventName, unhighlight, false);
                    });
                    
                    dropZone.removeEventListener('drop', handleDrop, false);
                    fileSelectBtn.removeEventListener('click', function() {});
                    imageInput.removeEventListener('change', function() {});
                };
            }
            
            // åˆå§‹åŒ–è§†å›¾æ¨¡å¼
            initViewModes();
            
            // åˆå§‹åŒ–å¿«æ·é”®
            initKeyboardShortcuts();
            
            // åˆå§‹åŒ–æ‹–æ‹½ä¸Šä¼ åŠŸèƒ½
            initDragDropUpload();
            
            // åˆå§‹åŒ–å¯¼èˆªä¸é¢åŒ…å±‘
            function initNavigation() {
                // åŠ¨æ€é¢åŒ…å±‘å¯¼èˆªç®¡ç†
                const breadcrumbManager = {
                    // æ›´æ–°é¢åŒ…å±‘
                    update: function(path) {
                        const breadcrumb = document.getElementById('breadcrumb');
                        if (!breadcrumb) return;
                        
                        // æ„å»ºé¢åŒ…å±‘HTML
                        let breadcrumbHTML = '<a href="#" class="breadcrumb-item" data-path="home" style="color: #667eea; text-decoration: none; cursor: pointer;">é¦–é¡µ</a>';
                        
                        path.forEach((item, index) => {
                            if (index === path.length - 1) {
                                // å½“å‰é¡µé¢ï¼Œä¸å¯ç‚¹å‡»
                                breadcrumbHTML += `<span style="color: #999; margin: 0 4px;">></span><span style="color: #333;">${item.label}</span>`;
                            } else {
                                // å¯¼èˆªé¡¹ï¼Œå¯ç‚¹å‡»
                                breadcrumbHTML += `<span style="color: #999; margin: 0 4px;">></span><a href="#" class="breadcrumb-item" data-path="${item.path}" style="color: #667eea; text-decoration: none; cursor: pointer;">${item.label}</a>`;
                            }
                        });
                        
                        breadcrumb.innerHTML = breadcrumbHTML;
                        
                        // æ·»åŠ ç‚¹å‡»äº‹ä»¶
                        breadcrumb.querySelectorAll('.breadcrumb-item').forEach(item => {
                            item.addEventListener('click', function(e) {
                                e.preventDefault();
                                const path = this.getAttribute('data-path');
                                if (path === 'home') {
                                    // åˆ‡æ¢åˆ°é¦–é¡µ
                                    console.log('åˆ‡æ¢åˆ°é¦–é¡µ');
                                } else {
                                    // åˆ‡æ¢åˆ°æŒ‡å®šæ¨¡å—
                                    console.log('åˆ‡æ¢åˆ°æ¨¡å—:', path);
                                }
                            });
                        });
                    },
                    
                    // è®¾ç½®å½“å‰è·¯å¾„
                    setCurrentPath: function(clientType, module) {
                        const clientLabels = {
                            'public': 'å¤§ä¼—ç«¯',
                            'enterprise': 'ä¼ä¸šç«¯',
                            'government': 'æ”¿åºœç«¯',
                            'association': 'åä¼šç«¯',
                            'institution': 'é™¢æ ¡ç«¯'
                        };
                        
                        const moduleLabels = {
                            'ai-valuation': 'AIä¼°ä»·',
                            'market-analysis': 'å¸‚åœºåˆ†æ',
                            'case-library': 'æ¡ˆä¾‹åº“',
                            'investment-analysis': 'æŠ•èµ„åˆ†æ',
                            'system-settings': 'ç³»ç»Ÿè®¾ç½®'
                        };
                        
                        const path = [
                            { label: clientLabels[clientType] || 'æœªçŸ¥å®¢æˆ·ç«¯', path: clientType },
                            { label: moduleLabels[module] || 'æœªçŸ¥æ¨¡å—', path: module }
                        ];
                        
                        this.update(path);
                    }
                };
                
                // ç›‘å¬å®¢æˆ·ç«¯åˆ‡æ¢äº‹ä»¶
                document.querySelectorAll('.client-tab').forEach(tab => {
                    tab.addEventListener('click', function() {
                        const clientType = this.getAttribute('data-client');
                        const currentModule = document.querySelector('.module-content.active')?.id;
                        if (currentModule) {
                            breadcrumbManager.setCurrentPath(clientType, currentModule);
                        }
                    });
                });
                
                // ç›‘å¬æ¨¡å—åˆ‡æ¢äº‹ä»¶
                document.querySelectorAll('.menu-item').forEach(item => {
                    item.addEventListener('click', function() {
                        const module = this.getAttribute('data-module');
                        const currentClient = document.querySelector('.client-tab.active')?.getAttribute('data-client') || 'public';
                        if (module) {
                            breadcrumbManager.setCurrentPath(currentClient, module);
                        }
                    });
                });
                
                // åˆå§‹åŒ–é¢åŒ…å±‘
                const initialClient = document.querySelector('.client-tab.active')?.getAttribute('data-client') || 'public';
                const initialModule = document.querySelector('.module-content.active')?.id || 'ai-valuation';
                breadcrumbManager.setCurrentPath(initialClient, initialModule);
                
                // æš´éœ²é¢åŒ…å±‘ç®¡ç†å™¨
                window.breadcrumbManager = breadcrumbManager;
            }
            
            // è°ƒç”¨å¯¼èˆªåˆå§‹åŒ–
            initNavigation();
            
            // Toastæ¶ˆæ¯æç¤ºç³»ç»Ÿ
            function showToast(message, type = 'info') {
                // åˆ›å»ºtoastå…ƒç´ 
                const toast = document.createElement('div');
                toast.className = `toast fixed bottom-4 right-4 px-4 py-2 rounded-lg shadow-lg z-50 transition-all duration-300 ease-in-out transform translate-y-0 opacity-100`;
                
                // è®¾ç½®æ ·å¼
                switch(type) {
                    case 'success':
                        toast.style.backgroundColor = '#52c41a';
                        toast.style.color = 'white';
                        break;
                    case 'error':
                        toast.style.backgroundColor = '#f5222d';
                        toast.style.color = 'white';
                        break;
                    case 'warning':
                        toast.style.backgroundColor = '#faad14';
                        toast.style.color = 'white';
                        break;
                    default:
                        toast.style.backgroundColor = '#667eea';
                        toast.style.color = 'white';
                }
                
                // è®¾ç½®æ¶ˆæ¯å†…å®¹
                toast.textContent = message;
                
                // æ·»åŠ åˆ°é¡µé¢
                document.body.appendChild(toast);
                
                // 3ç§’åè‡ªåŠ¨ç§»é™¤
                setTimeout(() => {
                    toast.classList.remove('translate-y-0', 'opacity-100');
                    toast.classList.add('translate-y-4', 'opacity-0');
                    setTimeout(() => {
                        if (toast.parentNode) {
                            toast.parentNode.removeChild(toast);
                        }
                    }, 300);
                }, 2000);
            }
            
            // å•æ¡æ•°æ®æ“¦é™¤åŠŸèƒ½
            function deleteSingleItem(itemId, itemElement) {
                if (confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡è®°å½•å—ï¼Ÿ')) {
                    // ä¿å­˜æ“ä½œè®°å½•
                    const operation = {
                        type: 'deleteSingle',
                        itemId: itemId,
                        itemData: itemElement.outerHTML
                    };
                    operationHistory.pushOperation(operation);
                    
                    // åˆ é™¤DOMå…ƒç´ 
                    itemElement.remove();
                    
                    // æ˜¾ç¤ºæç¤º
                    showToast('å·²æˆåŠŸåˆ é™¤è®°å½•', 'success');
                }
            }
            
            // æ‰¹é‡æ•°æ®æ“¦é™¤åŠŸèƒ½
            function deleteSelectedItems() {
                const selectedItems = document.querySelectorAll('.file-item.selected');
                if (selectedItems.length === 0) {
                    showToast('è¯·å…ˆé€‰æ‹©è¦åˆ é™¤çš„è®°å½•', 'warning');
                    return;
                }
                
                if (confirm(`ç¡®å®šè¦åˆ é™¤é€‰ä¸­çš„ ${selectedItems.length} æ¡è®°å½•å—ï¼Ÿ`)) {
                    // ä¿å­˜æ“ä½œè®°å½•
                    const operation = {
                        type: 'deleteMultiple',
                        items: Array.from(selectedItems).map(item => ({
                            itemId: item.dataset.id,
                            itemData: item.outerHTML
                        }))
                    };
                    operationHistory.pushOperation(operation);
                    
                    // åˆ é™¤DOMå…ƒç´ 
                    selectedItems.forEach(item => item.remove());
                    
                    // æ˜¾ç¤ºæç¤º
                    showToast(`å·²æˆåŠŸåˆ é™¤ ${selectedItems.length} æ¡è®°å½•`, 'success');
                    
                    // æ›´æ–°æŒ‰é’®çŠ¶æ€
                    operationHistory.updateButtonStatus();
                }
            }
            
            // æ·»åŠ ç‚¹å‡»å†å²è®°å½•é¡¹çš„åŠŸèƒ½
            const historyItems = document.querySelectorAll('.sidebar-panel#history .file-item');
            historyItems.forEach(item => {
                item.addEventListener('click', function() {
                    // æ·»åŠ ç‚¹å‡»æ•ˆæœ
                    this.style.backgroundColor = '#e0e4ff';
                    setTimeout(() => {
                        this.style.backgroundColor = '#f8f9fa';
                    }, 200);
                    
                    // è¿™é‡Œå¯ä»¥æ·»åŠ åŠ è½½å†å²è®°å½•çš„åŠŸèƒ½
                    const historyTitle = this.querySelector('div').textContent;
                    console.log('åŠ è½½å†å²è®°å½•:', historyTitle);
                });
            });
            
            // åˆå§‹åŒ–å›é€€/æ¢å¤åŠŸèƒ½
            function initUndoRedo() {
                const undoBtn = document.getElementById('undo-btn');
                const redoBtn = document.getElementById('redo-btn');
                const eraseSelectedBtn = document.getElementById('erase-selected-btn');
                const clearTempBtn = document.getElementById('clear-temp-btn');
                
                // æ’¤é”€æ“ä½œ
                if (undoBtn) {
                    undoBtn.addEventListener('click', function() {
                        const operation = operationHistory.undo();
                        if (operation) {
                            // å¤„ç†æ’¤é”€é€»è¾‘
                            showToast('å·²æ’¤é”€ä¸Šä¸€æ­¥æ“ä½œ', 'info');
                        }
                    });
                }
                
                // æ¢å¤æ“ä½œ
                if (redoBtn) {
                    redoBtn.addEventListener('click', function() {
                        const operation = operationHistory.redo();
                        if (operation) {
                            // å¤„ç†æ¢å¤é€»è¾‘
                            showToast('å·²æ¢å¤æ“ä½œ', 'info');
                        }
                    });
                }
                
                // æ“¦é™¤é€‰ä¸­æ•°æ®
                if (eraseSelectedBtn) {
                    eraseSelectedBtn.addEventListener('click', deleteSelectedItems);
                }
                
                // æ¸…ç©ºä¸´æ—¶æ“ä½œ
                if (clearTempBtn) {
                    clearTempBtn.addEventListener('click', function() {
                        if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰ä¸´æ—¶æ“ä½œè®°å½•å—ï¼Ÿ')) {
                            operationHistory.history = [];
                            operationHistory.currentIndex = -1;
                            operationHistory.updateButtonStatus();
                            showToast('å·²æ¸…ç©ºä¸´æ—¶æ“ä½œè®°å½•', 'success');
                        }
                    });
                }
            }
            
            // åˆå§‹åŒ–å›é€€/æ¢å¤åŠŸèƒ½
            initUndoRedo();
        });
    </script>
    <!-- ä¼°ä»·åŠŸèƒ½ JavaScript -->
    <script>
        // è¡¨å•æäº¤å¤„ç†
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('valuation-form');
            const resultDiv = document.getElementById('valuation-result');
            const submitBtn = document.getElementById('submit-valuation');
            const resetBtn = document.getElementById('reset-valuation');
            const chartTabs = document.querySelectorAll('.chart-tab');
            
            // å›¾è¡¨é€‰é¡¹å¡åˆ‡æ¢
            chartTabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    // ç§»é™¤æ‰€æœ‰æ´»è·ƒçŠ¶æ€
                    chartTabs.forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.chart-panel').forEach(panel => {
                        panel.style.display = 'none';
                    });
                    
                    // æ·»åŠ å½“å‰æ´»è·ƒçŠ¶æ€
                    this.classList.add('active');
                    const chartType = this.getAttribute('data-chart');
                    document.getElementById(`${chartType}-container`).style.display = 'block';
                });
            });
            
            // è¡¨å•æäº¤äº‹ä»¶
            form.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                submitBtn.innerHTML = '<span style="display: inline-block; width: 16px; height: 16px; border: 2px solid rgba(255,255,255,0.3); border-radius: 50%; border-top-color: white; animation: spin 1s linear infinite;"></span> ä¼°ä»·ä¸­...';
                submitBtn.disabled = true;
                
                try {
                    // æ”¶é›†è¡¨å•æ•°æ®
                    const formData = {
                        area: parseFloat(document.getElementById('area').value),
                        rooms: parseInt(document.getElementById('rooms').value),
                        bathrooms: parseInt(document.getElementById('bathrooms').value),
                        floor_level: parseInt(document.getElementById('floor_level').value),
                        building_year: parseInt(document.getElementById('building_year').value),
                        property_type: document.getElementById('property_type').value,
                        orientation: document.getElementById('orientation').value,
                        decoration_status: document.getElementById('decoration_status').value,
                        model_type: document.getElementById('model_type').value
                    };
                    
                    // å‘é€è¯·æ±‚åˆ°åç«¯
                    const response = await fetch('http://localhost:3000/api/valuations', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            // è¿™é‡Œéœ€è¦æ·»åŠ è®¤è¯tokenï¼Œç›®å‰æ¨¡æ‹Ÿ
                            'Authorization': 'Bearer mock_token'
                        },
                        body: JSON.stringify({
                            property_id: 'mock_property_id', // å®é™…é¡¹ç›®ä¸­åº”è¯¥ä»æ•°æ®åº“è·å–
                            model_type: formData.model_type
                        })
                    });
                    
                    if (!response.ok) {
                        throw new Error('ä¼°ä»·å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
                    }
                    
                    const result = await response.json();
                    
                    // æ˜¾ç¤ºä¼°ä»·ç»“æœ
                    displayValuationResult(result.data, formData);
                    
                    // åˆ‡æ¢åˆ°ç»“æœè§†å›¾
                    form.style.display = 'none';
                    resultDiv.style.display = 'block';
                    
                } catch (error) {
                    console.error('ä¼°ä»·é”™è¯¯:', error);
                    alert('ä¼°ä»·å¤±è´¥: ' + error.message);
                } finally {
                    // æ¢å¤æŒ‰é’®çŠ¶æ€
                    submitBtn.innerHTML = 'ğŸš€ å¼€å§‹ä¼°ä»·';
                    submitBtn.disabled = false;
                }
            });
            
            // é‡ç½®æŒ‰é’®äº‹ä»¶
            resetBtn.addEventListener('click', function() {
                resultDiv.style.display = 'none';
                form.style.display = 'block';
                form.reset();
            });
            
            // æ˜¾ç¤ºä¼°ä»·ç»“æœ
            function displayValuationResult(result, formData) {
                // å¡«å……æ ¸å¿ƒä¼°ä»·ä¿¡æ¯
                document.getElementById('estimated-price').textContent = result.estimated_price.toLocaleString() + ' å…ƒ';
                document.getElementById('price-per-sqm').textContent = result.price_per_sqm.toLocaleString() + ' å…ƒ/ã¡';
                document.getElementById('confidence-level').textContent = (result.confidence_level * 100).toFixed(1) + '%';
                document.getElementById('used-model').textContent = {
                    'linear': 'çº¿æ€§å›å½’æ¨¡å‹',
                    'random_forest': 'éšæœºæ£®æ—æ¨¡å‹',
                    'ensemble': 'é›†æˆæ¨¡å‹'
                }[result.model_type] || result.model_type;
                document.getElementById('valuation-time').textContent = new Date().toLocaleString();
                
                // ç”Ÿæˆæ‰€æœ‰å›¾è¡¨
                generateFeatureImportanceChart(result);
                generateMarketTrendChart(result);
                generatePriceComparisonChart(result);
                generateValuationHistoryChart(result);
            }
            
            // ç”Ÿæˆç‰¹å¾é‡è¦æ€§å›¾è¡¨
            function generateFeatureImportanceChart(result) {
                const ctx = document.getElementById('feature-importance-chart').getContext('2d');
                const featureImportance = result.result_details?.feature_importance || {
                    area: 0.35,
                    property_type: 0.20,
                    building_year: 0.15,
                    floor_level: 0.10,
                    rooms: 0.08,
                    bathrooms: 0.06,
                    orientation: 0.03,
                    decoration_status: 0.03
                };
                
                const chartData = {
                    labels: Object.keys(featureImportance).map(key => {
                        const labelMap = {
                            area: 'é¢ç§¯',
                            property_type: 'ç‰©ä¸šç±»å‹',
                            building_year: 'å»ºç­‘å¹´ä»½',
                            floor_level: 'æ¥¼å±‚',
                            rooms: 'å®¤æ•°',
                            bathrooms: 'å…æ•°',
                            orientation: 'æœå‘',
                            decoration_status: 'è£…ä¿®çŠ¶å†µ'
                        };
                        return labelMap[key] || key;
                    }),
                    datasets: [{
                        label: 'ç‰¹å¾é‡è¦æ€§',
                        data: Object.values(featureImportance).map(val => val * 100),
                        backgroundColor: 'rgba(102, 126, 234, 0.6)',
                        borderColor: 'rgba(102, 126, 234, 1)',
                        borderWidth: 1
                    }]
                };
                
                new Chart(ctx, {
                    type: 'bar',
                    data: chartData,
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'é‡è¦æ€§ (%)'
                                }
                            },
                            x: {
                                title: {
                                    display: true,
                                    text: 'ç‰¹å¾'
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                display: false
                            }
                        }
                    }
                });
            }
            
            // ç”Ÿæˆå¸‚åœºè¶‹åŠ¿å¯¹æ¯”å›¾è¡¨
            function generateMarketTrendChart(result) {
                const ctx = document.getElementById('market-trend-chart').getContext('2d');
                
                // æ¨¡æ‹Ÿå¸‚åœºè¶‹åŠ¿æ•°æ®
                const months = ['1æœˆ', '2æœˆ', '3æœˆ', '4æœˆ', '5æœˆ', '6æœˆ', '7æœˆ', '8æœˆ', '9æœˆ', '10æœˆ', '11æœˆ', '12æœˆ'];
                const avgMarketPrice = [14000, 14200, 14500, 14300, 14800, 15000, 15200, 15300, 15500, 15600, 15800, 16000];
                const estimatedPrice = result.price_per_sqm;
                
                const chartData = {
                    labels: months,
                    datasets: [{
                        label: 'åŒºåŸŸå¹³å‡å•ä»·',
                        data: avgMarketPrice,
                        borderColor: 'rgba(102, 126, 234, 1)',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        tension: 0.4,
                        fill: true
                    }, {
                        label: 'å½“å‰ä¼°ä»·å•ä»·',
                        data: months.map(() => estimatedPrice),
                        borderColor: 'rgba(82, 196, 26, 1)',
                        backgroundColor: 'rgba(82, 196, 26, 0.1)',
                        borderDash: [5, 5],
                        fill: false
                    }]
                };
                
                new Chart(ctx, {
                    type: 'line',
                    data: chartData,
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: false,
                                title: {
                                    display: true,
                                    text: 'å•ä»· (å…ƒ/ã¡)'
                                }
                            },
                            x: {
                                title: {
                                    display: true,
                                    text: 'æœˆä»½'
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                display: true,
                                position: 'top'
                            }
                        }
                    }
                });
            }
            
            // ç”Ÿæˆä»·æ ¼å¯¹æ¯”åˆ†æå›¾è¡¨
            function generatePriceComparisonChart(result) {
                const ctx = document.getElementById('price-comparison-chart').getContext('2d');
                
                // æ¨¡æ‹Ÿä¸åŒæ¨¡å‹çš„ä¼°ä»·ç»“æœ
                const models = ['çº¿æ€§å›å½’', 'éšæœºæ£®æ—', 'é›†æˆæ¨¡å‹'];
                const prices = [
                    Math.round(result.estimated_price * 0.95),
                    Math.round(result.estimated_price * 1.02),
                    result.estimated_price
                ];
                
                const chartData = {
                    labels: models,
                    datasets: [{
                        label: 'ä¼°ä»·ç»“æœ (å…ƒ)',
                        data: prices,
                        backgroundColor: [
                            'rgba(102, 126, 234, 0.6)',
                            'rgba(82, 196, 26, 0.6)',
                            'rgba(250, 173, 20, 0.6)'
                        ],
                        borderColor: [
                            'rgba(102, 126, 234, 1)',
                            'rgba(82, 196, 26, 1)',
                            'rgba(250, 173, 20, 1)'
                        ],
                        borderWidth: 1
                    }]
                };
                
                new Chart(ctx, {
                    type: 'bar',
                    data: chartData,
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: false,
                                title: {
                                    display: true,
                                    text: 'ä¼°ä»·ç»“æœ (å…ƒ)'
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                display: false
                            }
                        }
                    }
                });
            }
            
            // ç”Ÿæˆå†å²ä¼°ä»·è¶‹åŠ¿å›¾è¡¨
            function generateValuationHistoryChart(result) {
                const ctx = document.getElementById('valuation-history-chart').getContext('2d');
                
                // æ¨¡æ‹Ÿå†å²ä¼°ä»·æ•°æ®
                const dates = ['2025-01', '2025-03', '2025-05', '2025-07', '2025-09', '2025-11', '2025-12'];
                const historicalPrices = [
                    Math.round(result.estimated_price * 0.85),
                    Math.round(result.estimated_price * 0.9),
                    Math.round(result.estimated_price * 0.92),
                    Math.round(result.estimated_price * 0.95),
                    Math.round(result.estimated_price * 0.98),
                    Math.round(result.estimated_price * 1.0),
                    result.estimated_price
                ];
                
                const chartData = {
                    labels: dates,
                    datasets: [{
                        label: 'å†å²ä¼°ä»· (ä¸‡å…ƒ)',
                        data: historicalPrices.map(price => Math.round(price / 10000)),
                        borderColor: 'rgba(245, 34, 45, 1)',
                        backgroundColor: 'rgba(245, 34, 45, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                };
                
                new Chart(ctx, {
                    type: 'line',
                    data: chartData,
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: false,
                                title: {
                                    display: true,
                                    text: 'ä¼°ä»· (ä¸‡å…ƒ)'
                                }
                            },
                            x: {
                                title: {
                                    display: true,
                                    text: 'æ—¥æœŸ'
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                display: true,
                                position: 'top'
                            }
                        }
                    }
                });
            }
        });
        
        // æ·»åŠ åŠ è½½åŠ¨ç”»æ ·å¼
        const style = document.createElement('style');
        style.textContent = `
            @keyframes spin {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>