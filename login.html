<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>ç™»å½• - ValuHub</title>
    <style>
        /* åŸºç¡€æ ·å¼ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            font-size: 14px;
            line-height: 1.5;
            color: #333;
            background-color: #f5f7fa;
        }

        /* å®¹å™¨æ ·å¼ */
        .container {
            max-width: 400px;
            margin: 50px auto;
            padding: 30px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        /* æ ‡é¢˜æ ·å¼ */
        .title {
            font-size: 24px;
            font-weight: bold;
            text-align: center;
            margin-bottom: 30px;
            color: #667eea;
        }

        /* è¡¨å•æ ·å¼ */
        .form {
            display: none;
        }

        .form.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #333;
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.1);
        }

        .form-group input.error {
            border-color: #ff4d4f;
        }

        /* å¯†ç æ˜¾ç¤º/éšè—åˆ‡æ¢ */
        .password-input-wrapper {
            position: relative;
        }

        .password-toggle {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            color: #999;
        }

        /* éªŒè¯ç æ ·å¼ */
        .captcha-group {
            display: flex;
            gap: 10px;
        }

        .captcha-input {
            flex: 1;
        }

        .captcha-image {
            width: 100px;
            height: 44px;
            background-color: #f0f0f0;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: bold;
            color: #333;
            letter-spacing: 3px;
        }

        /* æŒ‰é’®æ ·å¼ */
        .btn {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background-color: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background-color: #5568d3;
        }

        .btn-primary:disabled {
            background-color: #a5b1e8;
            cursor: not-allowed;
        }

        .btn-secondary {
            background-color: transparent;
            color: #667eea;
            border: 1px solid #667eea;
        }

        .btn-secondary:hover {
            background-color: rgba(102, 126, 234, 0.1);
        }

        /* é“¾æ¥æ ·å¼ */
        .links {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
            font-size: 14px;
        }

        .link {
            color: #667eea;
            text-decoration: none;
        }

        .link:hover {
            text-decoration: underline;
        }

        /* åˆ‡æ¢è¡¨å•é“¾æ¥ */
        .switch-form {
            text-align: center;
            margin-top: 20px;
            font-size: 14px;
        }

        .switch-form a {
            color: #667eea;
            text-decoration: none;
            font-weight: 500;
        }

        .switch-form a:hover {
            text-decoration: underline;
        }

        /* é”™è¯¯æç¤º */
        .error-message {
            color: #ff4d4f;
            font-size: 12px;
            margin-top: 5px;
        }

        /* åŠ è½½çŠ¶æ€ */
        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* å€’è®¡æ—¶æ ·å¼ */
        .countdown {
            color: #ff4d4f;
            font-size: 14px;
        }

        /* ç¡®ä¿logoå§‹ç»ˆæ­£ç¡®æ˜¾ç¤º */
        img[src="å›¾ç‰‡1.png"] {
            max-width: 80px !important;
            max-height: 80px !important;
            width: 80px !important;
            height: 80px !important;
            object-fit: contain !important;
            display: inline-block !important;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 480px) {
            .container {
                margin: 20px;
                padding: 20px;
            }

            .title {
                font-size: 20px;
            }

            .captcha-group {
                flex-direction: column;
            }

            .captcha-image {
                width: 100%;
                height: 44px;
            }
        }
    </style>









<style>
/* é€šç”¨ä¿®å¤æ ·å¼ - ç¡®ä¿æ–‡å­—æ¨ªå‘æ˜¾ç¤ºå’Œå¯¼èˆªæ å¢å¤§ */

/* æœ€é«˜ä¼˜å…ˆçº§ - ç¡®ä¿æ‰€æœ‰å…ƒç´ æ–‡å­—æ¨ªå‘æ˜¾ç¤º */
*,
*::before,
*::after {
    writing-mode: horizontal-tb !important;
    text-orientation: mixed !important;
    direction: ltr !important;
    /* åªç¡®ä¿æ–‡å­—æ¨ªå‘ï¼Œä¸å¼ºåˆ¶flexå¸ƒå±€ï¼Œè®©æ–‡æœ¬æ­£å¸¸æ¢è¡Œ */
}

/* ç¡®ä¿æ–‡æœ¬å…ƒç´ æ­£å¸¸æ˜¾ç¤ºç©ºæ ¼å’Œæ¢è¡Œ */
p,
span,
div,
th,
td,
li,
strong,
em,
ai,
button,
input,
textarea,
select,
label,
h1,
h2,
h3,
h4,
h5,
h6 {
    display: block !important;
    white-space: normal !important;
    word-break: normal !important;
    overflow-wrap: break-word !important;
}

/* ä¿®å¤LOGOæ–‡å­—ç«–å‘æ˜¾ç¤ºé—®é¢˜ */
.navbar-brand,
.logo {
    display: flex !important;
    align-items: center !important;
    gap: var(--spacing-2) !important;
    flex-direction: row !important;
    white-space: nowrap !important;
}

.navbar-brand img,
.logo img {
    display: inline-block !important;
    vertical-align: middle !important;
    max-width: 50px !important;
    max-height: 50px !important;
    width: 50px !important;
    height: 50px !important;
    object-fit: contain !important;
}

.navbar-brand span,
.navbar-brand a,
.logo span,
.logo a {
    display: inline-block !important;
    vertical-align: middle !important;
}

/* ç¡®ä¿å¯¼èˆªæ å’Œèœå•æ­£ç¡®æ˜¾ç¤º */
.navbar {
    height: 80px !important;
    padding: 16px 24px !important;
    min-height: 80px !important;
    display: flex !important;
    align-items: center !important;
    justify-content: space-between !important;
}

/* å¯¼èˆªèœå•æ ·å¼ */
.nav-menu {
    display: flex !important;
    flex-direction: row !important;
    align-items: center !important;
    gap: var(--spacing-4) !important;
}

.nav-menu a {
    display: inline-flex !important;
    align-items: center !important;
    justify-content: center !important;
    height: 80px !important;
    padding: 0 16px !important;
    font-size: 16px !important;
    line-height: 1 !important;
    text-decoration: none !important;
    color: inherit !important;
    white-space: nowrap !important;
}

/* å¯¼èˆªæŒ‰é’®æ ·å¼ */
.nav-menu .btn {
    display: inline-flex !important;
    align-items: center !important;
    justify-content: center !important;
    height: auto !important;
    min-height: 40px !important;
    padding: 8px 16px !important;
    font-size: 14px !important;
    line-height: 1 !important;
}

/* ç¡®ä¿å®¹å™¨å…ƒç´ æ¨ªå‘æ˜¾ç¤º */
.d-flex,
.align-items-center,
.justify-content-between,
.justify-content-center,
.hero-buttons,
.filter-group,
.filter-search-section,
.action-buttons,
.nav-actions,
.nav-left,
.nav-right,
.user-info,
.stat-header,
.score-item-header {
    display: flex !important;
    flex-direction: row !important;
}

/* ç§»åŠ¨ç«¯èœå•æŒ‰é’®æ ·å¼ */
.btn-text.d-lg-none {
    display: none !important;
}

/* ç¡®ä¿ç½‘æ ¼å¸ƒå±€æ­£å¸¸æ˜¾ç¤º */
.grid,
.grid-cols-4,
.grid-cols-3,
.grid-cols-2 {
    display: grid !important;
    flex-direction: initial !important;
}

/* ç¡®ä¿è¡¨æ ¼å¸ƒå±€æ­£å¸¸æ˜¾ç¤º */
table,
tr,
thead,
tbody,
th,
td {
    display: table !important;
    display: table-row !important;
    display: table-header-group !important;
    display: table-row-group !important;
    display: table-cell !important;
    flex-direction: initial !important;
}

/* ç¡®ä¿åˆ—è¡¨å¸ƒå±€æ­£å¸¸æ˜¾ç¤º */
ul,
ol,
li {
    display: list-item !important;
    flex-direction: initial !important;
}

/* ç¡®ä¿è¡¨å•å…ƒç´ æ­£å¸¸æ˜¾ç¤º */
input,
textarea,
select,
button {
    display: inline-block !important;
    flex-direction: initial !important;
}

/* ç¡®ä¿æ–‡æœ¬å†…å®¹æ­£å¸¸æ˜¾ç¤ºæ¢è¡Œå’Œç©ºæ ¼ */
.text-content,
.card-content,
.main-content,
.scoring-content,
.page-header,
.analysis-title,
.analysis-subtitle,
.chart-container,
.card,
.card-header,
.status-tag,
.score-display,
.pagination,
.pagination-info,
.score-detail-body,
.detail-section,
.detail-title,
.detail-item,
.detail-label,
.detail-value,
.score-item-name,
.score-item-weight,
.score-item-score,
.score-item-description,
.form-group,
.form-label {
    display: block !important;
    flex-direction: initial !important;
    white-space: normal !important;
    word-wrap: break-word !important;
    word-break: normal !important;
}
</style>
</head>
<body>
    <div class="container">
        <div style="text-align: center; margin-bottom: 20px;">
            <img src="å›¾ç‰‡1.png" alt="ValuHub Logo" style="width: 80px; height: 80px; object-fit: contain;">
        </div>
        <h1 class="title">ValuHubç™»å½•</h1>

        <!-- ç™»å½•è¡¨å• -->
        <form id="loginForm" class="form active">
            <div class="form-group">
                <label for="loginUsername">æ‰‹æœºå·</label>
                <input type="tel" id="loginUsername" name="phone" placeholder="è¯·è¾“å…¥æ‰‹æœºå·" required>
                <div class="error-message" id="loginUsernameError"></div>
            </div>

            <div class="form-group">
                <label for="loginPassword">å¯†ç </label>
                <div class="password-input-wrapper">
                    <input type="password" id="loginPassword" name="password" placeholder="è¯·è¾“å…¥å¯†ç " required>
                    <span class="password-toggle" onclick="togglePassword('loginPassword')">ğŸ‘ï¸</span>
                </div>
                <div class="error-message" id="loginPasswordError"></div>
            </div>

            <button type="submit" class="btn btn-primary" id="loginBtn">
                ç™»å½•
            </button>

            <div class="links">
                <a href="#" class="link" onclick="showForm('register')">æ³¨å†Œ</a>
                <a href="#" class="link" onclick="showForm('forgot')">å¿˜è®°å¯†ç </a>
            </div>
        </form>

        <!-- æ³¨å†Œè¡¨å• -->
        <form id="registerForm" class="form">
            <div class="form-group">
                <label for="registerPhone">æ‰‹æœºå·</label>
                <input type="tel" id="registerPhone" name="phone" placeholder="è¯·è¾“å…¥æ‰‹æœºå·" required>
                <div class="error-message" id="registerPhoneError"></div>
            </div>

            <div class="form-group captcha-group">
                <div style="flex: 1;">
                    <label for="registerCaptcha">å›¾å½¢éªŒè¯ç </label>
                    <input type="text" id="registerCaptcha" name="captcha" placeholder="è¯·è¾“å…¥å›¾å½¢éªŒè¯ç " class="captcha-input" required>
                    <div class="error-message" id="registerCaptchaError"></div>
                </div>
                <div>
                    <label>&nbsp;</label>
                    <div class="captcha-image" id="registerCaptchaImage" onclick="generateCaptcha('register')">ç‚¹å‡»åˆ·æ–°</div>
                </div>
            </div>

            <div class="form-group captcha-group">
                <div style="flex: 1;">
                    <label for="registerSmsCode">æ‰‹æœºéªŒè¯ç </label>
                    <input type="text" id="registerSmsCode" name="smsCode" placeholder="è¯·è¾“å…¥æ‰‹æœºéªŒè¯ç " class="captcha-input" required>
                    <div class="error-message" id="registerSmsCodeError"></div>
                </div>
                <div>
                    <label>&nbsp;</label>
                    <button type="button" class="btn btn-secondary" id="sendRegisterSms" onclick="sendSmsCode('register')">
                        è·å–éªŒè¯ç 
                    </button>
                </div>
            </div>

            <div class="form-group">
                <label for="registerPassword">è®¾ç½®å¯†ç </label>
                <div class="password-input-wrapper">
                    <input type="password" id="registerPassword" name="password" placeholder="è¯·è®¾ç½®å¯†ç " required>
                    <span class="password-toggle" onclick="togglePassword('registerPassword')">ğŸ‘ï¸</span>
                </div>
                <div class="error-message" id="registerPasswordError"></div>
            </div>

            <button type="submit" class="btn btn-primary" id="registerBtn">
                æ³¨å†Œ
            </button>

            <div class="switch-form">
                å·²æœ‰è´¦å·ï¼Ÿ<a href="#" onclick="showForm('login')">ç«‹å³ç™»å½•</a>
            </div>
        </form>

        <!-- å¿˜è®°å¯†ç è¡¨å• -->
        <form id="forgotForm" class="form">
            <div class="form-group">
                <label for="forgotPhone">æ‰‹æœºå·</label>
                <input type="tel" id="forgotPhone" name="phone" placeholder="è¯·è¾“å…¥æ‰‹æœºå·" required>
                <div class="error-message" id="forgotPhoneError"></div>
            </div>

            <div class="form-group captcha-group">
                <div style="flex: 1;">
                    <label for="forgotCaptcha">å›¾å½¢éªŒè¯ç </label>
                    <input type="text" id="forgotCaptcha" name="captcha" placeholder="è¯·è¾“å…¥å›¾å½¢éªŒè¯ç " class="captcha-input" required>
                    <div class="error-message" id="forgotCaptchaError"></div>
                </div>
                <div>
                    <label>&nbsp;</label>
                    <div class="captcha-image" id="forgotCaptchaImage" onclick="generateCaptcha('forgot')">ç‚¹å‡»åˆ·æ–°</div>
                </div>
            </div>

            <div class="form-group captcha-group">
                <div style="flex: 1;">
                    <label for="forgotSmsCode">æ‰‹æœºéªŒè¯ç </label>
                    <input type="text" id="forgotSmsCode" name="smsCode" placeholder="è¯·è¾“å…¥æ‰‹æœºéªŒè¯ç " class="captcha-input" required>
                    <div class="error-message" id="forgotSmsCodeError"></div>
                </div>
                <div>
                    <label>&nbsp;</label>
                    <button type="button" class="btn btn-secondary" id="sendForgotSms" onclick="sendSmsCode('forgot')">
                        è·å–éªŒè¯ç 
                    </button>
                </div>
            </div>

            <div class="form-group">
                <label for="newPassword">æ–°å¯†ç </label>
                <div class="password-input-wrapper">
                    <input type="password" id="newPassword" name="newPassword" placeholder="è¯·è®¾ç½®æ–°å¯†ç " required>
                    <span class="password-toggle" onclick="togglePassword('newPassword')">ğŸ‘ï¸</span>
                </div>
                <div class="error-message" id="newPasswordError"></div>
            </div>

            <div class="form-group">
                <label for="confirmPassword">ç¡®è®¤å¯†ç </label>
                <div class="password-input-wrapper">
                    <input type="password" id="confirmPassword" name="confirmPassword" placeholder="è¯·ç¡®è®¤æ–°å¯†ç " required>
                    <span class="password-toggle" onclick="togglePassword('confirmPassword')">ğŸ‘ï¸</span>
                </div>
                <div class="error-message" id="confirmPasswordError"></div>
            </div>

            <button type="submit" class="btn btn-primary" id="forgotBtn">
                é‡ç½®å¯†ç 
            </button>

            <div class="switch-form">
                è¿”å›ç™»å½•ï¼Ÿ<a href="#" onclick="showForm('login')">ç«‹å³ç™»å½•</a>
            </div>
        </form>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let currentCaptchas = {};
        let countdownTimers = {};

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            generateCaptcha('register');
            generateCaptcha('forgot');

            // è¡¨å•æäº¤äº‹ä»¶
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            document.getElementById('registerForm').addEventListener('submit', handleRegister);
            document.getElementById('forgotForm').addEventListener('submit', handleForgotPassword);
        });

        // åˆ‡æ¢è¡¨å•
        function showForm(formType) {
            // éšè—æ‰€æœ‰è¡¨å•
            document.querySelectorAll('.form').forEach(form => {
                form.classList.remove('active');
            });

            // æ˜¾ç¤ºæŒ‡å®šè¡¨å•
            document.getElementById(formType + 'Form').classList.add('active');
        }

        // åˆ‡æ¢å¯†ç æ˜¾ç¤º/éšè—
        function togglePassword(inputId) {
            const input = document.getElementById(inputId);
            const type = input.getAttribute('type');
            input.setAttribute('type', type === 'password' ? 'text' : 'password');
        }

        // ç”Ÿæˆå›¾å½¢éªŒè¯ç 
        function generateCaptcha(formType) {
            const chars = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz';
            let captcha = '';
            for (let i = 0; i < 4; i++) {
                captcha += chars.charAt(Math.floor(Math.random() * chars.length));
            }

            // ä¿å­˜éªŒè¯ç 
            currentCaptchas[formType] = captcha;

            // æ›´æ–°éªŒè¯ç å›¾ç‰‡
            const captchaImage = document.getElementById(formType + 'CaptchaImage');
            // ç”ŸæˆéšæœºèƒŒæ™¯è‰²
            const bgColor = `rgb(${Math.floor(Math.random() * 200 + 55)}, ${Math.floor(Math.random() * 200 + 55)}, ${Math.floor(Math.random() * 200 + 55)})`;
            captchaImage.style.backgroundColor = bgColor;
            captchaImage.textContent = captcha;
        }

        // å‘é€çŸ­ä¿¡éªŒè¯ç 
        function sendSmsCode(formType) {
            const phoneInput = document.getElementById(formType + 'Phone');
            const captchaInput = document.getElementById(formType + 'Captcha');
            const sendBtn = document.getElementById('send' + formType.charAt(0).toUpperCase() + formType.slice(1) + 'Sms');

            // éªŒè¯æ‰‹æœºå·
            if (!validatePhone(phoneInput.value)) {
                showError(formType + 'Phone', 'è¯·è¾“å…¥æ­£ç¡®çš„æ‰‹æœºå·');
                return;
            }

            // éªŒè¯å›¾å½¢éªŒè¯ç 
            if (captchaInput.value.toLowerCase() !== currentCaptchas[formType].toLowerCase()) {
                showError(formType + 'Captcha', 'å›¾å½¢éªŒè¯ç é”™è¯¯');
                generateCaptcha(formType);
                return;
            }

            // å¼€å§‹å€’è®¡æ—¶
            let countdown = 60;
            sendBtn.disabled = true;
            sendBtn.innerHTML = `${countdown}ç§’åé‡è¯•`;

            countdownTimers[formType] = setInterval(() => {
                countdown--;
                sendBtn.innerHTML = `${countdown}ç§’åé‡è¯•`;
                if (countdown <= 0) {
                    clearInterval(countdownTimers[formType]);
                    sendBtn.disabled = false;
                    sendBtn.innerHTML = 'è·å–éªŒè¯ç ';
                }
            }, 1000);

            // æ¨¡æ‹Ÿå‘é€çŸ­ä¿¡
            console.log('å‘é€çŸ­ä¿¡éªŒè¯ç åˆ°:', phoneInput.value);
        }

        // è¡¨å•éªŒè¯å‡½æ•°
        function validatePhone(phone) {
            const phoneRegex = /^1[3-9]\d{9}$/;
            return phoneRegex.test(phone);
        }

        function validateEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }

        function validatePassword(password) {
            return password.length >= 6;
        }

        // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
        function showError(fieldId, message) {
            const errorElement = document.getElementById(fieldId + 'Error');
            const inputElement = document.getElementById(fieldId);
            errorElement.textContent = message;
            inputElement.classList.add('error');
        }

        // æ¸…é™¤é”™è¯¯ä¿¡æ¯
        function clearError(fieldId) {
            const errorElement = document.getElementById(fieldId + 'Error');
            const inputElement = document.getElementById(fieldId);
            errorElement.textContent = '';
            inputElement.classList.remove('error');
        }

        // å¤„ç†ç™»å½•
        async function handleLogin(e) {
            e.preventDefault();

            const phone = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            const loginBtn = document.getElementById('loginBtn');

            // æ¸…é™¤ä¹‹å‰çš„é”™è¯¯
            clearError('loginUsername');
            clearError('loginPassword');

            // è¡¨å•éªŒè¯
            let isValid = true;

            if (!validatePhone(phone)) {
                showError('loginUsername', 'è¯·è¾“å…¥æ­£ç¡®çš„æ‰‹æœºå·');
                isValid = false;
            }

            if (!password) {
                showError('loginPassword', 'è¯·è¾“å…¥å¯†ç ');
                isValid = false;
            } else if (!validatePassword(password)) {
                showError('loginPassword', 'å¯†ç é•¿åº¦ä¸èƒ½å°‘äº6ä½');
                isValid = false;
            }

            if (!isValid) {
                return;
            }

            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            loginBtn.innerHTML = '<span class="loading"></span> ç™»å½•ä¸­...';
            loginBtn.disabled = true;

            try {
                // æ¨¡æ‹Ÿç™»å½•ï¼ˆå› ä¸ºåç«¯APIå¯èƒ½ä¸å­˜åœ¨ï¼‰
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // ç®€å•çš„æ¨¡æ‹ŸéªŒè¯ï¼ˆä½¿ç”¨ç”¨æˆ·æä¾›çš„æ‰‹æœºå·å’Œå¯†ç ï¼‰
                if (phone === '16680508457' && (password === '123456' || password === 'æµ‹è¯•äº†123456')) {
                    // ç™»å½•æˆåŠŸï¼Œå­˜å‚¨ç”¨æˆ·ä¿¡æ¯åˆ°localStorage
                    localStorage.setItem('userLoggedIn', 'true');
                    localStorage.setItem('userPhone', phone);
                    localStorage.setItem('userName', 'æµ‹è¯•ç”¨æˆ·');
                    
                    // é»˜è®¤è®¾ç½®ä¸ºæ™®é€šç‰ˆï¼Œä¸“ä¸šç‰ˆç”¨æˆ·å¯ä»¥é€šè¿‡å…¶ä»–æ–¹å¼åˆ‡æ¢
                    // è¿™é‡Œå¯ä»¥æ ¹æ®å®é™…éœ€æ±‚ä»åç«¯è·å–æˆ–è®©ç”¨æˆ·é€‰æ‹©
                    localStorage.setItem('userVersion', 'basic');
                    
                    // è·å–é‡å®šå‘URLï¼Œå¦‚æœæ²¡æœ‰åˆ™é»˜è®¤è·³è½¬åˆ°school.html
                    const urlParams = new URLSearchParams(window.location.search);
                    let redirectUrl = urlParams.get('redirect') || 'school.html';
                    
                    // ç§»é™¤file://åè®®å’Œç»å¯¹è·¯å¾„ï¼Œåªä¿ç•™ç›¸å¯¹è·¯å¾„
                    if (redirectUrl.startsWith('file://')) {
                        // ä»file://è·¯å¾„ä¸­æå–ç›¸å¯¹è·¯å¾„
                        const url = new URL(redirectUrl);
                        redirectUrl = url.pathname.split('/').pop();
                    }
                    
                    console.log('ç™»å½•æˆåŠŸï¼Œå‡†å¤‡è·³è½¬');
                    console.log('åŸå§‹é‡å®šå‘URL:', urlParams.get('redirect'));
                    console.log('å¤„ç†åçš„é‡å®šå‘URL:', redirectUrl);
                    
                    // é‡å®šå‘åˆ°æŒ‡å®šé¡µé¢
                    window.location.href = redirectUrl;
                } else {
                    throw new Error('æ‰‹æœºå·æˆ–å¯†ç é”™è¯¯');
                }
            } catch (error) {
                showError('loginPassword', error.message || 'ç™»å½•å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
            } finally {
                // æ¢å¤æŒ‰é’®çŠ¶æ€
                loginBtn.innerHTML = 'ç™»å½•';
                loginBtn.disabled = false;
            }
        }

        // å¤„ç†æ³¨å†Œ
        async function handleRegister(e) {
            e.preventDefault();

            const phone = document.getElementById('registerPhone').value;
            const captcha = document.getElementById('registerCaptcha').value;
            const smsCode = document.getElementById('registerSmsCode').value;
            const password = document.getElementById('registerPassword').value;
            const registerBtn = document.getElementById('registerBtn');

            // æ¸…é™¤ä¹‹å‰çš„é”™è¯¯
            clearError('registerPhone');
            clearError('registerCaptcha');
            clearError('registerSmsCode');
            clearError('registerPassword');

            // è¡¨å•éªŒè¯
            let isValid = true;

            if (!validatePhone(phone)) {
                showError('registerPhone', 'è¯·è¾“å…¥æ­£ç¡®çš„æ‰‹æœºå·');
                isValid = false;
            }

            if (captcha.toLowerCase() !== currentCaptchas['register'].toLowerCase()) {
                showError('registerCaptcha', 'å›¾å½¢éªŒè¯ç é”™è¯¯');
                isValid = false;
            }

            // è°ƒç”¨åç«¯APIæ³¨å†Œ
            if (!validatePassword(password)) {
                showError('registerPassword', 'å¯†ç é•¿åº¦ä¸èƒ½å°‘äº6ä½');
                isValid = false;
            }

            if (!isValid) {
                return;
            }

            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            registerBtn.innerHTML = '<span class="loading"></span> æ³¨å†Œä¸­...';
            registerBtn.disabled = true;

            try {
                // è°ƒç”¨åç«¯APIæ³¨å†Œ
                const response = await fetch('http://localhost:8000/api/v1/register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        phone: phone,
                        username: 'user_' + phone.slice(-4), // è‡ªåŠ¨ç”Ÿæˆç”¨æˆ·å
                        password: password
                    })
                });

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.detail || 'æ³¨å†Œå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
                }

                // æ³¨å†ŒæˆåŠŸååˆ‡æ¢åˆ°ç™»å½•è¡¨å•
                showForm('login');
            } catch (error) {
                showError('registerPhone', error.message || 'æ³¨å†Œå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
            } finally {
                // æ¢å¤æŒ‰é’®çŠ¶æ€
                registerBtn.innerHTML = 'æ³¨å†Œ';
                registerBtn.disabled = false;
            }
        }

        // å¤„ç†å¿˜è®°å¯†ç 
        async function handleForgotPassword(e) {
            e.preventDefault();

            const phone = document.getElementById('forgotPhone').value;
            const captcha = document.getElementById('forgotCaptcha').value;
            const smsCode = document.getElementById('forgotSmsCode').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const forgotBtn = document.getElementById('forgotBtn');

            // æ¸…é™¤ä¹‹å‰çš„é”™è¯¯
            clearError('forgotPhone');
            clearError('forgotCaptcha');
            clearError('forgotSmsCode');
            clearError('newPassword');
            clearError('confirmPassword');

            // è¡¨å•éªŒè¯
            let isValid = true;

            if (!validatePhone(phone)) {
                showError('forgotPhone', 'è¯·è¾“å…¥æ­£ç¡®çš„æ‰‹æœºå·');
                isValid = false;
            }

            if (captcha.toLowerCase() !== currentCaptchas['forgot'].toLowerCase()) {
                showError('forgotCaptcha', 'å›¾å½¢éªŒè¯ç é”™è¯¯');
                isValid = false;
            }

            if (!smsCode || smsCode.length !== 6) {
                showError('forgotSmsCode', 'è¯·è¾“å…¥6ä½éªŒè¯ç ');
                isValid = false;
            }

            if (!validatePassword(newPassword)) {
                showError('newPassword', 'å¯†ç é•¿åº¦ä¸èƒ½å°‘äº6ä½');
                isValid = false;
            }

            if (newPassword !== confirmPassword) {
                showError('confirmPassword', 'ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´');
                isValid = false;
            }

            if (!isValid) {
                return;
            }

            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            forgotBtn.innerHTML = '<span class="loading"></span> é‡ç½®ä¸­...';
            forgotBtn.disabled = true;

            try {
                // æ¨¡æ‹Ÿé‡ç½®å¯†ç è¯·æ±‚
                await new Promise(resolve => setTimeout(resolve, 1000));

                // é‡ç½®æˆåŠŸååˆ‡æ¢åˆ°ç™»å½•è¡¨å•
                showForm('login');
            } catch (error) {
                showError('forgotPhone', 'å¯†ç é‡ç½®å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
            } finally {
                // æ¢å¤æŒ‰é’®çŠ¶æ€
                forgotBtn.innerHTML = 'é‡ç½®å¯†ç ';
                forgotBtn.disabled = false;
            }
        }
    </script>
</body>
</html>