# 跨浏览器测试指南

本文档详细介绍了如何使用BrowserStack和LambdaTest进行跨浏览器兼容性测试，确保应用在各种浏览器和设备上的表现一致。

## 支持的平台

- **BrowserStack**: 支持3000+浏览器/操作系统组合
- **LambdaTest**: 提供自动化截图测试和视觉回归分析

## 环境准备

### 1. 安装依赖

```bash
# 安装测试依赖
npm install cypress lambdatest-screenshot --save-dev
```

### 2. 设置API凭证

在运行测试前，需要设置BrowserStack和LambdaTest的API凭证。

**Windows环境:**

```powershell
# BrowserStack凭证
set BROWSERSTACK_USERNAME=your_username
set BROWSERSTACK_ACCESS_KEY=your_access_key

# LambdaTest凭证
set LAMBDATEST_USERNAME=your_username
set LAMBDATEST_ACCESS_KEY=your_access_key
```

**Linux/Mac环境:**

```bash
# BrowserStack凭证
export BROWSERSTACK_USERNAME=your_username
export BROWSERSTACK_ACCESS_KEY=your_access_key

# LambdaTest凭证
export LAMBDATEST_USERNAME=your_username
export LAMBDATEST_ACCESS_KEY=your_access_key
```

## 运行测试

### 快速测试（推荐开发阶段使用）

快速测试使用精简的浏览器组合，适合日常开发和快速验证。

```bash
# BrowserStack快速测试
npm run test:browserstack:quick

# LambdaTest快速测试
npm run test:lambdatest:quick
```

### 完整测试（推荐发布前使用）

完整测试使用全面的浏览器组合，确保应用在各种环境下都能正常工作。

```bash
# BrowserStack完整测试
npm run test:browserstack

# LambdaTest完整测试
npm run test:lambdatest

# 运行所有平台测试
npm run test:all-browsers
```

### 手动运行Cypress测试

```bash
# 打开Cypress测试运行器
npm run test:cypress

# 以无头模式运行Cypress测试
npm run test:cypress:run
```

## 测试配置文件说明

### 1. cypress.config.js

主Cypress配置文件，集成了BrowserStack和LambdaTest的配置：

- 基础测试设置
- 环境变量配置
- 测试文件路径设置
- 浏览器支持配置

### 2. browserstack.config.js

BrowserStack专用配置，包含：

- 桌面浏览器配置（Chrome、Firefox、Safari、Edge等）
- 移动设备配置（iOS、Android）
- 企业级浏览器配置
- 特殊浏览器组合配置

### 3. lambdatest.config.js

LambdaTest自动化截图测试配置，包含：

- 要测试的URL列表
- 响应式截图尺寸设置
- 浏览器和设备组合配置
- 视觉回归测试设置

## 自定义测试

### 添加新的测试场景

在`cypress/e2e/`目录下创建新的测试文件，使用Cypress测试语法：

```javascript
describe('自定义测试场景', () => {
  it('测试特定功能', () => {
    cy.visit('/your-page');
    // 添加测试断言
  });
});
```

### 修改浏览器配置

如需调整测试的浏览器组合，可以编辑以下文件：

- `browserstack.config.js`: 修改浏览器版本和设备列表
- `lambdatest.config.js`: 修改截图尺寸和测试URL

## 测试报告

测试完成后，报告将生成在`test-reports`目录下：

- 测试结果JSON文件
- 截图对比报告（LambdaTest）
- 失败测试详情

## 最佳实践

1. **开发阶段**：使用快速测试模式验证基本兼容性
2. **发布前**：运行完整测试确保全面兼容性
3. **定期执行**：设置CI/CD流水线，定期运行跨浏览器测试
4. **关注视觉回归**：使用LambdaTest的截图对比功能，及早发现UI问题
5. **优先测试关键流程**：确保核心用户流程在所有浏览器中正常工作

## 故障排除

### 常见问题

1. **测试超时**：检查网络连接，增加`waitTime`配置
2. **环境变量错误**：确保正确设置了API凭证
3. **本地开发环境访问**：确保启用了tunnel配置，允许测试服务访问本地开发服务器
4. **依赖安装失败**：尝试使用`npm install`重新安装依赖

### 联系支持

- **BrowserStack支持**: https://www.browserstack.com/support
- **LambdaTest支持**: https://www.lambdatest.com/support

## 注意事项

- 运行完整测试可能需要较长时间，建议在非工作时间执行
- 某些测试可能会产生费用，请注意控制测试频率和范围
- 定期更新测试配置，以覆盖最新的浏览器版本和设备

---

本指南将帮助开发团队确保应用在各种浏览器环境中的一致性和兼容性，提升用户体验。
