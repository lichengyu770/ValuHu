# 房产数据管理系统 - 数据库设计

## 1. 数据库概述

本文档详细描述房产数据管理系统的数据库结构设计，包括各数据表的结构、字段定义、关系说明等。系统采用关系型数据库设计，确保数据完整性和一致性。

## 2. 数据库表结构

### 2.1 用户表 (users)

| 字段名       | 数据类型       | 约束                                                    | 描述                       |
| :----------- | :------------- | :------------------------------------------------------ | :------------------------- |
| `id`         | `INT`          | `PRIMARY KEY AUTO_INCREMENT`                            | 用户ID                     |
| `username`   | `VARCHAR(50)`  | `UNIQUE NOT NULL`                                       | 用户名                     |
| `password`   | `VARCHAR(255)` | `NOT NULL`                                              | 密码（加密存储）           |
| `role`       | `VARCHAR(20)`  | `NOT NULL`                                              | 用户角色（admin/user）     |
| `status`     | `TINYINT`      | `DEFAULT 1`                                             | 用户状态（1:启用, 0:禁用） |
| `created_at` | `TIMESTAMP`    | `DEFAULT CURRENT_TIMESTAMP`                             | 创建时间                   |
| `updated_at` | `TIMESTAMP`    | `DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP` | 更新时间                   |

### 2.2 房产信息表 (properties)

| 字段名              | 数据类型        | 约束                                                    | 描述           |
| :------------------ | :-------------- | :------------------------------------------------------ | :------------- |
| `id`                | `INT`           | `PRIMARY KEY AUTO_INCREMENT`                            | 房产ID         |
| `property_code`     | `VARCHAR(30)`   | `UNIQUE NOT NULL`                                       | 房产编码       |
| `property_name`     | `VARCHAR(200)`  | `NOT NULL`                                              | 房产名称       |
| `location`          | `VARCHAR(255)`  | `NOT NULL`                                              | 地理位置       |
| `area`              | `DECIMAL(10,2)` | `NOT NULL`                                              | 面积（平方米） |
| `type`              | `VARCHAR(50)`   | `NOT NULL`                                              | 房产类型       |
| `construction_year` | `INT`           |                                                         | 建造年份       |
| `description`       | `TEXT`          |                                                         | 房产描述       |
| `status`            | `VARCHAR(20)`   | `DEFAULT 'active'`                                      | 状态           |
| `created_at`        | `TIMESTAMP`     | `DEFAULT CURRENT_TIMESTAMP`                             | 创建时间       |
| `updated_at`        | `TIMESTAMP`     | `DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP` | 更新时间       |

### 2.3 房产评估表 (property_evaluations)

| 字段名             | 数据类型        | 约束                                    | 描述                      |
| :----------------- | :-------------- | :-------------------------------------- | :------------------------ |
| `id`               | `INT`           | `PRIMARY KEY AUTO_INCREMENT`            | 评估记录ID                |
| `property_id`      | `INT`           | `FOREIGN KEY REFERENCES properties(id)` | 房产ID                    |
| `evaluation_type`  | `VARCHAR(50)`   | `NOT NULL`                              | 评估类型（GIS/收益/综合） |
| `evaluation_value` | `DECIMAL(15,2)` | `NOT NULL`                              | 评估价值                  |
| `evaluation_date`  | `DATE`          | `NOT NULL`                              | 评估日期                  |
| `evaluator`        | `VARCHAR(100)`  |                                         | 评估人                    |
| `methodology`      | `TEXT`          |                                         | 评估方法说明              |
| `report_url`       | `VARCHAR(255)`  |                                         | 评估报告文件路径          |
| `created_by`       | `INT`           | `FOREIGN KEY REFERENCES users(id)`      | 创建人ID                  |
| `created_at`       | `TIMESTAMP`     | `DEFAULT CURRENT_TIMESTAMP`             | 创建时间                  |

### 2.4 电子证书表 (electronic_certs)

| 字段名               | 数据类型       | 约束                                                    | 描述         |
| :------------------- | :------------- | :------------------------------------------------------ | :----------- |
| `id`                 | `INT`          | `PRIMARY KEY AUTO_INCREMENT`                            | 证书ID       |
| `certificate_number` | `VARCHAR(100)` | `UNIQUE NOT NULL`                                       | 证书编号     |
| `property_id`        | `INT`          | `FOREIGN KEY REFERENCES properties(id)`                 | 房产ID       |
| `certificate_type`   | `VARCHAR(50)`  | `NOT NULL`                                              | 证书类型     |
| `issue_date`         | `DATE`         | `NOT NULL`                                              | 颁发日期     |
| `expiry_date`        | `DATE`         |                                                         | 到期日期     |
| `issuing_authority`  | `VARCHAR(200)` |                                                         | 颁发机构     |
| `status`             | `VARCHAR(20)`  | `DEFAULT 'valid'`                                       | 证书状态     |
| `cert_file_url`      | `VARCHAR(255)` |                                                         | 证书文件路径 |
| `created_by`         | `INT`          | `FOREIGN KEY REFERENCES users(id)`                      | 创建人ID     |
| `created_at`         | `TIMESTAMP`    | `DEFAULT CURRENT_TIMESTAMP`                             | 创建时间     |
| `updated_at`         | `TIMESTAMP`    | `DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP` | 更新时间     |

### 2.5 操作日志表 (operation_logs)

| 字段名           | 数据类型       | 约束                               | 描述                                          |
| :--------------- | :------------- | :--------------------------------- | :-------------------------------------------- |
| `id`             | `BIGINT`       | `PRIMARY KEY AUTO_INCREMENT`       | 日志ID                                        |
| `user_id`        | `INT`          | `FOREIGN KEY REFERENCES users(id)` | 操作用户ID                                    |
| `username`       | `VARCHAR(50)`  | `NOT NULL`                         | 操作用户名                                    |
| `operation_type` | `VARCHAR(50)`  | `NOT NULL`                         | 操作类型（login/logout/create/update/delete） |
| `entity_type`    | `VARCHAR(50)`  |                                    | 操作实体类型                                  |
| `entity_id`      | `VARCHAR(100)` |                                    | 操作实体ID                                    |
| `operation_desc` | `TEXT`         |                                    | 操作描述                                      |
| `ip_address`     | `VARCHAR(50)`  |                                    | 客户端IP地址                                  |
| `user_agent`     | `TEXT`         |                                    | 客户端浏览器信息                              |
| `created_at`     | `TIMESTAMP`    | `DEFAULT CURRENT_TIMESTAMP`        | 操作时间                                      |

### 2.6 系统监控表 (system_monitor)

| 字段名         | 数据类型        | 约束                         | 描述       |
| :------------- | :-------------- | :--------------------------- | :--------- |
| `id`           | `BIGINT`        | `PRIMARY KEY AUTO_INCREMENT` | 监控记录ID |
| `metric_name`  | `VARCHAR(100)`  | `NOT NULL`                   | 指标名称   |
| `metric_value` | `DECIMAL(20,4)` | `NOT NULL`                   | 指标值     |
| `metric_unit`  | `VARCHAR(20)`   |                              | 指标单位   |
| `monitor_time` | `TIMESTAMP`     | `DEFAULT CURRENT_TIMESTAMP`  | 监控时间   |
| `server_name`  | `VARCHAR(100)`  |                              | 服务器名称 |

### 2.7 系统配置表 (system_configs)

| 字段名         | 数据类型       | 约束                                                    | 描述     |
| :------------- | :------------- | :------------------------------------------------------ | :------- |
| `id`           | `INT`          | `PRIMARY KEY AUTO_INCREMENT`                            | 配置ID   |
| `config_key`   | `VARCHAR(100)` | `UNIQUE NOT NULL`                                       | 配置键   |
| `config_value` | `TEXT`         | `NOT NULL`                                              | 配置值   |
| `config_desc`  | `VARCHAR(255)` |                                                         | 配置描述 |
| `created_at`   | `TIMESTAMP`    | `DEFAULT CURRENT_TIMESTAMP`                             | 创建时间 |
| `updated_at`   | `TIMESTAMP`    | `DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP` | 更新时间 |

## 3. 表关系图

```
+----------------+     +------------------+
|     users      |     |  properties      |
+----------------+     +------------------+
| id             |     | id               |
| username       |     | property_code    |
| password       |     | property_name    |
| role           |     | location         |
| status         |     | area             |
+----------------+     | type             |
        |              | construction_year|
        |              | ...              |
        |              +------------------+
        |                     |
        |                     v
        |              +------------------+
        |              |property_evaluations|
        |              +------------------+
        |              | id               |
        |              | property_id      |
        |              | evaluation_type  |
        |              | evaluation_value |
        |              | created_by       |
        |              +------------------+
        |                     |
        |                     v
        |              +------------------+
        |              | electronic_certs |
        |              +------------------+
        |              | id               |
        |              | certificate_number|
        |              | property_id      |
        |              | created_by       |
        |              +------------------+
        |
        v
+------------------+
|  operation_logs  |
+------------------+
| id               |
| user_id          |
| username         |
| operation_type   |
| entity_type      |
| entity_id        |
| ip_address       |
+------------------+
```

## 4. 索引设计

为提高查询性能，在以下字段上建立索引：

1. **users表**
   - `username` (UNIQUE INDEX)
   - `role` (INDEX)

2. **properties表**
   - `property_code` (UNIQUE INDEX)
   - `location` (INDEX)
   - `type` (INDEX)

3. **property_evaluations表**
   - `property_id` (INDEX)
   - `evaluation_type` (INDEX)
   - `evaluation_date` (INDEX)

4. **electronic_certs表**
   - `certificate_number` (UNIQUE INDEX)
   - `property_id` (INDEX)
   - `issue_date` (INDEX)

5. **operation_logs表**
   - `user_id` (INDEX)
   - `operation_type` (INDEX)
   - `created_at` (INDEX)

6. **system_monitor表**
   - `metric_name` (INDEX)
   - `monitor_time` (INDEX)

## 5. 数据安全设计

### 5.1 敏感数据保护

- 用户密码采用加盐哈希存储，不可逆
- 敏感配置信息加密存储
- 定期数据备份策略

### 5.2 数据完整性

- 通过外键约束维护表间关系完整性
- 关键字段设置NOT NULL约束
- 使用事务确保数据操作的原子性

### 5.3 数据库访问控制

- 最小权限原则配置数据库用户
- 定期审查数据库访问权限
- 记录数据库访问日志

## 6. 数据库优化考虑

### 6.1 查询优化

- 为常用查询建立适当索引
- 避免在大数据量表上进行全表扫描
- 优化复杂查询语句

### 6.2 分表分库策略（未来扩展）

- 操作日志表可按时间范围进行分表
- 系统监控表可按时间和服务器进行分表
- 房产数据量过大时可考虑按地区进行分库
