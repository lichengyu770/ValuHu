<!doctype html>
<html lang="zh-CN">
  <head>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>智能估价流程 - 数智估价核心引擎 - ValuHub</title>
    <!-- 引入图标库 -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <!-- 引入共享样式 -->
    <link rel="stylesheet" href="shared.css" />
    <!-- 页面特定样式 -->
    <style>
      /* 基础样式 */
      :root {
        --color-primary: #1a73e8;
        --color-primary-light: #4285f4;
        --color-secondary: #f9a825;
        --color-secondary-light: #ffb74d;
        --color-success: #4caf50;
        --color-background: #f5f7fa;
        --color-white: #ffffff;
        --color-text: #1d2129;
        --color-text-light: #666;
        --color-border: #dcdfe6;
        --border-radius: 8px;
        --box-shadow: 0 4px 12px rgba(26, 115, 232, 0.15);
        --transition: transform 0.3s, box-shadow 0.3s, color 0.3s;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: 'Roboto', '思源黑体', sans-serif;
      }
      body {
        background-color: var(--color-white);
        color: var(--color-text);
      }
      .container {
        width: 100%;
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 20px;
      }

      /* 按钮样式 */
      .btn {
        padding: 12px 24px;
        border-radius: var(--border-radius);
        border: none;
        cursor: pointer;
        transition: var(--transition);
        font-weight: 500;
        font-size: 14px;
      }

      .btn-primary {
        background: linear-gradient(
          135deg,
          var(--color-primary),
          var(--color-primary-light)
        );
        color: white;
      }

      .btn-primary:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 15px rgba(26, 115, 232, 0.4);
      }

      .btn-secondary {
        background: white;
        color: var(--color-primary);
        border: 1px solid var(--color-primary);
      }

      .btn-secondary:hover {
        background: var(--color-primary);
        color: white;
      }

      /* 页面结构 */
      .hero {
        margin-top: 65px;
        height: 200px;
        background: linear-gradient(
          135deg,
          var(--color-primary),
          var(--color-primary-light)
        );
        display: flex;
        align-items: center;
        justify-content: center;
        text-align: center;
        color: white;
      }

      .hero h1 {
        font-size: 32px;
        margin-bottom: 10px;
      }

      .hero p {
        font-size: 16px;
        opacity: 0.9;
      }

      /* 主内容区 */
      .main-content {
        padding: 40px 0;
      }

      /* 步骤导航 */
      .steps-nav {
        display: flex;
        justify-content: center;
        margin-bottom: 40px;
      }

      .step {
        display: flex;
        align-items: center;
        font-size: 14px;
        color: var(--color-text-light);
      }

      .step.active {
        color: var(--color-primary);
        font-weight: 500;
      }

      .step-number {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        background: var(--color-border);
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 10px;
        transition: all 0.3s ease;
      }

      .step.active .step-number {
        background: var(--color-primary);
        color: white;
      }

      .step-line {
        width: 40px;
        height: 2px;
        background: var(--color-border);
        margin: 0 10px;
      }

      .step.active .step-line {
        background: var(--color-primary);
      }

      /* 估价阶段标题 */
      .stage-title {
        text-align: center;
        margin-bottom: 30px;
      }

      .stage-title h2 {
        font-size: 24px;
        color: var(--color-primary);
        margin-bottom: 10px;
      }

      .stage-title p {
        font-size: 14px;
        color: var(--color-text-light);
      }

      /* 关键词选择区域 */
      .keyword-section {
        background: white;
        padding: 40px;
        border-radius: var(--border-radius);
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        max-width: 800px;
        margin: 0 auto 30px;
      }

      .keyword-section h2 {
        font-size: 20px;
        color: var(--color-primary);
        margin-bottom: 20px;
        text-align: center;
      }

      .keyword-input-group {
        display: flex;
        gap: 15px;
        margin-bottom: 30px;
      }

      .keyword-input {
        flex: 1;
        padding: 12px 20px;
        border: 2px solid var(--color-border);
        border-radius: var(--border-radius);
        font-size: 16px;
        transition: border-color 0.3s;
      }

      .keyword-input:focus {
        outline: none;
        border-color: var(--color-primary);
        box-shadow: 0 0 0 2px rgba(26, 115, 232, 0.1);
      }

      /* 关键词标签 */
      .keywords-container {
        margin: 20px 0;
      }

      .keywords-title {
        font-size: 14px;
        color: var(--color-text-light);
        margin-bottom: 15px;
      }

      .keyword-tags {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
      }

      .keyword-tag {
        padding: 8px 16px;
        background: #f0f4f8;
        color: var(--color-primary);
        border-radius: 20px;
        font-size: 14px;
        cursor: pointer;
        transition: all 0.3s ease;
        border: 1px solid var(--color-border);
      }

      .keyword-tag:hover {
        background: var(--color-primary);
        color: white;
        transform: translateY(-1px);
      }

      .keyword-tag.selected {
        background: var(--color-primary);
        color: white;
      }

      /* 估价结果区域 */
      .result-section {
        background: white;
        padding: 40px;
        border-radius: var(--border-radius);
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        max-width: 800px;
        margin: 0 auto 30px;
        text-align: center;
      }

      .result-icon {
        font-size: 64px;
        color: var(--color-success);
        margin-bottom: 20px;
      }

      .result-title {
        font-size: 24px;
        color: var(--color-primary);
        margin-bottom: 10px;
      }

      .result-value {
        font-size: 48px;
        font-weight: bold;
        color: var(--color-primary);
        margin: 20px 0;
      }

      .result-value span {
        font-size: 16px;
        font-weight: normal;
        color: var(--color-text-light);
      }

      .result-details {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 20px;
        margin: 30px 0;
      }

      .result-detail-item {
        background: #f8f9fa;
        padding: 20px;
        border-radius: var(--border-radius);
      }

      .result-detail-item h3 {
        font-size: 14px;
        color: var(--color-text-light);
        margin-bottom: 5px;
      }

      .result-detail-item p {
        font-size: 18px;
        color: var(--color-primary);
        font-weight: 500;
      }

      /* 二次估价按钮 */
      .secondary-valuation-btn {
        margin-top: 30px;
        padding: 12px 30px;
        font-size: 16px;
      }

      /* 估价选项区域 */
      .valuation-options {
        background: white;
        padding: 40px;
        border-radius: var(--border-radius);
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        max-width: 800px;
        margin: 0 auto 30px;
      }

      .valuation-options h2 {
        font-size: 20px;
        color: var(--color-primary);
        margin-bottom: 30px;
        text-align: center;
      }

      .options-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .option-card {
        padding: 30px 20px;
        border: 2px solid var(--color-border);
        border-radius: var(--border-radius);
        text-align: center;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .option-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      }

      .option-card.selected {
        border-color: var(--color-primary);
        background: linear-gradient(135deg, #f0f4f8, #e2e8f0);
      }

      .option-price {
        font-size: 28px;
        font-weight: bold;
        color: var(--color-primary);
        margin-bottom: 10px;
      }

      .option-price span {
        font-size: 14px;
        font-weight: normal;
      }

      .option-title {
        font-size: 16px;
        font-weight: 500;
        margin-bottom: 15px;
        color: var(--color-text);
      }

      .option-features {
        list-style: none;
        margin-bottom: 20px;
      }

      .option-features li {
        font-size: 12px;
        color: var(--color-text-light);
        margin-bottom: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .option-features li::before {
        content: '✓';
        color: var(--color-success);
        margin-right: 5px;
      }

      /* 表单区域 */
      .form-section {
        background: white;
        padding: 40px;
        border-radius: var(--border-radius);
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        max-width: 800px;
        margin: 0 auto 30px;
      }

      .form-section h2 {
        font-size: 20px;
        color: var(--color-primary);
        margin-bottom: 30px;
        text-align: center;
      }

      .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-bottom: 20px;
      }

      .form-group {
        margin-bottom: 20px;
      }

      .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 500;
        font-size: 14px;
      }

      .form-input {
        width: 100%;
        padding: 12px 20px;
        border: 2px solid var(--color-border);
        border-radius: var(--border-radius);
        font-size: 14px;
        transition: border-color 0.3s;
      }

      .form-input:focus {
        outline: none;
        border-color: var(--color-primary);
        box-shadow: 0 0 0 2px rgba(26, 115, 232, 0.1);
      }

      .form-textarea {
        width: 100%;
        padding: 12px 20px;
        border: 2px solid var(--color-border);
        border-radius: var(--border-radius);
        font-size: 14px;
        resize: vertical;
        min-height: 120px;
        transition: border-color 0.3s;
      }

      .form-textarea:focus {
        outline: none;
        border-color: var(--color-primary);
        box-shadow: 0 0 0 2px rgba(26, 115, 232, 0.1);
      }

      /* 样本模态框样式 */
      .sample-modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0, 0, 0, 0.4);
      }

      .sample-modal-content {
        background-color: #fefefe;
        margin: 15% auto;
        padding: 20px;
        border: 1px solid #888;
        width: 80%;
        max-width: 600px;
        border-radius: var(--border-radius);
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
      }

      .sample-modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
      }

      .sample-modal-title {
        font-size: 20px;
        color: var(--color-primary);
        margin: 0;
      }

      .close-modal {
        color: #aaa;
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
      }

      .close-modal:hover,
      .close-modal:focus {
        color: black;
        text-decoration: none;
        cursor: pointer;
      }

      .sample-content {
        width: 100%;
        min-height: 200px;
        padding: 15px;
        border: 1px solid var(--color-border);
        border-radius: var(--border-radius);
        font-family: monospace;
        font-size: 14px;
        resize: vertical;
        margin-bottom: 20px;
      }

      .sample-actions {
        display: flex;
        justify-content: flex-end;
        gap: 10px;
      }

      /* 高级报告可视化区域样式 */
      .advanced-visualization-section {
        margin-top: 40px;
        padding-top: 30px;
        border-top: 1px solid var(--color-border);
      }

      .visualization-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .visualization-item {
        border: 1px solid var(--color-border);
        border-radius: var(--border-radius);
        overflow: hidden;
        transition: all 0.3s ease;
        background: white;
      }

      .visualization-item:hover {
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      }

      .visualization-item.locked {
        position: relative;
        opacity: 0.8;
      }

      .visualization-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 20px;
        background: linear-gradient(
          135deg,
          var(--color-primary),
          var(--color-primary-light)
        );
        color: white;
      }

      .visualization-header h4 {
        margin: 0;
        font-size: 16px;
        font-weight: 500;
      }

      .lock-icon {
        font-size: 14px;
        opacity: 0.8;
        cursor: pointer;
        transition: opacity 0.3s ease;
      }

      .lock-icon:hover {
        opacity: 1;
      }

      .lock-icon i {
        font-size: 16px;
      }

      .visualization-placeholder {
        padding: 30px 20px;
        text-align: center;
        min-height: 120px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
      }

      .visualization-placeholder i {
        font-size: 32px;
        color: var(--color-primary);
        margin-bottom: 10px;
        opacity: 0.7;
      }

      .visualization-placeholder p {
        margin: 0;
        font-size: 14px;
        color: var(--color-text-light);
        line-height: 1.5;
      }

      .locked-message {
        text-align: center;
        padding: 20px;
        background: #f8f9fa;
        border-radius: var(--border-radius);
        border: 1px dashed var(--color-border);
      }

      .locked-message p {
        margin-bottom: 15px;
        color: var(--color-text-light);
        font-size: 14px;
      }
    
        img[src="图片1.png"] {
            max-width: 45px !important;
            max-height: 45px !important;
            width: 45px !important;
            height: 45px !important;
            object-fit: contain !important;
            display: inline-block !important;
        }
    </style>
  








<style>
/* 通用修复样式 - 确保文字横向显示和导航栏增大 */

/* 最高优先级 - 确保所有元素文字横向显示 */
*,
*::before,
*::after {
    writing-mode: horizontal-tb !important;
    text-orientation: mixed !important;
    direction: ltr !important;
    /* 只确保文字横向，不强制flex布局，让文本正常换行 */
}

/* 确保文本元素正常显示空格和换行 */
p,
span,
div,
th,
td,
li,
strong,
em,
ai,
button,
input,
textarea,
select,
label,
h1,
h2,
h3,
h4,
h5,
h6 {
    display: block !important;
    white-space: normal !important;
    word-break: normal !important;
    overflow-wrap: break-word !important;
}

/* 修复LOGO文字竖向显示问题 */
.navbar-brand,
.logo {
    display: flex !important;
    align-items: center !important;
    gap: var(--spacing-2) !important;
    flex-direction: row !important;
    white-space: nowrap !important;
}

.navbar-brand img,
.logo img {
    display: inline-block !important;
    vertical-align: middle !important;
    max-width: 50px !important;
    max-height: 50px !important;
    width: 50px !important;
    height: 50px !important;
    object-fit: contain !important;
}

.navbar-brand span,
.navbar-brand a,
.logo span,
.logo a {
    display: inline-block !important;
    vertical-align: middle !important;
}

/* 确保导航栏和菜单正确显示 */
.navbar {
    height: 80px !important;
    padding: 16px 24px !important;
    min-height: 80px !important;
    display: flex !important;
    align-items: center !important;
    justify-content: space-between !important;
}

/* 导航菜单样式 */
.nav-menu {
    display: flex !important;
    flex-direction: row !important;
    align-items: center !important;
    gap: var(--spacing-4) !important;
}

.nav-menu a {
    display: inline-flex !important;
    align-items: center !important;
    justify-content: center !important;
    height: 80px !important;
    padding: 0 16px !important;
    font-size: 16px !important;
    line-height: 1 !important;
    text-decoration: none !important;
    color: inherit !important;
    white-space: nowrap !important;
}

/* 导航按钮样式 */
.nav-menu .btn {
    display: inline-flex !important;
    align-items: center !important;
    justify-content: center !important;
    height: auto !important;
    min-height: 40px !important;
    padding: 8px 16px !important;
    font-size: 14px !important;
    line-height: 1 !important;
}

/* 确保容器元素横向显示 */
.d-flex,
.align-items-center,
.justify-content-between,
.justify-content-center,
.hero-buttons,
.filter-group,
.filter-search-section,
.action-buttons,
.nav-actions,
.nav-left,
.nav-right,
.user-info,
.stat-header,
.score-item-header {
    display: flex !important;
    flex-direction: row !important;
}

/* 移动端菜单按钮样式 */
.btn-text.d-lg-none {
    display: none !important;
}

/* 确保网格布局正常显示 */
.grid,
.grid-cols-4,
.grid-cols-3,
.grid-cols-2 {
    display: grid !important;
    flex-direction: initial !important;
}

/* 确保表格布局正常显示 */
table,
tr,
thead,
tbody,
th,
td {
    display: table !important;
    display: table-row !important;
    display: table-header-group !important;
    display: table-row-group !important;
    display: table-cell !important;
    flex-direction: initial !important;
}

/* 确保列表布局正常显示 */
ul,
ol,
li {
    display: list-item !important;
    flex-direction: initial !important;
}

/* 确保表单元素正常显示 */
input,
textarea,
select,
button {
    display: inline-block !important;
    flex-direction: initial !important;
}

/* 确保文本内容正常显示换行和空格 */
.text-content,
.card-content,
.main-content,
.scoring-content,
.page-header,
.analysis-title,
.analysis-subtitle,
.chart-container,
.card,
.card-header,
.status-tag,
.score-display,
.pagination,
.pagination-info,
.score-detail-body,
.detail-section,
.detail-title,
.detail-item,
.detail-label,
.detail-value,
.score-item-name,
.score-item-weight,
.score-item-score,
.score-item-description,
.form-group,
.form-label {
    display: block !important;
    flex-direction: initial !important;
    white-space: normal !important;
    word-wrap: break-word !important;
    word-break: normal !important;
}
</style>
</head>
  <body>
    <!-- 导航栏 -->
    <div id="navbar"></div>

    <!-- 页面内容 -->
    <main>
      <!-- 封面区 -->
      <section class="hero">
        <div class="container">
          <h1>智能估价流程</h1>
          <p>简单几步，快速获取精准估价结果</p>
        </div>
      </section>

      <!-- 主内容区 -->
      <section class="main-content">
        <div class="container">
          <!-- 步骤导航 -->
          <div class="steps-nav">
            <div class="step active">
              <span>关键词输入</span>
              <div class="step-number">1</div>
              <div class="step-line"></div>
            </div>
            <div class="step">
              <div class="step-number">2</div>
              <div class="step-line"></div>
              <span>估价结果</span>
            </div>
            <div class="step">
              <div class="step-number">3</div>
              <div class="step-line"></div>
              <span>选择服务</span>
            </div>
            <div class="step">
              <div class="step-number">4</div>
              <span>表单提交</span>
            </div>
          </div>

          <!-- 关键词输入区域 -->
          <div id="keywordStage" class="stage">
            <div class="keyword-section">
              <h2>步骤1：输入估价关键词</h2>
              <div class="keyword-input-group">
                <input
                  type="text"
                  id="keywordInput"
                  class="keyword-input"
                  placeholder="请输入房产地址或关键词，例如：北京朝阳区"
                />
                <button id="startValuationBtn" class="btn btn-primary">
                  开始估价
                </button>
              </div>

              <!-- 推荐关键词标签 -->
              <div class="keywords-container">
                <div class="keywords-title">推荐关键词</div>
                <div class="keyword-tags">
                  <span class="keyword-tag">北京朝阳区</span>
                  <span class="keyword-tag">上海浦东新区</span>
                  <span class="keyword-tag">广州天河区</span>
                  <span class="keyword-tag">深圳南山区</span>
                  <span class="keyword-tag">杭州西湖区</span>
                  <span class="keyword-tag">成都高新区</span>
                </div>
              </div>
            </div>
          </div>

          <!-- 估价结果区域 -->
          <div id="resultStage" class="stage" style="display: none">
            <div class="result-section">
              <div class="result-icon">
                <i class="fas fa-chart-line"></i>
              </div>
              <h2 class="result-title">估价完成</h2>
              <div class="result-value">
                ¥<span id="valuationAmount">1,500,000</span> <span>/ 套</span>
              </div>
              <div class="result-details">
                <div class="result-detail-item">
                  <h3>建筑类型</h3>
                  <p id="buildingType">住宅</p>
                </div>
                <div class="result-detail-item">
                  <h3>建筑面积</h3>
                  <p id="buildingArea">100 ㎡</p>
                </div>
                <div class="result-detail-item">
                  <h3>估价方法</h3>
                  <p id="valuationMethod">市场比较法</p>
                </div>
              </div>

              <!-- 高级报告可视化区域（带锁） -->
              <div class="advanced-visualization-section">
                <h3 style="margin-bottom: 20px; color: var(--color-primary)">
                  高级报告可视化
                </h3>

                <div class="visualization-grid">
                  <!-- 小区区位图 -->
                  <div class="visualization-item locked">
                    <div class="visualization-header">
                      <h4>小区区位图</h4>
                      <span class="lock-icon" title="需要登录或付费查看">
                        <i class="fas fa-lock"></i>
                      </span>
                    </div>
                    <div class="visualization-placeholder">
                      <i class="fas fa-map-marked-alt"></i>
                      <p>小区地理位置与周边配套设施分布</p>
                    </div>
                  </div>

                  <!-- 楼栋分布图 -->
                  <div class="visualization-item locked">
                    <div class="visualization-header">
                      <h4>楼栋分布图</h4>
                      <span class="lock-icon" title="需要登录或付费查看">
                        <i class="fas fa-lock"></i>
                      </span>
                    </div>
                    <div class="visualization-placeholder">
                      <i class="fas fa-building"></i>
                      <p>小区内各楼栋位置与布局</p>
                    </div>
                  </div>

                  <!-- 价格曲线趋势折线图 -->
                  <div class="visualization-item locked">
                    <div class="visualization-header">
                      <h4>价格趋势折线图</h4>
                      <span class="lock-icon" title="需要登录或付费查看">
                        <i class="fas fa-lock"></i>
                      </span>
                    </div>
                    <div class="visualization-placeholder">
                      <i class="fas fa-chart-line"></i>
                      <p>近12个月房价走势分析</p>
                    </div>
                  </div>

                  <!-- 热力图可视化 -->
                  <div class="visualization-item locked">
                    <div class="visualization-header">
                      <h4>热力图可视化</h4>
                      <span class="lock-icon" title="需要登录或付费查看">
                        <i class="fas fa-lock"></i>
                      </span>
                    </div>
                    <div class="visualization-placeholder">
                      <i class="fas fa-fire"></i>
                      <p>区域房价热力分布</p>
                    </div>
                  </div>
                </div>

                <div class="locked-message">
                  <p>
                    上述高级可视化内容仅对<span
                      style="color: var(--color-primary)"
                      >高级估价服务</span
                    >用户开放
                  </p>
                  <button
                    class="btn btn-primary"
                    onclick="
                      document.getElementById('resultStage').style.display =
                        'none';
                      document.getElementById('optionsStage').style.display =
                        'block';
                    "
                  >
                    升级为高级估价
                  </button>
                </div>
              </div>
              <button id="nextToOptionsBtn" class="btn btn-primary">
                选择服务方案
              </button>
            </div>
          </div>

          <!-- 估价选项区域 -->
          <div id="optionsStage" class="stage" style="display: none">
            <div class="valuation-options">
              <h2>步骤3：选择服务方案</h2>
              <div class="options-grid">
                <div class="option-card" data-option="basic">
                  <div class="option-price">¥99 <span>/ 次</span></div>
                  <div class="option-title">基础估价</div>
                  <ul class="option-features">
                    <li>基础估价报告</li>
                    <li>市场比较数据</li>
                    <li>7天有效期</li>
                    <li>标准服务支持</li>
                  </ul>
                  <button class="btn btn-primary">选择</button>
                </div>
                <div class="option-card" data-option="standard">
                  <div class="option-price">¥199 <span>/ 次</span></div>
                  <div class="option-title">标准估价</div>
                  <ul class="option-features">
                    <li>详细估价报告</li>
                    <li>多维度分析</li>
                    <li>30天有效期</li>
                    <li>优先服务支持</li>
                  </ul>
                  <button class="btn btn-primary">选择</button>
                </div>
                <div class="option-card" data-option="premium">
                  <div class="option-price">¥499 <span>/ 次</span></div>
                  <div class="option-title">高级估价</div>
                  <ul class="option-features">
                    <li>专业估价报告</li>
                    <li>深度市场分析</li>
                    <li>90天有效期</li>
                    <li>专属客服支持</li>
                    <li>专家咨询服务</li>
                  </ul>
                  <button class="btn btn-primary">选择</button>
                </div>
              </div>
              <div style="text-align: center">
                <button id="nextToFormBtn" class="btn btn-primary">
                  提交表单
                </button>
              </div>
            </div>
          </div>

          <!-- 表单提交区域 -->
          <div id="formStage" class="stage" style="display: none">
            <div class="form-section">
              <h2>步骤4：填写联系信息</h2>
              <form id="valuationForm">
                <div class="form-row">
                  <div class="form-group">
                    <label for="name">姓名 *</label>
                    <input
                      type="text"
                      id="name"
                      name="name"
                      class="form-input"
                      required
                    />
                  </div>
                  <div class="form-group">
                    <label for="phone">电话 *</label>
                    <input
                      type="tel"
                      id="phone"
                      name="phone"
                      class="form-input"
                      required
                    />
                  </div>
                </div>
                <div class="form-row">
                  <div class="form-group">
                    <label for="email">邮箱 *</label>
                    <input
                      type="email"
                      id="email"
                      name="email"
                      class="form-input"
                      required
                    />
                  </div>
                  <div class="form-group">
                    <label for="company">公司</label>
                    <input
                      type="text"
                      id="company"
                      name="company"
                      class="form-input"
                    />
                  </div>
                </div>
                <div class="form-group">
                  <label for="address">房产地址 *</label>
                  <input
                    type="text"
                    id="address"
                    name="address"
                    class="form-input"
                    required
                  />
                </div>
                <div class="form-group">
                  <label for="message">备注信息</label>
                  <textarea
                    id="message"
                    name="message"
                    class="form-textarea"
                    rows="4"
                  ></textarea>
                </div>
                <div style="text-align: center">
                  <button type="submit" class="btn btn-primary">
                    提交表单
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </section>
    </main>

    <!-- 样本模态框 -->
    <div id="sampleModal" class="sample-modal">
      <div class="sample-modal-content">
        <div class="sample-modal-header">
          <h3 class="sample-modal-title">估价表单样本</h3>
          <span class="close-modal" id="closeSampleModal">&times;</span>
        </div>
        <textarea id="sampleContent" class="sample-content" readonly></textarea>
        <div class="sample-actions">
          <button id="copySampleBtn" class="btn btn-secondary">复制样本</button>
          <button id="closeModalBtn" class="btn btn-primary">关闭</button>
        </div>
      </div>
    </div>

    <!-- 引入共享脚本 -->
    <script src="shared.js"></script>

    <!-- 页面脚本 -->
    <script>
      // 表单提交服务类（简化版，完整版本在src/services/FormSubmissionService.js）
      class FormSubmissionService {
        constructor() {
          this.archivedData = JSON.parse(
            localStorage.getItem('formSubmissionArchive') || '[]'
          );
        }

        // 生成唯一ID
        generateId(prefix = 'submission') {
          return `${prefix}-${Date.now()}-${Math.floor(Math.random() * 1000)}`;
        }

        // 验证邮箱格式
        validateEmail(email) {
          const emailRegex = /^[^s@]+@[^s@]+.[^s@]+$/;
          return emailRegex.test(email);
        }

        // 验证必填字段
        validateRequired(value) {
          return (
            value !== undefined &&
            value !== null &&
            value.toString().trim() !== ''
          );
        }

        // 规范化表单数据
        normalizeFormData(formData) {
          const normalizedData = {};
          for (const field in formData) {
            if (formData.hasOwnProperty(field)) {
              normalizedData[field] =
                typeof formData[field] === 'string'
                  ? formData[field].trim()
                  : formData[field];
            }
          }

          const now = new Date();
          return {
            ...normalizedData,
            submissionId: this.generateId('submission'),
            submissionDate: now.toISOString(),
            formattedDate: now.toLocaleString('zh-CN'),
            status: 'pending',
            emailSent: false,
          };
        }

        // 生成标准样本格式
        generateStandardSample(normalizedData) {
          const sampleTemplate =
            `--- 客户估价表单提交样本 ---
` +
            `提交ID: ${normalizedData.submissionId}
` +
            `提交时间: ${normalizedData.formattedDate}
` +
            `--- 基本信息 ---
` +
            `姓名: ${normalizedData.name || '未填写'}
` +
            `电话: ${normalizedData.phone || '未填写'}
` +
            `邮箱: ${normalizedData.email || '未填写'}
` +
            `公司: ${normalizedData.company || '未填写'}
` +
            `房产地址: ${normalizedData.address || '未填写'}
` +
            `--- 估价信息 ---
` +
            `建筑类型: ${normalizedData.buildingType || '未填写'}
` +
            `建筑面积: ${normalizedData.buildingArea || '未填写'}
` +
            `估价金额: ${normalizedData.valuationAmount || '未填写'}
` +
            `估价方法: ${normalizedData.valuationMethod || '未填写'}
` +
            `--- 备注信息 ---
` +
            `${normalizedData.message || '未填写'}
` +
            `--- 附加信息 ---
` +
            `状态: ${normalizedData.status}
` +
            `邮件发送状态: ${normalizedData.emailSent ? '已发送' : '未发送'}
` +
            `--- 样本结束 ---`;

          return sampleTemplate;
        }

        // 归档表单数据
        archiveFormData(normalizedData) {
          // 生成标准样本
          const standardSample = this.generateStandardSample(normalizedData);

          // 添加样本到数据中
          const archivedItem = {
            ...normalizedData,
            standardSample,
          };

          // 保存到归档列表
          this.archivedData.unshift(archivedItem);
          localStorage.setItem(
            'formSubmissionArchive',
            JSON.stringify(this.archivedData)
          );

          return archivedItem;
        }

        // 发送邮件（模拟实现）
        async sendEmail(archivedItem, recipient) {
          try {
            // 模拟邮件发送延迟
            await new Promise((resolve) => setTimeout(resolve, 1000));

            // 构建邮件内容
            const emailContent = {
              to: recipient,
              subject: `客户估价表单提交 - ${archivedItem.submissionId}`,
              body: `尊敬的收件人：

您收到了一份新的客户估价表单提交，详情如下：

${archivedItem.standardSample}

请及时处理。

此致，
估价系统`,
            };

            // 模拟发送成功
            console.log('[邮件发送模拟] 邮件已发送:', {
              recipient: emailContent.to,
              subject: emailContent.subject,
              content: emailContent.body,
            });

            // 更新归档数据状态
            archivedItem.emailSent = true;
            archivedItem.status = 'completed';
            this.saveArchivedData();

            return true;
          } catch (error) {
            console.error('发送邮件失败:', error);
            // 更新归档数据状态
            archivedItem.status = 'failed';
            this.saveArchivedData();
            throw new Error('邮件发送失败');
          }
        }

        // 保存归档数据
        saveArchivedData() {
          localStorage.setItem(
            'formSubmissionArchive',
            JSON.stringify(this.archivedData)
          );
        }

        // 表单提交主流程
        async submitForm(formData, recipient = 'lichengyu@fangsuanyun.cn') {
          try {
            // 1. 验证表单数据
            if (!this.validateRequired(formData.name)) {
              throw new Error('姓名不能为空');
            }
            if (!this.validateRequired(formData.phone)) {
              throw new Error('电话不能为空');
            }
            if (!this.validateRequired(formData.email)) {
              throw new Error('邮箱不能为空');
            }
            if (!this.validateEmail(formData.email)) {
              throw new Error('邮箱格式不正确');
            }
            if (!this.validateRequired(formData.address)) {
              throw new Error('房产地址不能为空');
            }

            // 2. 规范化表单数据
            const normalizedData = this.normalizeFormData(formData);

            // 3. 归档表单数据
            const archivedItem = this.archiveFormData(normalizedData);

            // 4. 发送邮件
            await this.sendEmail(archivedItem, recipient);

            return {
              success: true,
              message: '表单提交成功，邮件已发送',
              data: archivedItem,
            };
          } catch (error) {
            console.error('表单提交错误:', error);
            return {
              success: false,
              message: error.message,
              data: null,
            };
          }
        }
      }

      // 初始化表单提交服务
      const formSubmissionService = new FormSubmissionService();

      // 显示样本模态框
      function showSampleModal(sampleText) {
        const sampleModal = document.getElementById('sampleModal');
        const sampleContent = document.getElementById('sampleContent');
        sampleContent.value = sampleText;
        sampleModal.style.display = 'block';
        document.body.style.overflow = 'hidden';
      }

      // 关闭样本模态框
      function closeSampleModal() {
        const sampleModal = document.getElementById('sampleModal');
        sampleModal.style.display = 'none';
        document.body.style.overflow = 'auto';
      }

      // 复制样本到剪贴板
      function copySampleToClipboard() {
        const sampleContent = document.getElementById('sampleContent');
        sampleContent.select();
        sampleContent.setSelectionRange(0, 99999); // 兼容移动设备
        document.execCommand('copy');
        alert('样本已复制到剪贴板');
      }

      // 页面加载完成后初始化
      document.addEventListener('DOMContentLoaded', function () {
        // 加载导航栏
        fetch('nav-template.html')
          .then((response) => response.text())
          .then((data) => {
            document.getElementById('navbar').innerHTML = data;
          })
          .catch((error) => console.error('加载导航栏失败:', error));

        // 步骤1：开始估价按钮
        const startValuationBtn = document.getElementById('startValuationBtn');
        startValuationBtn.addEventListener('click', function () {
          const keywordInput = document.getElementById('keywordInput');
          if (keywordInput.value.trim() === '') {
            alert('请输入关键词');
            return;
          }

          // 切换到结果页面
          document.getElementById('keywordStage').style.display = 'none';
          document.getElementById('resultStage').style.display = 'block';

          // 更新步骤导航
          const steps = document.querySelectorAll('.step');
          steps[0].classList.remove('active');
          steps[1].classList.add('active');
        });

        // 步骤2：选择服务方案按钮
        const nextToOptionsBtn = document.getElementById('nextToOptionsBtn');
        nextToOptionsBtn.addEventListener('click', function () {
          // 切换到选项页面
          document.getElementById('resultStage').style.display = 'none';
          document.getElementById('optionsStage').style.display = 'block';

          // 更新步骤导航
          const steps = document.querySelectorAll('.step');
          steps[1].classList.remove('active');
          steps[2].classList.add('active');
        });

        // 服务选项选择
        const optionCards = document.querySelectorAll('.option-card');
        optionCards.forEach((card) => {
          card.addEventListener('click', function () {
            // 移除其他选中状态
            optionCards.forEach((c) => c.classList.remove('selected'));
            // 添加当前选中状态
            this.classList.add('selected');
          });
        });

        // 步骤3：提交表单按钮
        const nextToFormBtn = document.getElementById('nextToFormBtn');
        nextToFormBtn.addEventListener('click', function () {
          // 检查是否选择了服务
          const selectedCard = document.querySelector('.option-card.selected');
          if (!selectedCard) {
            alert('请选择服务方案');
            return;
          }

          // 切换到表单页面
          document.getElementById('optionsStage').style.display = 'none';
          document.getElementById('formStage').style.display = 'block';

          // 更新步骤导航
          const steps = document.querySelectorAll('.step');
          steps[2].classList.remove('active');
          steps[3].classList.add('active');
        });

        // 步骤4：表单提交处理
        const valuationForm = document.getElementById('valuationForm');
        valuationForm.addEventListener('submit', async function (e) {
          e.preventDefault();

          // 收集表单数据
          const formData = {
            name: document.getElementById('name').value,
            phone: document.getElementById('phone').value,
            email: document.getElementById('email').value,
            company: document.getElementById('company').value,
            address: document.getElementById('address').value,
            message: document.getElementById('message').value,
            // 添加估价相关信息
            buildingType: document.getElementById('buildingType').textContent,
            buildingArea: document.getElementById('buildingArea').textContent,
            valuationAmount:
              document.getElementById('valuationAmount').textContent,
            valuationMethod:
              document.getElementById('valuationMethod').textContent,
          };

          try {
            // 使用表单提交服务处理表单
            const result = await formSubmissionService.submitForm(
              formData,
              'lichengyu@fangsuanyun.cn'
            );

            if (result.success) {
              alert(result.message);
              // 显示样本模态框
              showSampleModal(result.data.standardSample);
              // 重置表单
              valuationForm.reset();
            } else {
              alert(result.message);
            }
          } catch (error) {
            console.error('表单提交错误:', error);
            alert('消息发送失败，请稍后重试。');
          }
        });

        // 关键词标签点击处理
        const keywordTags = document.querySelectorAll('.keyword-tag');
        keywordTags.forEach((tag) => {
          tag.addEventListener('click', function () {
            document.getElementById('keywordInput').value = this.textContent;
          });
        });

        // 模态框事件处理
        document
          .getElementById('closeSampleModal')
          .addEventListener('click', closeSampleModal);
        document
          .getElementById('closeModalBtn')
          .addEventListener('click', closeSampleModal);
        document
          .getElementById('copySampleBtn')
          .addEventListener('click', copySampleToClipboard);

        // 点击外部关闭模态框
        window.onclick = function (event) {
          const sampleModal = document.getElementById('sampleModal');
          if (event.target === sampleModal) {
            closeSampleModal();
          }
        };
      });
    </script>
  </body>
</html>
